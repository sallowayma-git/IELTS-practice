<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¯å¾„å®Œæ•´æ€§æ£€æŸ¥å™¨æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.danger {
            background: #dc3545;
        }
        .button.danger:hover {
            background: #c82333;
        }
        .results {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ddd;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }
        .url-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        .section {
            margin-bottom: 30px;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” è·¯å¾„å®Œæ•´æ€§æ£€æŸ¥å™¨</h1>

    <div class="container">
        <h2>è¯´æ˜</h2>
        <div class="info">
            <p>æ­¤å·¥å…·ç”¨äºæ£€æŸ¥HTMLæ–‡ä»¶ä¸­çš„è„šæœ¬å¼•ç”¨æ˜¯å¦æœ‰æ•ˆï¼Œè¾“å‡ºPASS/FAILæŠ¥å‘Šã€‚</p>
            <p>æ”¯æŒæ£€æŸ¥å½“å‰é¡µé¢æˆ–æŒ‡å®šçš„URLåˆ—è¡¨ã€‚</p>
        </div>
    </div>

    <div class="container">
        <h2>æ£€æŸ¥é€‰é¡¹</h2>

        <div class="section">
            <h3>é€‰é¡¹ 1: æ£€æŸ¥å½“å‰é¡µé¢</h3>
            <p>æ£€æŸ¥å½“å‰HTMLé¡µé¢ä¸­çš„æ‰€æœ‰è„šæœ¬å¼•ç”¨ã€‚</p>
            <button class="button" onclick="checkCurrentPage()">æ£€æŸ¥å½“å‰é¡µé¢</button>
        </div>

        <div class="section">
            <h3>é€‰é¡¹ 2: æ£€æŸ¥æŒ‡å®šURL</h3>
            <p>è¾“å…¥è¦æ£€æŸ¥çš„HTMLæ–‡ä»¶URLï¼Œæ¯è¡Œä¸€ä¸ªï¼š</p>
            <textarea class="url-input" id="urlList" rows="6" placeholder="ä¾‹å¦‚ï¼š
index.html
test_file_protocol.html
.superdesign/design_iterations/ielts_academic_functional_2.html"></textarea>
            <button class="button" onclick="checkUrls()">æ£€æŸ¥æŒ‡å®šURL</button>
            <button class="button danger" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>

        <div class="section">
            <h3>é€‰é¡¹ 3: æ£€æŸ¥é»˜è®¤é¡µé¢</h3>
            <p>æ£€æŸ¥å¸¸ç”¨çš„HTMLé¡µé¢ï¼š</p>
            <button class="button" onclick="checkDefaultPages()">æ£€æŸ¥é»˜è®¤é¡µé¢</button>
        </div>
    </div>

    <div class="container">
        <h2>æ£€æŸ¥ç»“æœ</h2>
        <div class="results" id="results">ç­‰å¾…æ£€æŸ¥...</div>
    </div>

    <!-- åŠ è½½è·¯å¾„å®Œæ•´æ€§æ£€æŸ¥å™¨ -->
    <script src="tests/path-integrity-checker.js"></script>

    <script>
        // ä¿å­˜åŸå§‹console.logä»¥æ•è·è¾“å‡º
        const originalConsoleLog = console.log;
        let logOutput = '';

        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            logOutput += args.join(' ') + '\n';
            updateResults();
        };

        function updateResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent = logOutput;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function clearResults() {
            logOutput = '';
            updateResults();
        }

        async function checkCurrentPage() {
            clearResults();
            console.log('ğŸš€ å¼€å§‹æ£€æŸ¥å½“å‰é¡µé¢...');

            try {
                await runPathIntegrityCheck();
                console.log('\nâœ… å½“å‰é¡µé¢æ£€æŸ¥å®Œæˆ');
            } catch (error) {
                console.log(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }

        async function checkUrls() {
            const urlList = document.getElementById('urlList').value.trim();

            if (!urlList) {
                alert('è¯·è¾“å…¥è¦æ£€æŸ¥çš„URLåˆ—è¡¨');
                return;
            }

            const urls = urlList.split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0);

            if (urls.length === 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„URL');
                return;
            }

            clearResults();
            console.log(`ğŸš€ å¼€å§‹æ£€æŸ¥ ${urls.length} ä¸ªæŒ‡å®šURL...`);
            console.log('URLåˆ—è¡¨:');
            urls.forEach(url => console.log(`  - ${url}`));

            try {
                await runPathIntegrityCheck(urls);
                console.log('\nâœ… æŒ‡å®šURLæ£€æŸ¥å®Œæˆ');
            } catch (error) {
                console.log(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }

        async function checkDefaultPages() {
            const defaultUrls = [
                'index.html',
                'test_file_protocol.html',
                '.superdesign/design_iterations/ielts_academic_functional_2.html',
                '.superdesign/design_iterations/HP/practice.html',
                '.superdesign/design_iterations/my_melody_ielts_1.html'
            ];

            // è®¾ç½®URLåˆ—è¡¨åˆ°è¾“å…¥æ¡†
            document.getElementById('urlList').value = defaultUrls.join('\n');

            // è‡ªåŠ¨å¼€å§‹æ£€æŸ¥
            await checkUrls();
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… è·¯å¾„å®Œæ•´æ€§æ£€æŸ¥å™¨æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('é€‰æ‹©ä¸€ä¸ªæ£€æŸ¥é€‰é¡¹å¼€å§‹æµ‹è¯•');
        });
    </script>
</body>
</html>