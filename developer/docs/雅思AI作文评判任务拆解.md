# 雅思AI作文评判应用任务拆解文档

> 基于《雅思AI作文评判应用完整需求文档》（含桥接补充与双轨存储说明）生成。条目按需求章节逐条映射，便于后续设计与开发阶段追踪。所有需求变更需先在需求文档记录，再同步此文档。

## 总览

- **阶段划分**：沿用需求文档的能力分层（写作模块、后端服务、Legacy 整合、桌面发行、体验与安全）。每阶段内按需求章节拆分任务。
- **标识说明**：`[R6.3]` 表示来源于需求文档第 6.3 节；`[P1]` 表示建议在 Phase 1 完成。勾选框用于迭代跟踪。
- **产出要求**：每个任务需具备代码、测试、文档三项交付（除非标注“调研”）。

---

## Phase 0 — 基建与调研 (支持 R2 / R6 前置条件)

**✅ 状态更新 (2025-10-04)**: Phase 0 基础设施搭建已完成

- [✓] **P0-1 仓库与流程基线** `[R2.2]` `[已完成]`
  - ✅ 初始化目录结构（ielts-writing-assistant/, src/, server/, electron/, docs/）。
  - ✅ 设定项目架构和模块划分。
  - ✅ 交付：`README.md`、`.gitignore`、基础配置文件。

- [✓] **P0-2 环境与依赖管理** `[R2.1]` `[已完成]`
  - ✅ 配置 Node 20 版本，创建 `.nvmrc`。
  - ✅ 配置 Vue 3、Element Plus、Express、better-sqlite3、Electron 等基础依赖。
  - ✅ 交付：工作区 `package.json`、`vite.config.js`、构建脚本。

- [✓] **P0-3 基础应用框架** `[新增]` `[已完成]`
  - ✅ 创建 Vue 3 应用入口和路由配置。
  - ✅ 完成 5 个主要视图组件（首页、写作、评测、历史、设置）。
  - ✅ 搭建 Element Plus UI 框架集成。

- [✓] **P0-4 Electron 桌面应用** `[新增]` `[已完成]`
  - ✅ 创建 Electron 主进程和预加载脚本。
  - ✅ 配置应用菜单和 IPC 通信。
  - ✅ 设置打包构建配置。

- [✓] **P0-5 Express 后端服务** `[新增]` `[已完成]`
  - ✅ 搭建 Express 服务器和 SQLite 数据库。
  - ✅ 完成核心 API 路由模块（写作、评估、历史、设置）。
  - ✅ 实现数据库初始化和基础 CRUD 操作。

- [ ] **P0-6 CI/CD 验证** `[R6.9.4]` `[待实现]`
  - 配置 GitHub Actions（或其他）运行 Lint、测试空跑、打包占位。
  - 输出流水线日志模板与失败回溯说明。

- [ ] **P0-7 技术 Spike** `[R6.7.2][R6.3]` `[待实现]`
  - 验证 SSE + Electron（流式响应）可行性。
  - 验证真实 AI API 集成方案。

- [✓] **P0-8 项目架构确认** `[已完成]`
  - ✅ 确认新项目与现有Web端分离架构
  - ✅ 明确技术栈：Vue 3 + Electron + SQLite + AI评判
  - ✅ 输出项目分析报告和实施策略
  - ✅ 交付：`10-04 log.md` 分析文档

**Phase 0 总结**: 基础设施搭建完成，项目具备完整的开发、构建和运行能力。  
  - 比较 BrowserView vs iframe 实现 LegacyWrapper，输出降级策略建议。  
  - 研究 keytar/钥匙串 API 可用性与权限。  
  - 交付：技术评估报告。

---

## Phase 1 — 写作模块基础能力 (覆盖需求第 3 章、4 章、6.3~6.6)

### 数据层与服务

- [ ] **P1-1 数据库结构实现** `[R3.1][R3.2]`  
  - 创建 SQLite schema：`users`, `api_configs`, `drafts`, `essay_topics`, `writing_evaluations`, `evaluation_items`, `evaluation_feedback`, `writing_history_views`。  
  - 搭建 migrations 机制，含版本表、迁移 CLI。  
  - 单元测试：字段校验、外键约束。

- [ ] **P1-2 LLM 服务抽象** `[R4.1][R4.2]`  
  - 实现 `llm.service.js`：统一请求签名、供应商切换、提示词模板、速率限制与超时。  
  - 定义错误分类（网络、鉴权、配额、内容限制），返回标准化错误码。  
  - 模拟器/Mock 供前端开发。

- [ ] **P1-3 SSE 评分流** `[R4.1.2][R6.3.5]`  
  - Express 路由 `POST /api/evaluations/stream`，输出阶段事件（`queued`、`partial`、`completed`、`error`）。  
  - 实现服务器端事件缓存、断线重试。  
  - 记录请求日志（用于调试和溯源）。

- [ ] **P1-4 API 配置管理** `[R4.4][R6.5.2]`  
  - CRUD 路由（列出、创建、更新、删除），支持多供应商、多密钥。  
  - SQL 约束：唯一名称、启用状态。  
  - 与 Pinia store 对接的 JSON 接口。

### 前端写作体验

- [ ] **P1-5 Vue 应用框架搭建** `[R6.1]`  
  - 初始化 Vue 3 + Router + Pinia + Element Plus 骨架。  
  - 配置主题、全局布局、导航框架（写作/历史/设置）。

- [ ] **P1-6 Compose 编辑器与草稿** `[R6.3.2][R6.3.4]`  
  - Tiptap 编辑器封装：Task 选择、字数统计、模板插入。  
  - 草稿自动保存（Pinia + drafts 表 + local fallback）。  
  - UI：评分按钮、进度条、Toast。

- [ ] **P1-7 评分结果展示** `[R6.3.5][R6.3.6]`  
  - 雷达图（ECharts）、分项评分列表、系统提示文本。  
  - SSE 订阅 Hook (`useSSE`)，处理 partial → final 渲染。  
  - 错误提示、重试按钮。

- [ ] **P1-8 历史记录视图 (基础)** `[R6.4.1][R6.4.2]`  
  - 列表、分页、筛选（Task 类型、日期、评分区间）。  
  - 详情页展示评分细节、AI 建议文本。  
  - 导出 Markdown（与需求 6.4.4 对齐）。

- [ ] **P1-9 题目库管理 (写作 Task)** `[R6.5.1][R6.5.3]`  
  - CRUD 接口：新增题目、标签、类别。  
  - 前端 Topic Manage 页面、导入导出（CSV/JSON）。

- [ ] **P1-10 设置页面（初版）** `[R6.5]`  
  - API 配置列表、默认供应商选择、主题/语言占位。  
  - 表单校验与保存反馈。

---

## Phase 2 — 写作模块增强、安全与体验优化 (需求 6.3 深化、6.9 性能、6.8 多语言)

- [✓] **P2-1 语法错误标注 Pipeline** `[R6.3.7]` `[2025-10-04 完成]`
  - ✅ 扩展 LLM 提示词，拆分错误类型（语法、词汇、结构、标点、风格）。
  - ✅ 数据结构：`evaluation_annotations` 表保存错误定位，支持用户反馈。
  - ✅ 前端高亮渲染、侧栏错误列表、采纳/忽略操作。
  - ✅ 集成到AssessmentView，支持实时语法检查和标注管理。

- [✓] **P2-2 评分对比与趋势分析** `[R6.4.3]` `[2025-10-04 完成]`
  - ✅ 多次评分选择对比、雷达图叠加（ECharts实现）。
  - ✅ 趋势图：时间序列（平均得分、子项得分）。
  - ✅ 集成到HistoryView，支持自定义日期范围筛选。
  - ✅ 详细对比表格和统计数据展示。

- [✓] **P2-3 导出增强与备份** `[R6.4.4]` `[2025-10-04 完成]`
  - ✅ CSV导出严格按需求6.4.4字段顺序：提交时间、题目类型、题目标题、字数、总分、Task Achievement、Coherence & Cohesion、Lexical Resource、Grammatical Range、模型名称。
  - ✅ 文件名格式：`ielts-history-{日期}.csv`。
  - ✅ 导出当前筛选结果，支持批量导出与导入校验。
  - ✅ JSON完整导出（包含评分、错误标注、题目信息）。

- [ ] **P2-4 API 配置安全** `[R6.5.2][7.6]`  
  - Electron 主进程 + keytar 存储密钥，桥接接口 `secrets:*`。  
  - 设置页密钥操作日志，错误码反馈。

- [ ] **P2-5 评分队列与重试** `[7.6]`  
  - 本地队列（SQLite）记录待执行评分任务。  
  - 网络检测、失败重试、手动重放 UI。  
  - 队列状态可视化。

- [ ] **P2-6 多语言支持** `[R6.8]`  
  - 完成 zh-CN/en 语言包；首启语言检测。  
  - LLM 提示词添加语言指令；切换后刷新提示。  
  - 文案审校、RTL 兼容性确认（如需）。

- [ ] **P2-7 性能优化基线** `[R6.9]`  
  - 历史列表虚拟滚动、图片懒加载。  
  - 数据库索引优化、缓存策略（统计 30 秒缓存）。  
  - 性能监控脚本（可选）。

---

## Phase 3 — Legacy 系统整合 (需求 6.7 与 7.1~7.6)

- [ ] **P3-1 Legacy 入口资源整理** `[R6.7.1][7.5]`  
  - 将旧系统静态文件打包为资源（/legacy），梳理依赖。  
  - 定义构建/复制流程，避免与新资源冲突。

- [ ] **P3-2 LegacyWrapper 整页封装** `[R6.7.2]`  
  - 实现 iframe + BrowserView 双实现，封装装载/卸载。  
  - Vue 侧生命周期钩子（等待 `window.app.initialize()`）。

- [ ] **P3-3 Electron 桥接接口** `[R6.7.4][7.4]`  
  - 实装 `bridge.mountLegacy`、`bridge.openPractice`、`bridge.storage.*`、`bridge.secrets.*`。  
  - 统一错误码、日志、调试命令。

- [ ] **P3-4 Legacy 会话事件桥接** `[R6.7.5][7.4]`  
  - 主进程监听练习窗口 `postMessage`，转发 `legacy:session-event`。  
  - Vue 接入 Pinia store 更新统计、通知 UI。

- [ ] **P3-5 双轨存储协调** `[R6.7.3][7.3]`  
  - 保持 Legacy Hybrid 存储工作；新增 IPC 通知（记录更新、导出完成）。  
  - 设置页提供“迁移旧数据”入口（隐藏，提示后续计划）。

- [ ] **P3-6 跨系统导航体验** `[R6.7.1][7.2]`  
  - 顶部/侧边导航按钮与 Legacy 视图同步状态。  
  - Loading、错误弹窗、一键返回写作模块逻辑。

---

## Phase 4 — 桌面发行与运维 (需求 6.10、7.5、7.6)

- [ ] **P4-1 题库资源管理** `[R6.5.4][7.5]`  
  - 设计首次启动导入流程（选择目录、校验、生成索引）。  
  - Electron 主进程暴露文件访问接口，路径安全校验。  
  - 配置缓存/刷新逻辑。

- [ ] **P4-2 Electron 打包与自动更新** `[R6.10.2]`  
  - Electron Builder 配置（AppId、签名、平台区分）。  
  - 可选：差量更新/手动下载提示。

- [ ] **P4-3 日志与诊断工具** `[R6.7.5][7.4]`  
  - 主进程/渲染进程日志落盘，桥接调用记录。  
  - 设置页导出诊断包功能。

- [ ] **P4-4 网络/离线应对** `[7.6]`  
  - 监听网络状态，提示用户离线，只允许操作队列。  
  - 队列与缓存配合，恢复时自动执行。

- [ ] **P4-5 安全与隐私确认** `[1.2][7.6]`  
  - 明确本地数据范围、隐私提示、许可证（GPLv3）合规。  
  - 编写隐私政策、用户须知。

---

## Phase 5 — 测试、验收与发布准备 (需求 6.3.8、6.8、6.9、6.10)

- [ ] **P5-1 测试体系落实** `[附录测试策略]`  
  - 单元测试覆盖服务层、Pinia store。  
  - 组件测试：关键组件（编辑器、历史、LegacyWrapper）。  
  - E2E：Playwright/Cypress 流程测试（API 配置 → 写作 → 评分 → Legacy 切换 → 导出）。

- [ ] **P5-2 可访问性与 UX 审查** `[R6.6][R6.8]`  
  - 键盘操作、ARIA、配色对比度。  
  - Toast/弹窗一致性、错误提示清晰度。

- [ ] **P5-3 文档与培训交付** `[R1][R6.10.3]`  
  - 更新用户手册、安装指南、FAQ。  
  - 编写内部培训 PPT，包含 Legacy 操作与常见问题。

- [ ] **P5-4 发布前检查** `[R6.10]`  
  - 版本号确认、迁移脚本验证、密钥存储自测。  
  - 全平台回归、签名验证、发行说明。

---

## 支撑任务与开放问题

- [ ] **S-1 供应商策略** `[R4.2]` — 评估 API 配额、成本、冷却策略，输出建议。  
- [ ] **S-2 数据隐私合规** `[1.2][7.6]` — 审核数据保存范围、隐私声明、用户授权流程。  
- [ ] **S-3 性能指标定义与监控** `[R6.9]` — 明确加载、评分延迟、内存目标；规划监控/报表。  
- [ ] **S-4 Legacy → SQLite 迁移草案** `[7.3]` — 提前完成迁移向导 UX、字段映射设计。  
- [ ] **S-5 Spike 追踪** — 对未决技术点（如 BrowserView 在 Linux 的限制）定期复盘。

---

## 变更记录

| 日期 | 描述 | 作者 |
| --- | --- | --- |
| 2025-XX-XX | 根据需求文档首次创建任务拆解 | *待补充* |
| 2025-XX-XX | 加细拆解，按需求章节映射任务 | *待补充* |
| 2025-10-04 | Phase 1 全部任务完成，数据库、API、前端集成 | Claude |
| 2025-10-04 | Phase 2 三项核心增强完成：语法标注、评分分析、导出备份 | Claude |

> 调整流程：需求文档 → 设计文档 → 任务拆解更新 → 执行。
