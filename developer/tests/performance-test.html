<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€§èƒ½åŸºçº¿æµ‹é‡å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
        }
        .metric-value { font-size: 36px; font-weight: bold; margin: 10px 0; }
        .metric-label { font-size: 14px; opacity: 0.9; }
        .metric-trend { font-size: 12px; margin-top: 5px; }
        .trend-up { color: #4CAF50; }
        .trend-down { color: #f44336; }
        .trend-stable { color: #FFC107; }
        button {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-danger { background-color: #dc3545; color: white; }
        button:hover { opacity: 0.8; transform: translateY(-1px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background-color: #28a745;
            transition: width 0.3s ease;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-idle { background-color: #6c757d; }
        .status-running { background-color: #17a2b8; animation: pulse 1s infinite; }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .recommendation {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .recommendation.high { background: #f8d7da; border-color: #f5c6cb; }
        .recommendation.medium { background: #fff3cd; border-color: #ffeaa7; }
        .recommendation.low { background: #d1ecf1; border-color: #bee5eb; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .live-metric {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 2px;
        }
        .metric-fps { background: #e3f2fd; color: #1976d2; }
        .metric-memory { background: #f3e5f5; color: #7b1fa2; }
        .metric-delay { background: #e8f5e8; color: #388e3c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š æ€§èƒ½åŸºçº¿æµ‹é‡å·¥å…·</h1>
        <p>æµ‹é‡ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼Œå»ºç«‹æ€§èƒ½åŸºçº¿ï¼Œè¯†åˆ«ä¼˜åŒ–æœºä¼š</p>

        <div class="test-section">
            <h3>ğŸ¯ æµ‹è¯•æ§åˆ¶é¢æ¿</h3>

            <div style="margin: 15px 0;">
                <span class="status-indicator status-idle" id="testStatus"></span>
                <button class="btn-primary" onclick="runQuickTest()" id="quickTestBtn">
                    âš¡ å¿«é€Ÿæµ‹è¯• (10ç§’)
                </button>
                <button class="btn-success" onclick="runFullBenchmark()" id="fullTestBtn">
                    ğŸš€ å®Œæ•´åŸºå‡†æµ‹è¯•
                </button>
                <button class="btn-warning" onclick="startLiveMonitoring()" id="liveMonitorBtn">
                    ğŸ“ˆ å®æ—¶ç›‘æ§
                </button>
                <button class="btn-danger" onclick="stopLiveMonitoring()" id="stopMonitorBtn" disabled>
                    â¹ï¸ åœæ­¢ç›‘æ§
                </button>
                <button class="btn-secondary" onclick="clearResults()">
                    ğŸ—‘ï¸ æ¸…é™¤ç»“æœ
                </button>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>
            <div id="progressText" style="text-align: center; margin: 10px 0;">å‡†å¤‡å°±ç»ª</div>

            <div id="liveMetrics" style="margin: 15px 0;">
                <strong>å®æ—¶æŒ‡æ ‡:</strong>
                <span class="live-metric metric-fps" id="liveFps">FPS: --</span>
                <span class="live-metric metric-memory" id="liveMemory">å†…å­˜: --</span>
                <span class="live-metric metric-delay" id="liveDelay">å»¶è¿Ÿ: --</span>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡</h3>

            <div class="metric-grid" id="metricsGrid">
                <!-- æŒ‡æ ‡å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ æ€§èƒ½å»ºè®®</h3>
            <div id="recommendations">
                <p>è¿è¡Œæµ‹è¯•åå°†æ˜¾ç¤ºæ€§èƒ½ä¼˜åŒ–å»ºè®®...</p>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š è¯¦ç»†æŠ¥å‘Š</h3>
            <pre id="detailedReport">è¿è¡Œæµ‹è¯•åå°†æ˜¾ç¤ºè¯¦ç»†çš„æ€§èƒ½æŠ¥å‘Š...</pre>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ é«˜çº§æµ‹è¯•</h3>

            <div style="margin: 15px 0;">
                <button class="btn-primary" onclick="testDOMPerformance()">
                    ğŸ—ï¸ DOMæ€§èƒ½æµ‹è¯•
                </button>
                <button class="btn-primary" onclick="testDataProcessingPerformance()">
                    ğŸ“Š æ•°æ®å¤„ç†æµ‹è¯•
                </button>
                <button class="btn-primary" onclick="testUIInteractionPerformance()">
                    ğŸ–±ï¸ äº¤äº’æ€§èƒ½æµ‹è¯•
                </button>
                <button class="btn-primary" onclick="testVirtualScrollingPerformance()">
                    ğŸ“œ è™šæ‹Ÿæ»šåŠ¨æµ‹è¯•
                </button>
            </div>

            <div id="advancedResults" style="margin-top: 15px;"></div>
        </div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„è„šæœ¬ -->
    <script src="../../js/utils/storage.js"></script>
    <script src="../../js/data/dataSources/storageDataSource.js"></script>
    <script src="../../js/data/repositories/baseRepository.js"></script>
    <script src="../../js/data/repositories/dataRepositoryRegistry.js"></script>
    <script src="../../js/data/repositories/practiceRepository.js"></script>
    <script src="../../js/data/repositories/settingsRepository.js"></script>
    <script src="../../js/data/repositories/backupRepository.js"></script>
    <script src="../../js/data/repositories/metaRepository.js"></script>
    <script src="../../js/data/index.js"></script>
    <script src="./js/performanceBaseline.js"></script>

    <script>
        let performanceBaseline = null;
        let liveMonitoringInterval = null;
        let currentTest = null;

        // æ£€æŸ¥ä¾èµ–å¹¶åˆå§‹åŒ–
        function initializePerformanceTool() {
            try {
                // æ£€æŸ¥å¿…è¦çš„ä¾èµ–
                if (typeof window.PerformanceBaseline === 'undefined') {
                    throw new Error('PerformanceBaselineç±»æœªåŠ è½½');
                }

                // åˆ›å»ºå®ä¾‹
                performanceBaseline = new PerformanceBaseline();
                console.log('ğŸ“Š æ€§èƒ½æµ‹é‡å·¥å…·å·²åŠ è½½');
                updateTestStatus('idle');

                return true;
            } catch (error) {
                console.error('âŒ æ€§èƒ½å·¥å…·åˆå§‹åŒ–å¤±è´¥:', error);
                updateTestStatus('error');
                updateProgress(100, 'åˆå§‹åŒ–å¤±è´¥: ' + error.message);

                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                document.getElementById('metricsGrid').innerHTML =
                    '<div class="recommendation high"><h4>âŒ åˆå§‹åŒ–å¤±è´¥</h4><p>' + error.message + '</p></div>';

                return false;
            }
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½åŠ è½½å®Œæˆ
            setTimeout(() => {
                initializePerformanceTool();
            }, 100);
        });

        // æ›´æ–°æµ‹è¯•çŠ¶æ€
        function updateTestStatus(status) {
            const indicator = document.getElementById('testStatus');
            indicator.className = `status-indicator status-${status}`;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percentage, text = '') {
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = text;
        }

        // æ›´æ–°å®æ—¶æŒ‡æ ‡
        function updateLiveMetrics() {
            if (!performanceBaseline || !performanceBaseline.isMonitoring) return;

            const metrics = performanceBaseline.metrics;

            // FPS
            if (metrics.fps.length > 0) {
                const recentFps = metrics.fps.slice(-10); // æœ€è¿‘10å¸§
                const avgFps = recentFps.reduce((a, b) => a + b, 0) / recentFps.length;
                document.getElementById('liveFps').textContent = `FPS: ${avgFps.toFixed(1)}`;
            }

            // å†…å­˜
            if (metrics.memory.length > 0) {
                const latestMemory = metrics.memory[metrics.memory.length - 1];
                const memoryMB = (latestMemory.used / 1024 / 1024).toFixed(1);
                document.getElementById('liveMemory').textContent = `å†…å­˜: ${memoryMB}MB`;
            }

            // å»¶è¿Ÿ
            if (metrics.interactionDelay.length > 0) {
                const recentDelays = metrics.interactionDelay.slice(-5); // æœ€è¿‘5æ¬¡äº¤äº’
                const avgDelay = recentDelays.reduce((a, b) => a + b.delay, 0) / recentDelays.length;
                document.getElementById('liveDelay').textContent = `å»¶è¿Ÿ: ${avgDelay.toFixed(1)}ms`;
            }
        }

        // å¿«é€Ÿæµ‹è¯•
        async function runQuickTest() {
            if (!performanceBaseline) {
                if (!initializePerformanceTool()) {
                    alert('æ€§èƒ½æµ‹é‡å·¥å…·åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯');
                    return;
                }
            }

            updateTestStatus('running');
            const quickTestBtn = document.getElementById('quickTestBtn');
            quickTestBtn.disabled = true;

            try {
                updateProgress(0, 'å¼€å§‹å¿«é€Ÿæ€§èƒ½æµ‹è¯•...');

                performanceBaseline.startMonitoring(10000); // 10ç§’æµ‹è¯•

                // æ›´æ–°è¿›åº¦
                for (let i = 0; i <= 100; i += 10) {
                    updateProgress(i, `æµ‹è¯•è¿›è¡Œä¸­... ${i}%`);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    updateLiveMetrics();
                }

                updateProgress(100, 'æµ‹è¯•å®Œæˆï¼');
                updateTestStatus('success');
                displayResults();

            } catch (error) {
                console.error('å¿«é€Ÿæµ‹è¯•å¤±è´¥:', error);
                updateTestStatus('error');
                updateProgress(100, 'æµ‹è¯•å¤±è´¥');
            } finally {
                quickTestBtn.disabled = false;
            }
        }

        // å®Œæ•´åŸºå‡†æµ‹è¯•
        async function runFullBenchmark() {
            if (!performanceBaseline) {
                if (!initializePerformanceTool()) {
                    alert('æ€§èƒ½æµ‹é‡å·¥å…·åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯');
                    return;
                }
            }

            updateTestStatus('running');
            const fullTestBtn = document.getElementById('fullTestBtn');
            fullTestBtn.disabled = true;

            try {
                updateProgress(0, 'å¼€å§‹å®Œæ•´åŸºå‡†æµ‹è¯•...');

                const results = await performanceBaseline.runFullBenchmark();

                updateProgress(100, 'åŸºå‡†æµ‹è¯•å®Œæˆï¼');
                updateTestStatus('success');
                displayResults();
                displayRecommendations();

            } catch (error) {
                console.error('åŸºå‡†æµ‹è¯•å¤±è´¥:', error);
                updateTestStatus('error');
                updateProgress(100, 'æµ‹è¯•å¤±è´¥');
            } finally {
                fullTestBtn.disabled = false;
            }
        }

        // å¼€å§‹å®æ—¶ç›‘æ§
        function startLiveMonitoring() {
            if (!performanceBaseline) {
                if (!initializePerformanceTool()) {
                    alert('æ€§èƒ½æµ‹é‡å·¥å…·åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯');
                    return;
                }
            }

            updateTestStatus('running');
            document.getElementById('liveMonitorBtn').disabled = true;
            document.getElementById('stopMonitorBtn').disabled = false;

            performanceBaseline.startMonitoring(60000); // 60ç§’ç›‘æ§

            // æ›´æ–°å®æ—¶æŒ‡æ ‡
            liveMonitoringInterval = setInterval(() => {
                updateLiveMetrics();
                if (performanceBaseline.metrics.fps.length > 0) {
                    displayCurrentMetrics();
                }
            }, 1000);

            updateProgress(0, 'å®æ—¶ç›‘æ§ä¸­...');
        }

        // åœæ­¢å®æ—¶ç›‘æ§
        function stopLiveMonitoring() {
            if (performanceBaseline) {
                performanceBaseline.stopMonitoring();
            }

            if (liveMonitoringInterval) {
                clearInterval(liveMonitoringInterval);
                liveMonitoringInterval = null;
            }

            updateTestStatus('success');
            document.getElementById('liveMonitorBtn').disabled = false;
            document.getElementById('stopMonitorBtn').disabled = true;
            updateProgress(100, 'ç›‘æ§å·²åœæ­¢');

            displayResults();
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults() {
            const report = performanceBaseline.baselineData;
            if (!report) return;

            // æ˜¾ç¤ºæŒ‡æ ‡å¡ç‰‡
            displayMetricCards(report);

            // æ˜¾ç¤ºè¯¦ç»†æŠ¥å‘Š
            document.getElementById('detailedReport').textContent = JSON.stringify(report, null, 2);
        }

        // æ˜¾ç¤ºæŒ‡æ ‡å¡ç‰‡
        function displayMetricCards(report) {
            const metricsGrid = document.getElementById('metricsGrid');
            let html = '';

            // FPSå¡ç‰‡
            if (report.fps) {
                const fpsTrend = report.fps.average >= 50 ? 'trend-up' :
                                 report.fps.average >= 30 ? 'trend-stable' : 'trend-down';
                const fpsIcon = report.fps.average >= 50 ? 'ğŸŸ¢' :
                               report.fps.average >= 30 ? 'ğŸŸ¡' : 'ğŸ”´';

                html += `
                    <div class="metric-card">
                        <div class="metric-label">å¹³å‡å¸§ç‡ (FPS)</div>
                        <div class="metric-value">${fpsIcon} ${report.fps.average.toFixed(1)}</div>
                        <div class="metric-trend">
                            èŒƒå›´: ${report.fps.min.toFixed(1)} - ${report.fps.max.toFixed(1)}
                        </div>
                        <div class="metric-trend ${fpsTrend}">
                            P95: ${report.fps.p95.toFixed(1)} FPS
                        </div>
                    </div>
                `;
            }

            // å†…å­˜å¡ç‰‡
            if (report.memory) {
                const memoryMB = (report.memory.used.average / 1024 / 1024).toFixed(1);
                const memoryIcon = report.memory.utilizationRate.average < 50 ? 'ğŸŸ¢' :
                                  report.memory.utilizationRate.average < 80 ? 'ğŸŸ¡' : 'ğŸ”´';

                html += `
                    <div class="metric-card">
                        <div class="metric-label">å†…å­˜ä½¿ç”¨</div>
                        <div class="metric-value">${memoryIcon} ${memoryMB} MB</div>
                        <div class="metric-trend">
                            åˆ©ç”¨ç‡: ${report.memory.utilizationRate.average.toFixed(1)}%
                        </div>
                        <div class="metric-trend">
                            å³°å€¼: ${(report.memory.used.max / 1024 / 1024).toFixed(1)} MB
                        </div>
                    </div>
                `;
            }

            // äº¤äº’å»¶è¿Ÿå¡ç‰‡
            if (report.interaction) {
                const delayIcon = report.interaction.average < 50 ? 'ğŸŸ¢' :
                                report.interaction.average < 100 ? 'ğŸŸ¡' : 'ğŸ”´';

                html += `
                    <div class="metric-card">
                        <div class="metric-label">äº¤äº’å»¶è¿Ÿ</div>
                        <div class="metric-value">${delayIcon} ${report.interaction.average.toFixed(1)} ms</div>
                        <div class="metric-trend">
                            èŒƒå›´: ${report.interaction.min.toFixed(1)} - ${report.interaction.max.toFixed(1)} ms
                        </div>
                        <div class="metric-trend">
                            P95: ${report.interaction.p95.toFixed(1)} ms
                        </div>
                    </div>
                `;
            }

            // æ¸²æŸ“æ—¶é—´å¡ç‰‡
            if (report.render) {
                const renderIcon = report.render.average < 16 ? 'ğŸŸ¢' :  // 60 FPS = 16ms per frame
                                 report.render.average < 33 ? 'ğŸŸ¡' : 'ğŸ”´';  // 30 FPS = 33ms per frame

                html += `
                    <div class="metric-card">
                        <div class="metric-label">æ¸²æŸ“æ—¶é—´</div>
                        <div class="metric-value">${renderIcon} ${report.render.average.toFixed(1)} ms</div>
                        <div class="metric-trend">
                            èŒƒå›´: ${report.render.min.toFixed(1)} - ${report.render.max.toFixed(1)} ms
                        </div>
                        <div class="metric-trend">
                            P95: ${report.render.p95.toFixed(1)} ms
                        </div>
                    </div>
                `;
            }

            // ç³»ç»Ÿä¿¡æ¯å¡ç‰‡
            if (report.systemInfo) {
                html += `
                    <div class="metric-card">
                        <div class="metric-label">ç³»ç»Ÿä¿¡æ¯</div>
                        <div class="metric-value">ğŸ–¥ï¸ ${report.systemInfo.platform}</div>
                        <div class="metric-trend">
                            å±å¹•: ${report.systemInfo.screen.width}x${report.systemInfo.screen.height}
                        </div>
                        <div class="metric-trend">
                            è§†å£: ${report.systemInfo.viewport.width}x${report.systemInfo.viewport.height}
                        </div>
                    </div>
                `;
            }

            metricsGrid.innerHTML = html;
        }

        // æ˜¾ç¤ºå½“å‰æŒ‡æ ‡ï¼ˆç”¨äºå®æ—¶ç›‘æ§ï¼‰
        function displayCurrentMetrics() {
            const metrics = performanceBaseline.metrics;

            if (metrics.fps.length > 0) {
                const recentFps = metrics.fps.slice(-30); // æœ€è¿‘30å¸§
                const avgFps = recentFps.reduce((a, b) => a + b, 0) / recentFps.length;

                const liveMetricsGrid = document.getElementById('metricsGrid');
                if (liveMetricsGrid.children.length === 0) {
                    displayMetricCards(performanceBaseline.baselineData || {
                        fps: { average: avgFps, min: Math.min(...recentFps), max: Math.max(...recentFps) }
                    });
                }
            }
        }

        // æ˜¾ç¤ºæ€§èƒ½å»ºè®®
        function displayRecommendations() {
            const recommendations = performanceBaseline.getPerformanceRecommendations();
            if (!recommendations || recommendations.length === 0) {
                document.getElementById('recommendations').innerHTML =
                    '<div class="recommendation low">ğŸ‰ æ€§èƒ½è¡¨ç°è‰¯å¥½ï¼Œæš‚æ— ä¼˜åŒ–å»ºè®®ï¼</div>';
                return;
            }

            let html = '';
            recommendations.forEach(rec => {
                const severityClass = rec.severity;
                const severityIcon = rec.severity === 'high' ? 'ğŸ”´' :
                                    rec.severity === 'medium' ? 'ğŸŸ¡' : 'ğŸŸ¢';

                html += `
                    <div class="recommendation ${severityClass}">
                        <h4>${severityIcon} ${rec.category} - ${rec.severity.toUpperCase()}</h4>
                        <p><strong>é—®é¢˜:</strong> ${rec.message}</p>
                        <p><strong>å»ºè®®:</strong></p>
                        <ul>
                            ${rec.suggestions.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    </div>
                `;
            });

            document.getElementById('recommendations').innerHTML = html;
        }

        // DOMæ€§èƒ½æµ‹è¯•
        async function testDOMPerformance() {
            if (!performanceBaseline) {
                if (!initializePerformanceTool()) return;
            }

            document.getElementById('advancedResults').innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•DOMæ€§èƒ½...</div>';
            await performanceBaseline.testDOMPerformance();

            const result = document.getElementById('advancedResults');
            result.innerHTML = '<div class="pass">âœ… DOMæ€§èƒ½æµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†ç»“æœ</div>';
        }

        // æ•°æ®å¤„ç†æ€§èƒ½æµ‹è¯•
        async function testDataProcessingPerformance() {
            if (!performanceBaseline) {
                if (!initializePerformanceTool()) return;
            }

            document.getElementById('advancedResults').innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•æ•°æ®å¤„ç†æ€§èƒ½...</div>';
            await performanceBaseline.testDataProcessingPerformance();

            const result = document.getElementById('advancedResults');
            result.innerHTML = '<div class="pass">âœ… æ•°æ®å¤„ç†æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†ç»“æœ</div>';
        }

        // UIäº¤äº’æ€§èƒ½æµ‹è¯•
        async function testUIInteractionPerformance() {
            if (!performanceBaseline) {
                if (!initializePerformanceTool()) return;
            }

            document.getElementById('advancedResults').innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•UIäº¤äº’æ€§èƒ½...</div>';
            await performanceBaseline.testUIInteractionPerformance();

            const result = document.getElementById('advancedResults');
            result.innerHTML = '<div class="pass">âœ… UIäº¤äº’æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†ç»“æœ</div>';
        }

        // è™šæ‹Ÿæ»šåŠ¨æ€§èƒ½æµ‹è¯•
        async function testVirtualScrollingPerformance() {
            if (!performanceBaseline) {
                if (!initializePerformanceTool()) return;
            }

            document.getElementById('advancedResults').innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•è™šæ‹Ÿæ»šåŠ¨æ€§èƒ½...</div>';

            // åˆ›å»ºå¤§é‡æµ‹è¯•æ•°æ®
            const largeDataSet = Array.from({ length: 10000 }, (_, i) => ({
                id: i,
                title: `è™šæ‹Ÿæ»šåŠ¨æµ‹è¯•é¡¹ç›® ${i}`,
                description: `è¿™æ˜¯ç¬¬ ${i} ä¸ªæµ‹è¯•é¡¹ç›®çš„æè¿°å†…å®¹`,
                category: ['é˜…è¯»', 'å¬åŠ›', 'å†™ä½œ', 'å£è¯­'][i % 4],
                score: Math.floor(Math.random() * 100)
            }));

            // åˆ›å»ºæµ‹è¯•å®¹å™¨
            const container = document.createElement('div');
            container.id = 'virtual-scroll-test';
            container.style.cssText = 'height: 400px; overflow-y: auto; border: 1px solid #ddd; margin: 10px 0;';
            document.body.appendChild(container);

            try {
                const startTime = performance.now();

                // æ¨¡æ‹Ÿè™šæ‹Ÿæ»šåŠ¨ï¼šåªæ¸²æŸ“å¯è§åŒºåŸŸçš„å…ƒç´ 
                const itemHeight = 40;
                const visibleCount = Math.ceil(400 / itemHeight) + 2; // +2 for buffer
                let scrollTop = 0;

                const renderVisibleItems = () => {
                    const startIndex = Math.floor(scrollTop / itemHeight);
                    const endIndex = Math.min(startIndex + visibleCount, largeDataSet.length);

                    container.innerHTML = '';
                    for (let i = startIndex; i < endIndex; i++) {
                        const item = largeDataSet[i];
                        const div = document.createElement('div');
                        div.style.cssText = `height: ${itemHeight}px; padding: 10px; border-bottom: 1px solid #eee;`;
                        div.innerHTML = `<strong>${item.title}</strong> - ${item.category} (${item.score}åˆ†)`;
                        container.appendChild(div);
                    }
                };

                // åˆå§‹æ¸²æŸ“
                renderVisibleItems();

                // æµ‹è¯•æ»šåŠ¨æ€§èƒ½
                const scrollTestDuration = 5000; // 5ç§’
                const scrollInterval = setInterval(() => {
                    scrollTop += itemHeight * 2;
                    if (scrollTop > (largeDataSet.length - visibleCount) * itemHeight) {
                        scrollTop = 0;
                    }
                    container.scrollTop = scrollTop;
                    renderVisibleItems();
                }, 16); // ~60 FPS

                await new Promise(resolve => setTimeout(resolve, scrollTestDuration));
                clearInterval(scrollInterval);

                const endTime = performance.now();
                const totalTime = endTime - startTime;
                const scrollOperations = (scrollTestDuration / 16);
                const avgScrollTime = totalTime / scrollOperations;

                document.getElementById('advancedResults').innerHTML = `
                    <div class="pass">
                        âœ… è™šæ‹Ÿæ»šåŠ¨æ€§èƒ½æµ‹è¯•å®Œæˆ<br>
                        æ€»æ—¶é—´: ${totalTime.toFixed(2)}ms<br>
                        æ»šåŠ¨æ“ä½œ: ${scrollOperations.toFixed(0)} æ¬¡<br>
                        å¹³å‡æ»šåŠ¨æ—¶é—´: ${avgScrollTime.toFixed(2)}ms<br>
                        æ•°æ®é‡: ${largeDataSet.length} é¡¹<br>
                        å¯è§åŒºåŸŸ: ${visibleCount} é¡¹
                    </div>
                `;

            } finally {
                // æ¸…ç†æµ‹è¯•å…ƒç´ 
                document.body.removeChild(container);
            }
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            if (performanceBaseline) {
                performanceBaseline.metrics = {
                    fps: [],
                    memory: [],
                    interactionDelay: [],
                    renderTime: [],
                    loadTime: null
                };
                performanceBaseline.baselineData = null;
            }

            document.getElementById('metricsGrid').innerHTML = '';
            document.getElementById('recommendations').innerHTML = '<p>è¿è¡Œæµ‹è¯•åå°†æ˜¾ç¤ºæ€§èƒ½ä¼˜åŒ–å»ºè®®...</p>';
            document.getElementById('detailedReport').textContent = 'è¿è¡Œæµ‹è¯•åå°†æ˜¾ç¤ºè¯¦ç»†çš„æ€§èƒ½æŠ¥å‘Š...';
            document.getElementById('advancedResults').innerHTML = '';
            document.getElementById('liveFps').textContent = 'FPS: --';
            document.getElementById('liveMemory').textContent = 'å†…å­˜: --';
            document.getElementById('liveDelay').textContent = 'å»¶è¿Ÿ: --';

            updateTestStatus('idle');
            updateProgress(0, 'å‡†å¤‡å°±ç»ª');
        }
    </script>
</body>
</html>
