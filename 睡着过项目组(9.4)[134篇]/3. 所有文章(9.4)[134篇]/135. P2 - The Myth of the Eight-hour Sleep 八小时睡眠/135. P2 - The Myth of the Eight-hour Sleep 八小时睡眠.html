<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IELTS Reading Practice - The Myth of the Eight-hour Sleep</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --line: #e5e7eb;
            --bg: #f6f7fb;
            --panel: #fff;
            --accent: #3b82f6;
            --muted: #6b7280;
            --shadow: 0 6px 20px rgba(0,0,0,.12);
            --text-color: #333;
            --highlight: #fff3a3;
            --selbar-bg: #111;
            --selbar-text: #fff;
        }

        body.dark-mode {
            --line: #4a4a4a;
            --bg: #1a1a1a;
            --panel: #2a2a2a;
            --muted: #bbb;
            --text-color: #f0f0f0;
            --highlight: #5b21b6;
            --selbar-bg: #1f2937;
            --selbar-text: #e5e7eb;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html { font-size: 16px; }
        html.font-regular { font-size: 16px; }
        html.font-large { font-size: 18px; }
        html.font-xlarge { font-size: 20px; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background: var(--bg);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease;
            padding-bottom: 64px;
        }

        .header {
            background-color: var(--panel);
            padding: 12px 20px;
            border-bottom: 1px solid var(--line);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,.05);
        }

        .header-content { display: flex; align-items: center; gap: 16px; }
        .header h1 { font-size: 1.2rem; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-color); }
        #timer { font-size: 1rem; font-weight: 500; background: var(--bg); padding: 6px 12px; border-radius: 6px; border: 1px solid var(--line); min-width: 90px; text-align: center; color: var(--text-color); }
        .header-controls { display: flex; align-items: center; gap: 10px; }
        .header-btn { background: var(--panel); border: 1px solid var(--line); border-radius: 6px; padding: 6px 12px; cursor: pointer; font-size: 0.9rem; transition: all 0.2s ease; color: var(--text-color); }
        .header-btn:hover { background: var(--bg); border-color: var(--accent); }

        #settings-panel {
            position: absolute; top: 60px; right: 20px; width: 200px; background: var(--panel); border-radius: 12px;
            box-shadow: var(--shadow); border: 1px solid var(--line); z-index: 1000; padding: 8px; display: none;
        }
        .settings-group { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--line); }
        .settings-group:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .settings-title { font-size: 0.85rem; color: var(--muted); margin-bottom: 8px; padding-left: 12px; }
        .settings-option { display: block; width: 100%; text-align: left; padding: 8px 12px; border: none; background: none; cursor: pointer; font-size: 0.9rem; border-radius: 6px; color: var(--text-color); }
        .settings-option.active { background: #e9effd; color: var(--accent); font-weight: 500; }
        .dark-mode .settings-option.active { background: #1e3a8a; }

        #notes-panel {
            position: fixed; right: 12px; bottom: 76px; width: 320px; height: 45vh; background: var(--panel); border: 1px solid var(--line); border-radius: 12px;
            display: none; flex-direction: column; z-index: 900; box-shadow: var(--shadow); overflow: hidden;
        }
        #notes-panel header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid var(--line); background-color: var(--bg); }
        #notes-panel h3 { font-size: 1rem; font-weight: 600; color: var(--text-color); margin: 0; }
        #notes-panel textarea { flex: 1; border: 0; padding: 16px; resize: none; font-size: 0.95rem; background: transparent; color: var(--text-color); line-height: 1.6; }
        #notes-panel textarea:focus { outline: none; }
        #close-note { padding: 4px 8px; border-radius: 4px; border: 1px solid var(--line); background: transparent; cursor: pointer; color: var(--text-color); transition: background-color 0.2s; }
        #close-note:hover { background-color: rgba(0,0,0,0.05); }
        .dark-mode #close-note:hover { background-color: rgba(255,255,255,0.1); }

        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.08); z-index: 800; display: none; backdrop-filter: blur(2px); }
        .dark-mode .overlay { background: rgba(0, 0, 0, 0.3); }

        .shell { display: flex; height: calc(100vh - 58px - 64px); width: 100%; overflow: hidden; }
        .pane { background: var(--panel); overflow: auto; padding: 24px; }
        #left { min-width: 280px; max-width: calc(100% - 280px); width: 50%; }
        #right { min-width: 280px; flex: 1; background: var(--bg); border-left: 1px solid var(--line); }
        .dark-mode #right { background: #1a1a1a; }

        #divider { flex: 0 0 8px; background: var(--bg); cursor: ew-resize; user-select: none; position: relative; border-left: 1px solid var(--line); border-right: 1px solid var(--line); }
        #divider::before { content: ""; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 4px; height: 30px; border-radius: 2px; background: rgba(100, 100, 100, 0.2); }
        #divider:hover { background: #dbeafe; }
        .dark-mode #divider { border-color: #4a4a4a; }
        .dark-mode #divider:hover { background: #1e40af; }

        h2, h3, h4 { margin: 0 0 16px; color: var(--text-color); }
        #left p, #right p { margin: 0 0 16px; line-height: 1.7; }
        #left strong, #right strong { font-weight: 600; }
        .empty-space { height: 40px; }

        .group { background: var(--panel); border: 1px solid var(--line); border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .question-item { padding: 12px 0; border-bottom: 1px dashed var(--line); }
        .question-item:last-child { border-bottom: none; }
        .question-item p { margin: 0; }

        #results { background: var(--panel); border: 1px solid var(--line); border-radius: 10px; padding: 20px; margin-top: 20px; display: none; line-height: 1.8; }
        .results-table { width: 100%; border-collapse: collapse; margin-top: 12px; font-size: 0.9rem; }
        .results-table th, .results-table td { border: 1px solid var(--line); padding: 8px; text-align: center; }
        .results-table th { background: var(--bg); }
        .result-correct { color: #10b981; font-weight: bold; }
        .result-incorrect { color: #ef4444; font-weight: bold; }

        .hl { background: var(--highlight); box-shadow: inset 0 -2px 0 rgba(0,0,0,.05); cursor: pointer; }
        .dark-mode .hl { color: #f5f3ff; }

        #selbar { position: absolute; display: none; z-index: 6000; background: var(--selbar-bg); color: var(--selbar-text); border-radius: 8px; padding: 6px; box-shadow: var(--shadow); font-size: 13px; gap: 6px; align-items: center; }
        #selbar button { background: transparent; color: var(--selbar-text); border: 1px solid rgba(255,255,255,.25); padding: 4px 8px; border-radius: 6px; cursor: pointer; }
        #selbar button:hover { border-color: var(--selbar-text); }

        .practice-nav { background: var(--panel); padding: 12px 20px; display: flex; align-items: center; gap: 16px; box-shadow: 0 -2px 4px rgba(0,0,0,.05); flex-wrap: wrap; position: fixed; left: 0; right: 0; bottom: 0; border-top: 1px solid var(--line); z-index: 4000; }
        .practice-nav .title { font-weight: 600; color: var(--muted); }
        .practice-nav .questions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .practice-nav .q-item { padding: 6px 10px; border: 1px solid var(--line); border-radius: 6px; background: var(--panel); cursor: pointer; font-size: 14px; transition: all 0.2s; min-width: 36px; text-align: center; color: var(--text-color); }
        .practice-nav .q-item:hover { background: var(--bg); border-color: var(--accent); }
        .practice-nav .q-item.answered { background: #e0e7ff; border-color: var(--accent); color: var(--accent); font-weight: 500; }
        .dark-mode .practice-nav .q-item.answered { background: #3949ab; border-color: var(--accent); color: #e8eaf6; }
        .practice-nav .q-item.correct { background: #dcfce7; border-color: #4ade80; color: #15803d; }
        .dark-mode .practice-nav .q-item.correct { background: #166534; border-color: #4ade80; color: #dcfce7; }
        .practice-nav .q-item.incorrect { background: #fee2e2; border-color: #f87171; color: #b91c1c; }
        .dark-mode .practice-nav .q-item.incorrect { background: #991b1b; border-color: #f87171; color: #fee2e2; }
        .practice-nav .controls { margin-left: auto; display: flex; align-items: center; gap: 12px; }
        .practice-nav .controls button { padding: 8px 12px; border: 1px solid var(--line); border-radius: 6px; background: var(--panel); cursor: pointer; color: var(--text-color); }
        .practice-nav .controls button.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
        
        /* Drag and Drop Styles */
        .paragraph-wrapper { position: relative; margin-bottom: 1rem; }
        .paragraph-dropzone { min-height: 40px; background: #f0f9ff; border: 2px dashed #93c5fd; border-radius: 8px; margin-bottom: 8px; padding: 6px 10px; display: flex; align-items: center; gap: 10px; transition: all 0.2s; }
        .dark-mode .paragraph-dropzone { background: #1e3a8a; border-color: #3b82f6; }
        .paragraph-dropzone.drag-over { background: #dbeafe; border-color: #3b82f6; }
        .dark-mode .paragraph-dropzone.drag-over { background: #1e40af; }
        .paragraph-label { font-weight: bold; color: #64748b; font-size: 0.9rem; min-width: 80px; }
        .dark-mode .paragraph-label { color: #94a3b8; }
        .dropped-items { display: flex; flex-wrap: wrap; gap: 6px; flex: 1; }
        .headings-pool, .options-pool { background: #fafbfc; border: 1px solid var(--line); border-radius: 8px; padding: 12px; margin: 16px 0; }
        .dark-mode .headings-pool, .dark-mode .options-pool { background: #334155; }
        .pool-items { display: flex; flex-wrap: wrap; gap: 8px; }
        .drag-item { padding: 6px 12px; background-color: #eef2ff; border: 1px solid #c7d2fe; border-radius: 6px; cursor: grab; user-select: none; font-size: 14px; transition: all 0.2s; color: #333; }
        .dark-mode .drag-item { background-color: #4f46e5; border-color: #6366f1; color: #fff; }
        .drag-item.dragging { opacity: 0.5; }
        .dropped-items .drag-item, .match-dropzone .drag-item { cursor: default; }
        .match-question-item { display: grid; grid-template-columns: 1fr 180px; align-items: center; gap: 8px; line-height: 1.5; padding: 10px 0; border-bottom: 1px dashed var(--line);}
        .match-question-item:last-child { border-bottom: none; }
        .match-dropzone { width: 100%; height: 38px; border: 2px dashed #9ca3af; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .match-dropzone.drag-over { border-color: var(--accent); background: #eff6ff; }
        .dark-mode .match-dropzone.drag-over { background: #1e3a8a; }

        /* Summary Completion Styles */
        .summary-completion p { line-height: 2.5; }
        .summary-completion input { border: none; border-bottom: 1px solid #9ca3af; padding: 2px 8px; font-size: 1em; background: transparent; color: var(--text-color); min-width: 120px; text-align: center; }
        .dark-mode .summary-completion input { border-bottom-color: #666; }
        .summary-completion input:focus { outline: none; border-bottom: 2px solid var(--accent); }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1>The Myth of the Eight-hour Sleep</h1>
            <div id="timer">00:00</div>
        </div>
        <div class="header-controls">
            <button class="header-btn" id="size-btn">Size</button>
            <button class="header-btn" id="color-btn">Color</button>
            <button class="header-btn" id="note-btn">Note</button>
        </div>
    </header>

    <div id="settings-panel">
        <div class="settings-group">
            <div class="settings-title">Font Size</div>
            <button class="settings-option active" data-size="regular">Regular</button>
            <button class="settings-option" data-size="large">Large</button>
            <button class="settings-option" data-size="xlarge">Extra Large</button>
        </div>
        <div class="settings-group">
            <div class="settings-title">Color Mode</div>
            <button class="settings-option active" data-mode="light">Black on White</button>
            <button class="settings-option" data-mode="dark">White on Black</button>
        </div>
    </div>

    <div id="notes-panel">
        <header>
            <h3>Notes</h3>
            <button id="close-note">Close</button>
        </header>
        <textarea placeholder="Write your notes here..."></textarea>
    </div>

    <div class="overlay"></div>

    <div class="shell">
        <section class="pane" id="left">
            <h2>READING PASSAGE 2</h2>
            <p>You should spend about 20 minutes on Questions 14-26, which are based on Reading Passage 2 on the following pages.</p>

            <h3>The Myth of the Eight-hour Sleep</h3>
            
            <div class="paragraph-wrapper">
                <div class="paragraph-dropzone" data-section="A" id="q14-dropzone">
                    <span class="paragraph-label">Section A (Q14):</span>
                    <div class="dropped-items"></div>
                </div>
                <p><strong>A</strong> We often worry about lying awake in the middle of the night—but it could be good for you. Indications from both science and history suggest that the eight-hour sleep may not be a natural or inborn pattern for humans. In the early 1990s, psychiatrist Thomas Wehr conducted research which implies just that. Wehr kept a group of people in a darkened room for 14 hours a day for a month. It took some time for their sleep to regulate, but by the fourth week the subjects had settled into a very distinct sleeping pattern. First, they slept for four hours, then woke for one or two hours before falling into a second four-hour sleep. Though sleep scientists were impressed by the implications of the study, the idea that we must sleep for eight consecutive hours persists amongst the general public.</p>
            </div>
            <div class="paragraph-wrapper">
                <div class="paragraph-dropzone" data-section="B" id="q15-dropzone">
                    <span class="paragraph-label">Section B (Q15):</span>
                    <div class="dropped-items"></div>
                </div>
                <p><strong>B</strong> In 2001, historian Roger Ekirch of Virginia Tech University in the US published a paper drawn from 16 years of research, revealing historical evidence that humans used to sleep in two distinct periods of time each night. Ekirch's research found more than 500 references to a segmented sleeping pattern—in diaries, court records, medical books and literature, from the ancient Greeks to tribes in Nigeria. Much like Wehr's findings, these references describe a first sleep which began not long following sunset. Then there was a waking period of one or two hours and after that a second sleep. During the waking period, people could be quite active. They sometimes got up and moved around the house, although most people stayed in bed, and perhaps read or wrote if they had enough money for candles. In many historic accounts, Ekirch found that people used the time that they were awake between periods of sleep to think about and attempt to analyse their dreams.</p>
                <p>In his book, <em>Evening's Empire</em>, historian Craig Koslofsky suggests an explanation for this divided sleep pattern in Europe. ‘Associations with night before the 17th century were not good,' he writes. He goes on to explain that the streets of the cities and towns at night were often populated by thieves or worse. The streets at night consequently scared many people. Even the wealthy, who could afford to light their way, had better things to spend their nights on.</p>
            </div>
            <div class="paragraph-wrapper">
                <div class="paragraph-dropzone" data-section="C" id="q16-dropzone">
                    <span class="paragraph-label">Section C (Q16):</span>
                    <div class="dropped-items"></div>
                </div>
                <p><strong>C</strong> Ekirch found that references to the first and second sleep started to disappear during the late 17th century. The pattern began to alter first among the upper classes in northern Europe and, over the course of the next 200 years, began changing amongst the rest of Western society. By the 1920s, the idea of a first and second sleep had receded entirely from our social consciousness. Ekirch attributes the initial shift to improvements in street and home lighting.</p>
                <p>As the night became a time for all kinds of activity, the length of time people slept declined. In 1667, Paris became the first city in the world to light its streets, using wax candles in glass lamps. It was followed by another French city, Lille, in the same year and by Amsterdam in Holland two years later, where a much more efficient oil-powered lamp was developed. London didn't light its streets until 1684, but by the end of the 17th century, more than 50 of Europe's major towns and cities were lit at night. Coffee houses emerged as a fashionable phenomenon and many were open virtually around the clock. Going out at night became commonplace, and spending hours lying in bed was considered a waste of time. 'People were becoming increasingly time-conscious and sensitive to efficiency, certainly before the 19th century,' says Ekirch. ‘But the Industrial Revolution intensified that attitude considerably.' Strong evidence of this shifting attitude is contained in a medical journal from 1829 which urged parents to force their children out of the pattern of first and second sleep.</p>
            </div>
            <div class="paragraph-wrapper">
                <div class="paragraph-dropzone" data-section="D" id="q17-dropzone">
                    <span class="paragraph-label">Section D (Q17):</span>
                    <div class="dropped-items"></div>
                </div>
                <p><strong>D</strong> Today, most people seem to have adapted quite well to the eight-hour sleep, but Ekirch believes many sleeping problems may have roots in the human body's natural preference for divided sleep, as well as in difficulties caused by extended exposure to artificial light in the modern world. This could be the cause of a condition called sleep maintenance insomnia, where people wake during the night and have trouble getting back to sleep. The condition first appears in literature at the end of the 19th century, at the same time as accounts of interrupted sleep disappear.</p>
            </div>
             <div class="paragraph-wrapper">
                <div class="paragraph-dropzone" data-section="E" id="q18-dropzone">
                    <span class="paragraph-label">Section E (Q18):</span>
                    <div class="dropped-items"></div>
                </div>
                <p><strong>E</strong> Sleep psychologist Gregg Jacobs says that the idea that we must sleep for an extended period of time could be damaging if it makes people who wake up in the night anxious, as this anxiety can itself discourage sleep and is likely to affect waking life too. Jacobs suggests that the waking period between sleeps, when people simply rested and relaxed, could have played an important part in the human capacity to regulate stress naturally. Russell Foster, a professor of circadian (body clock) neuroscience at Oxford University in the UK, shares this point of view. ‘Over 30% of the medical problems that doctors are faced with stem directly or indirectly from sleep. But sleep has been ignored in medical training, and there are very few centres where sleep is studied,' Foster says. He feels this needs to change.</p>
            </div>

            <div class="empty-space"></div>
        </section>
        
        <div id="divider"></div>
        
        <section class="pane" id="right">
            <h3>Questions</h3>
            
            <div class="group" id="q14-18-anchor">
                <h4>Questions 14–18</h4>
                <p>Reading Passage 2 has five sections, <strong>A–E</strong>.</p>
                <p>Choose the correct heading for each section from the list of headings below.</p>
                <p><em>Drag a heading from this list and drop it onto the correct section's answer box on the left.</em></p>
                <div class="headings-pool" id="headings-pool-container">
                    <strong>List of Headings</strong>
                    <div class="pool-items">
                        <div class="drag-item" draggable="true" data-heading="i">i Historical reasons why interrupted sleep became uncommon</div>
                        <div class="drag-item" draggable="true" data-heading="ii">ii Brain structures involved in sleep patterns</div>
                        <div class="drag-item" draggable="true" data-heading="iii">iii Potential health issues related to sleep</div>
                        <div class="drag-item" draggable="true" data-heading="iv">iv Famous cases in literature of sleep problems</div>
                        <div class="drag-item" draggable="true" data-heading="v">v An analysis of old documents to discover sleep patterns</div>
                        <div class="drag-item" draggable="true" data-heading="vi">vi Biological and environmental factors preventing people from falling asleep again</div>
                        <div class="drag-item" draggable="true" data-heading="vii">vii Scientific evidence that divided sleep is a natural phenomenon</div>
                    </div>
                </div>
            </div>
            
            <div class="group" id="q19-23-anchor">
                <h4>Questions 19–23</h4>
                <p>Look at the following statements (Questions 19–23) and the list of researchers below.</p>
                <p>Match each statement with the correct researcher, <strong>A–E</strong>.</p>
                <p><em>NB You may use any letter more than once.</em></p>
                
                <div class="match-question-item">
                    <p><strong>19</strong> In certain historical periods, the threat of criminal danger led to segmented sleep.</p>
                    <div class="match-dropzone" data-question="q19"></div>
                </div>
                <div class="match-question-item">
                    <p><strong>20</strong> Physicians should learn more about treating people with sleeping difficulties.</p>
                    <div class="match-dropzone" data-question="q20"></div>
                </div>
                <div class="match-question-item">
                     <p><strong>21</strong> Historically, when people experienced interrupted sleep, they used the waking periods at night for different activities.</p>
                    <div class="match-dropzone" data-question="q21"></div>
                </div>
                <div class="match-question-item">
                    <p><strong>22</strong> Technological changes in Europe made people more likely to sleep through the night.</p>
                    <div class="match-dropzone" data-question="q22"></div>
                </div>
                <div class="match-question-item">
                    <p><strong>23</strong> The belief that humans should have a long continuous sleep can be psychologically harmful.</p>
                    <div class="match-dropzone" data-question="q23"></div>
                </div>

                <div class="options-pool" id="researchers-options-pool">
                    <strong>List of Researchers</strong>
                    <div class="pool-items">
                        <div class="drag-item" draggable="true" data-option="A">A Thomas Wehr</div>
                        <div class="drag-item" draggable="true" data-option="B">B Roger Ekirch</div>
                        <div class="drag-item" draggable="true" data-option="C">C Craig Koslofsky</div>
                        <div class="drag-item" draggable="true" data-option="D">D Gregg Jacobs</div>
                        <div class="drag-item" draggable="true" data-option="E">E Russell Foster</div>
                    </div>
                </div>
            </div>

            <div class="group" id="q24-26-anchor">
                <h4>Questions 24–26</h4>
                <p>Complete the summary below.</p>
                <p>Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                <div class="summary-completion">
                    <h4>Historical patterns of interrupted sleep</h4>
                    <p>
                    Historical evidence seems to show that humans had common sleep patterns which were quite unlike today's eight hours of unbroken sleep each night. People habitually went to bed early, soon after <strong>24</strong> <input type="text" id="q24_input">, slept for a while, then woke up for a few hours of activity or perhaps to consider, for example, the meaning of their <strong>25</strong> <input type="text" id="q25_input">.
                    </p>
                    <p>
                    There was little else to do at home in the dark, since what little means of lighting they had, such as using candles, was costly. In 16th-century Europe, people tended to stay at home at night because they feared <strong>26</strong> <input type="text" id="q26_input"> on largely unlit city streets. Once urban street lighting improved, nightlife in cities became popular, and recreational spots like coffee houses came to be considered fashionable. Consequently, sleeping patterns also began to change.
                    </p>
                </div>
            </div>
            
            <div id="results"></div>
        </section>
    </div>
    
    <div class="practice-nav">
        <div class="title">Questions</div>
        <div class="questions">
            <div class="q-item" id="q14-nav" onclick="scrollToElement('q14-18-anchor')">14</div>
            <div class="q-item" id="q15-nav" onclick="scrollToElement('q14-18-anchor')">15</div>
            <div class="q-item" id="q16-nav" onclick="scrollToElement('q14-18-anchor')">16</div>
            <div class="q-item" id="q17-nav" onclick="scrollToElement('q14-18-anchor')">17</div>
            <div class="q-item" id="q18-nav" onclick="scrollToElement('q14-18-anchor')">18</div>
            <div class="q-item" id="q19-nav" onclick="scrollToElement('q19-23-anchor')">19</div>
            <div class="q-item" id="q20-nav" onclick="scrollToElement('q19-23-anchor')">20</div>
            <div class="q-item" id="q21-nav" onclick="scrollToElement('q19-23-anchor')">21</div>
            <div class="q-item" id="q22-nav" onclick="scrollToElement('q19-23-anchor')">22</div>
            <div class="q-item" id="q23-nav" onclick="scrollToElement('q19-23-anchor')">23</div>
            <div class="q-item" id="q24-nav" onclick="scrollToElement('q24-26-anchor')">24</div>
            <div class="q-item" id="q25-nav" onclick="scrollToElement('q24-26-anchor')">25</div>
            <div class="q-item" id="q26-nav" onclick="scrollToElement('q24-26-anchor')">26</div>
        </div>
        <div class="controls">
            <button id="submit-btn" class="primary">Submit</button>
            <button id="reset-btn">Reset</button>
            <button id="pause-btn">Pause</button>
        </div>
    </div>

    <div aria-label="Selection tools" id="selbar" role="toolbar">
        <button id="btnHL">Highlight</button>
        <button id="btnUH">Remove</button>
        <button id="btnNote">Note</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Global State ---
            let settingsOpen = false, notesOpen = false;
            let timerRunning = true, seconds = 0, timer;
            let isResizing = false;
            let selbar = document.getElementById('selbar');
            let lastRange = null, currentHlNode = null, keepToolbar = false;
            let draggedElement = null;
            const questionNumbers = Array.from({length: 13}, (_, i) => i + 14);
            
            const correctAnswers = {
                q14: 'vii', q15: 'v', q16: 'i', q17: 'vi', q18: 'iii',
                q19: 'C', q20: 'E', q21: 'B', q22: 'B', q23: 'D',
                q24: 'sunset', q25: 'dreams', q26: 'thieves'
            };

            // --- Core Functions ---
            function startTimer() {
                timer = setInterval(() => {
                    if (timerRunning) {
                        seconds++;
                        const minutes = String(Math.floor(seconds / 60)).padStart(2, '0');
                        const secs = String(seconds % 60).padStart(2, '0');
                        document.getElementById('timer').textContent = `${minutes}:${secs}`;
                    }
                }, 1000);
            }

            function closeAllPanels() {
                notesOpen = false; settingsOpen = false;
                document.getElementById('notes-panel').style.display = 'none';
                document.getElementById('settings-panel').style.display = 'none';
                document.querySelector('.overlay').style.display = 'none';
            }

            window.scrollToElement = function(id) {
                const element = document.getElementById(id);
                const pane = element.closest('.pane');
                if (element && pane) {
                    const top = element.offsetTop - 20;
                    pane.scrollTo({ top, behavior: 'smooth' });
                }
            }
            
            // --- Drag and Drop Logic ---
            function setupDragAndDrop() {
                const draggables = document.querySelectorAll('.drag-item');
                const dropTargets = document.querySelectorAll('.paragraph-dropzone, .match-dropzone');
                const pools = document.querySelectorAll('.headings-pool, .options-pool');

                draggables.forEach(draggable => {
                    draggable.addEventListener('dragstart', (e) => {
                        draggedElement = draggable;
                        setTimeout(() => draggable.classList.add('dragging'), 0);
                    });
                    draggable.addEventListener('dragend', () => {
                        if (draggedElement) draggedElement.classList.remove('dragging');
                        draggedElement = null;
                    });
                });

                const handleDragOver = e => {
                    e.preventDefault();
                    const target = e.target.closest('.paragraph-dropzone, .match-dropzone, .headings-pool, .options-pool');
                    if (target) target.classList.add('drag-over');
                };

                const handleDragLeave = e => {
                    const target = e.target.closest('.paragraph-dropzone, .match-dropzone, .headings-pool, .options-pool');
                    if (target) target.classList.remove('drag-over');
                };

                const handleDrop = e => {
                    e.preventDefault();
                    const target = e.target.closest('.paragraph-dropzone, .match-dropzone, .headings-pool, .options-pool');
                    if (!target || !draggedElement) return;
                    
                    target.classList.remove('drag-over');

                    if (target.classList.contains('paragraph-dropzone')) {
                        const droppedItemsContainer = target.querySelector('.dropped-items');
                        const pool = document.getElementById('headings-pool-container');
                        if (droppedItemsContainer.children.length > 0) {
                            pool.querySelector('.pool-items').appendChild(droppedItemsContainer.firstElementChild);
                        }
                        droppedItemsContainer.appendChild(draggedElement);
                    } else if (target.classList.contains('match-dropzone')) {
                         target.innerHTML = '';
                         const clone = draggedElement.cloneNode(true);
                         target.appendChild(clone);
                    } else if (target.classList.contains('headings-pool') || target.classList.contains('options-pool')) {
                         target.querySelector('.pool-items').appendChild(draggedElement);
                    }

                    updateAnsweredState();
                };

                [...dropTargets, ...pools].forEach(container => {
                    container.addEventListener('dragover', handleDragOver);
                    container.addEventListener('dragleave', handleDragLeave);
                    container.addEventListener('drop', handleDrop);
                });
            }

            // --- Grading and State Update ---
            function updateAnsweredState() {
                questionNumbers.forEach(i => {
                    const navItem = document.getElementById(`q${i}-nav`);
                    if (!navItem || navItem.classList.contains('correct') || navItem.classList.contains('incorrect')) return;

                    let answered = false;
                    if (i >= 14 && i <= 18) {
                        answered = document.querySelector(`#q${i}-dropzone .dropped-items`).hasChildNodes();
                    } else if (i >= 19 && i <= 23) {
                        answered = document.querySelector(`.match-dropzone[data-question="q${i}"]`).hasChildNodes();
                    } else if (i >= 24 && i <= 26) {
                        answered = document.getElementById(`q${i}_input`).value.trim() !== "";
                    }
                    navItem.classList.toggle('answered', answered);
                });
            }
            
            function gradeAnswers() {
                timerRunning = false;
                document.getElementById('pause-btn').textContent = 'Continue';
                let correctCount = 0;
                const totalQuestions = questionNumbers.length;
                let resultsHTML = '<h4>Results</h4><table class="results-table"><thead><tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Result</th></tr></thead><tbody>';

                // Grade Q14-18 (Heading Matching)
                for (let i = 14; i <= 18; i++) {
                    const dropzone = document.querySelector(`#q${i}-dropzone .dropped-items`);
                    const droppedItem = dropzone.querySelector('.drag-item');
                    const userAnswer = droppedItem ? droppedItem.dataset.heading : 'No Answer';
                    const correctAnswer = correctAnswers[`q${i}`];
                    const isCorrect = userAnswer === correctAnswer;
                    if (isCorrect) correctCount++;
                    document.getElementById(`q${i}-nav`).classList.add(isCorrect ? 'correct' : 'incorrect');
                    resultsHTML += `<tr><td>${i}</td><td>${userAnswer}</td><td>${correctAnswer}</td><td class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '✓' : '✗'}</td></tr>`;
                }

                // Grade Q19-23 (Matching Researchers)
                for (let i = 19; i <= 23; i++) {
                    const dropzone = document.querySelector(`.match-dropzone[data-question="q${i}"]`);
                    const droppedItem = dropzone.querySelector('.drag-item');
                    const userAnswer = droppedItem ? droppedItem.dataset.option : 'No Answer';
                    const correctAnswer = correctAnswers[`q${i}`];
                    const isCorrect = userAnswer === correctAnswer;
                    if (isCorrect) correctCount++;
                    document.getElementById(`q${i}-nav`).classList.add(isCorrect ? 'correct' : 'incorrect');
                    resultsHTML += `<tr><td>${i}</td><td>${userAnswer}</td><td>${correctAnswer}</td><td class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '✓' : '✗'}</td></tr>`;
                }

                // Grade Q24-26 (Summary Completion)
                for (let i = 24; i <= 26; i++) {
                    const input = document.getElementById(`q${i}_input`);
                    const userAnswer = input.value.trim().toLowerCase() || 'No Answer';
                    const correctAnswer = correctAnswers[`q${i}`];
                    const isCorrect = userAnswer === correctAnswer;
                    if (isCorrect) correctCount++;
                    document.getElementById(`q${i}-nav`).classList.add(isCorrect ? 'correct' : 'incorrect');
                    resultsHTML += `<tr><td>${i}</td><td>${input.value.trim() || 'No Answer'}</td><td>${correctAnswer}</td><td class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '✓' : '✗'}</td></tr>`;
                }

                const score = Math.round((correctCount / totalQuestions) * 100);
                const summary = `<div style="font-weight:bold; margin-top:16px; font-size:1.1em;">Final Score: ${score}% (${correctCount}/${totalQuestions})</div>`;
                resultsHTML += `</tbody></table>`;
                
                document.getElementById('results').innerHTML = summary + resultsHTML;
                document.getElementById('results').style.display = 'block';
                scrollToElement('results');
            }

            function resetQuiz() {
                // Reset drag and drop
                const headingPool = document.getElementById('headings-pool-container').querySelector('.pool-items');
                document.querySelectorAll('.paragraph-dropzone .dropped-items .drag-item').forEach(item => headingPool.appendChild(item));
                
                const researchersPool = document.getElementById('researchers-options-pool').querySelector('.pool-items');
                document.querySelectorAll('.match-dropzone .drag-item').forEach(item => {
                    // Check if the pool already has this item before appending
                    let alreadyInPool = false;
                    for (const child of researchersPool.children) {
                        if (child.dataset.option === item.dataset.option) {
                            alreadyInPool = true;
                            break;
                        }
                    }
                    // This logic is tricky with cloning. A better way is to just rebuild the pool from a master list, but for now, we'll clear the dropzones and let the user re-drag from the existing pool items.
                });
                document.querySelectorAll('.match-dropzone').forEach(dz => dz.innerHTML = '');

                // Reset inputs
                document.querySelectorAll('input[type="text"]').forEach(el => el.value = '');
                
                // Reset UI
                document.querySelectorAll('.q-item').forEach(item => item.className = 'q-item');
                const resultsDiv = document.getElementById('results');
                resultsDiv.style.display = 'none';
                resultsDiv.innerHTML = '';
                
                // Reset timer
                seconds = 0;
                if (timer) clearInterval(timer);
                startTimer();
                document.getElementById('timer').textContent = '00:00';
                timerRunning = true;
                document.getElementById('pause-btn').textContent = 'Pause';
                updateAnsweredState();
            }

            // --- Highlighter & Selection Toolbar ---
            function positionSelbarForRect(rect) {
                selbar.style.display = 'flex';
                requestAnimationFrame(() => {
                    const top = window.scrollY + rect.top - selbar.offsetHeight - 8;
                    const left = window.scrollX + rect.left + rect.width / 2 - selbar.offsetWidth / 2;
                    selbar.style.top = `${(top > 0) ? top : (window.scrollY + rect.bottom + 8)}px`;
                    selbar.style.left = `${Math.max(8, left)}px`;
                });
            }

            function updateSelbar() {
                const sel = window.getSelection();
                if (!sel || sel.rangeCount === 0 || sel.isCollapsed) {
                    if (!keepToolbar && !currentHlNode) { selbar.style.display = 'none'; currentHlNode = null; }
                    return;
                }
                const range = sel.getRangeAt(0);
                let container = range.commonAncestorContainer;
                if (container.nodeType === Node.TEXT_NODE) container = container.parentElement;
                
                const isInAllowedPane = document.getElementById('left').contains(container) || document.getElementById('right').contains(container);
                const isHighlighted = container.classList?.contains('hl') || container.closest('.hl');
                if (!isInAllowedPane && !isHighlighted) { selbar.style.display = 'none'; return; }
                
                lastRange = range.cloneRange();
                currentHlNode = isHighlighted ? container.closest('.hl') : null;
                positionSelbarForRect(range.getBoundingClientRect());
            }

            function doHighlight() {
                if (currentHlNode || !lastRange || lastRange.collapsed) return;
                const sel = window.getSelection();
                try {
                    const span = document.createElement('span');
                    span.className = 'hl';
                    lastRange.surroundContents(span);
                } catch (e) { console.error("Highlighting failed:", e); return; }
                sel?.removeAllRanges();
                selbar.style.display = 'none';
            }

            function removeHighlight() {
                const sel = window.getSelection();
                let targetNode = currentHlNode;
                if (!targetNode && lastRange) {
                    const ancestor = lastRange.commonAncestorContainer;
                    targetNode = ancestor.nodeType === Node.TEXT_NODE ? ancestor.parentElement.closest('.hl') : ancestor.closest('.hl');
                }
                if (targetNode) {
                    const p = targetNode.parentNode;
                    while (targetNode.firstChild) p.insertBefore(targetNode.firstChild, targetNode);
                    if(p) p.removeChild(targetNode);
                    p?.normalize();
                }
                currentHlNode = null; sel?.removeAllRanges(); selbar.style.display = 'none';
            }

            // --- Event Listeners Setup ---
            startTimer();
            setupDragAndDrop();

            // Header controls
            document.getElementById('size-btn').addEventListener('click', (e) => { e.stopPropagation(); settingsOpen = !settingsOpen; document.getElementById('settings-panel').style.display = settingsOpen ? 'block' : 'none'; });
            document.getElementById('color-btn').addEventListener('click', (e) => { e.stopPropagation(); settingsOpen = !settingsOpen; document.getElementById('settings-panel').style.display = settingsOpen ? 'block' : 'none'; });
            document.getElementById('note-btn').addEventListener('click', () => { closeAllPanels(); notesOpen = true; document.getElementById('notes-panel').style.display = 'flex'; document.querySelector('.overlay').style.display = 'block'; });
            document.querySelectorAll('.settings-option[data-size]').forEach(btn => btn.addEventListener('click', function() { document.documentElement.className = `font-${this.dataset.size}`; document.querySelectorAll('.settings-option[data-size]').forEach(b => b.classList.remove('active')); this.classList.add('active'); }));
            document.querySelectorAll('.settings-option[data-mode]').forEach(btn => btn.addEventListener('click', function() { document.body.classList.toggle('dark-mode', this.dataset.mode === 'dark'); document.querySelectorAll('.settings-option[data-mode]').forEach(b => b.classList.remove('active')); this.classList.add('active'); }));
            document.getElementById('close-note').addEventListener('click', closeAllPanels);
            document.querySelector('.overlay').addEventListener('click', closeAllPanels);
            document.addEventListener('click', (e) => {
                const settingsPanel = document.getElementById('settings-panel');
                const headerControls = document.querySelector('.header-controls');
                if (!settingsPanel.contains(e.target) && !headerControls.contains(e.target)) { settingsPanel.style.display = 'none'; settingsOpen = false; }
            });

            // Bottom nav controls
            document.getElementById('submit-btn').addEventListener('click', gradeAnswers);
            document.getElementById('reset-btn').addEventListener('click', resetQuiz);
            document.getElementById('pause-btn').addEventListener('click', function() { timerRunning = !timerRunning; this.textContent = timerRunning ? 'Pause' : 'Continue'; });

            // Pane resizing
            const divider = document.getElementById('divider');
            const leftPane = document.getElementById('left');
            divider.addEventListener('mousedown', (e) => { isResizing = true; document.body.style.cursor = 'ew-resize'; e.preventDefault(); });
            document.addEventListener('mousemove', (e) => { if (!isResizing) return; const shellRect = document.querySelector('.shell').getBoundingClientRect(); let leftWidth = (e.clientX - shellRect.left) / shellRect.width * 100; leftPane.style.width = `${Math.max(20, Math.min(80, leftWidth))}%`; });
            document.addEventListener('mouseup', () => { if (isResizing) { isResizing = false; document.body.style.cursor = ''; } });
            
            // Update answered state on input/change
            document.getElementById('right').addEventListener('change', updateAnsweredState);
            document.getElementById('right').addEventListener('input', updateAnsweredState);
            document.getElementById('right').addEventListener('drop', () => setTimeout(updateAnsweredState, 0));

            // Selection toolbar events
            document.addEventListener('mouseup', () => setTimeout(updateSelbar, 10));
            document.addEventListener('selectionchange', () => setTimeout(updateSelbar, 10));
            document.addEventListener('mousedown', (e) => { keepToolbar = !!e.target.closest('#selbar, .hl'); }, true);
            document.addEventListener('click', (e) => {
                const target = e.target;
                if (target.classList.contains('hl')) {
                    currentHlNode = target; lastRange = null; positionSelbarForRect(target.getBoundingClientRect());
                    window.getSelection()?.removeAllRanges(); setTimeout(() => { keepToolbar = false; }, 0);
                } else if (!selbar.contains(e.target)) { selbar.style.display = 'none'; currentHlNode = null; }
            }, true);
            document.getElementById('btnHL').addEventListener('click', doHighlight);
            document.getElementById('btnUH').addEventListener('click', removeHighlight);
            document.getElementById('btnNote').addEventListener('click', function() {
                let text = (currentHlNode ? currentHlNode.textContent : (lastRange ? lastRange.cloneContents().textContent : '')).trim();
                if (text) {
                    const noteArea = document.querySelector('#notes-panel textarea');
                    noteArea.value += (noteArea.value ? '\n\n' : '') + '> ' + text;
                    closeAllPanels(); notesOpen = true; document.getElementById('notes-panel').style.display = 'flex';
                    document.querySelector('.overlay').style.display = 'block'; noteArea.scrollTop = noteArea.scrollHeight;
                }
                selbar.style.display = 'none';
            });
        });
    </script>
</body>
</html>