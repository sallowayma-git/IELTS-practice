<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reading Practice - The Burgess Shale fossils</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --line: #e5e7eb;
            --bg: #f6f7fb;
            --panel: #fff;
            --accent: #3b82f6;
            --muted: #6b7280;
            --shadow: 0 6px 20px rgba(0,0,0,.12);
            --text-color: #333;
            --highlight: #fff3a3;
            --selbar-bg: #111;
            --selbar-text: #fff;
        }

        body.dark-mode {
            --line: #4a4a4a;
            --bg: #1a1a1a;
            --panel: #2a2a2a;
            --muted: #bbb;
            --text-color: #f0f0f0;
            --highlight: #5b21b6;
            --selbar-bg: #1f2937;
            --selbar-text: #e5e7eb;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html { font-size: 16px; scroll-behavior: smooth; }
        html.font-regular { font-size: 16px; }
        html.font-large { font-size: 18px; }
        html.font-xlarge { font-size: 20px; }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            background: var(--bg);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease;
            padding-bottom: 64px;
        }

        .header {
            background-color: var(--panel);
            padding: 12px 20px;
            border-bottom: 1px solid var(--line);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header h1 {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #timer {
            font-size: 1rem;
            font-weight: 500;
            background: var(--bg);
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--line);
            min-width: 90px;
            text-align: center;
            color: var(--text-color);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-btn {
            background: var(--panel);
            border: 1px solid var(--line);
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            color: var(--text-color);
        }

        .header-btn:hover {
            background: var(--bg);
            border-color: var(--accent);
        }

        #settings-panel {
            position: absolute;
            top: 60px;
            right: 20px;
            width: 200px;
            background: var(--panel);
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--line);
            z-index: 1000;
            padding: 8px;
            display: none;
        }

        .settings-group {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--line);
        }
        .settings-group:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

        .settings-title {
            font-size: 0.85rem;
            color: var(--muted);
            margin-bottom: 8px;
            padding-left: 12px;
        }

        .settings-option {
            display: block;
            width: 100%;
            text-align: left;
            padding: 8px 12px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.9rem;
            border-radius: 6px;
            color: var(--text-color);
        }

        .settings-option.active {
            background: #e9effd;
            color: var(--accent);
            font-weight: 500;
        }
        
        .dark-mode .settings-option.active {
            background: #1e3a8a;
        }

        #notes-panel {
            position: fixed;
            right: 12px;
            bottom: 76px;
            width: 320px;
            height: 45vh;
            background: var(--panel);
            border: 1px solid var(--line);
            border-radius: 12px;
            display: none;
            flex-direction: column;
            z-index: 900;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        #notes-panel header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--line);
            background-color: var(--bg);
        }

        #notes-panel h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }

        #notes-panel textarea {
            flex: 1;
            border: 0;
            padding: 16px;
            resize: none;
            font-size: 0.95rem;
            background: transparent;
            color: var(--text-color);
            line-height: 1.6;
        }

        #notes-panel textarea:focus {
            outline: none;
        }

        #close-note {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid var(--line);
            background: transparent;
            cursor: pointer;
            color: var(--text-color);
            transition: background-color 0.2s;
        }
        
        #close-note:hover {
            background-color: rgba(0,0,0,0.1);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.08);
            z-index: 800;
            display: none;
            backdrop-filter: blur(2px);
        }
        
        .dark-mode .overlay {
            background: rgba(0, 0, 0, 0.3);
        }

        .shell {
            display: flex;
            height: calc(100vh - 58px - 64px);
            width: 100%;
            overflow: hidden;
        }

        .pane {
            background: var(--panel);
            overflow: auto;
            padding: 24px;
        }

        #left {
            min-width: 280px;
            max-width: calc(100% - 280px);
            width: 50%;
        }

        #right {
            min-width: 280px;
            flex: 1;
            background: var(--bg);
            border-left: 1px solid var(--line);
        }
        
        .dark-mode #right {
            background: #1a1a1a;
        }

        #divider {
            flex: 0 0 8px;
            background: var(--bg);
            cursor: ew-resize;
            user-select: none;
            position: relative;
        }
        
        #divider::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 30px;
            border-radius: 2px;
            background: rgba(100, 100, 100, 0.3);
        }
        
        #divider:hover {
            background: #dbeafe;
        }
        
        .dark-mode #divider:hover {
             background: #1e40af;
        }

        h2, h3, h4 {
            margin: 0 0 16px;
            color: var(--text-color);
        }
        
        #left p, #right p {
            margin: 0 0 16px;
            line-height: 1.7;
        }
        
        .group {
            background: var(--panel);
            border: 1px solid var(--line);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .question-item {
            padding: 12px 0;
            border-bottom: 1px dashed var(--line);
        }
        
        .question-item:last-child {
            border-bottom: none;
        }

        .radio-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }

        .radio-options label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        input.blank {
            border: none;
            border-bottom: 1px solid #9ca3af;
            padding: 2px 8px;
            font-size: 1em;
            background: transparent;
            color: var(--text-color);
            min-width: 150px;
            text-align: center;
        }
        
        .dark-mode input.blank {
            border-bottom-color: #666;
        }

        input.blank:focus {
            outline: none;
            border-bottom: 2px solid var(--accent);
        }
        
        .notes-section p, .table-section table {
            line-height: 2.2;
            margin-bottom: 12px;
        }
        
        .table-section table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        
        .table-section th, .table-section td {
            border: 1px solid var(--line);
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }

        .table-section th {
            background-color: var(--bg);
            font-weight: 600;
        }
        
        .table-section ul {
            padding-left: 20px;
            margin: 0;
        }
        
        .table-section li {
            margin-bottom: 8px;
        }

        #results {
            background: var(--panel);
            border: 1px solid var(--line);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
            line-height: 1.8;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            font-size: 0.9rem;
        }

        .results-table th, .results-table td {
            border: 1px solid var(--line);
            padding: 8px;
            text-align: center;
        }
        
        .results-table th { background: var(--bg); }
        .result-correct { color: #10b981; font-weight: bold; }
        .result-incorrect { color: #ef4444; font-weight: bold; }

        .hl {
            background: var(--highlight);
            box-shadow: inset 0 -2px 0 rgba(0,0,0,.05);
            cursor: pointer;
        }
        .dark-mode .hl { color: #f5f3ff; }

        #selbar {
            position: absolute;
            display: none;
            z-index: 6000;
            background: var(--selbar-bg);
            color: var(--selbar-text);
            border-radius: 8px;
            padding: 6px;
            box-shadow: var(--shadow);
            font-size: 13px;
            gap: 6px;
            align-items: center;
        }
        
        #selbar button {
            background: transparent;
            color: var(--selbar-text);
            border: 1px solid rgba(255,255,255,.25);
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
        }
        
        #selbar button:hover { border-color: var(--selbar-text); }

        .practice-nav {
            background: var(--panel);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 -2px 4px rgba(0,0,0,.05);
            flex-wrap: wrap;
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            border-top: 1px solid var(--line);
            z-index: 4000;
        }
        
        .practice-nav .title { font-weight: 600; color: var(--muted); }
        .practice-nav .questions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        
        .practice-nav .q-item {
            padding: 6px 10px;
            border: 1px solid var(--line);
            border-radius: 6px;
            background: var(--panel);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            min-width: 36px;
            text-align: center;
            color: var(--text-color);
        }

        .practice-nav .q-item:hover { background: var(--bg); border-color: var(--accent); }
        
        .practice-nav .q-item.answered {
            background: #e0e7ff;
            border-color: var(--accent);
            color: var(--accent);
            font-weight: 500;
        }
        
        .dark-mode .practice-nav .q-item.answered { background: #3949ab; border-color: var(--accent); color: #e8eaf6; }
        
        .practice-nav .q-item.correct { background: #dcfce7; border-color: #4ade80; color: #15803d; }
        .dark-mode .practice-nav .q-item.correct { background: #166534; border-color: #4ade80; color: #dcfce7; }
        
        .practice-nav .q-item.incorrect { background: #fee2e2; border-color: #f87171; color: #b91c1c; }
        .dark-mode .practice-nav .q-item.incorrect { background: #991b1b; border-color: #f87171; color: #fee2e2; }

        .practice-nav .controls { margin-left: auto; display: flex; align-items: center; gap: 12px; }
        
        .practice-nav .controls button {
            padding: 8px 12px;
            border: 1px solid var(--line);
            border-radius: 6px;
            background: var(--panel);
            cursor: pointer;
            color: var(--text-color);
        }
        
        .practice-nav .controls button.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
        
        .empty-space { height: 40px; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1>P1 - The Burgess Shale fossils</h1>
            <div id="timer">00:00</div>
        </div>
        <div class="header-controls">
            <button class="header-btn" id="size-btn">Size</button>
            <button class="header-btn" id="color-btn">Color</button>
            <button class="header-btn" id="note-btn">Note</button>
        </div>
    </header>

    <div id="settings-panel">
        <div class="settings-group">
            <div class="settings-title">Font Size</div>
            <button class="settings-option active" data-size="regular">Regular</button>
            <button class="settings-option" data-size="large">Large</button>
            <button class="settings-option" data-size="xlarge">Extra Large</button>
        </div>
        <div class="settings-group">
            <div class="settings-title">Color Mode</div>
            <button class="settings-option active" data-mode="light">Black on White</button>
            <button class="settings-option" data-mode="dark">White on Black</button>
        </div>
    </div>

    <div id="notes-panel">
        <header>
            <h3>Notes</h3>
            <button id="close-note">Close</button>
        </header>
        <textarea placeholder="Write your notes here..."></textarea>
    </div>

    <div class="overlay"></div>

    <div class="shell">
        <section class="pane" id="left">
            <h2>READING PASSAGE 1</h2>
            <p>You should spend about 20 minutes on Questions 1–13, which are based on Reading Passage 1 below.</p>
            
            <h3>The Burgess Shale fossils</h3>
            <h4>Fauna vanished with a whimper, not a bang</h4>
            
            <p>Some discoveries are so unusual it takes decades and sometimes even centuries to understand their full significance. One such discovery is the fossil bed known as the Burgess Shale, which contains a record of bizarre creatures that lived 505 million years ago. It was discovered in the Canadian Rockies over a century ago, and was popularized in 1989 in a book, <em>Wonderful Life</em>, by Stephen Jay Gould, an American paleontologist.</p>
            <p>The Burgess Shale fossils were created at a time when the future Canadian land mass was situated near the Earth's equator. The creatures were preserved when an entire marine ecosystem was buried in mud that eventually hardened and became exposed hundreds of millions of years later in an outcrop of the Rocky Mountains. American paleontologist Charles Walcott, following reports of fabulous fossil finds by construction workers on a Canadian railway who were digging in the mountains in the late 19th century, is said to have tripped over a block of shale in 1909 that revealed the area's remarkable supply of specimens. It has long been believed that the curious fauna that lived there vanished in a series of extinctions because the fossil record ends abruptly. But that no longer appears to be the case.</p>
            <p>The Burgess Shale began to form soon after a period known as the Cambrian explosion, when most major groups of complex animals arose over a surprisingly short period. Before 560 million years ago, most living things were either individual cells or simple colonies of cells. Then, and for reasons that remain a mystery, life massively diversified and became ever more complex as the rate of evolution increased. An unusual feature of the Burgess Shale is that it is one of the earliest fossil beds to contain impressions of soft body parts alongside the remains of bones and shells, which is highly unusual.</p>
            <p>Although the fossil bed was discovered on a mountain, these animals originally existed below an ocean, the bed of which was later pushed up to create the Rockies. Nobody knows exactly why they were so well preserved. One possibility is that the creatures were buried quickly and in conditions that were hostile to the bacteria that cause decomposition of soft body parts.</p>
            <p>Those who first worked on the Burgess Shale, unearthing 65,000 specimens over a 14-year period up to 1924, assumed that the fossils came from extinct members of groups of animals in existence today. This turned out to be misleading because many of the creatures are so unusual that they are still difficult to classify.</p>
            <p>One such example is Opabinia, a creature that grew to about 8 cm (3 inches), had five eyes, a body that was a series of lobes, a tail in the shape of a fan, and that ate using a proboscis.</p>
            <p>The proboscis had a set of grasping claws on the end, with which it grabbed food and stuffed it into its mouth. Nectocaris, meanwhile, could be mistaken for a leech, but with fins and tentacles. Weirdest of all was Hallucigenia, described by paleontologist Simon Conway Morris, when he re-examined Walcott's specimens in 1979. With its multiplicity of spines and tentacles, little about Hallucigenia made sense, but scientists hypothesized that the spines were legs that helped it move and the tentacles were for feeding. Like an abstract painting, its orientation is a mystery at first, making it difficult to work out which way up it went, which hole food went into, and which hole food came out of.</p>
            <p>Paleontologists had long thought that many of the Burgess Shale animals were examples of experiments in evolution. In other words, entirely new forms of life that did not survive or lead to other groups or species. Hallucigenia, ironically, turned out to be the exception that proved the rule. It is now thought to be an ancestor of the modern group of arthropods, which includes everything from flies and butterflies to centipedes and crabs.</p>
            <p>Now another misconception has been quashed. Writing in <em>Nature</em> recently, Peter Van Roy of Yale University in the United States and his colleagues suggest that the sudden absence of such crazy soft-bodied fossils does not indicate a mass extinction, but merely an end to the unusual local circumstances that caused the creatures to be preserved. In an area of the Atlas Mountains of Morocco, Van Roy's team of researchers has found another diverse (and sometimes bizarre) assemblage of soft-bodied organisms from a period after the Burgess Shale was formed. One discovery includes something that may be a stalked barnacle. This suggests that the evolution of such complex life went on uninterrupted. For its part, the Burgess Shale continues to produce an astonishing array of indefinable creatures faster than paleontologists can examine them. The world still has plenty to learn about this wonderful life.</p>
            
            <div class="empty-space"></div>
        </section>
        
        <div id="divider"></div>
        
        <section class="pane" id="right">
            <h3>Questions</h3>
            
            <div class="group" id="q1-5-anchor">
                <h4>Questions 1–5</h4>
                <p>Do the following statements agree with the information given in Reading Passage 1?</p>
                <p>In boxes 1–5 on your answer sheet, write</p>
                <ul style="list-style-type: none; padding-left: 0;">
                    <li><strong>TRUE</strong> if the statement agrees with the information</li>
                    <li><strong>FALSE</strong> if the statement contradicts the information</li>
                    <li><strong>NOT GIVEN</strong> if there is no information on this</li>
                </ul>
                
                <div class="question-item" id="q1-anchor">
                    <p><strong>1</strong> The Burgess Shale became widely known to the public because of Gould's book.</p>
                    <div class="radio-options">
                        <label><input name="q1" type="radio" value="TRUE"> TRUE</label>
                        <label><input name="q1" type="radio" value="FALSE"> FALSE</label>
                        <label><input name="q1" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
                    </div>
                </div>
                
                <div class="question-item" id="q2-anchor">
                    <p><strong>2</strong> Charles Walcott had to get permission from Canadian authorities to gain access to the fossil site.</p>
                    <div class="radio-options">
                        <label><input name="q2" type="radio" value="TRUE"> TRUE</label>
                        <label><input name="q2" type="radio" value="FALSE"> FALSE</label>
                        <label><input name="q2" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
                    </div>
                </div>
                
                <div class="question-item" id="q3-anchor">
                    <p><strong>3</strong> The Burgess Shale includes impressions of soft and hard body parts.</p>
                    <div class="radio-options">
                        <label><input name="q3" type="radio" value="TRUE"> TRUE</label>
                        <label><input name="q3" type="radio" value="FALSE"> FALSE</label>
                        <label><input name="q3" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
                    </div>
                </div>

                <div class="question-item" id="q4-anchor">
                    <p><strong>4</strong> The Burgess Shale creatures were land animals.</p>
                    <div class="radio-options">
                        <label><input name="q4" type="radio" value="TRUE"> TRUE</label>
                        <label><input name="q4" type="radio" value="FALSE"> FALSE</label>
                        <label><input name="q4" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
                    </div>
                </div>
                
                <div class="question-item" id="q5-anchor">
                    <p><strong>5</strong> Researchers now believe that Hallucigenia is unrelated to any modern creature.</p>
                    <div class="radio-options">
                        <label><input name="q5" type="radio" value="TRUE"> TRUE</label>
                        <label><input name="q5" type="radio" value="FALSE"> FALSE</label>
                        <label><input name="q5" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
                    </div>
                </div>
            </div>
            
            <div class="group" id="q6-9-anchor">
                <h4>Questions 6–9</h4>
                <p>Complete the notes below.</p>
                <p>Choose <strong>NO MORE THAN TWO WORDS AND/OR A NUMBER</strong> from the passage for each answer.</p>
                
                <div class="notes-section">
                    <h4 style="text-align: center; margin-bottom: 20px;">Burgess Shale</h4>
                    <h5>Formation</h5>
                    <p>• Burgess Shale was formed following a time called the <strong>6</strong> <input class="blank" name="q6"></p>

                    <h5>Discovery and investigation in the twentieth century</h5>
                    <p>• Discovered in 1909</p>
                    <p>• Charles Walcott learnt of the fossil finds from people building a <strong>7</strong> <input class="blank" name="q7"></p>
                    <p>• The first work on Burgess Shale was undertaken at the start of the century</p>
                    <p>• A researcher looked at Burgess Shale findings again in <strong>8</strong> <input class="blank" name="q8"></p>

                    <h5>Recent theories</h5>
                    <p>• Peter Van Roy</p>
                    <p style="padding-left: 20px;">– Believes that discoveries in Morocco show that the <strong>9</strong> <input class="blank" name="q9"> of complex life forms continued</p>
                </div>
            </div>
            
             <div class="group" id="q10-13-anchor">
                <h4>Questions 10–13</h4>
                <p>Complete the notes below.</p>
                <p>Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                
                <div class="table-section">
                     <h4 style="text-align: center; margin-bottom: 20px;">Burgess Shale Creatures</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Feature</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Opabinia</strong></td>
                                <td>
                                    <ul>
                                        <li>Five eyes</li>
                                        <li>Tail resembling a <strong>10</strong> <input class="blank" name="q10"></li>
                                        <li>Claws used to hold <strong>11</strong> <input class="blank" name="q11"></li>
                                    </ul>
                                </td>
                            </tr>
                             <tr>
                                <td><strong>Nectocaris</strong></td>
                                <td>
                                    <ul>
                                        <li>Looked like a <strong>12</strong> <input class="blank" name="q12"></li>
                                        <li>Fins</li>
                                        <li>Tentacles</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Hallucigenia</strong></td>
                                <td>
                                    <ul>
                                        <li>Spines used to <strong>13</strong> <input class="blank" name="q13"></li>
                                        <li>Tentacles</li>
                                    </ul>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="results"></div>
        </section>
    </div>
    
    <div class="practice-nav">
        <div class="title">Questions</div>
        <div class="questions">
            <div class="q-item" id="q1-nav" onclick="scrollToElement('q1-5-anchor')">1</div>
            <div class="q-item" id="q2-nav" onclick="scrollToElement('q1-5-anchor')">2</div>
            <div class="q-item" id="q3-nav" onclick="scrollToElement('q1-5-anchor')">3</div>
            <div class="q-item" id="q4-nav" onclick="scrollToElement('q1-5-anchor')">4</div>
            <div class="q-item" id="q5-nav" onclick="scrollToElement('q1-5-anchor')">5</div>
            <div class="q-item" id="q6-nav" onclick="scrollToElement('q6-9-anchor')">6</div>
            <div class="q-item" id="q7-nav" onclick="scrollToElement('q6-9-anchor')">7</div>
            <div class="q-item" id="q8-nav" onclick="scrollToElement('q6-9-anchor')">8</div>
            <div class="q-item" id="q9-nav" onclick="scrollToElement('q6-9-anchor')">9</div>
            <div class="q-item" id="q10-nav" onclick="scrollToElement('q10-13-anchor')">10</div>
            <div class="q-item" id="q11-nav" onclick="scrollToElement('q10-13-anchor')">11</div>
            <div class="q-item" id="q12-nav" onclick="scrollToElement('q10-13-anchor')">12</div>
            <div class="q-item" id="q13-nav" onclick="scrollToElement('q10-13-anchor')">13</div>
        </div>
        <div class="controls">
            <button id="submit-btn" class="primary">Submit</button>
            <button id="reset-btn">Reset</button>
            <button id="pause-btn">Pause</button>
        </div>
    </div>

    <div aria-label="Selection tools" id="selbar" role="toolbar">
        <button id="btnHL">Highlight</button>
        <button id="btnUH">Remove</button>
        <button id="btnNote">Note</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Global State ---
            let settingsOpen = false, notesOpen = false;
            let timerRunning = false, isResizing = false;
            let seconds = 0, timer;
            let userAnswers = {};
            let selbar = document.getElementById('selbar');
            let lastRange = null, currentHlNode = null, keepToolbar = false;
            
            const correctAnswers = {
                q1: 'TRUE', q2: 'NOT GIVEN', q3: 'TRUE', q4: 'FALSE', q5: 'FALSE',
                q6: 'Cambrian explosion', q7: 'railway', q8: '1979', q9: 'evolution',
                q10: 'fan', q11: 'food', q12: 'leech', q13: 'move'
            };

            // --- Timer Functions ---
            function updateTimerDisplay() {
                const minutes = String(Math.floor(seconds / 60)).padStart(2, '0');
                const secs = String(seconds % 60).padStart(2, '0');
                document.getElementById('timer').textContent = `${minutes}:${secs}`;
            }

            function startTimer() {
                if (timerRunning) return;
                timerRunning = true;
                timer = setInterval(() => {
                    seconds++;
                    updateTimerDisplay();
                }, 1000);
                document.getElementById('pause-btn').textContent = 'Pause';
            }

            function pauseTimer() {
                clearInterval(timer);
                timerRunning = false;
                document.getElementById('pause-btn').textContent = 'Continue';
            }

            // --- Panel Management & UI ---
            function closeAllPanels() {
                notesOpen = false; settingsOpen = false;
                document.getElementById('notes-panel').style.display = 'none';
                document.getElementById('settings-panel').style.display = 'none';
                document.querySelector('.overlay').style.display = 'none';
            }

            window.scrollToElement = function(id) {
                const element = document.getElementById(id);
                const pane = element.closest('.pane');
                if (element && pane) {
                    const top = element.offsetTop - 20;
                    pane.scrollTo({ top, behavior: 'smooth' });
                }
            }
            
            // --- Answer Tracking & Grading ---
            function setupAnswerTracking() {
                document.getElementById('right').addEventListener('change', (e) => {
                    if (e.target.type === 'radio') {
                         updateAnsweredState();
                    }
                });
                document.getElementById('right').addEventListener('input', (e) => {
                    if (e.target.classList.contains('blank')) {
                         updateAnsweredState();
                    }
                });
            }

            function updateAnsweredState() {
                // TRUE/FALSE/NOT GIVEN
                for (let i = 1; i <= 5; i++) {
                    const navItem = document.getElementById(`q${i}-nav`);
                    if (navItem.classList.contains('correct') || navItem.classList.contains('incorrect')) continue;
                    const answered = !!document.querySelector(`input[name="q${i}"]:checked`);
                    navItem.classList.toggle('answered', answered);
                }
                // BLANK FILLS
                for (let i = 6; i <= 13; i++) {
                    const navItem = document.getElementById(`q${i}-nav`);
                     if (navItem.classList.contains('correct') || navItem.classList.contains('incorrect')) continue;
                    const inputEl = document.querySelector(`input[name="q${i}"]`);
                    const answered = inputEl && inputEl.value.trim() !== '';
                    navItem.classList.toggle('answered', answered);
                }
            }
            
            function gradeAnswers() {
                pauseTimer();
                let correctCount = 0;
                const totalQuestions = 13;
                let resultsHTML = '<h4>Results</h4><table class="results-table"><thead><tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Result</th></tr></thead><tbody>';

                for (let i = 1; i <= 13; i++) {
                    let userAnswer, isCorrect;
                    const qId = `q${i}`;
                    const correctAnswer = correctAnswers[qId];
                    const navItem = document.getElementById(`${qId}-nav`);

                    if (i <= 5) { // Radio buttons
                        const userAnswerEl = document.querySelector(`input[name="${qId}"]:checked`);
                        userAnswer = userAnswerEl ? userAnswerEl.value : 'No Answer';
                    } else { // Text inputs
                        const inputEl = document.querySelector(`input[name="${qId}"]`);
                        userAnswer = inputEl ? inputEl.value.trim() : 'No Answer';
                        if (userAnswer === "") userAnswer = "No Answer";
                    }

                    isCorrect = userAnswer.toLowerCase() === correctAnswer.toLowerCase();
                    if (isCorrect) correctCount++;
                    
                    navItem.classList.remove('answered');
                    navItem.classList.add(isCorrect ? 'correct' : 'incorrect');
                    resultsHTML += `<tr><td>${i}</td><td>${userAnswer}</td><td>${correctAnswer}</td><td class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '✓' : '✗'}</td></tr>`;
                }
                
                const score = Math.round((correctCount / totalQuestions) * 100);
                const summary = `<div style="font-weight:bold; margin-bottom:16px; font-size:1.1em;">Final Score: ${score}% (${correctCount}/${totalQuestions})</div>`;
                
                document.getElementById('results').innerHTML = summary + resultsHTML;
                document.getElementById('results').style.display = 'block';
                scrollToElement('results');
            }

            function resetQuiz() {
                document.querySelectorAll('input[type="radio"]').forEach(el => el.checked = false);
                document.querySelectorAll('input.blank').forEach(el => el.value = "");

                document.querySelectorAll('.q-item').forEach(item => item.className = 'q-item');
                const resultsDiv = document.getElementById('results');
                resultsDiv.style.display = 'none';
                resultsDiv.innerHTML = '';
                
                pauseTimer();
                seconds = 0;
                updateTimerDisplay();
                startTimer();
            }

            // --- Highlighter & Selection Toolbar ---
            function positionSelbarForRect(rect) {
                selbar.style.display = 'flex';
                requestAnimationFrame(() => {
                    const top = window.scrollY + rect.top - selbar.offsetHeight - 8;
                    const left = window.scrollX + rect.left + rect.width / 2 - selbar.offsetWidth / 2;
                    selbar.style.top = `${(top > 0) ? top : (window.scrollY + rect.bottom + 8)}px`;
                    selbar.style.left = `${Math.max(8, left)}px`;
                });
            }

            function updateSelbar() {
                const sel = window.getSelection();
                if (!sel || sel.rangeCount === 0 || sel.isCollapsed) {
                    if (!keepToolbar && !currentHlNode) { selbar.style.display = 'none'; currentHlNode = null; }
                    return;
                }
                const range = sel.getRangeAt(0);
                let container = range.commonAncestorContainer;
                if (container.nodeType === Node.TEXT_NODE) container = container.parentElement;
                
                const leftPane = document.getElementById('left');
                const rightPane = document.getElementById('right');
                const isInAllowedPane = leftPane.contains(container) || rightPane.contains(container);
                const isHighlighted = container.classList?.contains('hl') || container.closest('.hl');
                
                if (!isInAllowedPane && !isHighlighted) { selbar.style.display = 'none'; return; }
                
                lastRange = range.cloneRange();
                currentHlNode = isHighlighted ? container.closest('.hl') : null;
                positionSelbarForRect(range.getBoundingClientRect());
            }
            
            function showToast(msg) {
                const toast = document.createElement('div');
                toast.style.cssText = `position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: var(--selbar-bg); color: var(--selbar-text); padding: 8px 16px; border-radius: 8px; z-index: 7000; font-size: 14px;`;
                toast.textContent = msg;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 1200);
            }

            function doHighlight() {
                if (currentHlNode || !lastRange || lastRange.collapsed) return;
                const sel = window.getSelection();
                try {
                    const span = document.createElement('span');
                    span.className = 'hl';
                    lastRange.surroundContents(span);
                } catch (e) { 
                    console.error("Highlighting failed:", e);
                    showToast('Highlighting failed');
                }
                sel?.removeAllRanges();
                selbar.style.display = 'none';
            }

            function removeHighlight() {
                const sel = window.getSelection();
                let targetNode = currentHlNode;
                if (!targetNode && lastRange) {
                    const ancestor = lastRange.commonAncestorContainer;
                    targetNode = ancestor.nodeType === Node.TEXT_NODE ? ancestor.parentElement.closest('.hl') : ancestor.closest('.hl');
                }
                if (targetNode) {
                    const p = targetNode.parentNode;
                    while (targetNode.firstChild) p.insertBefore(targetNode.firstChild, targetNode);
                    if(p) p.removeChild(targetNode);
                    p?.normalize();
                }
                currentHlNode = null; sel?.removeAllRanges(); selbar.style.display = 'none';
            }
            
            // --- Event Listeners Setup ---
            startTimer();
            setupAnswerTracking();

            // Header controls
            document.getElementById('size-btn').addEventListener('click', (e) => { e.stopPropagation(); settingsOpen = !settingsOpen; document.getElementById('settings-panel').style.display = settingsOpen ? 'block' : 'none'; });
            document.getElementById('color-btn').addEventListener('click', (e) => { e.stopPropagation(); settingsOpen = !settingsOpen; document.getElementById('settings-panel').style.display = settingsOpen ? 'block' : 'none'; });
            document.getElementById('note-btn').addEventListener('click', () => { closeAllPanels(); notesOpen = true; document.getElementById('notes-panel').style.display = 'flex'; document.querySelector('.overlay').style.display = 'block'; });
            
            document.querySelectorAll('.settings-option[data-size]').forEach(btn => btn.addEventListener('click', function() { document.documentElement.className = `font-${this.dataset.size}`; document.querySelectorAll('.settings-option[data-size]').forEach(b => b.classList.remove('active')); this.classList.add('active'); }));
            document.querySelectorAll('.settings-option[data-mode]').forEach(btn => btn.addEventListener('click', function() { document.body.classList.toggle('dark-mode', this.dataset.mode === 'dark'); document.querySelectorAll('.settings-option[data-mode]').forEach(b => b.classList.remove('active')); this.classList.add('active'); }));
            
            document.getElementById('close-note').addEventListener('click', closeAllPanels);
            document.querySelector('.overlay').addEventListener('click', closeAllPanels);
            document.addEventListener('click', (e) => {
                const settingsPanel = document.getElementById('settings-panel');
                const headerControls = document.querySelector('.header-controls');
                if (!settingsPanel.contains(e.target) && !headerControls.contains(e.target)) { settingsPanel.style.display = 'none'; settingsOpen = false; }
            });

            // Bottom nav controls
            document.getElementById('submit-btn').addEventListener('click', gradeAnswers);
            document.getElementById('reset-btn').addEventListener('click', resetQuiz);
            document.getElementById('pause-btn').addEventListener('click', () => { timerRunning ? pauseTimer() : startTimer(); });

            // Pane resizing
            const divider = document.getElementById('divider');
            const leftPane = document.getElementById('left');
            divider.addEventListener('mousedown', (e) => { isResizing = true; document.body.style.cursor = 'ew-resize'; e.preventDefault(); });
            document.addEventListener('mousemove', (e) => { if (!isResizing) return; const shellRect = document.querySelector('.shell').getBoundingClientRect(); let leftWidth = (e.clientX - shellRect.left) / shellRect.width * 100; leftPane.style.width = `${Math.max(20, Math.min(80, leftWidth))}%`; });
            document.addEventListener('mouseup', () => { if (isResizing) { isResizing = false; document.body.style.cursor = ''; } });
            
            // Selection toolbar events
            document.addEventListener('mouseup', () => setTimeout(updateSelbar, 10));
            document.addEventListener('selectionchange', () => setTimeout(updateSelbar, 10));
            document.addEventListener('mousedown', (e) => { keepToolbar = !!e.target.closest('#selbar, .hl'); }, true);
            document.addEventListener('click', (e) => {
                const target = e.target;
                if (target.classList.contains('hl')) {
                    currentHlNode = target; lastRange = null; positionSelbarForRect(target.getBoundingClientRect());
                    window.getSelection()?.removeAllRanges(); setTimeout(() => { keepToolbar = false; }, 0);
                } else if (!selbar.contains(e.target)) { selbar.style.display = 'none'; currentHlNode = null; }
            }, true);
            document.getElementById('btnHL').addEventListener('click', doHighlight);
            document.getElementById('btnUH').addEventListener('click', removeHighlight);
            document.getElementById('btnNote').addEventListener('click', function() {
                let text = (currentHlNode ? currentHlNode.textContent : (lastRange ? lastRange.cloneContents().textContent : '')).trim();
                if (text) {
                    const noteArea = document.querySelector('#notes-panel textarea');
                    noteArea.value += (noteArea.value ? '\n\n' : '') + '> ' + text;
                    closeAllPanels(); notesOpen = true; document.getElementById('notes-panel').style.display = 'flex';
                    document.querySelector('.overlay').style.display = 'block'; noteArea.scrollTop = noteArea.scrollHeight;
                }
                selbar.style.display = 'none';
            });
        });
    </script>
</body>
</html>