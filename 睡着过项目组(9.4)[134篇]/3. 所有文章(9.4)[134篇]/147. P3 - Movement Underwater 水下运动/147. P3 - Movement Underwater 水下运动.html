<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IELTS Reading Practice - Movement Underwater</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --line: #e5e7eb;
            --bg: #f6f7fb;
            --panel: #fff;
            --accent: #3b82f6;
            --muted: #6b7280;
            --shadow: 0 6px 20px rgba(0,0,0,.12);
            --text-color: #333;
            --highlight: #fff3a3;
            --selbar-bg: #111;
            --selbar-text: #fff;
        }

        body.dark-mode {
            --line: #4a4a4a;
            --bg: #1a1a1a;
            --panel: #2a2a2a;
            --muted: #bbb;
            --text-color: #f0f0f0;
            --highlight: #5b21b6;
            --selbar-bg: #1f2937;
            --selbar-text: #e5e7eb;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html { font-size: 16px; scroll-behavior: smooth; }
        html.font-regular { font-size: 16px; }
        html.font-large { font-size: 18px; }
        html.font-xlarge { font-size: 20px; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background: var(--bg);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease;
            padding-bottom: 64px;
        }

        .header {
            background-color: var(--panel);
            padding: 12px 20px;
            border-bottom: 1px solid var(--line);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,.05);
        }

        .header-content { display: flex; align-items: center; gap: 16px; }
        .header h1 { font-size: 1.2rem; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-color); }
        #timer { font-size: 1rem; font-weight: 500; background: var(--bg); padding: 6px 12px; border-radius: 6px; border: 1px solid var(--line); min-width: 90px; text-align: center; color: var(--text-color); }
        .header-controls { display: flex; align-items: center; gap: 10px; }
        .header-btn { background: var(--panel); border: 1px solid var(--line); border-radius: 6px; padding: 6px 12px; cursor: pointer; font-size: 0.9rem; transition: all 0.2s ease; color: var(--text-color); }
        .header-btn:hover { background: var(--bg); border-color: var(--accent); }

        #settings-panel {
            position: absolute; top: 60px; right: 20px; width: 200px; background: var(--panel); border-radius: 12px;
            box-shadow: var(--shadow); border: 1px solid var(--line); z-index: 1000; padding: 8px; display: none;
        }
        .settings-group { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--line); }
        .settings-group:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .settings-title { font-size: 0.85rem; color: var(--muted); margin-bottom: 8px; padding-left: 12px; }
        .settings-option { display: block; width: 100%; text-align: left; padding: 8px 12px; border: none; background: none; cursor: pointer; font-size: 0.9rem; border-radius: 6px; color: var(--text-color); }
        .settings-option.active { background: #e9effd; color: var(--accent); font-weight: 500; }
        .dark-mode .settings-option.active { background: #1e3a8a; }

        #notes-panel {
            position: fixed; right: 12px; bottom: 76px; width: 320px; height: 45vh; background: var(--panel); border: 1px solid var(--line); border-radius: 12px;
            display: none; flex-direction: column; z-index: 900; box-shadow: var(--shadow); overflow: hidden;
        }
        #notes-panel header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid var(--line); background-color: var(--bg); }
        #notes-panel h3 { font-size: 1rem; font-weight: 600; color: var(--text-color); margin: 0; }
        #notes-panel textarea { flex: 1; border: 0; padding: 16px; resize: none; font-size: 0.95rem; background: transparent; color: var(--text-color); line-height: 1.6; }
        #notes-panel textarea:focus { outline: none; }
        #close-note { padding: 4px 8px; border-radius: 4px; border: 1px solid var(--line); background: transparent; cursor: pointer; color: var(--text-color); transition: background-color 0.2s; }
        #close-note:hover { background-color: rgba(0,0,0,0.05); }
        .dark-mode #close-note:hover { background-color: rgba(255,255,255,0.1); }

        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.08); z-index: 800; display: none; backdrop-filter: blur(2px); }
        .dark-mode .overlay { background: rgba(0, 0, 0, 0.3); }

        .shell { display: flex; height: calc(100vh - 58px - 64px); width: 100%; overflow: hidden; }
        .pane { background: var(--panel); overflow: auto; padding: 24px; }
        #left { min-width: 280px; max-width: calc(100% - 280px); width: 50%; }
        #right { min-width: 280px; flex: 1; background: var(--bg); border-left: 1px solid var(--line); }
        .dark-mode #right { background: #1a1a1a; }

        #divider { flex: 0 0 8px; background: var(--bg); cursor: ew-resize; user-select: none; position: relative; border-left: 1px solid var(--line); border-right: 1px solid var(--line); }
        #divider::before { content: ""; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 4px; height: 30px; border-radius: 2px; background: rgba(100, 100, 100, 0.2); }
        #divider:hover { background: #dbeafe; }
        .dark-mode #divider { border-color: #4a4a4a; }
        .dark-mode #divider:hover { background: #1e40af; }

        h2, h3, h4 { margin: 0 0 16px; color: var(--text-color); }
        #left p, #right p { margin: 0 0 16px; line-height: 1.7; }
        #left strong, #right strong { font-weight: 600; }
        .empty-space { height: 40px; }

        .group { background: var(--panel); border: 1px solid var(--line); border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        
        #results { background: var(--panel); border: 1px solid var(--line); border-radius: 10px; padding: 20px; margin-top: 20px; display: none; line-height: 1.8; }
        .results-table { width: 100%; border-collapse: collapse; margin-top: 12px; font-size: 0.9rem; }
        .results-table th, .results-table td { border: 1px solid var(--line); padding: 8px; text-align: center; }
        .results-table th { background: var(--bg); }
        .result-correct { color: #10b981; font-weight: bold; }
        .result-incorrect { color: #ef4444; font-weight: bold; }

        .hl { background: var(--highlight); box-shadow: inset 0 -2px 0 rgba(0,0,0,.05); cursor: pointer; }
        .dark-mode .hl { color: #f5f3ff; }

        #selbar { position: absolute; display: none; z-index: 6000; background: var(--selbar-bg); color: var(--selbar-text); border-radius: 8px; padding: 6px; box-shadow: var(--shadow); font-size: 13px; gap: 6px; align-items: center; }
        #selbar button { background: transparent; color: var(--selbar-text); border: 1px solid rgba(255,255,255,.25); padding: 4px 8px; border-radius: 6px; cursor: pointer; }
        #selbar button:hover { border-color: var(--selbar-text); }

        .practice-nav { background: var(--panel); padding: 12px 20px; display: flex; align-items: center; gap: 16px; box-shadow: 0 -2px 4px rgba(0,0,0,.05); flex-wrap: wrap; position: fixed; left: 0; right: 0; bottom: 0; border-top: 1px solid var(--line); z-index: 4000; }
        .practice-nav .title { font-weight: 600; color: var(--muted); }
        .practice-nav .questions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .practice-nav .q-item { padding: 6px 10px; border: 1px solid var(--line); border-radius: 6px; background: var(--panel); cursor: pointer; font-size: 14px; transition: all 0.2s; min-width: 36px; text-align: center; color: var(--text-color); }
        .practice-nav .q-item:hover { background: var(--bg); border-color: var(--accent); }
        .practice-nav .q-item.answered { background: #e0e7ff; border-color: var(--accent); color: var(--accent); font-weight: 500; }
        .dark-mode .practice-nav .q-item.answered { background: #3949ab; border-color: var(--accent); color: #e8eaf6; }
        .practice-nav .q-item.correct { background: #dcfce7; border-color: #4ade80; color: #15803d; }
        .dark-mode .practice-nav .q-item.correct { background: #166534; border-color: #4ade80; color: #dcfce7; }
        .practice-nav .q-item.incorrect { background: #fee2e2; border-color: #f87171; color: #b91c1c; }
        .dark-mode .practice-nav .q-item.incorrect { background: #991b1b; border-color: #f87171; color: #fee2e2; }
        .practice-nav .controls { margin-left: auto; display: flex; align-items: center; gap: 12px; }
        .practice-nav .controls button { padding: 8px 12px; border: 1px solid var(--line); border-radius: 6px; background: var(--panel); cursor: pointer; color: var(--text-color); }
        .practice-nav .controls button.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
        
        /* Paragraph Matching Table Styles */
        .matching-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .matching-table th, .matching-table td { border: 1px solid var(--line); padding: 8px; text-align: left; vertical-align: middle; }
        .matching-table th { background-color: var(--bg); font-weight: bold; text-align: center; }
        .matching-table td:not(:first-child) { text-align: center; }
        .matching-table input[type="radio"] { cursor: pointer; transform: scale(1.2); }
        .matching-table td:first-child { line-height: 1.5; }

        /* Table Completion Styles */
        .completion-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .completion-table th, .completion-table td { border: 1px solid var(--line); padding: 12px; text-align: left; vertical-align: middle; }
        .completion-table th { background-color: var(--bg); font-weight: bold; }
        .completion-table input { border: none; border-bottom: 1px solid #9ca3af; padding: 2px 8px; font-size: 1em; background: transparent; color: var(--text-color); min-width: 120px; text-align: center; }
        .dark-mode .completion-table input { border-bottom-color: #666; }
        .completion-table input:focus { outline: none; border-bottom: 2px solid var(--accent); }

        /* UPDATED Diagram Labeling Styles for side-by-side layout */
        .diagram-layout-container {
            display: flex;
            align-items: center;
            gap: 20px; /* Reduced gap slightly */
            flex-wrap: wrap; 
        }
        .diagram-image-wrapper {
            flex: 2 1 320px; /* Image container grows twice as fast, has a larger base */
            min-width: 300px;
        }
        .diagram-image-wrapper img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
            border: 1px solid var(--line);
        }
        .diagram-inputs-wrapper {
            flex: 1 1 180px; /* Input container grows slower, has a smaller base */
            max-width: 220px; /* Set a max-width to keep inputs from getting too long */
            display: flex;
            flex-direction: column;
            gap: 18px; /* Slightly increased gap for better spacing */
        }
        .diagram-input-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .diagram-input-item label {
            font-weight: bold;
            min-width: 25px;
            text-align: right;
            color: var(--muted);
        }
        .diagram-input-item input {
            border: none;
            border-bottom: 1px solid #9ca3af;
            padding: 4px 8px;
            font-size: 1em;
            width: 100%;
            background: transparent;
            color: var(--text-color);
        }
        .diagram-input-item input:focus {
            outline: none;
            border-bottom: 2px solid var(--accent);
        }

    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1>P3 - Movement Underwater</h1>
            <div id="timer">00:00</div>
        </div>
        <div class="header-controls">
            <button class="header-btn" id="size-btn">Size</button>
            <button class="header-btn" id="color-btn">Color</button>
            <button class="header-btn" id="note-btn">Note</button>
        </div>
    </header>

    <div id="settings-panel">
        <div class="settings-group">
            <div class="settings-title">Font Size</div>
            <button class="settings-option active" data-size="regular">Regular</button>
            <button class="settings-option" data-size="large">Large</button>
            <button class="settings-option" data-size="xlarge">Extra Large</button>
        </div>
        <div class="settings-group">
            <div class="settings-title">Color Mode</div>
            <button class="settings-option active" data-mode="light">Black on White</button>
            <button class="settings-option" data-mode="dark">White on Black</button>
        </div>
    </div>

    <div id="notes-panel">
        <header>
            <h3>Notes</h3>
            <button id="close-note">Close</button>
        </header>
        <textarea placeholder="Write your notes here..."></textarea>
    </div>

    <div class="overlay"></div>

    <div class="shell">
        <section class="pane" id="left">
            <h2>READING PASSAGE 3</h2>
            <p>You should spend about 20 minutes on Questions 27–40, which are based on Reading Passage 3 below.</p>
            
            <h3>Movement Underwater</h3>
            
            <p><strong>A</strong> Self-propelled motion is a fundamental ability in many organisms. From the beating flagella of tiny plankton keeping afloat near the ocean surface to the playful perfection of dolphins surfing the bow wave of a ship, marine creatures have adopted a huge variety of styles, speeds, and methods of movement. Each species has its own particular need for the evolutionary developments that have taken place, but the basic requirements are the same—finding food, avoiding predation, seeking a mate or a safe place to have young, or migrating to an area with more favorable conditions.</p>
            
            <p><strong>B</strong> The particular physical properties of water that most affect movement are density, viscosity (stickiness), and buoyancy. Seawater is about 800 times denser than air and nearly 100 times as viscous. Consequently, there is much more resistance to movement than on land, as anyone will know who has ever tried to wade through waist-deep water. However, with density comes much greater buoyancy, so that organisms need to spend relatively little energy to stay afloat. As they move through the ocean environment, organisms seek to make wave motion, currents, and natural turbulence work to their advantage, not to their detriment.</p>
            
            <p><strong>C</strong> Most fishes have swim bladders to help them offset the density of their bodies and so maintain neutral buoyancy with minimal effort. These small, gas-filled chambers contain specialized networks of blood vessels that can add or remove gases such as oxygen and carbon dioxide. The ability to remain indefinitely at a constant depth without expending energy is especially important for slow-moving fishes that seek food in the shallows, or for those that hunt and scavenge in kelp forests. Active swimmers, such as mackerel, skipjacks, and sharks, do not have swim bladders because they need to change depth more rapidly than they could regulate the gas content. These fishes must swim forever or they will sink.</p>
            
            <p><strong>D</strong> Many animals, especially the tiny zooplankton, have taken to a life of simply drifting near the surface, contentedly feeding on the microscopic phytoplankton and bacteria floating there. Although life among the plankton might seem easy, there is in fact a remarkable range of movement. Some tiny plankton only 1–2 mm in length actually travel long distances each day. Species that live below the level where sunlight reaches nightly swim hundreds of meters up to the surface to feed in the relative safety of darkness. At dawn, they sink back down in an effort to escape predators—a double journey equivalent to a person swimming 700 km a day.</p>
            
            <p><strong>E</strong> It has taken marine creatures millions of years of evolution to overcome the chief deterrent to motion through a dense medium such as water—that of drag resistance. Swimming efficiency has been achieved by minimizing the three types of drag created by friction, turbulence, and body form. To reduce surface friction, the body must be smooth and rounded. In addition, the scales of most fishes are coated with slime to lubricate their passage through water. To reduce the turbulent drag created as water flows around the moving shape, a rounded front end and tapered back end are required. To reduce form drag, the cross-sectional area of the body should be minimal—a pencil shape would be ideal. The combined shape, taking into account all three types of drag, is the streamlined torpedo form of a tuna, the fastest-swimming of all fishes.</p>
            
            <p><strong>F</strong> Speed is only one of three important aspects of swimming ability. Tuna, swordfish, and mackerel all specialize in fast, steady cruising, but there are many other fishes for whom sustained speed is less important, such as the barracuda. This formidable predator specializes in swift acceleration, and has a far higher success rate for its attacks than its steady-cruising cousins. The freshwater pike, which lurks in the shadows until its quarry is within striking distance and then lunges with great rapidity, achieves a remarkable 70–80 percent success rate. The third specialization is maneuverability, best demonstrated by the butterfly fishes. These have disk-shaped bodies that permit abrupt changes of track. Many fishes are generalists, being at least partly proficient in all three modes of movement.</p>
            
            <p><strong>G</strong> Almost all fishes swim by undulation. Strong W-shaped muscles along the side of the body progressively contract and relax in sequence, from head to tail and from side to side, creating a traveling horizontal wave. The body is thrown into a series of curves that press sideways and back against the water, producing a forward thrust. The narrow, elongated forms of eels and sea snakes allow easy undulation along their full length. In contrast, the more stubby and inflexible bodies of armor-plated trunkfish use only the swish of their short tail fins to move themselves through the water. Most other fishes combine elements of both methods, coordinating powerful strokes of the tail fins with subtle body undulations.</p>

            <p><strong>H</strong> A fish's fins also play a vital and versatile role. The vertically oriented dorsal and ventral fins on the back and belly control sideways motion, while up-and-down motion is controlled by the pectoral and pelvic fins on the fish's sides. Whereas the shape of the tail fin relates directly to speed—crescent-moon-shaped for fast cruising, broad and flat for acceleration—the style and arrangement of the other fins are crucial for maneuverability. Puffer fishes scull with tiny, oscillating pectoral fins, while butterfly fishes undulate their broad dorsal and ventral fins, twisting and turning with great precision through intricate coral reefs.</p>
            
            <div class="empty-space"></div>
        </section>
        
        <div id="divider"></div>
        
        <section class="pane" id="right">
            <h3>Questions</h3>
            
            <div class="group" id="q27-31-anchor">
                <h4>Questions 27–31</h4>
                <p>Reading Passage 3 has eight paragraphs, <strong>A–H</strong>.</p>
                <p>Which paragraph contains the following information?</p>
                <p><em>Write the correct letter, <strong>A–H</strong>, in boxes 27–31 on your answer sheet.</em></p>
                <div style="overflow-x: auto;">
                    <table class="matching-table">
                        <thead>
                            <tr>
                                <th style="min-width: 250px;"></th>
                                <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>27</strong> A strategy to avoid being attacked</td>
                                <td><input type="radio" name="q27" value="A"></td><td><input type="radio" name="q27" value="B"></td><td><input type="radio" name="q27" value="C"></td><td><input type="radio" name="q27" value="D"></td><td><input type="radio" name="q27" value="E"></td><td><input type="radio" name="q27" value="F"></td><td><input type="radio" name="q27" value="G"></td><td><input type="radio" name="q27" value="H"></td>
                            </tr>
                             <tr>
                                <td><strong>28</strong> How fish are able to keep afloat naturally</td>
                                <td><input type="radio" name="q28" value="A"></td><td><input type="radio" name="q28" value="B"></td><td><input type="radio" name="q28" value="C"></td><td><input type="radio" name="q28" value="D"></td><td><input type="radio" name="q28" value="E"></td><td><input type="radio" name="q28" value="F"></td><td><input type="radio" name="q28" value="G"></td><td><input type="radio" name="q28" value="H"></td>
                            </tr>
                            <tr>
                                <td><strong>29</strong> The physical process by which fish propel themselves ahead</td>
                                <td><input type="radio" name="q29" value="A"></td><td><input type="radio" name="q29" value="B"></td><td><input type="radio" name="q29" value="C"></td><td><input type="radio" name="q29" value="D"></td><td><input type="radio" name="q29" value="E"></td><td><input type="radio" name="q29" value="F"></td><td><input type="radio" name="q29" value="G"></td><td><input type="radio" name="q29" value="H"></td>
                            </tr>
                            <tr>
                                <td><strong>30</strong> A list of reasons why different creatures move from one place to another</td>
                                <td><input type="radio" name="q30" value="A"></td><td><input type="radio" name="q30" value="B"></td><td><input type="radio" name="q30" value="C"></td><td><input type="radio" name="q30" value="D"></td><td><input type="radio" name="q30" value="E"></td><td><input type="radio" name="q30" value="F"></td><td><input type="radio" name="q30" value="G"></td><td><input type="radio" name="q30" value="H"></td>
                            </tr>
                             <tr>
                                <td><strong>31</strong> How the medium of water both restricts and aids movement</td>
                                <td><input type="radio" name="q31" value="A"></td><td><input type="radio" name="q31" value="B"></td><td><input type="radio" name="q31" value="C"></td><td><input type="radio" name="q31" value="D"></td><td><input type="radio" name="q31" value="E"></td><td><input type="radio" name="q31" value="F"></td><td><input type="radio" name="q31" value="G"></td><td><input type="radio" name="q31" value="H"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="group" id="q32-35-anchor">
                <h4>Questions 32–35</h4>
                <p>Complete the table below.</p>
                <p>Choose <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
                <table class="completion-table">
                    <thead>
                        <tr>
                            <th colspan="2">Specialisation</th>
                        </tr>
                        <tr>
                            <th>Specialised ability</th>
                            <th>Example fish species</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Ability to maintain the same <strong>32</strong> <input type="text" id="q32_input"> over long distances</td>
                            <td>Swordfish</td>
                        </tr>
                        <tr>
                            <td>Rapid <strong>33</strong> <input type="text" id="q33_input"></td>
                            <td>Barracuda</td>
                        </tr>
                        <tr>
                            <td>Sudden attack on prey following period of lying in wait</td>
                            <td><strong>34</strong> <input type="text" id="q34_input"></td>
                        </tr>
                        <tr>
                            <td>Rapid changes of direction</td>
                            <td><strong>35</strong> <input type="text" id="q35_input"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="group" id="q36-40-anchor">
                 <h4>Questions 36–40</h4>
                <p>Complete the diagram below.</p>
                <p>Choose <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
                <div class="diagram-layout-container">
                    <div class="diagram-image-wrapper">
                        <img src="https://i.postimg.cc/sDFrf8cZ/temp-Imageypq7-Ga.avif" alt="Diagram showing a fish's features for mobility, stability and combating drag resistance">
                    </div>
                    <div class="diagram-inputs-wrapper">
                        <div class="diagram-input-item"><label for="q36_input">36</label><input type="text" id="q36_input"></div>
                        <div class="diagram-input-item"><label for="q37_input">37</label><input type="text" id="q37_input"></div>
                        <div class="diagram-input-item"><label for="q38_input">38</label><input type="text" id="q38_input"></div>
                        <div class="diagram-input-item"><label for="q39_input">39</label><input type="text" id="q39_input"></div>
                        <div class="diagram-input-item"><label for="q40_input">40</label><input type="text" id="q40_input"></div>
                    </div>
                </div>
            </div>

            <div id="results"></div>
        </section>
    </div>
    
    <div class="practice-nav">
        <div class="title">Questions</div>
        <div class="questions">
            <div class="q-item" id="q27-nav" onclick="scrollToElement('q27-31-anchor')">27</div>
            <div class="q-item" id="q28-nav" onclick="scrollToElement('q27-31-anchor')">28</div>
            <div class="q-item" id="q29-nav" onclick="scrollToElement('q27-31-anchor')">29</div>
            <div class="q-item" id="q30-nav" onclick="scrollToElement('q27-31-anchor')">30</div>
            <div class="q-item" id="q31-nav" onclick="scrollToElement('q27-31-anchor')">31</div>
            <div class="q-item" id="q32-nav" onclick="scrollToElement('q32-35-anchor')">32</div>
            <div class="q-item" id="q33-nav" onclick="scrollToElement('q32-35-anchor')">33</div>
            <div class="q-item" id="q34-nav" onclick="scrollToElement('q32-35-anchor')">34</div>
            <div class="q-item" id="q35-nav" onclick="scrollToElement('q32-35-anchor')">35</div>
            <div class="q-item" id="q36-nav" onclick="scrollToElement('q36-40-anchor')">36</div>
            <div class="q-item" id="q37-nav" onclick="scrollToElement('q36-40-anchor')">37</div>
            <div class="q-item" id="q38-nav" onclick="scrollToElement('q36-40-anchor')">38</div>
            <div class="q-item" id="q39-nav" onclick="scrollToElement('q36-40-anchor')">39</div>
            <div class="q-item" id="q40-nav" onclick="scrollToElement('q36-40-anchor')">40</div>
        </div>
        <div class="controls">
            <button id="submit-btn" class="primary">Submit</button>
            <button id="reset-btn">Reset</button>
            <button id="pause-btn">Pause</button>
        </div>
    </div>

    <div aria-label="Selection tools" id="selbar" role="toolbar">
        <button id="btnHL">Highlight</button>
        <button id="btnUH">Remove</button>
        <button id="btnNote">Note</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Global State ---
            let settingsOpen = false, notesOpen = false;
            let timerRunning = true, seconds = 0, timer;
            let isResizing = false;
            let selbar = document.getElementById('selbar');
            let lastRange = null, currentHlNode = null, keepToolbar = false;
            
            const correctAnswers = {
                q27: 'D', q28: 'C', q29: 'G', q30: 'A', q31: 'B',
                q32: ['speed'],
                q33: ['acceleration'],
                q34: ['freshwater pike', 'pike'],
                q35: ['butterfly fishes'],
                q36: ['turbulent'],
                q37: ['up-and-down'],
                q38: ['sideways'],
                q39: ['maneuverability'],
                q40: ['form']
            };

            // --- Core Functions ---
            function startTimer() {
                timer = setInterval(() => {
                    if (timerRunning) {
                        seconds++;
                        const minutes = String(Math.floor(seconds / 60)).padStart(2, '0');
                        const secs = String(seconds % 60).padStart(2, '0');
                        document.getElementById('timer').textContent = `${minutes}:${secs}`;
                    }
                }, 1000);
            }

            function closeAllPanels() {
                notesOpen = false; settingsOpen = false;
                document.getElementById('notes-panel').style.display = 'none';
                document.getElementById('settings-panel').style.display = 'none';
                document.querySelector('.overlay').style.display = 'none';
            }

            window.scrollToElement = function(id) {
                const element = document.getElementById(id);
                const pane = element.closest('.pane');
                if (element && pane) {
                    const top = element.offsetTop - 20;
                    pane.scrollTo({ top, behavior: 'smooth' });
                }
            }

            // --- Grading and State Update ---
            function updateAnsweredState() {
                for (let i = 27; i <= 31; i++) {
                    const navItem = document.getElementById(`q${i}-nav`);
                     if (navItem && (navItem.classList.contains('correct') || navItem.classList.contains('incorrect'))) continue;
                    const answered = !!document.querySelector(`input[name="q${i}"]:checked`);
                    if(navItem) navItem.classList.toggle('answered', answered);
                }
                for (let i = 32; i <= 40; i++) {
                    const navItem = document.getElementById(`q${i}-nav`);
                     if (navItem && (navItem.classList.contains('correct') || navItem.classList.contains('incorrect'))) continue;
                    const answered = document.getElementById(`q${i}_input`).value.trim() !== "";
                    if(navItem) navItem.classList.toggle('answered', answered);
                }
            }
            
            function gradeAnswers() {
                timerRunning = false;
                document.getElementById('pause-btn').textContent = 'Continue';
                let correctCount = 0;
                const totalQuestions = 14;
                let resultsHTML = '<h4>Results</h4><table class="results-table"><thead><tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Result</th></tr></thead><tbody>';

                // Grade Q27-31 (Paragraph Matching)
                for (let i = 27; i <= 31; i++) {
                    const userAnswerEl = document.querySelector(`input[name="q${i}"]:checked`);
                    const userAnswer = userAnswerEl ? userAnswerEl.value : 'No Answer';
                    const correctAnswer = correctAnswers[`q${i}`];
                    const isCorrect = userAnswer === correctAnswer;
                    if (isCorrect) correctCount++;
                    document.getElementById(`q${i}-nav`).classList.add(isCorrect ? 'correct' : 'incorrect');
                    resultsHTML += `<tr><td>${i}</td><td>${userAnswer}</td><td>${correctAnswer}</td><td class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '✓' : '✗'}</td></tr>`;
                }

                // Grade Q32-40 (Completion)
                for (let i = 32; i <= 40; i++) {
                    const input = document.getElementById(`q${i}_input`);
                    const userAnswer = input.value.trim().toLowerCase() || 'No Answer';
                    const correctOptions = correctAnswers[`q${i}`];
                    const isCorrect = correctOptions.includes(userAnswer);
                    if (isCorrect) correctCount++;
                    document.getElementById(`q${i}-nav`).classList.add(isCorrect ? 'correct' : 'incorrect');
                    resultsHTML += `<tr><td>${i}</td><td>${input.value.trim() || 'No Answer'}</td><td>${correctOptions[0]}</td><td class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '✓' : '✗'}</td></tr>`;
                }

                const score = Math.round((correctCount / totalQuestions) * 100);
                const summary = `<div style="font-weight:bold; margin-top:16px; font-size:1.1em;">Final Score: ${score}% (${correctCount}/${totalQuestions})</div>`;
                resultsHTML += `</tbody></table>`;
                
                document.getElementById('results').innerHTML = summary + resultsHTML;
                document.getElementById('results').style.display = 'block';
                scrollToElement('results');
            }

            function resetQuiz() {
                document.querySelectorAll('input[type="radio"]').forEach(el => el.checked = false);
                document.querySelectorAll('input[type="text"]').forEach(el => el.value = '');
                document.querySelectorAll('.q-item').forEach(item => item.className = 'q-item');
                const resultsDiv = document.getElementById('results');
                resultsDiv.style.display = 'none';
                resultsDiv.innerHTML = '';
                
                seconds = 0;
                if(timer) clearInterval(timer);
                document.getElementById('timer').textContent = '00:00';
                timerRunning = true;
                document.getElementById('pause-btn').textContent = 'Pause';
                startTimer();
                updateAnsweredState();
            }

            // --- Highlighter & Selection Toolbar ---
            function positionSelbarForRect(rect) {
                selbar.style.display = 'flex';
                requestAnimationFrame(() => {
                    const top = window.scrollY + rect.top - selbar.offsetHeight - 8;
                    const left = window.scrollX + rect.left + rect.width / 2 - selbar.offsetWidth / 2;
                    selbar.style.top = `${(top > 0) ? top : (window.scrollY + rect.bottom + 8)}px`;
                    selbar.style.left = `${Math.max(8, left)}px`;
                });
            }

            function updateSelbar() {
                const sel = window.getSelection();
                if (!sel || sel.rangeCount === 0 || sel.isCollapsed) {
                    if (!keepToolbar && !currentHlNode) { selbar.style.display = 'none'; currentHlNode = null; }
                    return;
                }
                const range = sel.getRangeAt(0);
                let container = range.commonAncestorContainer;
                if (container.nodeType === Node.TEXT_NODE) container = container.parentElement;
                
                const isInAllowedPane = document.getElementById('left').contains(container) || document.getElementById('right').contains(container);
                const isHighlighted = container.classList?.contains('hl') || container.closest('.hl');
                if (!isInAllowedPane && !isHighlighted) { selbar.style.display = 'none'; return; }
                
                lastRange = range.cloneRange();
                currentHlNode = isHighlighted ? container.closest('.hl') : null;
                positionSelbarForRect(range.getBoundingClientRect());
            }

            function doHighlight() {
                if (currentHlNode || !lastRange || lastRange.collapsed) return;
                const sel = window.getSelection();
                try {
                    const span = document.createElement('span');
                    span.className = 'hl';
                    lastRange.surroundContents(span);
                } catch (e) { console.error("Highlighting failed:", e); return; }
                sel?.removeAllRanges();
                selbar.style.display = 'none';
            }

            function removeHighlight() {
                const sel = window.getSelection();
                let targetNode = currentHlNode;
                if (!targetNode && lastRange) {
                    const ancestor = lastRange.commonAncestorContainer;
                    targetNode = ancestor.nodeType === Node.TEXT_NODE ? ancestor.parentElement.closest('.hl') : ancestor.closest('.hl');
                }
                if (targetNode) {
                    const p = targetNode.parentNode;
                    while (targetNode.firstChild) p.insertBefore(targetNode.firstChild, targetNode);
                    if(p) p.removeChild(targetNode);
                    p?.normalize();
                }
                currentHlNode = null; sel?.removeAllRanges(); selbar.style.display = 'none';
            }

            // --- Event Listeners Setup ---
            startTimer();

            // Header controls
            document.getElementById('size-btn').addEventListener('click', (e) => { e.stopPropagation(); settingsOpen = !settingsOpen; document.getElementById('settings-panel').style.display = settingsOpen ? 'block' : 'none'; });
            document.getElementById('color-btn').addEventListener('click', (e) => { e.stopPropagation(); settingsOpen = !settingsOpen; document.getElementById('settings-panel').style.display = settingsOpen ? 'block' : 'none'; });
            document.getElementById('note-btn').addEventListener('click', () => { closeAllPanels(); notesOpen = true; document.getElementById('notes-panel').style.display = 'flex'; document.querySelector('.overlay').style.display = 'block'; });
            document.querySelectorAll('.settings-option[data-size]').forEach(btn => btn.addEventListener('click', function() { document.documentElement.className = `font-${this.dataset.size}`; document.querySelectorAll('.settings-option[data-size]').forEach(b => b.classList.remove('active')); this.classList.add('active'); }));
            document.querySelectorAll('.settings-option[data-mode]').forEach(btn => btn.addEventListener('click', function() { document.body.classList.toggle('dark-mode', this.dataset.mode === 'dark'); document.querySelectorAll('.settings-option[data-mode]').forEach(b => b.classList.remove('active')); this.classList.add('active'); }));
            document.getElementById('close-note').addEventListener('click', closeAllPanels);
            document.querySelector('.overlay').addEventListener('click', closeAllPanels);
            document.addEventListener('click', (e) => {
                const settingsPanel = document.getElementById('settings-panel');
                const headerControls = document.querySelector('.header-controls');
                if (!settingsPanel.contains(e.target) && !headerControls.contains(e.target)) { settingsPanel.style.display = 'none'; settingsOpen = false; }
            });

            // Bottom nav controls
            document.getElementById('submit-btn').addEventListener('click', gradeAnswers);
            document.getElementById('reset-btn').addEventListener('click', resetQuiz);
            document.getElementById('pause-btn').addEventListener('click', function() { timerRunning = !timerRunning; this.textContent = timerRunning ? 'Pause' : 'Continue'; });

            // Pane resizing
            const divider = document.getElementById('divider');
            const leftPane = document.getElementById('left');
            divider.addEventListener('mousedown', (e) => { isResizing = true; document.body.style.cursor = 'ew-resize'; e.preventDefault(); });
            document.addEventListener('mousemove', (e) => { if (!isResizing) return; const shellRect = document.querySelector('.shell').getBoundingClientRect(); let leftWidth = (e.clientX - shellRect.left) / shellRect.width * 100; leftPane.style.width = `${Math.max(20, Math.min(80, leftWidth))}%`; });
            document.addEventListener('mouseup', () => { if (isResizing) { isResizing = false; document.body.style.cursor = ''; } });
            
            // Update answered state on input/change
            document.getElementById('right').addEventListener('change', updateAnsweredState);
            document.getElementById('right').addEventListener('input', updateAnsweredState);

            // Selection toolbar events
            document.addEventListener('mouseup', () => setTimeout(updateSelbar, 10));
            document.addEventListener('selectionchange', () => setTimeout(updateSelbar, 10));
            document.addEventListener('mousedown', (e) => { keepToolbar = !!e.target.closest('#selbar, .hl'); }, true);
            document.addEventListener('click', (e) => {
                const target = e.target;
                if (target.classList.contains('hl')) {
                    currentHlNode = target; lastRange = null; positionSelbarForRect(target.getBoundingClientRect());
                    window.getSelection()?.removeAllRanges(); setTimeout(() => { keepToolbar = false; }, 0);
                } else if (!selbar.contains(e.target)) { selbar.style.display = 'none'; currentHlNode = null; }
            }, true);
            document.getElementById('btnHL').addEventListener('click', doHighlight);
            document.getElementById('btnUH').addEventListener('click', removeHighlight);
            document.getElementById('btnNote').addEventListener('click', function() {
                let text = (currentHlNode ? currentHlNode.textContent : (lastRange ? lastRange.cloneContents().textContent : '')).trim();
                if (text) {
                    const noteArea = document.querySelector('#notes-panel textarea');
                    noteArea.value += (noteArea.value ? '\n\n' : '') + '> ' + text;
                    closeAllPanels(); notesOpen = true; document.getElementById('notes-panel').style.display = 'flex';
                    document.querySelector('.overlay').style.display = 'block'; noteArea.scrollTop = noteArea.scrollHeight;
                }
                selbar.style.display = 'none';
            });
        });
    </script>
</body>
</html>