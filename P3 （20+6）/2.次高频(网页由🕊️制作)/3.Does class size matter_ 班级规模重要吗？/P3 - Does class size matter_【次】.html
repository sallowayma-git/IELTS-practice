<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>P3 ‚Äì Does class size matter?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --line: #e5e7eb;
      --bg: #f6f7fb;
      --panel: #fff;
      --accent: #3b82f6;
      --muted: #6b7280;
      --shadow: 0 6px 20px rgba(0, 0, 0, .12);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      padding-bottom: 82px;
    }

    .shell {
      display: flex;
      height: 100vh;
      width: 100%;
    }

    .pane {
      background: var(--panel);
      overflow: auto;
      padding: 20px;
    }

    #left {
      flex: 0 0 50%;
      min-width: 280px;
    }

    #right {
      flex: 1 1 auto;
      min-width: 320px;
      background: #fbfbff;
      border-left: 1px solid var(--line);
    }

    #divider {
      flex: 0 0 8px;
      background: linear-gradient(90deg, #e5e7eb, #d1d5db);
      cursor: ew-resize;
      position: relative;
      z-index: 5;
      user-select: none;
    }

    h2,
    h3,
    h4 {
      margin: 0 0 10px;
    }

    #left p {
      margin: 0 0 12px;
      line-height: 1.6;
      word-break: normal;
      overflow-wrap: normal;
      hyphens: none;
    }

    .group {
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 14px;
    }

    input.blank {
      border: none;
      border-bottom: 1px solid #9ca3af;
      padding: 2px 4px;
      font-size: 1em;
      background: transparent;
    }

    input.blank:focus {
      outline: none;
      border-bottom: 2px solid var(--accent);
    }

    button {
      padding: 8px 12px;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #fff;
      cursor: pointer;
    }

    button.primary {
      background: var(--accent);
      color: #fff;
      border-color: #3b82f6;
    }

    #results {
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
    }

    .hl {
      background: #fff3a3;
      box-shadow: inset 0 -2px 0 rgba(0, 0, 0, .05);
      cursor: pointer;
    }

    .hl:hover {
      filter: brightness(0.98);
    }

    #selbar {
      position: absolute;
      display: none;
      z-index: 2000;
      background: #111;
      color: #fff;
      border-radius: 8px;
      padding: 6px;
      box-shadow: var(--shadow);
      font-size: 13px;
      gap: 6px;
      align-items: center;
    }

    #selbar button {
      background: transparent;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, .25);
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
    }

    #selbar button:hover {
      border-color: #fff;
    }

    #notes {
      position: fixed;
      right: 12px;
      bottom: 12px;
      width: 320px;
      height: 42vh;
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 12px;
      display: none;
      flex-direction: column;
      z-index: 1500;
      box-shadow: var(--shadow);
    }

    #notes header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      border-bottom: 1px solid var(--line);
    }

    #notes textarea {
      flex: 1;
      border: 0;
      padding: 10px;
      resize: none;
      font-size: 14px;
      line-height: 1.5;
    }

    #toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
      background: #111;
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      display: none;
      z-index: 2500;
    }

    details.answerbox summary {
      cursor: pointer;
      user-select: none;
      list-style: none;
    }

    details.answerbox {
      border: 1px dashed var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      background: #fff;
    }

    .badge {
      display: inline-block;
      background: #eef2ff;
      color: #4338ca;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      margin-left: 6px;
    }

    .practice-nav {
      background: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .05);
      flex-wrap: wrap;
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      border-top: 2px solid var(--line);
      z-index: 4000;
    }

    .practice-nav .title {
      font-weight: 600;
      color: var(--muted);
    }

    .practice-nav .questions {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .practice-nav .q-item {
      padding: 6px 10px;
      border: 1px solid var(--line);
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      min-width: 36px;
      text-align: center;
    }

    .practice-nav .q-item:hover {
      background: #f1f5f9;
      border-color: var(--accent);
    }

    .practice-nav .q-item.answered {
      background: #e0e7ff;
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 500;
    }

    .practice-nav .q-item.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .practice-nav .controls {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    #timer {
      display: inline-block;
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 4px 10px;
      font-size: 14px;
      vertical-align: middle;
      cursor: pointer;
      transition: all 0.2s;
    }

    #timer:hover {
      background: #f8fafc;
      border-color: var(--accent);
    }

    #timer.paused {
      background: #fef3c7;
      border-color: #f59e0b;
      color: #92400e;
    }

    /* Dark mode styles */
    body.dark {
      --bg: #0f172a;
      --panel: #1e293b;
      --line: #334155;
      --muted: #94a3b8;
      color: #e2e8f0;
    }

    body.dark #right {
      background: #0f172a;
    }

    body.dark .group {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark button {
      background: #1e293b;
      color: #e2e8f0;
      border-color: #334155;
    }

    body.dark button:hover {
      background: #334155;
    }

    body.dark #results {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark #notes {
      background: #1e293b;
      border-color: #334155;
      color: #e2e8f0;
    }

    body.dark .practice-nav {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark .q-item {
      background: #0f172a;
      color: #e2e8f0;
      border-color: #334155;
    }

    body.dark .q-item:hover {
      background: #334155;
    }

    body.dark #timer {
      background: #1e293b;
      color: #e2e8f0;
      border-color: #334155;
    }

    body.dark #timer:hover {
      background: #334155;
    }

    .theme-toggle {
      background: transparent;
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
    }

    .theme-toggle:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
  </style>
</head>

<body>
  <div class="practice-nav">
    <div class="title">Questions</div>
    <div class="questions">
      <div class="q-item" onclick="scrollToElement('q27-anchor')">27</div>
      <div class="q-item" onclick="scrollToElement('q28-anchor')">28</div>
      <div class="q-item" onclick="scrollToElement('q29-anchor')">29</div>
      <div class="q-item" onclick="scrollToElement('q30-anchor')">30</div>
      <div class="q-item" onclick="scrollToElement('q31-anchor')">31</div>
      <div class="q-item" onclick="scrollToElement('q32-anchor')">32</div>
      <div class="q-item" onclick="scrollToElement('q33-anchor')">33</div>
      <div class="q-item" onclick="scrollToElement('q34-anchor')">34</div>
      <div class="q-item" onclick="scrollToElement('q35-anchor')">35</div>
      <div class="q-item" onclick="scrollToElement('q36-anchor')">36</div>
      <div class="q-item" onclick="scrollToElement('q37-anchor')">37</div>
      <div class="q-item" onclick="scrollToElement('q38-anchor')">38</div>
      <div class="q-item" onclick="scrollToElement('q39-anchor')">39</div>
      <div class="q-item" onclick="scrollToElement('q40-anchor')">40</div>
    </div>
    <div class="controls">
      <span id="timer">00:00</span>
      <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">üåô</button>
    </div>
  </div>

  <div class="shell">
    <section class="pane" id="left">
      <h2>READING PASSAGE 3</h2>
      <p>You should spend about 20 minutes on Questions 27‚Äì40, which are based on Reading Passage 3 below.</p>
      <h3>Does class size matter?</h3>
      
      <h4>Paragraph A</h4>
      <p>Of all the ideas for improving education, few are as simple or attractive as reducing the number of pupils per teacher. With its uncomplicated appeal, class-size reduction has lately gone from being a subject of primarily academic interest to becoming a public issue. In the U.S., more than 20 states have adopted policies aimed at decreasing class size.</p>
      
      <h4>Paragraph B</h4>
      <p>One way investigators have attempted to analyse the effects of class size is by reviewing existing data, such as records kept by the U.S. Department of Education. These show that between 1969 and 1997, the average number of pupils per teacher in American public and private elementary schools fell from 25 to 18, a decline of more than 27 per cent. In secondary schools, the number also fell, from 19 to 14. Do these findings mean that class size makes no difference? Not necessarily. For a variety of reasons, most researchers, including us, pay little attention to those figures. For instance, schools strive for more than just high test scores; they also try to keep their dropout rates low. Indeed, the dropout rate for students aged 16 to 24 fell from 15 to 11 per cent over that period. Because drop-outs generally come from the low end of the achievement distribution, a reduction in the dropout rate could be expected to pull down average test scores in the upper grades. Ideally, U.S. students would all come from families that are financially well-off, with two highly educated, English-speaking parents who are involved in their children's schooling. Teachers would all be creative and have complete mastery of their subject matter. Schools would be nicely outfitted with libraries, computers and other resources.</p>
      
      <h4>Paragraph C</h4>
      <p>Over the past 35 years, hundreds of studies and analyses of existing data (such as the Department of Education records) have focused on class size. Unfortunately, most of these studies were poorly designed. The notable exception was the STAR project. Students entering kindergarten were randomly assigned to one of three kinds of classes: a small class of 13 to 17 students, or a regular-size class of 22 to 26 students. The students remained in whatever category they had been assigned to through the third grade, after which they joined a regular classroom in the fourth. To ensure that teaching quality did not differ, teachers were randomly assigned to small- and regularsize classrooms. Few teachers received any special training for working with small classes, and there were no new curricular materials.</p>
      
      <h4>Paragraph D</h4>
      <p>Charles M. Achilles of Eastern Michigan University found "an array of benefits of small classes" in his review. He also found that the effect was stronger for minority students: Black and Hispanic children improved their scores slightly more than did other students - a significant finding from a policy standpoint. He argues that the STAR data cannot be used to prove that the gains persist for years after a student has returned to regularsize classes. He and others have also shown that, during the study, too many children migrated from the regular to the small classes, probably because school personnel caved in to parent demands. The criticism does not undermine the finding of a statistically significant benefit of being in a small class.</p>
      
      <h4>Paragraph E</h4>
      <p>California's multi-billion-dollar effort, begun in 1996, stands more as a model of what not to do than as an initiative worthy of emulation. The state is trying to reduce class size in kindergarten through grade three from a maximum of 33 to a maximum of 20 in rich and poor districts alike - despite a shortage of qualified teachers, especially in low-income areas. This across-the-board approach may be politically expedient, but it seems actually to have exacerbated the disparity in resources available to rich and poor schools in California. The better-paying, more affluent districts got the best teachers - including a fair number of the good teachers from poorer schools. Evaluators found a small but statistically significant achievement advantage in reading, writing and mathematics for students in classes that had been reduced to 20 or fewer pupils, as compared with classes of more than 20. The second programme, Wisconsin's Student Achievement Guarantee in Education (SAGE), also begun in 1996, was a five-year study. It was small - class size was reduced in just 14 schools - but noteworthy because it targeted schools in which at least 30 per cent of the students were below the poverty level.</p>
    </section>

    <div id="divider"></div>

    <section class="pane" id="right">
      <div class="group">
        <h3>Questions 27‚Äì31</h3>
        <p>Reading Passage 3 has five paragraphs, A‚ÄìE.</p>
        <p>Which paragraph contains the following information?</p>
        <p>Write the correct letter, A‚ÄìE, in boxes 27‚Äì31 on your answer sheet.</p>
        
        <div id="q27-anchor">
          <p><strong>27</strong> a reference to the fact that class-size reduction has become a major political issue</p>
          <label><input type="radio" name="q27" value="A"> A</label>
          <label><input type="radio" name="q27" value="B"> B</label>
          <label><input type="radio" name="q27" value="C"> C</label>
          <label><input type="radio" name="q27" value="D"> D</label>
          <label><input type="radio" name="q27" value="E"> E</label>
        </div>

        <div id="q28-anchor">
          <p><strong>28</strong> details of how one research project was organised</p>
          <label><input type="radio" name="q28" value="A"> A</label>
          <label><input type="radio" name="q28" value="B"> B</label>
          <label><input type="radio" name="q28" value="C"> C</label>
          <label><input type="radio" name="q28" value="D"> D</label>
          <label><input type="radio" name="q28" value="E"> E</label>
        </div>

        <div id="q29-anchor">
          <p><strong>29</strong> reference to a policy that was expensive but failed</p>
          <label><input type="radio" name="q29" value="A"> A</label>
          <label><input type="radio" name="q29" value="B"> B</label>
          <label><input type="radio" name="q29" value="C"> C</label>
          <label><input type="radio" name="q29" value="D"> D</label>
          <label><input type="radio" name="q29" value="E"> E</label>
        </div>

        <div id="q30-anchor">
          <p><strong>30</strong> a description of the conditions that would be ideal for education</p>
          <label><input type="radio" name="q30" value="A"> A</label>
          <label><input type="radio" name="q30" value="B"> B</label>
          <label><input type="radio" name="q30" value="C"> C</label>
          <label><input type="radio" name="q30" value="D"> D</label>
          <label><input type="radio" name="q30" value="E"> E</label>
        </div>

        <div id="q31-anchor">
          <p><strong>31</strong> reasons why a particular research project produced reliable results</p>
          <label><input type="radio" name="q31" value="A"> A</label>
          <label><input type="radio" name="q31" value="B"> B</label>
          <label><input type="radio" name="q31" value="C"> C</label>
          <label><input type="radio" name="q31" value="D"> D</label>
          <label><input type="radio" name="q31" value="E"> E</label>
        </div>
      </div>

      <div class="group">
        <h3>Questions 32‚Äì40</h3>
        <p>Choose the correct letter, A, B or C.</p>
        <p>Write the correct letter in boxes 32‚Äì40 on your answer sheet.</p>

        <div id="q32-anchor">
          <p><strong>32</strong> The writer's attitude to class-size reduction is</p>
          <label><input type="radio" name="q32" value="A"> A positive</label><br>
          <label><input type="radio" name="q32" value="B"> B negative</label><br>
          <label><input type="radio" name="q32" value="C"> C neutral</label>
        </div>

        <div id="q33-anchor">
          <p><strong>33</strong> According to the writer, the STAR project was</p>
          <label><input type="radio" name="q33" value="A"> A well-designed</label><br>
          <label><input type="radio" name="q33" value="B"> B poorly designed</label><br>
          <label><input type="radio" name="q33" value="C"> C typical of most studies</label>
        </div>

        <div id="q34-anchor">
          <p><strong>34</strong> The writer suggests that the California policy</p>
          <label><input type="radio" name="q34" value="A"> A made the situation worse</label><br>
          <label><input type="radio" name="q34" value="B"> B was completely successful</label><br>
          <label><input type="radio" name="q34" value="C"> C had mixed results</label>
        </div>

        <div id="q35-anchor">
          <p><strong>35</strong> The SAGE programme was different from California's because it</p>
          <label><input type="radio" name="q35" value="A"> A was larger in scale</label><br>
          <label><input type="radio" name="q35" value="B"> B lasted longer</label><br>
          <label><input type="radio" name="q35" value="C"> C focused on disadvantaged schools</label>
        </div>

        <div id="q36-anchor">
          <p><strong>36</strong> What does the writer say about the Department of Education figures?</p>
          <label><input type="radio" name="q36" value="A"> A They should be ignored</label><br>
          <label><input type="radio" name="q36" value="B"> B They are completely accurate</label><br>
          <label><input type="radio" name="q36" value="C"> C They need careful interpretation</label>
        </div>

        <div id="q37-anchor">
          <p><strong>37</strong> The writer mentions dropout rates to show that</p>
          <label><input type="radio" name="q37" value="A"> A class size affects all students equally</label><br>
          <label><input type="radio" name="q37" value="B"> B test scores can be misleading</label><br>
          <label><input type="radio" name="q37" value="C"> C smaller classes prevent students leaving</label>
        </div>

        <div id="q38-anchor">
          <p><strong>38</strong> According to Achilles, the STAR project showed that</p>
          <label><input type="radio" name="q38" value="A"> A small classes benefit minority students more</label><br>
          <label><input type="radio" name="q38" value="B"> B the benefits last for many years</label><br>
          <label><input type="radio" name="q38" value="C"> C too many students changed classes</label>
        </div>

        <div id="q39-anchor">
          <p><strong>39</strong> The writer suggests that California's policy was</p>
          <label><input type="radio" name="q39" value="A"> A well-planned</label><br>
          <label><input type="radio" name="q39" value="B"> B politically motivated</label><br>
          <label><input type="radio" name="q39" value="C"> C based on solid research</label>
        </div>

        <div id="q40-anchor">
          <p><strong>40</strong> What is the writer's main conclusion about class-size reduction?</p>
          <label><input type="radio" name="q40" value="A"> A It can be effective if properly implemented</label><br>
          <label><input type="radio" name="q40" value="B"> B It is too expensive to be worthwhile</label><br>
          <label><input type="radio" name="q40" value="C"> C It has no measurable benefits</label>
        </div>
      </div>

      <div class="group">
        <button class="primary" onclick="grade()">Submit Answers</button>
        <button onclick="toggleNotes()">üìù Notes</button>
      </div>

      <div id="results"></div>

      <details class="answerbox">
        <summary>Answer Key</summary>
        <ol>
          <li>27 ‚Üí A</li>
          <li>28 ‚Üí C</li>
          <li>29 ‚Üí E</li>
          <li>30 ‚Üí B</li>
          <li>31 ‚Üí C</li>
          <li>32 ‚Üí A</li>
          <li>33 ‚Üí A</li>
          <li>34 ‚Üí A</li>
          <li>35 ‚Üí C</li>
          <li>36 ‚Üí A</li>
          <li>37 ‚Üí C</li>
          <li>38 ‚Üí A</li>
          <li>39 ‚Üí B</li>
          <li>40 ‚Üí A</li>
        </ol>
      </details>
    </section>
  </div>

  <div id="selbar">
    <button id="btnHL">üñçÔ∏è Highlight</button>
    <button id="btnUH">‚ùå Remove</button>
    <button id="btnNote">üìù Note</button>
  </div>

  <div id="notes">
    <header>
      <span>üìù Notes</span>
      <div>
        <button id="btnCopy">üìã</button>
        <button id="btnClose">‚úï</button>
      </div>
    </header>
    <textarea id="noteArea" placeholder="Write your notes here..."></textarea>
  </div>

  <div id="toast"></div>

  <script>
    // Timer with click to pause/resume functionality
    let _t = 0;
    let timerRunning = true;
    let timerInterval;
    const _timerEl = document.getElementById('timer');

    function updateTimer() {
      const m = Math.floor(_t / 60);
      const s = _t % 60;
      _timerEl.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        if (timerRunning) {
          _t++;
          updateTimer();
        }
      }, 1000);
    }

    // Add click functionality to timer
    _timerEl.addEventListener('click', function () {
      if (timerRunning) {
        clearInterval(timerInterval);
        timerRunning = false;
        _timerEl.classList.add('paused');
        showToast('Timer paused');
      } else {
        startTimer();
        timerRunning = true;
        _timerEl.classList.remove('paused');
        showToast('Timer resumed');
      }
    });

    // Start timer on page load
    startTimer();

    // Dark mode functionality
    function toggleTheme() {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem('darkMode', isDark);
      const themeButton = document.querySelector('.theme-toggle');
      themeButton.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    }

    // Load saved theme
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark');
      document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
    }

    // Navigation functionality
    function scrollToElement(id) {
      const element = document.getElementById(id);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Update navigation state
        document.querySelectorAll('.q-item').forEach(item => item.classList.remove('active'));
        const questionNum = id.replace('-anchor', '').replace('q', '');
        const navItem = document.querySelector(`[onclick="scrollToElement('${id}')"]`);
        if (navItem) navItem.classList.add('active');
      }
    }

    // Answer tracking
    function updateAnswerStatus() {
      for (let i = 27; i <= 40; i++) {
        const input = document.querySelector(`input[name="q${i}"]:checked`);
        const navItem = document.querySelector(`[onclick="scrollToElement('q${i}-anchor')"]`);
        if (navItem) {
          if (input) {
            navItem.classList.add('answered');
          } else {
            navItem.classList.remove('answered');
          }
        }
      }
    }

    // Listen for answer changes
    document.addEventListener('change', updateAnswerStatus);

    // Highlighting functionality
    let lastRange = null;
    let currentHlNode = null;
    const selbar = document.getElementById('selbar');
    const btnHL = document.getElementById('btnHL');
    const btnUH = document.getElementById('btnUH');
    const btnNote = document.getElementById('btnNote');

    document.addEventListener('mouseup', function (e) {
      const sel = window.getSelection();
      if (sel.rangeCount && !sel.isCollapsed) {
        lastRange = sel.getRangeAt(0);
        const rect = lastRange.getBoundingClientRect();
        selbar.style.left = rect.left + 'px';
        selbar.style.top = (rect.top - 40) + 'px';
        selbar.style.display = 'flex';
      }
    });

    document.addEventListener('click', function (e) {
      if (e.target.classList && e.target.classList.contains('hl')) {
        currentHlNode = e.target;
        const rect = e.target.getBoundingClientRect();
        selbar.style.left = rect.left + 'px';
        selbar.style.top = (rect.top - 40) + 'px';
        selbar.style.display = 'flex';
      } else if (!selbar.contains(e.target)) {
        selbar.style.display = 'none';
        currentHlNode = null;
      }
    });

    function doHighlight() {
      if (currentHlNode) return;
      if (!lastRange) return;
      try {
        const wrap = document.createElement('span');
        wrap.className = 'hl';
        wrap.appendChild(lastRange.cloneContents());
        lastRange.deleteContents();
        lastRange.insertNode(wrap);
      } catch (e) {
        console.error('Highlight failed:', e);
      }
      selbar.style.display = 'none';
      showToast('Highlighted');
    }

    function removeHighlight() {
      if (currentHlNode) {
        const p = currentHlNode.parentNode;
        while (currentHlNode.firstChild) p.insertBefore(currentHlNode.firstChild, currentHlNode);
        p.removeChild(currentHlNode);
        p.normalize();
        currentHlNode = null;
        selbar.style.display = 'none';
        showToast('Highlight removed');
        return;
      }
      
      if (!lastRange) return;
      const selRect = lastRange.getBoundingClientRect();
      const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
      const toRemove = [];
      
      while (walker.nextNode()) {
        const n = walker.currentNode;
        if (n.classList && n.classList.contains('hl')) {
          const r = n.getBoundingClientRect();
          if (!(r.right < selRect.left || r.left > selRect.right || r.bottom < selRect.top || r.top > selRect.bottom)) {
            toRemove.push(n);
          }
        }
      }
      
      toRemove.forEach(function (el) {
        const p = el.parentNode;
        while (el.firstChild) p.insertBefore(el.firstChild, el);
        p.removeChild(el);
        p.normalize();
      });
      
      selbar.style.display = 'none';
      showToast('Highlight removed');
    }

    btnHL.addEventListener('click', doHighlight);
    btnUH.addEventListener('click', removeHighlight);

    // Notes functionality
    const notes = document.getElementById('notes');
    const noteArea = document.getElementById('noteArea');
    const btnCopy = document.getElementById('btnCopy');
    const btnClose = document.getElementById('btnClose');

    function toggleNotes() {
      notes.style.display = (notes.style.display === 'flex' ? 'none' : 'flex');
    }

    btnClose.addEventListener('click', toggleNotes);
    btnCopy.addEventListener('click', async function () {
      await navigator.clipboard.writeText(noteArea.value || '');
      showToast('Copied');
    });

    btnNote.addEventListener('click', function () {
      let text = '';
      if (currentHlNode) {
        text = (currentHlNode.textContent || '').trim();
      } else if (lastRange) {
        const frag = lastRange.cloneContents();
        text = (frag.textContent || '').trim();
      }
      toggleNotes();
      if (text) {
        noteArea.value = (noteArea.value ? noteArea.value + '\n' : '') + '> ' + text + '\n';
      }
      selbar.style.display = 'none';
    });

    // Toast functionality
    const toastEl = document.getElementById('toast');
    function showToast(msg) {
      toastEl.textContent = msg;
      toastEl.style.display = 'block';
      setTimeout(function () { toastEl.style.display = 'none'; }, 1200);
    }

    // Grading functionality
    const answers = {
      "q27": "A", "q28": "C", "q29": "E", "q30": "B", "q31": "C",
      "q32": "A", "q33": "A", "q34": "A", "q35": "C", "q36": "A",
      "q37": "C", "q38": "A", "q39": "B", "q40": "A"
    };

    function grade() {
      let total = 0, correct = 0, lines = [];
      
      function push(q, ok, user) {
        total++;
        if (ok) correct++;
        lines.push(q.toUpperCase() + ": " + (user || 'None') + " " + (ok ? '‚úì' : '‚úó'));
      }

      for (let n = 27; n <= 40; n++) {
        const sel = document.querySelector('input[name="q' + n + '"]:checked');
        const val = sel ? sel.value : '';
        push('q' + n, val === answers['q' + n], val);
      }

      const acc = (total ? Math.round(100 * correct / total) : 0);
      let html = '<p><strong>Score:</strong> ' + correct + '/' + total + ' <span class="badge">Accuracy ' + acc + '%</span></p>';
      html += '<pre>' + lines.join('\n') + '</pre>';
      document.getElementById('results').innerHTML = html;
    }

    // Divider resize functionality
    let isResizing = false;
    const divider = document.getElementById('divider');
    const leftPane = document.getElementById('left');
    const rightPane = document.getElementById('right');

    divider.addEventListener('mousedown', function (e) {
      isResizing = true;
      document.addEventListener('mousemove', handleResize);
      document.addEventListener('mouseup', stopResize);
    });

    function handleResize(e) {
      if (!isResizing) return;
      const containerRect = document.querySelector('.shell').getBoundingClientRect();
      const newLeftWidth = ((e.clientX - containerRect.left) / containerRect.width) * 100;
      
      if (newLeftWidth > 20 && newLeftWidth < 80) {
        leftPane.style.flex = `0 0 ${newLeftWidth}%`;
      }
    }

    function stopResize() {
      isResizing = false;
      document.removeEventListener('mousemove', handleResize);
      document.removeEventListener('mouseup', stopResize);
    }
  </script>

  <!-- Practice page enhancer integration -->
  <script>
    if (!window.practicePageEnhancer) {
      const script = document.createElement('script');
      script.src = '../../js/practice-page-enhancer.js';
      script.onload = function () { console.log('Practice page enhancer loaded'); };
      script.onerror = function () { console.error('Practice page enhancer failed to load'); loadInlineEnhancer(); };
      document.head.appendChild(script);
    }

    function loadInlineEnhancer() {
      if (window.practicePageEnhancer) return;

      window.practicePageEnhancer = {
        initialize: function () {
          this.setupCommunication();
          this.trackAnswers();
          this.sendSessionReady();
        },

        setupCommunication: function () {
          console.log('[InlineEnhancer] Communication setup');
        },

        trackAnswers: function () {
          document.addEventListener('change', (e) => {
            if (e.target.type === 'radio') {
              console.log('[InlineEnhancer] Answer changed:', e.target.name, e.target.value);
            }
          });

          document.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON' &&
              (e.target.textContent.includes('Submit') ||
                e.target.textContent.includes('Grade'))) {
              setTimeout(() => this.sendPracticeComplete(), 100);
            }
          });
        },

        sendSessionReady: function () {
          console.log('[InlineEnhancer] Session ready');
        },

        sendPracticeComplete: function () {
          const answers = {};
          for (let i = 27; i <= 40; i++) {
            const input = document.querySelector(`input[name="q${i}"]:checked`);
            answers[`q${i}`] = input ? input.value : '';
          }
          console.log('[InlineEnhancer] Practice complete:', answers);
        }
      };
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        window.practicePageEnhancer.initialize();
      });
    } else {
      window.practicePageEnhancer.initialize();
    }
  </script>

</body>

</html>