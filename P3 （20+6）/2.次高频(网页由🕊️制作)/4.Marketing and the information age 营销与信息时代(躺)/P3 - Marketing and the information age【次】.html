<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>P3 – Marketing and The Information Age</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --line: #e5e7eb;
      --bg: #f6f7fb;
      --panel: #fff;
      --accent: #3b82f6;
      --muted: #6b7280;
      --shadow: 0 6px 20px rgba(0, 0, 0, .12);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      padding-bottom: 82px;
    }

    .shell {
      display: flex;
      height: 100vh;
      width: 100%;
    }

    .pane {
      background: var(--panel);
      overflow: auto;
      padding: 20px;
    }

    #left {
      flex: 0 0 50%;
      min-width: 280px;
    }

    #right {
      flex: 1 1 auto;
      min-width: 320px;
      background: #fbfbff;
      border-left: 1px solid var(--line);
    }

    #divider {
      flex: 0 0 8px;
      background: linear-gradient(90deg, #e5e7eb, #d1d5db);
      cursor: ew-resize;
      position: relative;
      z-index: 5;
      user-select: none;
    }

    h2,
    h3,
    h4 {
      margin: 0 0 10px;
    }

    #left p {
      margin: 0 0 12px;
      line-height: 1.6;
      word-break: normal;
      overflow-wrap: normal;
      hyphens: none;
    }

    .group {
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 14px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th,
    td {
      border: 1px solid var(--line);
      padding: 6px;
      text-align: center;
      font-size: 14px;
    }

    th:first-child,
    td:first-child {
      text-align: left;
      padding-left: 8px;
    }

    button {
      padding: 8px 12px;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #fff;
      cursor: pointer;
    }

    button.primary {
      background: var(--accent);
      color: #fff;
      border-color: #3b82f6;
    }

    #results {
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
    }

    .hl {
      background: #fff3a3;
      box-shadow: inset 0 -2px 0 rgba(0, 0, 0, .05);
      cursor: pointer;
    }

    .hl:hover {
      filter: brightness(0.98);
    }

    #selbar {
      position: absolute;
      display: none;
      z-index: 2000;
      background: #111;
      color: #fff;
      border-radius: 8px;
      padding: 6px;
      box-shadow: var(--shadow);
      font-size: 13px;
      gap: 6px;
      align-items: center;
    }

    #selbar button {
      background: transparent;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, .25);
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
    }

    #selbar button:hover {
      border-color: #fff;
    }

    #notes {
      position: fixed;
      right: 12px;
      bottom: 12px;
      width: 320px;
      height: 42vh;
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 12px;
      display: none;
      flex-direction: column;
      z-index: 1500;
      box-shadow: var(--shadow);
    }

    #notes header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      border-bottom: 1px solid var(--line);
    }

    #notes textarea {
      flex: 1;
      border: 0;
      padding: 10px;
      resize: none;
      font-size: 14px;
      line-height: 1.5;
    }

    #toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
      background: #111;
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      display: none;
      z-index: 2500;
    }

    details.answerbox summary {
      cursor: pointer;
      user-select: none;
      list-style: none;
    }

    details.answerbox {
      border: 1px dashed var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      background: #fff;
    }

    .badge {
      display: inline-block;
      background: #eef2ff;
      color: #4338ca;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      margin-left: 6px;
    }

    .practice-nav {
      background: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .05);
      flex-wrap: wrap;
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      border-top: 2px solid var(--line);
      z-index: 4000;
    }

    .practice-nav .title {
      font-weight: 600;
      color: var(--muted);
    }

    .practice-nav .questions {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .practice-nav .q-item {
      padding: 6px 10px;
      border: 1px solid var(--line);
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      min-width: 36px;
      text-align: center;
    }

    .practice-nav .q-item:hover {
      background: #f1f5f9;
      border-color: var(--accent);
    }

    .practice-nav .q-item.answered {
      background: #e0e7ff;
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 500;
    }

    .practice-nav .q-item.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .practice-nav .controls {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    #timer {
      display: inline-block;
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 4px 10px;
      font-size: 14px;
      vertical-align: middle;
      cursor: pointer;
      transition: all 0.2s;
    }

    #timer:hover {
      background: #f8fafc;
      border-color: var(--accent);
    }

    #timer.paused {
      background: #fef3c7;
      border-color: #f59e0b;
      color: #92400e;
    }

    /* Dark mode styles */
    body.dark {
      --bg: #0f172a;
      --panel: #1e293b;
      --line: #334155;
      --muted: #94a3b8;
      color: #e2e8f0;
    }

    body.dark #right {
      background: #0f172a;
    }

    body.dark .group {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark button {
      background: #1e293b;
      color: #e2e8f0;
      border-color: #334155;
    }

    body.dark button:hover {
      background: #334155;
    }

    body.dark #results {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark #notes {
      background: #1e293b;
      border-color: #334155;
      color: #e2e8f0;
    }

    body.dark .practice-nav {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark .q-item {
      background: #0f172a;
      color: #e2e8f0;
      border-color: #334155;
    }

    body.dark .q-item:hover {
      background: #334155;
    }

    body.dark #timer {
      background: #1e293b;
      color: #e2e8f0;
      border-color: #334155;
    }

    body.dark #timer:hover {
      background: #334155;
    }

    body.dark table,
    body.dark th,
    body.dark td {
      border-color: #334155;
    }

    body.dark th {
      background: #0f172a;
    }

    .theme-toggle {
      background: transparent;
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
    }

    .theme-toggle:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
  </style>
</head>

<body>
  <div class="practice-nav">
    <div class="title">Questions</div>
    <div class="questions">
      <div class="q-item" onclick="scrollToElement('q27-anchor')">27</div>
      <div class="q-item" onclick="scrollToElement('q28-anchor')">28</div>
      <div class="q-item" onclick="scrollToElement('q29-anchor')">29</div>
      <div class="q-item" onclick="scrollToElement('q30-anchor')">30</div>
      <div class="q-item" onclick="scrollToElement('q31-anchor')">31</div>
      <div class="q-item" onclick="scrollToElement('q32-anchor')">32</div>
      <div class="q-item" onclick="scrollToElement('q33-anchor')">33</div>
      <div class="q-item" onclick="scrollToElement('q34-anchor')">34</div>
      <div class="q-item" onclick="scrollToElement('q35-anchor')">35</div>
      <div class="q-item" onclick="scrollToElement('q36-anchor')">36</div>
      <div class="q-item" onclick="scrollToElement('q37-anchor')">37</div>
      <div class="q-item" onclick="scrollToElement('q38-anchor')">38</div>
      <div class="q-item" onclick="scrollToElement('q39-anchor')">39</div>
      <div class="q-item" onclick="scrollToElement('q40-anchor')">40</div>
    </div>
    <div class="controls">
      <span id="timer">00:00</span>
      <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">🌙</button>
    </div>
  </div>

  <div class="shell">
    <section class="pane" id="left">
      <h2>READING PASSAGE 3</h2>
      <p>You should spend about 20 minutes on Questions 27–40, which are based on Reading Passage 3 below.</p>
      <h3>Marketing and The Information Age</h3>
      
      <h4>A</h4>
      <p>For the early practitioners of marketing in the late 19th and early 20th centuries, the business of selling was simply a matter of continually finding new customers. By contrast, marketing managers in the current era recognise the importance of gathering information about the market and about potential customers. They recognise that if companies are to be profitable, customers must gain and retain their perceptions of value from the brands they buy over a long time frame, rather than from a single transaction. This also means that customers must see value in returning continually to the stores where they shop, as well as to the service providers they deal with.</p>
      
      <h4>B</h4>
      <p>Marketing practitioners and marketing scientists have never worked more closely than they currently do. There are many reasons for this, including the fact that this is the information age where convergence in telecommunications, media and technology is causing old ways to be challenged, and new methods and tools to be tested. Customer expectations have risen as new technologies allow new approaches. For instance, the subscriber-TV music channel Channel [V] encourages its viewers to sign up for text messages and email alerts that tell them when their favourite artists and songs are about to be broadcast. Competitive advantage lies in being able to recognise which customers can be given greater attention, not just because they demand it but because it makes commercial sense to provide high levels of product quality and service.</p>
      
      <h4>C</h4>
      <p>Modern marketing information systems rely on information technology to enable marketing intelligence to be gathered and to store and analyse marketing research information. While some of the information used is gathered by government bodies such as the Australian Bureau of Statistics and Statistics New Zealand, most of it is purposefully gathered by marketing organisations for client companies. In the process, computer technology is used to manipulate the data and then to present the information in such a way that executives can readily identify any problems or issues, and quickly arrive at solutions.</p>
      
      <h4>D</h4>
      <p>In order to produce superior value and satisfaction for customers, marketing managers need information at almost every turn. They need information about customers – end-users and resellers as well as competitors and governmental and other forces in the marketplace. One marketing executive put it this way: 'To manage a business well is to manage its future; and to manage the future is to manage information.' Increasingly, marketers are viewing information not just as an input for making better decisions but also as an important strategic asset and marketing tool. As household incomes increase, choice widens and buyers become better at discriminating, so sellers need information about how buyers respond to different products and advertising campaigns.</p>
      
      <h4>E</h4>
      <p>The supply of information has also increased greatly. It has been suggested by the futurist and best-selling author John Naisbitt that the United States and, by observation, developed countries such as Australia, New Zealand and Singapore are moving from industrial to information-based economies. These post-industrial economies earn 70–80% of their Gross Domestic Product from services, and have entered what some commentators have termed the 'Information Age' or the 'Information Technology Era'.</p>
      
      <h4>F</h4>
      <p>One study found that with all the information now available through supermarket scanners, a packaged-goods product controller is bombarded with one million to one billion new numbers each week. As Naisbitt points out: 'Running out of information is not a problem, but drowning in it is.' Yet marketers frequently complain that they lack information of the right kind but have plenty of the wrong kind, or they claim that marketing information is so widely spread throughout the organisation that it takes great effort to locate even simple facts. In addition, subordinates may withhold information they believe will reflect badly on their performance and important information often arrives too late to be useful, or on-time information is not accurate. So marketing managers need better information. Although marketing organisations have greater capacity to provide managers with information, they often do not use it well. As a result, many marketing organisations are now studying their managers' information needs and designing information systems specifically to meet those needs.</p>
      
      <h4>G</h4>
      <p>One solution is to use a Marketing Information System (MIS). This consists of people, equipment and procedures which, when put together, are able to gather, analyse, evaluate and distribute needed, timely and accurate information to marketing decision-makers. The MIS begins and ends with marketing managers. First, it interacts with these managers to assess the information needs they have. Next, it develops the needed information from internal records, marketing intelligence activities and the research process. The analysis unit processes the data to make it more useful and, finally, the MIS distributes it to managers in the right form and at the right time to help them make better marketing decisions.</p>
      
      <h4>H</h4>
      <p>However, the costs of obtaining, processing, storing and delivering information can mount quickly. In some cases additional information will do little to change or improve a manager's decision, or the costs of the information will exceed the returns from the improved decision. For example, if an organisation estimates that launching a new product without any further information will yield a profit of $500,000, then it would be foolish to spend $30,000 for additional information that would increase the profit to only $525,000. By itself, information is valueless – its value comes from its use.</p>
    </section>

    <div id="divider"></div>

    <section class="pane" id="right">
      <div class="group">
        <h3>Questions 27–31</h3>
        <p>Reading Passage 3 has eight paragraphs, A–H.</p>
        <p>Which paragraph contains the following information?</p>
        <p>Write the correct letter, A–H, in boxes 27–31 on your answer sheet.</p>
        
        <table>
          <thead>
            <tr>
              <th>Information</th>
              <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th>
            </tr>
          </thead>
          <tbody>
            <tr id="q27-anchor">
              <td><strong>27</strong> the fact that there may be too much information to cope with</td>
              <td><input type="radio" name="q27" value="A"></td>
              <td><input type="radio" name="q27" value="B"></td>
              <td><input type="radio" name="q27" value="C"></td>
              <td><input type="radio" name="q27" value="D"></td>
              <td><input type="radio" name="q27" value="E"></td>
              <td><input type="radio" name="q27" value="F"></td>
              <td><input type="radio" name="q27" value="G"></td>
              <td><input type="radio" name="q27" value="H"></td>
            </tr>
            <tr id="q28-anchor">
              <td><strong>28</strong> reference to the fact that marketing approaches have had to change</td>
              <td><input type="radio" name="q28" value="A"></td>
              <td><input type="radio" name="q28" value="B"></td>
              <td><input type="radio" name="q28" value="C"></td>
              <td><input type="radio" name="q28" value="D"></td>
              <td><input type="radio" name="q28" value="E"></td>
              <td><input type="radio" name="q28" value="F"></td>
              <td><input type="radio" name="q28" value="G"></td>
              <td><input type="radio" name="q28" value="H"></td>
            </tr>
            <tr id="q29-anchor">
              <td><strong>29</strong> why marketing managers require information</td>
              <td><input type="radio" name="q29" value="A"></td>
              <td><input type="radio" name="q29" value="B"></td>
              <td><input type="radio" name="q29" value="C"></td>
              <td><input type="radio" name="q29" value="D"></td>
              <td><input type="radio" name="q29" value="E"></td>
              <td><input type="radio" name="q29" value="F"></td>
              <td><input type="radio" name="q29" value="G"></td>
              <td><input type="radio" name="q29" value="H"></td>
            </tr>
            <tr id="q30-anchor">
              <td><strong>30</strong> reference to a system that can provide good information for marketing managers</td>
              <td><input type="radio" name="q30" value="A"></td>
              <td><input type="radio" name="q30" value="B"></td>
              <td><input type="radio" name="q30" value="C"></td>
              <td><input type="radio" name="q30" value="D"></td>
              <td><input type="radio" name="q30" value="E"></td>
              <td><input type="radio" name="q30" value="F"></td>
              <td><input type="radio" name="q30" value="G"></td>
              <td><input type="radio" name="q30" value="H"></td>
            </tr>
            <tr id="q31-anchor">
              <td><strong>31</strong> the fact that information can be expensive</td>
              <td><input type="radio" name="q31" value="A"></td>
              <td><input type="radio" name="q31" value="B"></td>
              <td><input type="radio" name="q31" value="C"></td>
              <td><input type="radio" name="q31" value="D"></td>
              <td><input type="radio" name="q31" value="E"></td>
              <td><input type="radio" name="q31" value="F"></td>
              <td><input type="radio" name="q31" value="G"></td>
              <td><input type="radio" name="q31" value="H"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="group">
        <h3>Questions 32–36</h3>
        <p>Complete the sentences below.</p>
        <p>Choose <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
        <p>Write your answers in boxes 32–36 on your answer sheet.</p>

        <div id="q32-anchor">
          <p><strong>32</strong> Early marketing was simply about finding new <input type="text" class="blank" name="q32" placeholder="______">.</p>
        </div>

        <div id="q33-anchor">
          <p><strong>33</strong> Channel [V] uses <input type="text" class="blank" name="q33" placeholder="______"> and email alerts to inform viewers.</p>
        </div>

        <div id="q34-anchor">
          <p><strong>34</strong> Most marketing information is gathered by <input type="text" class="blank" name="q34" placeholder="______"> for their clients.</p>
        </div>

        <div id="q35-anchor">
          <p><strong>35</strong> John Naisbitt suggests that developed countries are moving towards <input type="text" class="blank" name="q35" placeholder="______"> economies.</p>
        </div>

        <div id="q36-anchor">
          <p><strong>36</strong> A Marketing Information System consists of people, equipment and <input type="text" class="blank" name="q36" placeholder="______">.</p>
        </div>
      </div>

      <div class="group">
        <h3>Questions 37–40</h3>
        <p>Choose the correct letter, A, B or C.</p>
        <p>Write the correct letter in boxes 37–40 on your answer sheet.</p>

        <div id="q37-anchor">
          <p><strong>37</strong> According to the passage, modern marketing managers</p>
          <label><input type="radio" name="q37" value="A"> A focus only on finding new customers</label><br>
          <label><input type="radio" name="q37" value="B"> B understand the importance of information gathering</label><br>
          <label><input type="radio" name="q37" value="C"> C prefer traditional marketing methods</label>
        </div>

        <div id="q38-anchor">
          <p><strong>38</strong> The main problem with information today is that</p>
          <label><input type="radio" name="q38" value="A"> A there is too little available</label><br>
          <label><input type="radio" name="q38" value="B"> B it is too expensive to obtain</label><br>
          <label><input type="radio" name="q38" value="C"> C there may be too much to handle effectively</label>
        </div>

        <div id="q39-anchor">
          <p><strong>39</strong> A Marketing Information System (MIS)</p>
          <label><input type="radio" name="q39" value="A"> A replaces marketing managers</label><br>
          <label><input type="radio" name="q39" value="B"> B works with marketing managers</label><br>
          <label><input type="radio" name="q39" value="C"> C is controlled by computer technology</label>
        </div>

        <div id="q40-anchor">
          <p><strong>40</strong> The value of information depends on</p>
          <label><input type="radio" name="q40" value="A"> A how much it costs</label><br>
          <label><input type="radio" name="q40" value="B"> B how it is used</label><br>
          <label><input type="radio" name="q40" value="C"> C how quickly it is obtained</label>
        </div>
      </div>

      <div class="group">
        <button class="primary" onclick="grade()">Submit Answers</button>
        <button onclick="toggleNotes()">📝 Notes</button>
      </div>

      <div id="results"></div>

      <details class="answerbox">
        <summary>Answer Key</summary>
        <ol>
          <li>27 → F</li>
          <li>28 → B</li>
          <li>29 → D</li>
          <li>30 → G</li>
          <li>31 → H</li>
          <li>32 → customers</li>
          <li>33 → text messages</li>
          <li>34 → marketing organisations</li>
          <li>35 → information-based</li>
          <li>36 → procedures</li>
          <li>37 → B</li>
          <li>38 → C</li>
          <li>39 → B</li>
          <li>40 → B</li>
        </ol>
      </details>
    </section>
  </div>

  <div id="selbar">
    <button id="btnHL">🖍️ Highlight</button>
    <button id="btnUH">❌ Remove</button>
    <button id="btnNote">📝 Note</button>
  </div>

  <div id="notes">
    <header>
      <span>📝 Notes</span>
      <div>
        <button id="btnCopy">📋</button>
        <button id="btnClose">✕</button>
      </div>
    </header>
    <textarea id="noteArea" placeholder="Write your notes here..."></textarea>
  </div>

  <div id="toast"></div>

  <script>
    // Timer with click to pause/resume functionality
    let _t = 0;
    let timerRunning = true;
    let timerInterval;
    const _timerEl = document.getElementById('timer');

    function updateTimer() {
      const m = Math.floor(_t / 60);
      const s = _t % 60;
      _timerEl.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        if (timerRunning) {
          _t++;
          updateTimer();
        }
      }, 1000);
    }

    // Add click functionality to timer
    _timerEl.addEventListener('click', function () {
      if (timerRunning) {
        clearInterval(timerInterval);
        timerRunning = false;
        _timerEl.classList.add('paused');
        showToast('Timer paused');
      } else {
        startTimer();
        timerRunning = true;
        _timerEl.classList.remove('paused');
        showToast('Timer resumed');
      }
    });

    // Start timer on page load
    startTimer();

    // Dark mode functionality
    function toggleTheme() {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem('darkMode', isDark);
      const themeButton = document.querySelector('.theme-toggle');
      themeButton.textContent = isDark ? '☀️' : '🌙';
    }

    // Load saved theme
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark');
      document.querySelector('.theme-toggle').textContent = '☀️';
    }

    // Navigation functionality
    function scrollToElement(id) {
      const element = document.getElementById(id);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Update navigation state
        document.querySelectorAll('.q-item').forEach(item => item.classList.remove('active'));
        const questionNum = id.replace('-anchor', '').replace('q', '');
        const navItem = document.querySelector(`[onclick="scrollToElement('${id}')"]`);
        if (navItem) navItem.classList.add('active');
      }
    }

    // Answer tracking
    function updateAnswerStatus() {
      for (let i = 27; i <= 40; i++) {
        const input = document.querySelector(`input[name="q${i}"]:checked`) || 
                     document.querySelector(`input[name="q${i}"][type="text"]`);
        const navItem = document.querySelector(`[onclick="scrollToElement('q${i}-anchor')"]`);
        if (navItem) {
          if (input && ((input.type === 'radio' && input.checked) || 
                       (input.type === 'text' && input.value.trim()))) {
            navItem.classList.add('answered');
          } else {
            navItem.classList.remove('answered');
          }
        }
      }
    }

    // Listen for answer changes
    document.addEventListener('change', updateAnswerStatus);
    document.addEventListener('input', updateAnswerStatus);

    // Highlighting functionality
    let lastRange = null;
    let currentHlNode = null;
    const selbar = document.getElementById('selbar');
    const btnHL = document.getElementById('btnHL');
    const btnUH = document.getElementById('btnUH');
    const btnNote = document.getElementById('btnNote');

    document.addEventListener('mouseup', function (e) {
      const sel = window.getSelection();
      if (sel.rangeCount && !sel.isCollapsed) {
        lastRange = sel.getRangeAt(0);
        const rect = lastRange.getBoundingClientRect();
        selbar.style.left = rect.left + 'px';
        selbar.style.top = (rect.top - 40) + 'px';
        selbar.style.display = 'flex';
      }
    });

    document.addEventListener('click', function (e) {
      if (e.target.classList && e.target.classList.contains('hl')) {
        currentHlNode = e.target;
        const rect = e.target.getBoundingClientRect();
        selbar.style.left = rect.left + 'px';
        selbar.style.top = (rect.top - 40) + 'px';
        selbar.style.display = 'flex';
      } else if (!selbar.contains(e.target)) {
        selbar.style.display = 'none';
        currentHlNode = null;
      }
    });

    function doHighlight() {
      if (currentHlNode) return;
      if (!lastRange) return;
      try {
        const wrap = document.createElement('span');
        wrap.className = 'hl';
        wrap.appendChild(lastRange.cloneContents());
        lastRange.deleteContents();
        lastRange.insertNode(wrap);
      } catch (e) {
        console.error('Highlight failed:', e);
      }
      selbar.style.display = 'none';
      showToast('Highlighted');
    }

    function removeHighlight() {
      if (currentHlNode) {
        const p = currentHlNode.parentNode;
        while (currentHlNode.firstChild) p.insertBefore(currentHlNode.firstChild, currentHlNode);
        p.removeChild(currentHlNode);
        p.normalize();
        currentHlNode = null;
        selbar.style.display = 'none';
        showToast('Highlight removed');
        return;
      }
      
      if (!lastRange) return;
      const selRect = lastRange.getBoundingClientRect();
      const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
      const toRemove = [];
      
      while (walker.nextNode()) {
        const n = walker.currentNode;
        if (n.classList && n.classList.contains('hl')) {
          const r = n.getBoundingClientRect();
          if (!(r.right < selRect.left || r.left > selRect.right || r.bottom < selRect.top || r.top > selRect.bottom)) {
            toRemove.push(n);
          }
        }
      }
      
      toRemove.forEach(function (el) {
        const p = el.parentNode;
        while (el.firstChild) p.insertBefore(el.firstChild, el);
        p.removeChild(el);
        p.normalize();
      });
      
      selbar.style.display = 'none';
      showToast('Highlight removed');
    }

    btnHL.addEventListener('click', doHighlight);
    btnUH.addEventListener('click', removeHighlight);

    // Notes functionality
    const notes = document.getElementById('notes');
    const noteArea = document.getElementById('noteArea');
    const btnCopy = document.getElementById('btnCopy');
    const btnClose = document.getElementById('btnClose');

    function toggleNotes() {
      notes.style.display = (notes.style.display === 'flex' ? 'none' : 'flex');
    }

    btnClose.addEventListener('click', toggleNotes);
    btnCopy.addEventListener('click', async function () {
      await navigator.clipboard.writeText(noteArea.value || '');
      showToast('Copied');
    });

    btnNote.addEventListener('click', function () {
      let text = '';
      if (currentHlNode) {
        text = (currentHlNode.textContent || '').trim();
      } else if (lastRange) {
        const frag = lastRange.cloneContents();
        text = (frag.textContent || '').trim();
      }
      toggleNotes();
      if (text) {
        noteArea.value = (noteArea.value ? noteArea.value + '\n' : '') + '> ' + text + '\n';
      }
      selbar.style.display = 'none';
    });

    // Toast functionality
    const toastEl = document.getElementById('toast');
    function showToast(msg) {
      toastEl.textContent = msg;
      toastEl.style.display = 'block';
      setTimeout(function () { toastEl.style.display = 'none'; }, 1200);
    }

    // Grading functionality
    const answers = {
      "q27": "F", "q28": "B", "q29": "D", "q30": "G", "q31": "H",
      "q32": "customers", "q33": "text messages", "q34": "marketing organisations", 
      "q35": "information-based", "q36": "procedures",
      "q37": "B", "q38": "C", "q39": "B", "q40": "B"
    };

    function grade() {
      let total = 0, correct = 0, lines = [];
      
      function push(q, ok, user) {
        total++;
        if (ok) correct++;
        lines.push(q.toUpperCase() + ": " + (user || 'None') + " " + (ok ? '✓' : '✗'));
      }

      // Questions 27-31 (radio buttons)
      for (let n = 27; n <= 31; n++) {
        const sel = document.querySelector('input[name="q' + n + '"]:checked');
        const val = sel ? sel.value : '';
        push('q' + n, val === answers['q' + n], val);
      }

      // Questions 32-36 (text inputs)
      for (let n = 32; n <= 36; n++) {
        const input = document.querySelector('input[name="q' + n + '"]');
        const val = input ? input.value.trim().toLowerCase() : '';
        const expected = answers['q' + n].toLowerCase();
        push('q' + n, val === expected, input ? input.value : '');
      }

      // Questions 37-40 (radio buttons)
      for (let n = 37; n <= 40; n++) {
        const sel = document.querySelector('input[name="q' + n + '"]:checked');
        const val = sel ? sel.value : '';
        push('q' + n, val === answers['q' + n], val);
      }

      const acc = (total ? Math.round(100 * correct / total) : 0);
      let html = '<p><strong>Score:</strong> ' + correct + '/' + total + ' <span class="badge">Accuracy ' + acc + '%</span></p>';
      html += '<pre>' + lines.join('\n') + '</pre>';
      document.getElementById('results').innerHTML = html;
    }

    // Divider resize functionality
    let isResizing = false;
    const divider = document.getElementById('divider');
    const leftPane = document.getElementById('left');
    const rightPane = document.getElementById('right');

    divider.addEventListener('mousedown', function (e) {
      isResizing = true;
      document.addEventListener('mousemove', handleResize);
      document.addEventListener('mouseup', stopResize);
    });

    function handleResize(e) {
      if (!isResizing) return;
      const containerRect = document.querySelector('.shell').getBoundingClientRect();
      const newLeftWidth = ((e.clientX - containerRect.left) / containerRect.width) * 100;
      
      if (newLeftWidth > 20 && newLeftWidth < 80) {
        leftPane.style.flex = `0 0 ${newLeftWidth}%`;
      }
    }

    function stopResize() {
      isResizing = false;
      document.removeEventListener('mousemove', handleResize);
      document.removeEventListener('mouseup', stopResize);
    }
  </script>

  <!-- Practice page enhancer integration -->
  <script>
    if (!window.practicePageEnhancer) {
      const script = document.createElement('script');
      script.src = '../../js/practice-page-enhancer.js';
      script.onload = function () { console.log('Practice page enhancer loaded'); };
      script.onerror = function () { console.error('Practice page enhancer failed to load'); loadInlineEnhancer(); };
      document.head.appendChild(script);
    }

    function loadInlineEnhancer() {
      if (window.practicePageEnhancer) return;

      window.practicePageEnhancer = {
        initialize: function () {
          this.setupCommunication();
          this.trackAnswers();
          this.sendSessionReady();
        },

        setupCommunication: function () {
          console.log('[InlineEnhancer] Communication setup');
        },

        trackAnswers: function () {
          document.addEventListener('change', (e) => {
            if (e.target.type === 'radio' || e.target.type === 'text') {
              console.log('[InlineEnhancer] Answer changed:', e.target.name, e.target.value);
            }
          });

          document.addEventListener('input', (e) => {
            if (e.target.type === 'text') {
              console.log('[InlineEnhancer] Text input changed:', e.target.name, e.target.value);
            }
          });

          document.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON' &&
              (e.target.textContent.includes('Submit') ||
                e.target.textContent.includes('Grade'))) {
              setTimeout(() => this.sendPracticeComplete(), 100);
            }
          });
        },

        sendSessionReady: function () {
          console.log('[InlineEnhancer] Session ready');
        },

        sendPracticeComplete: function () {
          const answers = {};
          for (let i = 27; i <= 40; i++) {
            const radioInput = document.querySelector(`input[name="q${i}"]:checked`);
            const textInput = document.querySelector(`input[name="q${i}"][type="text"]`);
            if (radioInput) {
              answers[`q${i}`] = radioInput.value;
            } else if (textInput) {
              answers[`q${i}`] = textInput.value;
            } else {
              answers[`q${i}`] = '';
            }
          }
          console.log('[InlineEnhancer] Practice complete:', answers);
        }
      };
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        window.practicePageEnhancer.initialize();
      });
    } else {
      window.practicePageEnhancer.initialize();
    }
  </script>

</body>

</html>