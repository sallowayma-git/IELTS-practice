<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Book Review: The Discovery of Slowness</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
  :root { --line:#e5e7eb; --bg:#f6f7fb; --panel:#fff; --accent:#3b82f6; --muted:#6b7280; --shadow:0 6px 20px rgba(0,0,0,.12); }
  * { box-sizing: border-box; }
  html,body { height:100%; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); }
  #timer { position: static; display: inline-block; margin-left: 8px; background:#fff; border:1px solid var(--line); border-radius:10px; padding:2px 8px; font-size:14px; vertical-align: middle; }
  .shell { display:flex; height:100vh; width:100%; }
  .pane { background:var(--panel); overflow:auto; padding:20px; }
  #left { flex: 0 0 50%; min-width: 280px; }
  #right { flex: 1 1 auto; min-width: 320px; background:#fbfbff; border-left:1px solid var(--line); }
  #divider { flex: 0 0 8px; background: linear-gradient(90deg,#e5e7eb,#d1d5db); cursor: ew-resize; position:relative; z-index: 5; user-select:none; }
  h2,h3,h4 { margin:0 0 10px; }
  #left p { margin: 0 0 12px; line-height: 1.6; word-break: normal; overflow-wrap: normal; hyphens: none; }
  .group { background:#fff; border:1px solid var(--line); border-radius:10px; padding:12px; margin-bottom:14px; }
  table { border-collapse: collapse; width:100%; }
  th, td { border:1px solid var(--line); padding:6px; text-align:center; font-size:14px; }
  th:first-child, td:first-child { width:92px; }
  button { padding:8px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; cursor:pointer; }
  button.primary { background:var(--accent); color:#fff; border-color:#3b82f6; }
  #results { background:#fff; border:1px solid var(--line); border-radius:10px; padding:10px; }
  .hl { background:#fff3a3; box-shadow: inset 0 -2px 0 rgba(0,0,0,.05); cursor: pointer; }
  .hl:hover { filter: brightness(0.98); }
  #selbar { position: absolute; display:none; z-index: 2000; background:#111; color:#fff; border-radius: 8px; padding: 6px; box-shadow: var(--shadow); font-size: 13px; gap:6px; align-items: center; }
  #selbar button { background: transparent; color:#fff; border: 1px solid rgba(255,255,255,.25); padding: 4px 8px; border-radius: 6px; cursor:pointer; }
  #selbar button:hover { border-color:#fff; }
  #notes { position: fixed; right: 12px; bottom: 12px; width: 320px; height: 42vh; background:#fff; border:1px solid var(--line); border-radius: 12px; display:none; flex-direction: column; z-index:1500; box-shadow: var(--shadow); }
  #notes header { display:flex; align-items:center; justify-content: space-between; padding:8px 10px; border-bottom:1px solid var(--line); }
  #notes textarea { flex:1; border:0; padding:10px; resize:none; font-size:14px; line-height:1.5; }
  #toast { position: fixed; left:50%; transform: translateX(-50%); bottom: 24px; background:#111; color:#fff; padding:8px 12px; border-radius: 8px; display:none; z-index:2500; }
  .dropzone { border:2px dashed #cbd5e1; background:#f8fafc; border-radius:10px; min-height:40px; padding:4px 8px; display:inline-flex; align-items:center; justify-content:space-between; gap:8px; width: auto; min-width: 120px; max-width: 200px; vertical-align: middle; }
  .droplabel { color:#64748b; font-size:14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .cardpool { background:#f1f5f9; border-radius:10px; padding:12px; display:flex; flex-wrap:wrap; gap:8px; }
  .pool-slot { min-height:40px; }
  .card { background:#fff; border:1px solid #e5e7eb; border-radius:8px; padding:8px 10px; display:inline-flex; gap:8px; align-items:center; cursor:grab; box-shadow:0 1px 0 rgba(0,0,0,.03); white-space: nowrap; }
  .card:active { cursor:grabbing; }
  .tag { background:#eef2ff; color:#4338ca; padding:2px 8px; border-radius:999px; font-size:12px; }
  .btn-clear { border:1px solid #e5e7eb; background:#fff; border-radius:8px; padding:6px 8px; cursor:pointer; }
  .ghost { opacity: .5; }
  .over { outline:2px dashed #3b82f6; }
  details.answerbox summary { cursor: pointer; user-select:none; list-style: none; }
  details.answerbox { border:1px dashed var(--line); border-radius:10px; padding:8px 10px; background:#fff; }
  .badge { display:inline-block; background:#eef2ff; color:#4338ca; padding:2px 8px; border-radius:999px; font-size:12px; margin-left:6px; }
  body { padding-bottom: 82px; }
  .practice-nav { background:#fff; border-bottom:2px solid var(--line); padding:12px 20px; display:flex; align-items:center; gap:20px; box-shadow:0 2px 4px rgba(0,0,0,.05); flex-wrap:wrap; position:fixed; left:0; right:0; bottom:0; border-top:2px solid var(--line); border-bottom:0; z-index:4000; }
  .practice-nav .title { font-weight:600; color:var(--muted); }
  .practice-nav .questions { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .practice-nav .q-item { padding:6px 10px; border:1px solid var(--line); border-radius:6px; background:#fff; cursor:pointer; font-size:14px; transition:all 0.2s; min-width:36px; text-align:center; }
  .practice-nav .q-item:hover { background:#f1f5f9; border-color:var(--accent); }
  .practice-nav .q-item.answered { background:#e0e7ff; border-color:var(--accent); color:var(--accent); font-weight:500; }
  .practice-nav .q-item.active { background:var(--accent); color:#fff; border-color:var(--accent); }
  #selbar { z-index: 6000 !important; }
</style>
</head>
<body>
<div class="practice-nav">
  <div class="title">Questions</div>
  <div class="questions">
    <div class="q-item" id="q27-nav" onclick="scrollToElement('q27-anchor')">27</div>
    <div class="q-item" id="q28-nav" onclick="scrollToElement('q28-anchor')">28</div>
    <div class="q-item" id="q29-nav" onclick="scrollToElement('q29-anchor')">29</div>
    <div class="q-item" id="q30-nav" onclick="scrollToElement('q30-anchor')">30</div>
    <div class="q-item" id="q31-nav" onclick="scrollToElement('q31-anchor')">31</div>
    <div class="q-item" id="q32-nav" onclick="scrollToElement('q32-anchor')">32</div>
    <div class="q-item" id="q33-nav" onclick="scrollToElement('q33-anchor')">33</div>
    <div class="q-item" id="q34-nav" onclick="scrollToElement('q34-anchor')">34</div>
    <div class="q-item" id="q35-nav" onclick="scrollToElement('q35-anchor')">35</div>
    <div class="q-item" id="q36-nav" onclick="scrollToElement('q36-anchor')">36</div>
    <div class="q-item" id="q37-nav" onclick="scrollToElement('q37-anchor')">37</div>
    <div class="q-item" id="q38-nav" onclick="scrollToElement('q38-anchor')">38</div>
    <div class="q-item" id="q39-nav" onclick="scrollToElement('q39-anchor')">39</div>
    <div class="q-item" id="q40-nav" onclick="scrollToElement('q40-anchor')">40</div>
  </div>
</div>
<div class="shell">
  <section class="pane" id="left">
    <h2>READING PASSAGE 3 <span id="timer">00:00</span></h2>
    <p>You should spend about 20 minutes on Questions 27–40, which are based on Reading Passage 3 below.</p>
    <h3>Book Review:</h3>
    <p><em>The Discovery of Slowness by Sten Nadolny, translated by Ralph Freedman | Canongate, 311 pp</em></p>
    
    <h4>Paragraph A</h4>
    <p>The English explorer and writer John Franklin (1786–1847) joined the Navy at the age of 14, and fought at the battle of Trafalgar. When peace came, he turned his attention to Arctic exploration, and in particular to solving the conundrum of the Northwest Passage, a mythical clear-water route through the ice which would, if it existed, link the Pacific Ocean on America’s West Coast with the Atlantic on its East. The first expedition Franklin led to the Arctic was an arduous overland journey lasting from 1819 to 1822, in which he and his twenty-strong team covered 8,880 kilometres on foot. Their expedition was a triumph of surveying – they managed to chart hundreds of kilometres of previously unknown coastline – but food ran out on their journey back to civilisation, and the men were forced to eat their belts and their boots (which they boiled up to make leather soup).</p>
    
    <h4>Paragraph B</h4>
    <p>There followed a career as a travel writer and public speaker (‘the man who ate his boots’ was Franklin’s tag-line). Then in 1845, Franklin set off back to the Arctic with two ships – the Erebus and the Terror – and 129 men. Nothing was heard of them for 14 years, although more than 30 expeditions were dispatched in search of them. Eventually it was discovered that Franklin and all his team had perished after their ships were trapped in the ice.</p>
    
    <h4>Paragraph C</h4>
    <p>In his personal correspondence and published memoirs, Franklin comes across as a man dedicated to the external duties of war and exploration, who kept introspection and self-analysis to a minimum. His blandness makes him an amenably malleable subject for a novelist, and Sten Nadolny has taken full advantage of this in his book. Most important, Nadolny has endowed John Franklin with a defining trait for which there is no historical evidence: Langsamkeit (‘slowness’, or ‘calmness’).</p>
    
    <h4>Paragraph D</h4>
    <p>Slowness influences not only Franklin’s behaviour, but also his vision, his thought and his speech. The opening scene of The Discovery of Slowness depicts Franklin as a young boy, failing to catch a ball because his reaction time is too slow. Despite the bullying of his peers, Franklin resolves not to fall into step with ‘their way of doing things’. For Nadolny, Franklin’s fascination with the Arctic stems from his desire to find an environment suited to his peculiar slowness. He describes Franklin as a boy dreaming of the ‘time without hours and days’ which exists in the far north, a place ‘where nobody would find him too slow’.</p>
    
    <h4>Paragraph E</h4>
    <p>Ice is a slow mover. The compressed blue ice inside an Alpine crevasse will have fallen as snow several decades earlier. Polar pack ice takes at least two years to form. The film of crystals which first appears on the surface of the sea thickens into a silkily pliant layer called nilas; this in turn consolidates into young ice, which then deepens during several seasons to become pack. Ice demands a corresponding patience from those who venture onto it. The explorers who have thrived at high latitudes and at high altitudes haven’t usually been men of great speed. They have tended instead to demonstrate unusual self-possession, a considerable capacity for boredom, and a talent for the uncomplaining endurance of suffering.</p>
    
    <h4>Paragraph F</h4>
    <p>These were all qualities which the historical Franklin possessed in abundance, and so Nadolny’s exaggeration of them isn’t unreasonable. Even as an adult, Franklin’s slowness of thought means that he is unable to speak fluently, so he learns by heart ‘entire fleets of words and batteries of responses’, and speaks a languid, bric-à-brac language. In the Navy, his method of thinking first and acting later initially provokes mockery from his fellow sailors. But Franklin persists in doing things his way, and gradually earns the respect of those around him. To a commodore who tells him to speed up his report of an engagement, he replies: ‘When I tell something, sir, I use my own rhythm.’ A lieutenant says approvingly of him: ‘Because Franklin is so slow, he never loses time.’</p>
    
    <h4>Paragraph G</h4>
    <p>Nadolny also brings his central metaphor of slowness to bear on the novel’s language. The chapters describing Franklin’s early years are a medley of separate fragments, rhetorical questions, associative jumps and exclamation marks. In the later sections recounting Franklin’s first Arctic expedition, Nadolny brilliantly sets the narrative pace to the rhythms of the frozen landscape, and to the ‘slowness which is bred by hunger’.</p>
    
    <h4>Paragraph H</h4>
    <p>Since it was first published in Germany in 1983, The Discovery of Slowness has sold more than a million copies and been translated into 15 languages. It has been adopted as a manual and manifesto by European pressure groups and institutions representing causes as diverse as sustainable development, management science and motoring policy, even becoming involved in the debate about speed limits on German roads. The various groups that have taken the novel up have one thing in common: a dislike of the high-speed culture of Postmodernity. Nadolny’s Franklin appeals to them because he is immune to ‘the compulsion to be constantly occupied’, and to the idea that ‘someone was better if he could do the same thing fast’. It’s easy to see where the attraction lies for those in management. The novel is crammed with quotations about time-efficiency, punctiliousness and profitability: ‘What did “too late” mean? They hadn’t waited for it long enough, that’s what it meant.’</p>
    
    <p>&nbsp;</p>
    <p>&nbsp;</p> <!-- 添加空白行防止加载不完全 -->
  </section>
  <div id="divider" title="Drag to resize"></div>
  <section class="pane" id="right">
    <h3>Questions</h3>
    
    <div class="group">
      <h4>Questions 27–31</h4>
      <p>Reading Passage 3 has eight paragraphs, A–H.</p>
      <p>Which paragraph contains the following information?</p>
      <p>Write the correct letter, A–H, in boxes 27–31 on your answer sheet.</p>
      
      <a id="q27-anchor"></a>
      <div id="q27-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>27 a summary of Franklin’s occupation in the period before his first expedition</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q27" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q27" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q27" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q27" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q27" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q27" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q27" type="radio" value="G"> G</label>
          <label style="margin:0;"><input name="q27" type="radio" value="H"> H</label>
        </div>
      </div>
      
      <a id="q28-anchor"></a>
      <div id="q28-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>28 a reference to a feature of Franklin’s character in Nadolny’s novel that has no definite basis in fact</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q28" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q28" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q28" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q28" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q28" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q28" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q28" type="radio" value="G"> G</label>
          <label style="margin:0;"><input name="q28" type="radio" value="H"> H</label>
        </div>
      </div>
      
      <a id="q29-anchor"></a>
      <div id="q29-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>29 a connection between the central theme of the novel and an environmental process</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q29" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q29" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q29" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q29" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q29" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q29" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q29" type="radio" value="G"> G</label>
          <label style="margin:0;"><input name="q29" type="radio" value="H"> H</label>
        </div>
      </div>
      
      <a id="q30-anchor"></a>
      <div id="q30-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>30 a reference to the widespread appeal of Nadolny’s novel</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q30" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q30" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q30" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q30" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q30" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q30" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q30" type="radio" value="G"> G</label>
          <label style="margin:0;"><input name="q30" type="radio" value="H"> H</label>
        </div>
      </div>
      
      <a id="q31-anchor"></a>
      <div id="q31-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>31 a summary of events following Franklin’s return from his first expedition</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q31" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q31" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q31" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q31" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q31" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q31" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q31" type="radio" value="G"> G</label>
          <label style="margin:0;"><input name="q31" type="radio" value="H"> H</label>
        </div>
      </div>
    </div>
    
    <div class="group">
      <h4>Questions 32–35</h4>
      <p>Complete the summary using the list of words, A–L, below.</p>
      <p>Write the correct letter, A–L, in boxes 32–35 on your answer sheet.</p>
      
      <p>John Franklin and the Quality of Slowness</p>
      <p>Little is known from Franklin’s correspondence and published writings about his <a id="q32-anchor"></a><div class="dropzone" data-target="q32"><span class="droplabel">Drag answer here</span></div>. The author, Nadolny, suggests that Franklin’s whole life can be explained by the quality of ‘slowness’. He begins the book by showing how this affects the young Franklin’s <a id="q33-anchor"></a><div class="dropzone" data-target="q33"><span class="droplabel">Drag answer here</span></div> activities, and makes him become <a id="q34-anchor"></a><div class="dropzone" data-target="q34"><span class="droplabel">Drag answer here</span></div>. As a child, it is the quality of <a id="q35-anchor"></a><div class="dropzone" data-target="q35"><span class="droplabel">Drag answer here</span></div> that attracts Franklin to the Arctic.</p>
      
      <div class="cardpool">
        <div class="card" draggable="true" data-value="A">A a bully</div>
        <div class="card" draggable="true" data-value="B">B discoveries</div>
        <div class="card" draggable="true" data-value="C">C educational</div>
        <div class="card" draggable="true" data-value="D">D family</div>
        <div class="card" draggable="true" data-value="E">E isolation</div>
        <div class="card" draggable="true" data-value="F">F an outsider</div>
        <div class="card" draggable="true" data-value="G">G personality</div>
        <div class="card" draggable="true" data-value="H">H problems</div>
        <div class="card" draggable="true" data-value="I">I remoteness</div>
        <div class="card" draggable="true" data-value="J">J a scholar</div>
        <div class="card" draggable="true" data-value="K">K sporting</div>
        <div class="card" draggable="true" data-value="L">L timelessness</div>
      </div>
    </div>
    
    <div class="group">
      <h4>Questions 36–40</h4>
      <p>Choose the correct letter, A, B, C or D.</p>
      <p>Write the correct letter in boxes 36–40 on your answer sheet.</p>
      
      <a id="q36-anchor"></a>
      <div id="q36-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>36 In paragraph E, the writer describes different types of ice in order to illustrate</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q36" type="radio" value="A"> A the extreme conditions that Polar explorers have to face.</label>
          <label style="margin:0;"><input name="q36" type="radio" value="B"> B the unusual quality of the beauty of Polar regions.</label>
          <label style="margin:0;"><input name="q36" type="radio" value="C"> C the vital importance of preserving the Arctic environment.</label>
          <label style="margin:0;"><input name="q36" type="radio" value="D"> D the personal qualities required of an explorer in Arctic conditions.</label>
        </div>
      </div>
      
      <a id="q37-anchor"></a>
      <div id="q37-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>37 What is said about the way Franklin communicates?</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q37" type="radio" value="A"> A He expresses a very limited range of ideas.</label>
          <label style="margin:0;"><input name="q37" type="radio" value="B"> B He is only willing to discuss things he is familiar with.</label>
          <label style="margin:0;"><input name="q37" type="radio" value="C"> C He uses words and phrases that he has previously memorised.</label>
          <label style="margin:0;"><input name="q37" type="radio" value="D"> D He is only fluent when talking about naval matters.</label>
        </div>
      </div>
      
      <a id="q38-anchor"></a>
      <div id="q38-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>38 How does the attitude of the other sailors change towards Franklin?</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q38" type="radio" value="A"> A They no longer notice his slowness.</label>
          <label style="margin:0;"><input name="q38" type="radio" value="B"> B They start to copy his approach to work.</label>
          <label style="margin:0;"><input name="q38" type="radio" value="C"> C They begin to recognise his efforts to overcome his problems.</label>
          <label style="margin:0;"><input name="q38" type="radio" value="D"> D They eventually appreciate his good qualities.</label>
        </div>
      </div>
      
      <a id="q39-anchor"></a>
      <div id="q39-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>39 The chapters of The Discovery of Slowness which describe Franklin’s early years contain</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q39" type="radio" value="A"> A text from a wide variety of sources.</label>
          <label style="margin:0;"><input name="q39" type="radio" value="B"> B short, disconnected pieces of text.</label>
          <label style="margin:0;"><input name="q39" type="radio" value="C"> C descriptions of the Arctic landscape.</label>
          <label style="margin:0;"><input name="q39" type="radio" value="D"> D information about other explorers like Franklin.</label>
        </div>
      </div>
      
      <a id="q40-anchor"></a>
      <div id="q40-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>40 The Discovery of Slowness has achieved widespread popularity because</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q40" type="radio" value="A"> A it reflects many people’s concern about one aspect of modern life.</label>
          <label style="margin:0;"><input name="q40" type="radio" value="B"> B it offers achievable solutions to many of the problems of today.</label>
          <label style="margin:0;"><input name="q40" type="radio" value="C"> C it tells the story of someone’s triumph over personal problems.</label>
          <label style="margin:0;"><input name="q40" type="radio" value="D"> D it shows how life in the past was less pressured than it is now.</label>
        </div>
      </div>
    </div>
    
    <div style="display:flex;gap:8px;margin-bottom:10px;">
      <button class="primary" onclick="grade()">Submit</button>
      <button onclick="resetForm()">Reset</button>
      <button onclick="toggleNotes()">Notes</button>
    </div>
    <div id="results"></div>
    <details class="answerbox" id="answerBox">
      <summary>Show answers (click to toggle) <span class="badge">hidden</span></summary>
      <div id="answerContent"></div>
    </details>
  </section>
</div>
<div aria-label="Selection tools" id="selbar" role="toolbar">
  <button id="btnHL">Highlight</button>
  <button id="btnUH">Remove</button>
  <button id="btnNote">Note</button>
</div>
<div id="notes">
  <header>
    <strong>Notes</strong>
    <div>
      <button id="btnCopy">Copy</button>
      <button id="btnClose">Close</button>
    </div>
  </header>
  <textarea id="noteArea" placeholder="Type your notes here..."></textarea>
</div>
<div id="toast"></div>
<script>
// Timer
let _t=0; const _timerEl=document.getElementById('timer');
setInterval(function(){ 
  _t++; 
  var m=String(Math.floor(_t/60)).padStart(2,'0'); 
  var s=String(_t%60).padStart(2,'0'); 
  _timerEl.textContent=m+':'+s; 
},1000);
// Drag divider
var divider = document.getElementById('divider');
var left = document.getElementById('left');
var right = document.getElementById('right');
var dragging=false;
function startDrag(e){ 
  dragging=true; 
  document.body.style.cursor='ew-resize'; 
  if(e.preventDefault) e.preventDefault(); 
}
function endDrag(){ 
  dragging=false; 
  document.body.style.cursor=''; 
}
function onMove(clientX){
  var container = document.querySelector('.shell').getBoundingClientRect();
  var x = clientX - container.left;
  x = Math.max(280, Math.min(container.width-320, x));
  left.style.flex = '0 0 ' + x + 'px';
  right.style.flex = '1 1 auto';
}
divider.addEventListener('mousedown', function(e){ startDrag(e); });
window.addEventListener('mousemove', function(e){ if(dragging) onMove(e.clientX); });
window.addEventListener('mouseup', endDrag);
divider.addEventListener('touchstart', function(e){ startDrag(e.touches[0]); }, {passive:false});
window.addEventListener('touchmove', function(e){ if(dragging) onMove(e.touches[0].clientX); }, {passive:false});
window.addEventListener('touchend', endDrag);
</script>
<script>
// Highlight toolbar
var selbar = document.getElementById('selbar');
var btnHL = document.getElementById('btnHL');
var btnUH = document.getElementById('btnUH');
var btnNote = document.getElementById('btnNote');
var lastRange=null;
var currentHlNode=null;
var keepToolbar=false;
function positionSelbarForRect(rect){
  selbar.style.display='flex';
  requestAnimationFrame(function(){
    var top = window.scrollY + rect.top - selbar.offsetHeight - 8;
    var leftPos = window.scrollX + rect.left + rect.width/2 - selbar.offsetWidth/2;
    selbar.style.top = ((top>0)?top:(window.scrollY + rect.bottom + 8)) + 'px';
    selbar.style.left = Math.max(8, leftPos) + 'px';
  });
}
function updateSelbar(){
  var sel=window.getSelection();
  if(!sel || sel.rangeCount===0 || sel.isCollapsed) { 
    selbar.style.display='none'; 
    currentHlNode=null; 
    return; 
  }
  var range = sel.getRangeAt(0);
  lastRange = range.cloneRange();
  currentHlNode=null;
  positionSelbarForRect(range.getBoundingClientRect());
}
document.getElementById('left').addEventListener('mouseup', updateSelbar);
document.getElementById('right').addEventListener('mouseup', updateSelbar);
document.addEventListener('selectionchange', function(){ 
  var sel=window.getSelection(); 
  if(!sel || sel.rangeCount===0 || sel.isCollapsed){ 
    if(!keepToolbar && !currentHlNode){ 
      selbar.style.display='none'; 
    } 
  } 
});
document.addEventListener('scroll', function(){ 
  if(selbar.style.display==='flex') updateSelbar(); 
});
document.addEventListener('mousedown', function(e){
  var t = e.target;
  if(t.classList && t.classList.contains('hl')){
    keepToolbar = true;
  } else {
    keepToolbar = false;
  }
}, true);
document.addEventListener('click', function(e){
  var target = e.target;
  if(target.classList && target.classList.contains('hl')){
    currentHlNode = target;
    lastRange = null;
    positionSelbarForRect(target.getBoundingClientRect());
    var sel=window.getSelection();
    if(sel) sel.removeAllRanges();
    setTimeout(function(){ keepToolbar=false; }, 0);
  }
}, true);
function doHighlight(){
  if(currentHlNode) return;
  if(!lastRange || lastRange.collapsed) return;
  
  // 处理简单选择（同一节点内）
  if (lastRange.startContainer === lastRange.endContainer) {
    try {
      const span = document.createElement('span');
      span.className = 'hl';
      lastRange.surroundContents(span);
      selbar.style.display = 'none';
      showToast('Highlighted');
      return;
    } catch (e) {
      // 处理边缘情况
    }
  }
  
  // 处理复杂选择（跨多个节点）
  const fragment = lastRange.cloneContents();
  const div = document.createElement('div');
  div.appendChild(fragment);
  
  // 递归处理所有文本节点并添加高亮
  function processNode(node, parentHighlight) {
    if (node.nodeType === Node.TEXT_NODE) {
      if (node.textContent.trim().length > 0) {
        const span = document.createElement('span');
        span.className = 'hl';
        span.textContent = node.textContent;
        return span;
      }
      return node;
    }
    
    if (node.nodeType === Node.ELEMENT_NODE) {
      // 对于块级元素，创建新的块级高亮容器
      const isBlock = window.getComputedStyle(node).display.includes('block') || 
                     ['P', 'H1', 'H2', 'H3', 'H4', 'DIV'].includes(node.tagName);
      
      const wrapper = isBlock ? document.createElement(node.tagName.toLowerCase()) : document.createElement('span');
      wrapper.className = isBlock ? node.className + ' hl' : 'hl';
      
      // 复制其他属性
      Array.from(node.attributes).forEach(attr => {
        wrapper.setAttribute(attr.name, attr.value);
      });
      
      // 处理子节点
      while (node.firstChild) {
        const processedChild = processNode(node.firstChild, wrapper);
        wrapper.appendChild(processedChild);
      }
      
      return wrapper;
    }
    
    return node;
  }
  
  // 处理所有内容
  const highlightedContent = processNode(div, null);
  
  // 清除原有内容并插入高亮内容
  lastRange.deleteContents();
  lastRange.insertNode(highlightedContent);
  
  selbar.style.display = 'none';
  showToast('Highlighted');
}
function removeHighlight(){
  if(currentHlNode){
    // 移除单个高亮元素
    const parent = currentHlNode.parentNode;
    while(currentHlNode.firstChild) {
      parent.insertBefore(currentHlNode.firstChild, currentHlNode);
    }
    parent.removeChild(currentHlNode);
    parent.normalize(); // 合并相邻文本节点
    currentHlNode = null;
    selbar.style.display='none';
    showToast('Highlight removed');
    return;
  }
  
  if(!lastRange) return;
  
  // 移除选区中的所有高亮
  const selRect = lastRange.getBoundingClientRect();
  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
  const toRemove = [];
  
  while(walker.nextNode()){
    const node = walker.currentNode;
    if(node.classList && node.classList.contains('hl')) {
      const rect = node.getBoundingClientRect();
      // 检查节点是否与选区重叠
      if(!(rect.right < selRect.left || rect.left > selRect.right || 
          rect.bottom < selRect.top || rect.top > selRect.bottom)) {
        toRemove.push(node);
      }
    }
  }
  
  // 移除所有找到的高亮元素
  toRemove.forEach(el => {
    const parent = el.parentNode;
    while(el.firstChild) {
      parent.insertBefore(el.firstChild, el);
    }
    parent.removeChild(el);
    parent.normalize(); // 合并相邻文本节点
  });
  
  selbar.style.display='none';
  showToast('Highlight removed');
}
btnHL.addEventListener('click', doHighlight);
btnUH.addEventListener('click', removeHighlight);
</script>
<script>
// Notes
var notes = document.getElementById('notes');
var noteArea = document.getElementById('noteArea');
var btnCopy=document.getElementById('btnCopy');
var btnClose=document.getElementById('btnClose');
function toggleNotes(){ 
  notes.style.display = (notes.style.display==='flex'?'none':'flex'); 
}
window.toggleNotes = toggleNotes;
btnClose.addEventListener('click', toggleNotes);
btnCopy.addEventListener('click', async function(){ 
  await navigator.clipboard.writeText(noteArea.value||''); 
  showToast('Copied'); 
});
btnNote.addEventListener('click', function(){
  var text = '';
  if(currentHlNode){ 
    text = (currentHlNode.textContent||'').trim(); 
  } else if(lastRange){ 
    var frag = lastRange.cloneContents(); 
    text = (frag.textContent||'').trim(); 
  }
  toggleNotes();
  if(text) {
    noteArea.value = (noteArea.value? noteArea.value+'\n':'') + '> ' + text + '\n';
  }
  selbar.style.display='none';
});
// Toast
var toastEl=document.getElementById('toast');
function showToast(msg){
  toastEl.textContent=msg; 
  toastEl.style.display='block';
  setTimeout(function(){ toastEl.style.display='none'; }, 1200);
}
</script>
<script>
// Drag and drop for questions 32-35
const cards = document.querySelectorAll('.card');
const dropzones = document.querySelectorAll('.dropzone');
cards.forEach(card => {
  card.addEventListener('dragstart', () => {
    card.classList.add('dragging');
  });
  card.addEventListener('dragend', () => {
    card.classList.remove('dragging');
  });
});
dropzones.forEach(zone => {
  zone.addEventListener('dragover', e => {
    e.preventDefault();
    zone.classList.add('over');
  });
  
  zone.addEventListener('dragleave', () => {
    zone.classList.remove('over');
  });
  
  zone.addEventListener('drop', e => {
    e.preventDefault();
    zone.classList.remove('over');
    const draggingCard = document.querySelector('.dragging');
    if (draggingCard) {
      // 清除现有内容
      zone.innerHTML = '';
      zone.appendChild(draggingCard);
      // 标记为已回答
      const targetQ = zone.dataset.target;
      document.getElementById(targetQ + '-nav').classList.add('answered');
    }
  });
});
</script>
<script>
// Answer key and grading
var answers = {
  "q27":"A", "q28":"C", "q29":"E", "q30":"H", "q31":"B",
  "q32":"G", "q33":"K", "q34":"F", "q35":"L",
  "q36":"D", "q37":"C", "q38":"D", "q39":"B", "q40":"A"
};
function grade(){
  var total=0, correct=0, lines=[];
  
  // 检查单选题 (27-31, 36-40)
  for(let n=27; n<=31; n++){
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? 'âœ…' : 'âŒ'}`);
  }
  
  // 检查拖拽题 (32-35)
  dropzones.forEach(zone => {
    const q = zone.dataset.target;
    total++;
    const selectedCard = zone.querySelector('.card');
    const userAnswer = selectedCard ? selectedCard.dataset.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? 'âœ…' : 'âŒ'}`);
  });
  
  // 检查单选题 (36-40)
  for(let n=36; n<=40; n++){
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? 'âœ…' : 'âŒ'}`);
  }
  
  // 显示结果
  const acc = Math.round(100 * correct / total);
  document.getElementById('results').innerHTML = `
    <p><strong>Score:</strong> ${correct}/${total} <span class="badge">Accuracy ${acc}%</span></p>
    <pre>${lines.join('\n')}</pre>
  `;
  
  // 显示答案
  document.getElementById('answerContent').innerHTML = `
    <ol>
      <li>27 â†’ A</li>
      <li>28 â†’ C</li>
      <li>29 â†’ E</li>
      <li>30 â†’ H</li>
      <li>31 â†’ B</li>
      <li>32 â†’ G (personality)</li>
      <li>33 â†’ K (sporting)</li>
      <li>34 â†’ F (an outsider)</li>
      <li>35 â†’ L (timelessness)</li>
      <li>36 â†’ D</li>
      <li>37 â†’ C</li>
      <li>38 â†’ D</li>
      <li>39 â†’ B</li>
      <li>40 â†’ A</li>
    </ol>
  `;
  document.querySelector('#answerBox .badge').textContent = 'tap to view';
}
function resetForm(){
  // 重置拖拽题
  dropzones.forEach(zone => {
    const card = zone.querySelector('.card');
    if (card) {
      document.querySelector('.cardpool').appendChild(card);
      zone.innerHTML = '<span class="droplabel">Drag answer here</span>';
    }
  });
  
  // 重置单选题
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.checked = false;
  });
  
  // 重置结果和答案
  document.getElementById('results').innerHTML = '';
  document.getElementById('answerContent').innerHTML = '';
  document.querySelector('#answerBox .badge').textContent = 'hidden';
  
  // 重置导航栏的已回答状态
  document.querySelectorAll('.q-item').forEach(item => {
    item.classList.remove('answered');
  });
}
// 滚动到问题锚点
function scrollToElement(id){
  const el = document.getElementById(id);
  if(el){ 
    el.scrollIntoView({behavior:'smooth', block:'center'}); 
  }
  // 短暂高亮导航项
  const navs = document.querySelectorAll('.practice-nav .q-item');
  navs.forEach(n => n.classList.remove('active'));
  const btn = document.getElementById(id.replace('-anchor','-nav'));
  if(btn){ 
    btn.classList.add('active'); 
    setTimeout(() => btn.classList.remove('active'), 800); 
  }
}
// 监听交互并标记已回答
(function(){
  function markAnswered(qn){
    const nav = document.getElementById(`q${qn}-nav`);
    if(!nav) return;
    let answered = false;
    
    // 检查拖拽区 (32-35)
    if(qn >=32 && qn <=35){
      const zone = document.querySelector(`.dropzone[data-target="q${qn}"]`);
      answered = zone.querySelector('.card') !== null;
    } 
    // 检查单选题 (27-31, 36-40)
    else {
      const radios = document.querySelectorAll(`input[name="q${qn}"]:checked`);
      answered = radios.length > 0;
    }
    
    if(answered) nav.classList.add('answered');
    else nav.classList.remove('answered');
  }
  
  // 监听拖拽区
  dropzones.forEach(zone => {
    zone.addEventListener('drop', () => {
      const qn = zone.dataset.target.replace('q', '');
      markAnswered(qn);
    });
  });
  
  // 监听单选题
  for(let n=27; n<=31; n++){
    document.querySelectorAll(`input[name="q${n}"]`).forEach(radio => {
      radio.addEventListener('change', () => markAnswered(n));
    });
  }
  
  for(let n=36; n<=40; n++){
    document.querySelectorAll(`input[name="q${n}"]`).forEach(radio => {
      radio.addEventListener('change', () => markAnswered(n));
    });
  }
})();
</script>

<!-- 练习页面数据传输增强脚本 -->
<script>
// 检查是否已经有增强脚本
if (!window.practicePageEnhancer) {
    // 动态加载增强脚本
    const script = document.createElement('script');
    script.src = '../../js/practice-page-enhancer.js';
    script.onload = function() {
        console.log('练习页面增强脚本已加载');
    };
    script.onerror = function() {
        console.error('练习页面增强脚本加载失败');
        // 降级到内联增强
        loadInlineEnhancer();
    };
    document.head.appendChild(script);
}

// 内联增强器（降级方案）
function loadInlineEnhancer() {
    if (window.practicePageEnhancer) return;
    
    window.practicePageEnhancer = {
        initialize: function() {
            console.log('[InlineEnhancer] 内联增强器已初始化');
            this.setupCommunication();
            this.setupAnswerListeners();
            this.interceptSubmit();
        },
        
        setupCommunication: function() {
            this.parentWindow = window.opener || window.parent;
            window.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'INIT_SESSION') {
                    this.sessionId = event.data.data.sessionId;
                    this.sendMessage('SESSION_READY', {
                        pageType: this.detectPageType(),
                        url: window.location.href
                    });
                }
            });
        },
        
        detectPageType: function() {
            const title = document.title || '';
            if (title.includes('P1')) return 'P1';
            if (title.includes('P2')) return 'P2';
            if (title.includes('P3')) return 'P3';
            return 'unknown';
        },
        
        setupAnswerListeners: function() {
            this.answers = {};
            this.startTime = Date.now();
            
            document.addEventListener('change', (e) => {
                if (e.target.name && e.target.name.startsWith('q')) {
                    this.answers[e.target.name] = e.target.value;
                }
            });
        },
        
        interceptSubmit: function() {
            // 拦截grade函数
            if (typeof window.grade === 'function') {
                const originalGrade = window.grade;
                window.grade = () => {
                    const result = originalGrade();
                    setTimeout(() => this.handleSubmit(), 200);
                    return result;
                };
            }
            
            // 监听提交按钮
            document.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' && 
                    (e.target.textContent.includes('Submit') || 
                     e.target.onclick && e.target.onclick.toString().includes('grade'))) {
                    setTimeout(() => this.handleSubmit(), 300);
                }
            });
        },
        
        handleSubmit: function() {
            const results = {
                sessionId: this.sessionId,
                startTime: this.startTime,
                endTime: Date.now(),
                duration: Math.round((Date.now() - this.startTime) / 1000),
                answers: this.answers,
                scoreInfo: this.extractScore(),
                pageType: this.detectPageType(),
                url: window.location.href
            };
            
            this.sendMessage('PRACTICE_COMPLETE', results);
        },
        
        extractScore: function() {
            const resultsEl = document.getElementById('results');
            if (!resultsEl) return null;
            
            const text = resultsEl.textContent || '';
            const scoreMatch = text.match(/Score:\s*(\d+)\/(\d+)/i);
            if (scoreMatch) {
                const correct = parseInt(scoreMatch[1]);
                const total = parseInt(scoreMatch[2]);
                return {
                    correct: correct,
                    total: total,
                    accuracy: total > 0 ? correct / total : 0,
                    percentage: Math.round((correct / total) * 100),
                    source: 'inline_extraction'
                };
            }
            return null;
        },
        
        sendMessage: function(type, data) {
            if (this.parentWindow) {
                this.parentWindow.postMessage({
                    type: type,
                    data: data,
                    source: 'practice_page'
                }, '*');
            }
        }
    };
    
    // 初始化
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            window.practicePageEnhancer.initialize();
        });
    } else {
        window.practicePageEnhancer.initialize();
    }
}
</script>

</body>
</html>
