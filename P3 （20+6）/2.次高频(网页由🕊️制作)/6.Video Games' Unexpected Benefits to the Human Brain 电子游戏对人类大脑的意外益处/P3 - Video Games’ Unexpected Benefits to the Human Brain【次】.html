<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Video Games' Unexpected Benefits to the Human Brain</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root { 
    --line:#e5e7eb; 
    --bg:#f6f7fb; 
    --panel:#fff; 
    --accent:#3b82f6; 
    --muted:#6b7280; 
    --shadow:0 6px 20px rgba(0,0,0,.12); 
  }
  * { box-sizing: border-box; }
  html,body { height:100%; }
  body { 
    margin:0; 
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
    background:var(--bg); 
    padding-bottom: 82px; 
  }
  
  /* Â∏ÉÂ±ÄÊ†∑Âºè */
  .shell { display:flex; height:100vh; width:100%; }
  .pane { background:var(--panel); overflow:auto; padding:20px; }
  #left { flex: 0 0 50%; min-width: 280px; }
  #right { flex: 1 1 auto; min-width: 320px; background:#fbfbff; border-left:1px solid var(--line); }
  #divider { flex: 0 0 8px; background: linear-gradient(90deg,#e5e7eb,#d1d5db); cursor: ew-resize; position:relative; z-index: 5; user-select:none; }
  
  /* ÊñáÊú¨Ê†∑Âºè */
  h2,h3,h4 { margin:0 0 10px; }
  #left p { margin: 0 0 12px; line-height: 1.6; word-break: normal; overflow-wrap: normal; hyphens: none; }
  
  /* ÁªÑ‰ª∂Ê†∑Âºè */
  .group { background:#fff; border:1px solid var(--line); border-radius:10px; padding:12px; margin-bottom:14px; }
  input.blank { 
    border:none; 
    border-bottom:1px solid #9ca3af; 
    padding:2px 4px; 
    font-size:1em; 
    background:transparent; 
    min-width: 80px;
  }
  input.blank:focus { outline:none; border-bottom:2px solid var(--accent); }
  
  /* ÊåâÈíÆÊ†∑Âºè */
  button { 
    padding:8px 12px; 
    border:1px solid var(--line); 
    background:#fff; 
    border-radius:6px; 
    cursor:pointer; 
    transition:all 0.2s; 
    font-size:14px; 
  }
  button:hover { background:#f8fafc; border-color:#cbd5e1; }
  button.primary { 
    background:var(--accent); 
    color:#fff; 
    border-color:var(--accent); 
  }
  button.primary:hover { background:#2563eb; }
  
  /* ËÆ°Êó∂Âô®Ê†∑Âºè */
  #timer { 
    background:#fff; 
    color:var(--muted); 
    border:1px solid var(--line); 
    border-radius:6px; 
    padding:4px 8px; 
    cursor:pointer; 
    font-family: monospace; 
    transition:all 0.2s; 
    min-width: 52px;
    text-align: center;
  }
  #timer:hover { 
    background:#f1f5f9; 
    border-color:var(--accent); 
  }
  #timer.paused { 
    color: #ef4444; 
    border-color: #fecaca; 
    background: #fef2f2; 
  }
  
  /* ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ */
  .theme-toggle { 
    background:#fff; 
    color:var(--muted); 
    border:1px solid var(--line); 
    border-radius:6px; 
    width: 36px;
    height: 36px;
    font-size: 16px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .theme-toggle:hover {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
    transform: scale(1.05);
  }
  .theme-toggle:active {
    transform: scale(0.95);
  }
  
  /* ÊãñÊãΩÁõ∏ÂÖ≥Ê†∑Âºè */
  .dropzone { 
    border:2px dashed #cbd5e1; 
    background:#f8fafc; 
    border-radius:10px; 
    min-height:54px; 
    padding:8px; 
    display:flex; 
    align-items:center; 
    justify-content:space-between; 
    gap:8px; 
  }
  .droplabel { color:#64748b; }
  .cardpool { 
    background:#f1f5f9; 
    border-radius:10px; 
    padding:12px; 
    display:grid; 
    gap:8px; 
  }
  .pool-slot { min-height:40px; }
  .card { 
    background:#fff; 
    border:1px solid #e5e7eb; 
    border-radius:8px; 
    padding:8px 10px; 
    display:inline-flex; 
    gap:8px; 
    align-items:center; 
    cursor:grab; 
    box-shadow:0 1px 0 rgba(0,0,0,.03); 
  }
  .card:active { cursor:grabbing; }
  .tag { 
    background:#eef2ff; 
    color:#4338ca; 
    padding:2px 8px; 
    border-radius:999px; 
    font-size:12px; 
  }
  .btn-clear { 
    border:1px solid #e5e7eb; 
    background:#fff; 
    border-radius:8px; 
    padding:6px 8px; 
    cursor:pointer; 
  }
  .ghost { opacity: .5; }
  .over { outline:2px dashed #3b82f6; }
  
  /* Ê∑±Ëâ≤Ê®°ÂºèÊ†∑Âºè */
  body.dark { 
    --bg: #0f172a; 
    --panel: #1e293b; 
    --line: #334155; 
    --muted: #94a3b8; 
    color: #e2e8f0; 
  }
  body.dark #right { background: #0f172a; }
  body.dark .group { background: #1e293b; border-color: #334155; }
  body.dark button { background: #1e293b; color: #e2e8f0; border-color: #334155; }
  body.dark button:hover { background: #334155; }
  body.dark button.primary { background: var(--accent); color: #fff; }
  body.dark #results { background: #1e293b; border-color: #334155; }
  body.dark #notes { background: #1e293b; border-color: #334155; color: #e2e8f0; }
  body.dark .practice-nav { background: #1e293b; border-color: #334155; }
  body.dark .q-item { background: #0f172a; color: #e2e8f0; border-color: #334155; }
  body.dark .q-item:hover { background: #334155; }
  body.dark .q-item.answered { background: #1e40af; border-color: var(--accent); color: #93c5fd; }
  body.dark #timer { background: #1e293b; color: #e2e8f0; border-color: #334155; }
  body.dark #timer:hover { background: #334155; border-color: var(--accent); }
  body.dark details.answerbox { background: #1e293b; border-color: #334155; }
  body.dark input.blank { color: #e2e8f0; border-bottom-color: #64748b; }
  body.dark input.blank:focus { border-bottom-color: var(--accent); }
  body.dark .cardpool { background:#1e293b; }
  body.dark .card { background:#334155; border-color: #475569; }
  body.dark .dropzone { background:#1e293b; border-color: #475569; }
  body.dark .tag { background:#334155; color:#93c5fd; }
  body.dark .btn-clear { background:#334155; border-color: #475569; }
  
  /* ÂìçÂ∫îÂºèËÆæËÆ° */
  @media (max-width: 768px) {
    .shell { flex-direction: column; }
    #left, #right { flex: none; min-width: auto; }
    #divider { display: none; }
    .practice-nav .controls { gap: 8px; }
    #timer { font-size: 12px; padding: 3px 8px; }
    .theme-toggle { width: 32px; height: 32px; font-size: 14px; }
    #notes { width: calc(100vw - 24px); right: 12px; left: 12px; }
  }
  
  /* ÈÄâÊã©Â∑•ÂÖ∑Ê†è */
  #selbar { 
    position: fixed; 
    display:none; 
    z-index: 2000; 
    background:#111; 
    color:#fff; 
    border-radius: 8px; 
    padding: 6px; 
    box-shadow: var(--shadow); 
    font-size: 13px; 
    gap:6px; 
    align-items: center; 
  }
  #selbar button { 
    background: transparent; 
    color:#fff; 
    border: 1px solid rgba(255,255,255,.25); 
    padding: 4px 8px; 
    border-radius: 6px; 
    cursor:pointer; 
  }
  #selbar button:hover { border-color:#fff; }
  
  /* Á¨îËÆ∞Èù¢Êùø */
  #notes { 
    position: fixed; 
    right: 12px; 
    bottom: 12px; 
    width: 320px; 
    height: 42vh; 
    background:#fff; 
    border:1px solid var(--line); 
    border-radius: 12px; 
    display:none; 
    flex-direction: column; 
    z-index:1500; 
    box-shadow: var(--shadow); 
  }
  #notes header { 
    display:flex; 
    align-items:center; 
    justify-content: space-between; 
    padding:8px 10px; 
    border-bottom:1px solid var(--line); 
  }
  #notes textarea { 
    flex:1; 
    border:0; 
    padding:10px; 
    resize:none; 
    font-size:14px; 
    line-height:1.5; 
  }
  
  /* ToastÈÄöÁü• */
  #toast { 
    position: fixed; 
    bottom: 20px; 
    left: 50%; 
    transform: translateX(-50%); 
    background: rgba(0,0,0,0.8); 
    color: #fff; 
    padding: 8px 16px; 
    border-radius: 4px; 
    display: none; 
    z-index: 3000; 
    font-size: 14px; 
  }
  
  /* Á≠îÈ¢òÂØºËà™ */
  .practice-nav { 
    background:#fff; 
    padding:12px 20px; 
    display:flex; 
    align-items:center; 
    gap:16px; 
    box-shadow:0 2px 4px rgba(0,0,0,.05); 
    flex-wrap:wrap; 
    position:fixed; 
    left:0; 
    right:0; 
    bottom:0; 
    border-top:2px solid var(--line); 
    z-index:4000; 
  }
  .practice-nav .title { font-weight:600; color:var(--muted); }
  .practice-nav .questions { 
    display:flex; 
    gap:8px; 
    align-items:center; 
    flex-wrap:wrap; 
  }
  .practice-nav .q-item { 
    padding:6px 10px; 
    border:1px solid var(--line); 
    border-radius:6px; 
    background:#fff; 
    cursor:pointer; 
    font-size:14px; 
    transition:all 0.2s; 
    min-width:36px; 
    text-align:center; 
  }
  .practice-nav .q-item:hover { 
    background:#f1f5f9; 
    border-color:var(--accent); 
  }
  .practice-nav .q-item.answered { 
    background:#e0e7ff; 
    border-color:var(--accent); 
    color:var(--accent); 
    font-weight:500; 
  }
  .practice-nav .q-item.active { 
    background:var(--accent); 
    color:#fff; 
  }
  .practice-nav .controls { 
    display:flex; 
    gap:12px; 
    margin-left:auto; 
    align-items:center; 
  }
  
  /* Á≠îÈ¢òÁªìÊûúÊòæÁ§∫ */
  #results { 
    background:#fff; 
    border:1px solid var(--line); 
    border-radius:10px; 
    padding:12px; 
    margin:16px 0; 
    font-family: monospace; 
    white-space:pre-wrap; 
  }
  #results p { margin:0 0 8px; }
  .badge { 
    background:#e0e7ff; 
    color:var(--accent); 
    padding:2px 8px; 
    border-radius:999px; 
    font-size:12px; 
  }
  
  /* Á≠îÊ°àÊ°Ü */
  details.answerbox { 
    background:#fff; 
    border:1px solid var(--line); 
    border-radius:10px; 
    padding:12px; 
    margin-top:10px; 
  }
  details.answerbox summary { 
    cursor:pointer; 
    font-weight:600; 
    list-style:none; 
    display:flex; 
    align-items:center; 
    justify-content:space-between; 
  }
  details.answerbox summary::-webkit-details-marker { display:none; }
  #answerContent { margin-top:10px; }
  #answerContent ol { margin:0; padding-left:20px; }
  #answerContent li { margin:4px 0; }
  
  /* È´ò‰∫ÆÊ†∑Âºè */
  .hl { background: #ffeb3b; color: #000; }
  body.dark .hl { background: #8a6d00; color: #fff; }
  
  /* ÊªöÂä®Êù°Ê†∑Âºè */
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #c5c5d2; border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: #999; }
  body.dark ::-webkit-scrollbar-thumb { background: #4a5568; }
  body.dark ::-webkit-scrollbar-thumb:hover { background: #718096; }
  
  table { border-collapse: collapse; width:100%; }
  th, td { border:1px solid var(--line); padding:6px; text-align:center; font-size:14px; }
  th:first-child, td:first-child { width:92px; }
</style>
</head>
<body>

<div class="practice-nav">
  <div class="title">Questions</div>
  <div class="questions">
    <div class="q-item" id="q27-nav" onclick="scrollToElement('q27-anchor')">27</div>
    <div class="q-item" id="q28-nav" onclick="scrollToElement('q28-anchor')">28</div>
    <div class="q-item" id="q29-nav" onclick="scrollToElement('q29-anchor')">29</div>
    <div class="q-item" id="q30-nav" onclick="scrollToElement('q30-anchor')">30</div>
    <div class="q-item" id="q31-nav" onclick="scrollToElement('q31-anchor')">31</div>
    <div class="q-item" id="q32-nav" onclick="scrollToElement('q32-anchor')">32</div>
    <div class="q-item" id="q33-nav" onclick="scrollToElement('q33-anchor')">33</div>
    <div class="q-item" id="q34-nav" onclick="scrollToElement('q34-anchor')">34</div>
    <div class="q-item" id="q35-nav" onclick="scrollToElement('q35-anchor')">35</div>
    <div class="q-item" id="q36-nav" onclick="scrollToElement('q36-anchor')">36</div>
    <div class="q-item" id="q37-nav" onclick="scrollToElement('q37-anchor')">37</div>
    <div class="q-item" id="q38-nav" onclick="scrollToElement('q38-anchor')">38</div>
    <div class="q-item" id="q39-nav" onclick="scrollToElement('q39-anchor')">39</div>
    <div class="q-item" id="q40-nav" onclick="scrollToElement('q40-anchor')">40</div>
  </div>
  <div class="controls">
    <span id="timer" onclick="toggleTimer()">00:00</span>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">üåô</button>
  </div>
</div>

<div class="shell">
  <section class="pane" id="left">
    <h2>READING PASSAGE 3</h2>
    <p>You should spend about 20 minutes on Questions 27‚Äì40, which are based on Reading Passage 3 below.</p>
    <h3>Video Games' Unexpected Benefits to the Human Brain</h3>
    
    <h4>Paragraph A</h4>
    <p>Video games have long been associated with negative effects on behavior and health, particularly among young people. Parents, educators, and health professionals have expressed concerns about the potential for addiction, increased aggression, and reduced physical activity among avid gamers. However, recent scientific research has begun to reveal a more nuanced picture, suggesting that video games may actually offer several unexpected benefits to cognitive function and brain development. These findings challenge conventional wisdom and indicate that, when played in moderation, video games might serve as powerful tools for enhancing various mental abilities.</p>
    
    <h4>Paragraph B</h4>
    <p>One of the most significant benefits of video game play is the enhancement of visual attention skills. Studies have consistently shown that action video game players demonstrate superior performance on tasks requiring the tracking of multiple objects simultaneously and the rapid identification of targets among distractors. This improvement in visual attention is not limited to gaming contexts but generalizes to real-world situations. For example, research has found that experienced gamers are better at monitoring radar screens for air traffic control, detecting errors in baggage screening at airports, and performing surgical procedures that require precise hand-eye coordination. The mechanism behind this enhancement appears to involve the strengthening of neural pathways responsible for attentional control and the ability to filter out irrelevant information.</p>
    
    <h4>Paragraph C</h4>
    <p>Beyond visual attention, video games have been shown to improve cognitive flexibility, which refers to the mental ability to switch between different tasks or thoughts. This skill is crucial in our modern, multitasking world, where individuals frequently need to shift their focus between various activities. Research has demonstrated that gamers outperform non-gamers on tests that measure cognitive flexibility, such as the Trail Making Test and the Stroop Task. These improvements are thought to arise from the complex, rapidly changing environments presented in many video games, which require players to constantly adapt their strategies and switch between different types of challenges. The enhanced cognitive flexibility observed in gamers may translate into better academic performance and improved problem-solving abilities in daily life.</p>
    
    <h4>Paragraph D</h4>
    <p>Another surprising benefit of video game play is the enhancement of spatial navigation skills. Many video games, particularly those in the action and adventure genres, require players to navigate complex three-dimensional environments, remember the locations of important objects, and plan efficient routes to their destinations. Studies have found that gamers demonstrate superior performance on standardized tests of spatial ability, including mental rotation tasks and spatial visualization exercises. This improvement in spatial cognition is particularly pronounced among players of action games, which demand rapid processing of spatial information. The implications of these findings extend beyond gaming, as strong spatial skills are associated with success in fields such as engineering, architecture, and mathematics.</p>
    
    <h4>Paragraph E</h4>
    <p>Video games have also been shown to enhance working memory, which is the ability to temporarily hold and manipulate information in mind. This cognitive function is essential for a wide range of activities, from following multi-step instructions to solving complex mathematical problems. Research has demonstrated that training on specific types of video games can lead to measurable improvements in working memory capacity. These improvements appear to be dose-dependent, meaning that greater amounts of game play are associated with larger gains in working memory performance. Importantly, these benefits are not limited to young players; studies have shown that older adults can also experience working memory improvements through strategic video game training, potentially helping to offset age-related cognitive decline.</p>
    
    <h4>Paragraph F</h4>
    <p>Perhaps one of the most intriguing findings in video game research is the potential for games to enhance decision-making speed and accuracy. Studies have shown that action video game players can make decisions up to 25% faster than non-players without sacrificing accuracy. This improvement appears to result from the rapid-paced nature of many video games, which require players to make quick judgments based on incomplete information. The ability to process information rapidly and make accurate decisions under time pressure is valuable in many real-world contexts, from emergency response situations to competitive business environments. This enhanced decision-making capacity may be one of the most practically significant benefits of video game play.</p>
    
    <h4>Paragraph G</h4>
    <p>Recent research has also explored the potential therapeutic applications of video games. Specialized games have been developed to help treat conditions such as attention deficit hyperactivity disorder (ADHD), anxiety, and depression. These therapeutic games are designed to target specific cognitive or emotional deficits and provide engaging, interactive treatment experiences. Additionally, video games have shown promise in the rehabilitation of patients recovering from strokes or other neurological injuries. Virtual reality games, in particular, have been used to help patients regain motor function and spatial awareness. The engaging nature of games may enhance treatment compliance and make therapeutic interventions more effective than traditional approaches.</p>
    
    <h4>Paragraph H</h4>
    <p>Despite these promising findings, it is important to maintain a balanced perspective on video game play. Not all games provide the same cognitive benefits, and excessive play can still lead to negative outcomes such as reduced physical activity and social isolation. The key appears to be moderation and the selection of games that challenge cognitive abilities in meaningful ways. Educational games and action games have shown the most consistent benefits in research studies, while passive or repetitive games may offer fewer advantages. As our understanding of the relationship between video games and cognition continues to evolve, it will be important to develop evidence-based guidelines for healthy gaming practices that maximize benefits while minimizing potential harms.</p>
    
  </section>
  <div id="divider" title="Drag to resize"></div>
  <section class="pane" id="right">
    <h3>Questions</h3>
    
    <div class="group">
      <h4>Questions 27‚Äì32</h4>
      <p>Reading Passage 3 has eight paragraphs, A‚ÄìH.</p>
      <p>Which paragraph contains the following information?</p>
      <p>Write the correct letter, A‚ÄìH, in boxes 27‚Äì32 on your answer sheet.</p>
      
      <div id="q27-anchor">
        <p><span class="q-item">27</span> &nbsp;&nbsp;&nbsp; A reference to the potential therapeutic applications of video games<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q27" value="A"> A &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q27" value="B"> B &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q27" value="C"> C &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q27" value="D"> D &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q27" value="E"> E &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q27" value="F"> F &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q27" value="G"> G &nbsp;&nbsp;&nbsp;
        <input type="radio" name="q27" value="H"> H</p>
      </div>
      
      <div id="q28-anchor">
        <p><span class="q-item">28</span> &nbsp;&nbsp;&nbsp; A reference to the enhancement of visual attention skills<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q28" value="A"> A &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q28" value="B"> B &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q28" value="C"> C &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q28" value="D"> D &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q28" value="E"> E &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q28" value="F"> F &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q28" value="G"> G &nbsp;&nbsp;&nbsp;
        <input type="radio" name="q28" value="H"> H</p>
      </div>
      
      <div id="q29-anchor">
        <p><span class="q-item">29</span> &nbsp;&nbsp;&nbsp; A reference to the enhancement of spatial navigation skills<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q29" value="A"> A &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q29" value="B"> B &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q29" value="C"> C &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q29" value="D"> D &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q29" value="E"> E &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q29" value="F"> F &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q29" value="G"> G &nbsp;&nbsp;&nbsp;
        <input type="radio" name="q29" value="H"> H</p>
      </div>
      
      <div id="q30-anchor">
        <p><span class="q-item">30</span> &nbsp;&nbsp;&nbsp; A reference to enhanced decision-making speed and accuracy<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q30" value="A"> A &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q30" value="B"> B &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q30" value="C"> C &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q30" value="D"> D &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q30" value="E"> E &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q30" value="F"> F &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q30" value="G"> G &nbsp;&nbsp;&nbsp;
        <input type="radio" name="q30" value="H"> H</p>
      </div>
      
      <div id="q31-anchor">
        <p><span class="q-item">31</span> &nbsp;&nbsp;&nbsp; A reference to the enhancement of working memory<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q31" value="A"> A &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q31" value="B"> B &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q31" value="C"> C &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q31" value="D"> D &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q31" value="E"> E &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q31" value="F"> F &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q31" value="G"> G &nbsp;&nbsp;&nbsp;
        <input type="radio" name="q31" value="H"> H</p>
      </div>
      
      <div id="q32-anchor">
        <p><span class="q-item">32</span> &nbsp;&nbsp;&nbsp; A reference to the enhancement of cognitive flexibility<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q32" value="A"> A &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q32" value="B"> B &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q32" value="C"> C &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q32" value="D"> D &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q32" value="E"> E &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q32" value="F"> F &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q32" value="G"> G &nbsp;&nbsp;&nbsp;
        <input type="radio" name="q32" value="H"> H</p>
      </div>
    </div>
    
    <div class="group">
      <h4>Questions 33‚Äì35</h4>
      <p>Choose the correct letter, A, B, C or D.</p>
      <p>Write the correct letter in boxes 33‚Äì35 on your answer sheet.</p>
      
      <div id="q33-anchor">
        <p><span class="q-item">33</span> &nbsp;&nbsp;&nbsp; According to the passage, action video game players are better at<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q33" value="A"> A &nbsp;&nbsp;&nbsp; monitoring radar screens<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q33" value="B"> B &nbsp;&nbsp;&nbsp; detecting errors in baggage screening<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q33" value="C"> C &nbsp;&nbsp;&nbsp; performing surgical procedures<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q33" value="D"> D &nbsp;&nbsp;&nbsp; all of the above</p>
      </div>
      
      <div id="q34-anchor">
        <p><span class="q-item">34</span> &nbsp;&nbsp;&nbsp; According to the passage, which group can benefit from video game training?<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q34" value="A"> A &nbsp;&nbsp;&nbsp; only young players<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q34" value="B"> B &nbsp;&nbsp;&nbsp; only older adults<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q34" value="C"> C &nbsp;&nbsp;&nbsp; both young players and older adults<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q34" value="D"> D &nbsp;&nbsp;&nbsp; neither young players nor older adults</p>
      </div>
      
      <div id="q35-anchor">
        <p><span class="q-item">35</span> &nbsp;&nbsp;&nbsp; According to the passage, action video game players can make decisions how much faster than non-players?<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q35" value="A"> A &nbsp;&nbsp;&nbsp; 10% faster<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q35" value="B"> B &nbsp;&nbsp;&nbsp; 15% faster<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q35" value="C"> C &nbsp;&nbsp;&nbsp; 20% faster<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="radio" name="q35" value="D"> D &nbsp;&nbsp;&nbsp; 25% faster</p>
      </div>
    </div>
    
    <div class="group">
      <h4>Questions 36‚Äì40</h4>
      <p>Do the following statements agree with the information given in Reading Passage 3?</p>
      <p>In boxes 36‚Äì40 on your answer sheet, write</p>
      <p><strong>TRUE</strong> &nbsp;&nbsp;&nbsp; if the statement agrees with the information<br>
      <strong>FALSE</strong> &nbsp;&nbsp;&nbsp; if the statement contradicts the information<br>
      <strong>NOT GIVEN</strong> &nbsp;&nbsp;&nbsp; if there is no information on this</p>
      
      <div id="q36-anchor">
        <p><span class="q-item">36</span> &nbsp;&nbsp;&nbsp; <input type="radio" name="q36" value="TRUE"> TRUE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q36" value="FALSE"> FALSE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q36" value="NOT GIVEN"> NOT GIVEN<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Video games have only negative effects on behavior and health.</p>
      </div>
      
      <div id="q37-anchor">
        <p><span class="q-item">37</span> &nbsp;&nbsp;&nbsp; <input type="radio" name="q37" value="TRUE"> TRUE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q37" value="FALSE"> FALSE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q37" value="NOT GIVEN"> NOT GIVEN<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Enhanced cognitive flexibility may translate into better academic performance.</p>
      </div>
      
      <div id="q38-anchor">
        <p><span class="q-item">38</span> &nbsp;&nbsp;&nbsp; <input type="radio" name="q38" value="TRUE"> TRUE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q38" value="FALSE"> FALSE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q38" value="NOT GIVEN"> NOT GIVEN<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Strong spatial skills are associated with success in fields such as engineering and architecture.</p>
      </div>
      
      <div id="q39-anchor">
        <p><span class="q-item">39</span> &nbsp;&nbsp;&nbsp; <input type="radio" name="q39" value="TRUE"> TRUE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q39" value="FALSE"> FALSE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q39" value="NOT GIVEN"> NOT GIVEN<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; All video games provide the same cognitive benefits.</p>
      </div>
      
      <div id="q40-anchor">
        <p><span class="q-item">40</span> &nbsp;&nbsp;&nbsp; <input type="radio" name="q40" value="TRUE"> TRUE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q40" value="FALSE"> FALSE &nbsp;&nbsp;&nbsp; 
        <input type="radio" name="q40" value="NOT GIVEN"> NOT GIVEN<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Educational games have shown consistent benefits in research studies.</p>
      </div>
    </div>
    
    <div style="display:flex;gap:8px;margin-bottom:10px;">
      <button class="primary" onclick="grade()">Submit</button>
      <button onclick="resetForm()">Reset</button>
      <button onclick="toggleNotes()">Notes</button>
    </div>
    <div id="results"></div>
    <details class="answerbox" id="answerBox">
      <summary>Show answers (click to toggle) <span class="badge">hidden</span></summary>
      <div id="answerContent"></div>
    </details>
  </section>
</div>

<div aria-label="Selection tools" id="selbar" role="toolbar">
  <button id="btnHL">Highlight</button>
  <button id="btnUH">Remove</button>
  <button id="btnNote">Note</button>
</div>

<div id="notes">
  <header>
    <strong>Notes</strong>
    <div>
      <button id="btnCopy">Copy</button>
      <button id="btnClose">Close</button>
    </div>
  </header>
  <textarea id="noteArea" placeholder="Type your notes here..."></textarea>
</div>

<div id="toast"></div>

<script>
// È°µÈù¢ÊªöÂä®ÂäüËÉΩ
function scrollToElement(id) {
  const element = document.getElementById(id);
  if (element) {
    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
    // È´ò‰∫ÆÊòæÁ§∫È¢òÁõÆ
    element.style.backgroundColor = '#e0e7ff';
    setTimeout(() => {
      element.style.backgroundColor = '';
    }, 1000);
  }
}

// ÈáçÁΩÆË°®ÂçïÂäüËÉΩ
function resetForm() {
  // ÈáçÁΩÆÂçïÈÄâÊåâÈíÆ
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.checked = false;
  });
  
  // ÈáçÁΩÆÊñáÊú¨ËæìÂÖ•Ê°Ü
  document.querySelectorAll('input.blank').forEach(input => {
    input.value = '';
  });
  
  // Ê∏ÖÈô§ÁªìÊûú
  document.getElementById('results').innerHTML = '';
  
  // Êõ¥Êñ∞ÂØºËà™Áä∂ÊÄÅ
  updateAnswerStatus();
  
  showToast('Form reset');
}

// ToastÈÄöÁü•ÂäüËÉΩ
function showToast(msg) {
  const toastEl = document.getElementById('toast');
  toastEl.textContent = msg;
  toastEl.style.display = 'block';
  setTimeout(() => {
    toastEl.style.display = 'none';
  }, 1500);
}

// ËÆ°Êó∂Âô®ÂäüËÉΩ
let _t = 0;
let timerRunning = true;
let timerInterval;
const _timerEl = document.getElementById('timer');

function updateTimer() {
  const m = Math.floor(_t / 60);
  const s = _t % 60;
  _timerEl.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}

function startTimer() {
  timerInterval = setInterval(() => {
    if (timerRunning) {
      _t++;
      updateTimer();
    }
  }, 1000);
}

function toggleTimer() {
  if (timerRunning) {
    clearInterval(timerInterval);
    timerRunning = false;
    _timerEl.classList.add('paused');
    showToast('Timer paused');
  } else {
    startTimer();
    timerRunning = true;
    _timerEl.classList.remove('paused');
    showToast('Timer resumed');
  }
}

// ‰∏ªÈ¢òÂàáÊç¢ÂäüËÉΩ
function toggleTheme() {
  document.body.classList.toggle('dark');
  const isDark = document.body.classList.contains('dark');
  localStorage.setItem('darkMode', isDark);
  const themeButton = document.querySelector('.theme-toggle');
  themeButton.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
}

// ÊãñÊãΩÂàÜÊ†èÂäüËÉΩ
var divider = document.getElementById('divider');
var left = document.getElementById('left');
var right = document.getElementById('right');
var dragging = false;

function startDrag(e) {
  dragging = true;
  document.body.style.cursor = 'ew-resize';
  if (e.preventDefault) e.preventDefault();
}

function endDrag() {
  dragging = false;
  document.body.style.cursor = '';
}

function onMove(clientX) {
  var container = document.querySelector('.shell').getBoundingClientRect();
  var x = clientX - container.left;
  x = Math.max(280, Math.min(container.width - 320, x));
  left.style.flex = '0 0 ' + x + 'px';
  right.style.flex = '1 1 auto';
}

divider.addEventListener('mousedown', function(e) { startDrag(e); });
window.addEventListener('mousemove', function(e) { if (dragging) onMove(e.clientX); });
window.addEventListener('mouseup', endDrag);
divider.addEventListener('touchstart', function(e) { startDrag(e.touches[0]); }, { passive: false });
window.addEventListener('touchmove', function(e) { if (dragging) onMove(e.touches[0].clientX); }, { passive: false });
window.addEventListener('touchend', endDrag);

// È´ò‰∫ÆÂíåÁ¨îËÆ∞ÂäüËÉΩ
var selbar = document.getElementById('selbar');
var btnHL = document.getElementById('btnHL');
var btnUH = document.getElementById('btnUH');
var btnNote = document.getElementById('btnNote');
var lastRange = null;
var currentHlNode = null;
var keepToolbar = false;

function positionSelbarForRect(rect) {
  selbar.style.display = 'flex';
  requestAnimationFrame(function() {
    var top = window.scrollY + rect.top - selbar.offsetHeight - 8;
    var leftPos = window.scrollX + rect.left + rect.width/2 - selbar.offsetWidth/2;
    selbar.style.top = ((top > 0) ? top : (window.scrollY + rect.bottom + 8)) + 'px';
    selbar.style.left = Math.max(8, leftPos) + 'px';
  });
}

function updateSelbar() {
  var sel = window.getSelection();
  if (!sel || sel.rangeCount === 0 || sel.isCollapsed) {
    selbar.style.display = 'none';
    currentHlNode = null;
    return;
  }
  var range = sel.getRangeAt(0);
  lastRange = range.cloneRange();
  currentHlNode = null;
  positionSelbarForRect(range.getBoundingClientRect());
}

document.getElementById('left').addEventListener('mouseup', updateSelbar);
document.getElementById('right').addEventListener('mouseup', updateSelbar);
document.addEventListener('selectionchange', function() {
  var sel = window.getSelection();
  if (!sel || sel.rangeCount === 0 || sel.isCollapsed) {
    if (!keepToolbar && !currentHlNode) {
      selbar.style.display = 'none';
    }
  }
});
document.addEventListener('scroll', function() {
  if (selbar.style.display === 'flex') updateSelbar();
});

document.addEventListener('mousedown', function(e) {
  var t = e.target;
  if (t.classList && t.classList.contains('hl')) {
    keepToolbar = true;
  } else {
    keepToolbar = false;
  }
}, true);

document.addEventListener('click', function(e) {
  var target = e.target;
  if (target.classList && target.classList.contains('hl')) {
    currentHlNode = target;
    lastRange = null;
    positionSelbarForRect(target.getBoundingClientRect());
    var sel = window.getSelection();
    if (sel) sel.removeAllRanges();
    setTimeout(function() { keepToolbar = false; }, 0);
  }
}, true);

function doHighlight() {
  if (currentHlNode) return;
  if (!lastRange || lastRange.collapsed) return;
  
  const startNode = lastRange.startContainer;
  const endNode = lastRange.endContainer;
  
  if (startNode === endNode) {
    try {
      const span = document.createElement('span');
      span.className = 'hl';
      lastRange.surroundContents(span);
      selbar.style.display = 'none';
      showToast('Highlighted');
      return;
    } catch (e) {}
  }
  
  const fragment = lastRange.cloneContents();
  const div = document.createElement('div');
  div.appendChild(fragment);
  
  function processNode(node) {
    if (node.nodeType === Node.TEXT_NODE) {
      if (node.textContent.trim().length > 0) {
        const span = document.createElement('span');
        span.className = 'hl';
        span.textContent = node.textContent;
        return span;
      }
      return node;
    }
    
    if (node.nodeType === Node.ELEMENT_NODE) {
      const isBlock = window.getComputedStyle(node).display.includes('block') ||
        ['P', 'H1', 'H2', 'H3', 'H4', 'DIV'].includes(node.tagName);
      
      const wrapper = isBlock ? document.createElement(node.tagName.toLowerCase()) : document.createElement('span');
      wrapper.className = isBlock ? node.className + ' hl' : 'hl';
      
      Array.from(node.attributes).forEach(attr => {
        wrapper.setAttribute(attr.name, attr.value);
      });
      
      while (node.firstChild) {
        const processedChild = processNode(node.firstChild);
        wrapper.appendChild(processedChild);
      }
      
      return wrapper;
    }
    
    return node;
  }
  
  const highlightedContent = processNode(div);
  lastRange.deleteContents();
  lastRange.insertNode(highlightedContent);
  
  selbar.style.display = 'none';
  showToast('Highlighted');
}

function removeHighlight() {
  if (currentHlNode) {
    const parent = currentHlNode.parentNode;
    while (currentHlNode.firstChild) {
      parent.insertBefore(currentHlNode.firstChild, currentHlNode);
    }
    parent.removeChild(currentHlNode);
    parent.normalize();
    currentHlNode = null;
    selbar.style.display = 'none';
    showToast('Highlight removed');
    return;
  }
  
  if (!lastRange) return;
  
  const selRect = lastRange.getBoundingClientRect();
  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
  const toRemove = [];
  
  while (walker.nextNode()) {
    const node = walker.currentNode;
    if (node.classList && node.classList.contains('hl')) {
      const rect = node.getBoundingClientRect();
      if (!(rect.right < selRect.left || rect.left > selRect.right ||
        rect.bottom < selRect.top || rect.top > selRect.bottom)) {
        toRemove.push(node);
      }
    }
  }
  
  toRemove.forEach(el => {
    const parent = el.parentNode;
    while (el.firstChild) {
      parent.insertBefore(el.firstChild, el);
    }
    parent.removeChild(el);
    parent.normalize();
  });
  
  selbar.style.display = 'none';
  showToast('Highlight removed');
}

btnHL.addEventListener('click', doHighlight);
btnUH.addEventListener('click', removeHighlight);

// Á¨îËÆ∞ÂäüËÉΩ
var notes = document.getElementById('notes');
var noteArea = document.getElementById('noteArea');
var btnCopy = document.getElementById('btnCopy');
var btnClose = document.getElementById('btnClose');

function toggleNotes() {
  notes.style.display = (notes.style.display === 'flex' ? 'none' : 'flex');
}
window.toggleNotes = toggleNotes;

btnClose.addEventListener('click', toggleNotes);
btnCopy.addEventListener('click', async function() {
  await navigator.clipboard.writeText(noteArea.value || '');
  showToast('Copied');
});

btnNote.addEventListener('click', function() {
  var text = '';
  if (currentHlNode) {
    text = (currentHlNode.textContent || '').trim();
  } else if (lastRange) {
    var frag = lastRange.cloneContents();
    text = (frag.textContent || '').trim();
  }
  toggleNotes();
  if (text) {
    noteArea.value = (noteArea.value ? noteArea.value + '\n' : '') + '> ' + text + '\n';
  }
  selbar.style.display = 'none';
});

// Á≠îÈ¢òÁä∂ÊÄÅÊõ¥Êñ∞
function updateAnswerStatus() {
  for (let i = 27; i <= 40; i++) {
    const inputs = document.querySelectorAll(`input[name="q${i}"]`);
    const navItem = document.getElementById(`q${i}-nav`);
    if (navItem) {
      let answered = false;
      inputs.forEach(input => {
        if ((input.type === 'radio' || input.type === 'checkbox') && input.checked) {
          answered = true;
        } else if (input.type === 'text' && input.value.trim()) {
          answered = true;
        }
      });
      if (answered) {
        navItem.classList.add('answered');
      } else {
        navItem.classList.remove('answered');
      }
    }
  }
}

// Á≠îÊ°àÂíåËØÑÂàÜÁ≥ªÁªü
var answers = {
  "q27": "G", "q28": "B", "q29": "D", "q30": "F", "q31": "E", "q32": "C",
  "q33": "D", "q34": "C", "q35": "D",
  "q36": "FALSE", "q37": "TRUE", "q38": "TRUE", "q39": "FALSE", "q40": "TRUE"
};

function grade() {
  var total = 0, correct = 0, lines = [];
  
  // Ê£ÄÊü•ÂçïÈÄâÈ¢ò (27-40)
  for (let n = 27; n <= 40; n++) {
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '‚úì' : '‚úó'}`);
  }
  
  // ÊòæÁ§∫ÁªìÊûú
  const acc = Math.round(100 * correct / total);
  document.getElementById('results').innerHTML = `
    <p><strong>Score:</strong> ${correct}/${total} <span class="badge">Accuracy ${acc}%</span></p>
    <pre>${lines.join('\n')}</pre>
  `;
  
  // ÊòæÁ§∫Á≠îÊ°à
  document.getElementById('answerContent').innerHTML = `
    <ol>
      <li>27 ‚Üí G</li>
      <li>28 ‚Üí B</li>
      <li>29 ‚Üí D</li>
      <li>30 ‚Üí F</li>
      <li>31 ‚Üí E</li>
      <li>32 ‚Üí C</li>
      <li>33 ‚Üí D</li>
      <li>34 ‚Üí C</li>
      <li>35 ‚Üí D</li>
      <li>36 ‚Üí FALSE</li>
      <li>37 ‚Üí TRUE</li>
      <li>38 ‚Üí TRUE</li>
      <li>39 ‚Üí FALSE</li>
      <li>40 ‚Üí TRUE</li>
    </ol>
  `;
  document.querySelector('#answerBox .badge').textContent = 'tap to view';
  
  updateAnswerStatus();
}

// ÁõëÂê¨Á≠îÊ°àÂèòÂåñ
document.addEventListener('change', updateAnswerStatus);
document.addEventListener('input', updateAnswerStatus);

// È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
document.addEventListener('DOMContentLoaded', function() {
  startTimer();
  updateAnswerStatus(); // ÂàùÂßãÂåñÁ≠îÈ¢òÁä∂ÊÄÅ
  
  // Âä†ËΩΩ‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark');
    document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
  }
});

// ÁªÉ‰π†È°µÈù¢Â¢ûÂº∫ËÑöÊú¨ÈõÜÊàê
function loadPracticePageEnhancer() {
  const script = document.createElement('script');
  script.src = '../../../js/practice-page-enhancer.js';
  script.onload = function() {
    console.log('ÁªÉ‰π†È°µÈù¢Â¢ûÂº∫ËÑöÊú¨Â∑≤Âä†ËΩΩ');
  };
  script.onerror = function() {
    console.error('ÁªÉ‰π†È°µÈù¢Â¢ûÂº∫ËÑöÊú¨Âä†ËΩΩÂ§±Ë¥•');
    // ÈôçÁ∫ßÂà∞ÂÜÖËÅîÂ¢ûÂº∫
    loadInlineEnhancer();
  };
  document.head.appendChild(script);
}

// ÂÜÖËÅîÂ¢ûÂº∫Âô®ÔºàÈôçÁ∫ßÊñπÊ°àÔºâ
function loadInlineEnhancer() {
  if (window.practicePageEnhancer) return;
  
  window.practicePageEnhancer = {
    initialize: function() {
      console.log('[InlineEnhancer] ÂÜÖËÅîÂ¢ûÂº∫Âô®Â∑≤ÂàùÂßãÂåñ');
      this.setupCommunication();
      this.setupAnswerListeners();
      this.interceptSubmit();
    },
    
    setupCommunication: function() {
      this.parentWindow = window.opener || window.parent;
      window.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'INIT_SESSION') {
          this.sessionId = event.data.data.sessionId;
          this.sendMessage('SESSION_READY', {
            pageType: this.detectPageType(),
            url: window.location.href
          });
        }
      });
    },
    
    detectPageType: function() {
      const title = document.title || '';
      if (title.includes('P1')) return 'P1';
      if (title.includes('P2')) return 'P2';
      if (title.includes('P3')) return 'P3';
      return 'unknown';
    },
    
    setupAnswerListeners: function() {
      this.answers = {};
      this.startTime = Date.now();
      
      document.addEventListener('change', (e) => {
        if (e.target.name && e.target.name.startsWith('q')) {
          this.answers[e.target.name] = e.target.value;
        }
      });
      
      document.addEventListener('input', (e) => {
        if (e.target.name && e.target.name.startsWith('q')) {
          this.answers[e.target.name] = e.target.value;
        }
      });
    },
    
    interceptSubmit: function() {
      // Êã¶Êà™gradeÂáΩÊï∞
      if (typeof window.grade === 'function') {
        const originalGrade = window.grade;
        window.grade = () => {
          const result = originalGrade();
          setTimeout(() => this.handleSubmit(), 200);
          return result;
        };
      }
      
      // ÁõëÂê¨Êèê‰∫§ÊåâÈíÆ
      document.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON' &&
          (e.target.textContent.includes('Submit') ||
            e.target.onclick && e.target.onclick.toString().includes('grade'))) {
          setTimeout(() => this.handleSubmit(), 300);
        }
      });
    },
    
    handleSubmit: function() {
      const results = {
        sessionId: this.sessionId,
        startTime: this.startTime,
        endTime: Date.now(),
        duration: Math.round((Date.now() - this.startTime) / 1000),
        answers: this.answers,
        scoreInfo: this.extractScore(),
        pageType: this.detectPageType(),
        url: window.location.href
      };
      
      this.sendMessage('PRACTICE_COMPLETE', results);
    },
    
    extractScore: function() {
      const resultsEl = document.getElementById('results');
      if (!resultsEl) return null;
      
      const text = resultsEl.textContent || '';
      const scoreMatch = text.match(/Score:\s*(\d+)\/(\d+)/i);
      if (scoreMatch) {
        const correct = parseInt(scoreMatch[1]);
        const total = parseInt(scoreMatch[2]);
        return {
          correct: correct,
          total: total,
          accuracy: total > 0 ? correct / total : 0,
          percentage: Math.round((correct / total) * 100),
          source: 'inline_extraction'
        };
      }
      return null;
    },
    
    sendMessage: function(type, data) {
      if (this.parentWindow) {
        this.parentWindow.postMessage({
          type: type,
          data: data,
          source: 'practice_page'
        }, '*');
      }
    }
  };
  
  // ÂàùÂßãÂåñ
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      window.practicePageEnhancer.initialize();
    });
  } else {
    window.practicePageEnhancer.initialize();
  }
}

// Âä†ËΩΩÂ¢ûÂº∫ËÑöÊú¨
loadPracticePageEnhancer();
</script>

</body>
</html>