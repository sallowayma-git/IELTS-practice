<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>P3 – Science and Filmmaking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root { --line:#e5e7eb; --bg:#f6f7fb; --panel:#fff; --accent:#3b82f6; --muted:#6b7280; --shadow:0 6px 20px rgba(0,0,0,.12); }
  
    --line: #374151;
    --bg: #111827;
    --panel: #1f2937;
    --accent: #60a5fa;
    --muted: #9ca3af;
    --shadow: 0 6px 20px rgba(0,0,0,.3);
  }
  
  body {
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  
  
  
    color: #f9fafb;
  }
  
  
    background: var(--panel);
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: #374151;
    border-color: var(--accent);
  }
  
  
    background: #1e40af;
    color: #93c5fd;
  }
  
  
    background: var(--panel);
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: #374151;
    border-color: var(--accent);
  }
  
  
    background: var(--accent);
    color: white;
  }
  
  
    background: var(--panel);
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    border-color: var(--line);
    color: #f9fafb;
  }
  
  
    background: #fbbf24;
    color: #1f2937;
  }
  
  
    background: #374151;
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    border-color: var(--line);
    color: #f9fafb;
  }
  
  
    background: #374151;
  }
  
  
    background: var(--panel);
    border-color: var(--line);
  }
  
  
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    color: #f9fafb;
  }
  
  /* Timer enhancements */
  #timer {
    cursor: pointer !important;
    transition: all 0.2s ease;
    user-select: none;
  }
  
  #timer:hover {
    background: #f8fafc;
    border-color: var(--accent);
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
  }
  
  
    background: #1e293b;
    color: #e2e8f0;
    border-color: #334155;
  }
  
  
    background: #334155;
    border-color: var(--accent);
  }
  
  #timer.paused {
    background: #fef3c7 !important;
    color: #92400e !important;
    border-color: #f59e0b !important;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }
  
  /* Controls layout */
  .practice-nav .controls {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  /* Theme toggle button */
  .theme-toggle {
    border: none;
    cursor: pointer;
    background: transparent;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.2s ease;
  }
  
  .theme-toggle:hover {
    background: var(--accent);
    color: #fff;
    transform: scale(1.05);
  }
  
  .theme-toggle:active {
    transform: scale(0.95);
  }

  * { box-sizing: border-box; }
  html,body { height:100%; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); padding-bottom: 82px; }
  .shell { display:flex; height:100vh; width:100%; }
  .pane { background:var(--panel); overflow:auto; padding:20px; }
  #left { flex: 0 0 50%; min-width: 280px; }
  #right { flex: 1 1 auto; min-width: 320px; background:#fbfbff; border-left:1px solid var(--line); }
  #divider { flex: 0 0 8px; background: linear-gradient(90deg,#e5e7eb,#d1d5db); cursor: ew-resize; position:relative; z-index: 5; user-select:none; }
  h2,h3,h4 { margin:0 0 10px; }
  #left p { margin: 0 0 12px; line-height: 1.6; word-break: normal; overflow-wrap: normal; hyphens: none; }
  .group { background:#fff; border:1px solid var(--line); border-radius:10px; padding:12px; margin-bottom:14px; }
  input.blank { border:none; border-bottom:1px solid #9ca3af; padding:2px 4px; font-size:1em; background:transparent; }
  input.blank:focus { outline:none; border-bottom:2px solid var(--accent); }
  button { padding:8px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; cursor:pointer; }
  button.primary { background:var(--accent); color:#fff; border-color:#3b82f6; }
  #results { background:#fff; border:1px solid var(--line); border-radius:10px; padding:10px; }
  .hl { background:#fff3a3; box-shadow: inset 0 -2px 0 rgba(0,0,0,.05); cursor: pointer; }
  .hl:hover { filter: brightness(0.98); }
  #selbar { position: absolute; display:none; z-index: 2000; background:#111; color:#fff; border-radius: 8px; padding: 6px; box-shadow: var(--shadow); font-size: 13px; gap:6px; align-items: center; }
  #selbar button { background: transparent; color:#fff; border: 1px solid rgba(255,255,255,.25); padding: 4px 8px; border-radius: 6px; cursor:pointer; }
  #selbar button:hover { border-color:#fff; }
  #notes { position: fixed; right: 12px; bottom: 12px; width: 320px; height: 42vh; background:#fff; border:1px solid var(--line); border-radius: 12px; display:none; flex-direction: column; z-index:1500; box-shadow: var(--shadow); }
  #notes header { display:flex; align-items:center; justify-content: space-between; padding:8px 10px; border-bottom:1px solid var(--line); }
  #notes textarea { flex:1; border:0; padding:10px; resize:none; font-size:14px; line-height:1.5; }
  #toast { position: fixed; left:50%; transform: translateX(-50%); bottom: 24px; background:#111; color:#fff; padding:8px 12px; border-radius: 8px; display:none; z-index:2500; }
  details.answerbox summary { cursor: pointer; user-select:none; list-style: none; }
  details.answerbox { border:1px dashed var(--line); border-radius:10px; padding:8px 10px; background:#fff; }
  .badge { display:inline-block; background:#eef2ff; color:#4338ca; padding:2px 8px; border-radius:999px; font-size:12px; margin-left:6px; }
  .practice-nav { background:#fff; padding:12px 20px; display:flex; align-items:center; gap:16px; box-shadow:0 2px 4px rgba(0,0,0,.05); flex-wrap:wrap; position:fixed; left:0; right:0; bottom:0; border-top:2px solid var(--line); z-index:4000; }
  .practice-nav .title { font-weight:600; color:var(--muted); }
  .practice-nav .questions { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .practice-nav .q-item { padding:6px 10px; border:1px solid var(--line); border-radius:6px; background:#fff; cursor:pointer; font-size:14px; transition:all 0.2s; min-width:36px; text-align:center; }
  .practice-nav .q-item:hover { background:#f1f5f9; border-color:var(--accent); }
  .practice-nav .q-item.answered { background:#e0e7ff; border-color:var(--accent); color:var(--accent); font-weight:500; }
  .practice-nav .q-item.active { background:var(--accent); color:#fff; border-color:var(--accent); }
  .practice-nav .controls { margin-left: auto; display: flex; align-items: center; gap: 12px; }
  #timer { display: inline-block; background:#fff; border:1px solid var(--line); border-radius:10px; padding:4px 10px; font-size:14px; vertical-align: middle; }
  .theme-toggle { cursor: pointer; background: transparent; border: none; font-size: 18px; padding: 4px; }
  #selbar { z-index: 6000 !important; }
  .summary-box { border: 1px solid #ccc; padding: 12px; margin-top: 1em; border-radius: 8px;}
  .word-list-drag-drop { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; padding: 10px; background: #f9fafb; border-radius: 6px; min-height: 40px; }
  .dropzone { border:2px dashed #cbd5e1; background:#f8fafc; border-radius:10px; min-height:40px; padding:4px 8px; display:inline-flex; align-items:center; justify-content:center; gap:8px; width: 220px; vertical-align: middle; }
  .droplabel { color:#64748b; font-size:14px; }
  .card { background:#fff; border:1px solid #e5e7eb; border-radius:8px; padding:8px 10px; display:inline-flex; gap:8px; align-items:center; cursor:grab; box-shadow:0 1px 0 rgba(0,0,0,.03); white-space: nowrap; }
  .card:active { cursor:grabbing; }
  .ghost { opacity: .5; }
  .over { outline:2px solid var(--accent); }

  /* Dark Mode Styles */
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

/* 强力黑暗模式修复 - 使用!important确保优先级 */
body.dark {
  background: #111827 !important;
  color: #f9fafb !important;
}

body.dark * {
  border-color: #374151 !important;
}

body.dark .shell {
  background: #111827 !important;
}

body.dark .pane {
  background: #1f2937 !important;
  color: #f9fafb !important;
}

body.dark #left {
  background: #1f2937 !important;
}

body.dark #right {
  background: #1f2937 !important;
}

body.dark h1, body.dark h2, body.dark h3, body.dark h4, body.dark h5, body.dark h6 {
  color: #f9fafb !important;
}

body.dark p, body.dark li, body.dark td, body.dark th, body.dark label, body.dark span, body.dark div {
  color: #e5e7eb !important;
}

body.dark .group {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
  color: #f9fafb !important;
}

body.dark button {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark button:hover {
  background: #4b5563 !important;
  border-color: #60a5fa !important;
}

body.dark button.primary {
  background: #3b82f6 !important;
  color: white !important;
}

body.dark #results {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

body.dark details.answerbox {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
  color: #f9fafb !important;
}

body.dark details.answerbox summary {
  color: #f9fafb !important;
}

body.dark .practice-nav {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
}

body.dark .practice-nav .q-item {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark .practice-nav .q-item:hover {
  background: #4b5563 !important;
  border-color: #60a5fa !important;
}

body.dark .practice-nav .q-item.answered {
  background: #1e40af !important;
  color: #93c5fd !important;
}

body.dark .practice-nav .q-item.active {
  background: #3b82f6 !important;
  color: white !important;
}

body.dark #timer {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark #timer:hover {
  background: #4b5563 !important;
  border-color: #60a5fa !important;
}

body.dark .dropzone {
  background: #374151 !important;
  border: 2px dashed #4b5563 !important;
  color: #f9fafb !important;
}

body.dark .card {
  background: #374151 !important;
  border: 1px solid #4b5563 !important;
  color: #f9fafb !important;
}

body.dark .cardpool {
  background: #4b5563 !important;
}

body.dark .hl {
  background: #fbbf24 !important;
  color: #1f2937 !important;
}

body.dark input[type="radio"] {
  accent-color: #60a5fa !important;
}

body.dark input.blank {
  color: #f9fafb !important;
  border-bottom: 2px solid #4b5563 !important;
  background: transparent !important;
}

body.dark input.blank:focus {
  border-bottom-color: #60a5fa !important;
}

body.dark #notes {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
}

body.dark #notes header {
  color: #f9fafb !important;
  border-bottom: 1px solid #374151 !important;
}

body.dark #notes textarea {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

body.dark table {
  border-color: #374151 !important;
}

body.dark th, body.dark td {
  border-color: #374151 !important;
  color: #e5e7eb !important;
}

body.dark #divider {
  background: linear-gradient(90deg, #374151, #4b5563) !important;
}

/* 修复选择器和其他元素 */
body.dark select, body.dark option {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark textarea {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

body.dark input[type="text"], body.dark input[type="number"] {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

</style>
</head>
<body>

<div class="practice-nav">
  <div class="title">Questions</div>
  <div class="questions">
    <div class="q-item" id="q27-nav" onclick="scrollToElement('q27-anchor')">27</div>
    <div class="q-item" id="q28-nav" onclick="scrollToElement('q28-anchor')">28</div>
    <div class="q-item" id="q29-nav" onclick="scrollToElement('q29-anchor')">29</div>
    <div class="q-item" id="q30-nav" onclick="scrollToElement('q30-anchor')">30</div>
    <div class="q-item" id="q31-nav" onclick="scrollToElement('q31-anchor')">31</div>
    <div class="q-item" id="q32-nav" onclick="scrollToElement('q32-anchor')">32</div>
    <div class="q-item" id="q33-nav" onclick="scrollToElement('q33-anchor')">33</div>
    <div class="q-item" id="q34-nav" onclick="scrollToElement('q34-anchor')">34</div>
    <div class="q-item" id="q35-nav" onclick="scrollToElement('q35-anchor')">35</div>
    <div class="q-item" id="q36-nav" onclick="scrollToElement('q36-anchor')">36</div>
    <div class="q-item" id="q37-nav" onclick="scrollToElement('q37-anchor')">37</div>
    <div class="q-item" id="q38-nav" onclick="scrollToElement('q38-anchor')">38</div>
    <div class="q-item" id="q39-nav" onclick="scrollToElement('q39-anchor')">39</div>
    <div class="q-item" id="q40-nav" onclick="scrollToElement('q40-anchor')">40</div>
  </div>
  <div class="controls">
    <span id="timer">00:00</span>
    <button class="theme-toggle" onclick="toggleDarkMode()" title="Toggle dark/light mode">☀️</button>
  </div>
</div>

<div class="shell">
  <section class="pane" id="left">
    <h2>READING PASSAGE 3</h2>
    <p>You should spend about 20 minutes on Questions 27-40, which are based on Reading Passage 3 below.</p>
    
    <h3>Science and Filmmaking</h3>
    <p><em>Academics are now working more with filmmakers who are impressed by the results of their research in computer-generated imagery (CGI)</em></p>
    
    <p>Every year the film academy in the USA celebrates the outstanding achievements of the year in a ceremony known as the Oscars. An increasingly important component of the ceremony is the presentation of the Scientific and Technical awards. In 2004 a notable event took place: the academic world met the cinematographic world when researchers from Stanford University in the USA were awarded an Oscar. These researchers, led by Steve Marschner, were from the field of Computer Graphics at Stanford. They were part of a growing cohort of computer scientists that has become fundamental to moviemaking.</p>
    
    <p>Films have shown that it is possible to use CGI to make actors look younger, older, weaker or stronger than they actually are in a surprisingly realistic manner. At least, it is possible if the altered actors are not filmed too closely. This is because the difficulty of recreating the textures of both skin and fabric means that the effect is less convincing when seen close up. The work of Marschner and his colleagues has greatly improved the accurate and realistic modeling of both skin and fabric. They recognized that one of the difficulties of creating lifelike characters in the computer world is that, in CGI, the characters' skin is opaque (two-dimensional) whereas real skin is in fact translucent (three-dimensional), that is to say, it is semi-transparent.</p>
    
    <p>Marschner and his colleagues received the Oscar for their work in successfully producing a CGI model that simulates translucency; this is when light penetrates skin and then scatters below the skin's surface before re-emerging. This is called subsurface scattering, and the mathematics for the model goes back many decades to the time when it was used in astrophysics. Because human skin is naturally translucent, it was necessary to be able to create this artificially in order to simulate the soft appearance of real skin. Previous CGI models, which assumed that skin was entirely opaque, resulted in characters with a plastic appearance. The scientists' new model of CGI was so important in bringing digital characters to life that, within two years of their original research paper, all the major special-effects studios had incorporated it into their digital rendering systems.</p>
    
    <p>However, despite their award, the scientists, with admirable tenacity, continued their search for perfection, as they still did not feel that they had yet satisfactorily recreated the subtle ways light is reflected. To do this, they began to look in detail at the way skins and fabrics reflect light differently according to their make-up: the exact arrangement of fibers in fabric and the network of fibers in skin. Marschner and his team tried to do this by using computerized tomography, which is most familiar as a medical technique for examining people's internal organs. Like classical radiology, it uses X-rays, but because the image is constructed inside a computer using exposures taken from many different positions, rather than a single exposure on photographic film, it can capture fine details that are invisible in classical radiography.</p>
    
    <p>Unfortunately, the scientists understood that at this point in time they could not use computerized tomography on skin, because a very high-intensity X-ray is needed to show the kind of detail they wanted and this would be very dangerous for human skin. They have, however, had some success with fabric. Using this new method of imaging, they are able to accurately record the three-dimensional structure of all the fibers in a number of small pieces of fabric. These same pieces of fabric, through the use of CGI, can then be patched together to form an entire garment inside a computer, in the same way that a small group of actors can be made to look like hundreds of people gathered together. A garment created through CGI is therefore made up of pieces of fabric whose internal structure has been pre-recorded. This means that the way light is reflected by the garment can be calculated far more realistically than if the scientists just made a computer model of what they thought the interior of the fabric looked like. Cinematography will benefit from this because, although it may take some years to be able to use computerized tomographic imaging of skin, for the moment the movement of a virtual cloak or the lifting of a computerized hat should look far more realistic.</p>
    
    <p>In the meantime, according to Marschner's colleague Kavita Bala, the technology might have an application in online retailing. At the moment, people buying clothes over the internet have only a standard photograph to help them choose their purchases. It is hoped that if online shoppers can view items which have been presented through the use of computerized tomography graphics, they will have a much better understanding of what the material the item is made of is really like.</p>
    
    <p>Marschner is now working on the way light is scattered from individual hairs. He says, 'I feel lucky to be working in this niche. I'm a visual person and to be able to spend my time scrutinizing the world around me, trying to understand why it looks the way it does, is very rewarding'.</p>

    <p>&nbsp;</p>
  </section>
  <div id="divider" title="Drag to resize"></div>
  <section class="pane" id="right">
    <h3>Questions</h3>
    
    <div class="group">
        <h4>Questions 27–32</h4>
        <p>Choose the correct letter, A, B, C, or D.</p>
        
        <a id="q27-anchor"></a><div id="q27-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>27 What is the writer's main point in the first paragraph?</p><div><label style="display:block; margin:4px 0;"><input name="q27" type="radio" value="A"> A Computer scientists are rarely represented at the Oscars.</label><label style="display:block; margin:4px 0;"><input name="q27" type="radio" value="B"> B Film-industry awards hold little interest for computer scientists.</label><label style="display:block; margin:4px 0;"><input name="q27" type="radio" value="C"> C The USA rewards film actors more than computer scientists.</label><label style="display:block; margin:4px 0;"><input name="q27" type="radio" value="D"> D Computer scientists are becoming a vital part of the film industry.</label></div></div>
        <a id="q28-anchor"></a><div id="q28-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>28 When describing the way computer-generated imagery changes actors' appearance, what does the writer suggest?</p><div><label style="display:block; margin:4px 0;"><input name="q28" type="radio" value="A"> A CGI looks best from a distance.</label><label style="display:block; margin:4px 0;"><input name="q28" type="radio" value="B"> B CGI interferes with actors' facial expressions.</label><label style="display:block; margin:4px 0;"><input name="q28" type="radio" value="C"> C Audiences expect too much of CGI.</label><label style="display:block; margin:4px 0;"><input name="q28" type="radio" value="D"> D The scientists had hoped for more convincing results.</label></div></div>
        <a id="q29-anchor"></a><div id="q29-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>29 What does the writer suggest about the scientists' attitude to their work in the fourth paragraph?</p><div><label style="display:block; margin:4px 0;"><input name="q29" type="radio" value="A"> A They were motivated to get as near to reality as possible.</label><label style="display:block; margin:4px 0;"><input name="q29" type="radio" value="B"> B They were interested in gaining recognition for their work.</label><label style="display:block; margin:4px 0;"><input name="q29" type="radio" value="C"> C They thought it could have medical applications.</label><label style="display:block; margin:4px 0;"><input name="q29" type="radio" value="D"> D They hoped to receive further funding for their research.</label></div></div>
        <a id="q30-anchor"></a><div id="q30-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>30 What are we told about computerised tomography?</p><div><label style="display:block; margin:4px 0;"><input name="q30" type="radio" value="A"> A It has only recently been used by doctors.</label><label style="display:block; margin:4px 0;"><input name="q30" type="radio" value="B"> B It is similar to X-rays in the way it works.</label><label style="display:block; margin:4px 0;"><input name="q30" type="radio" value="C"> C Filmmakers have used it for many years for special lighting effects.</label><label style="display:block; margin:4px 0;"><input name="q30" type="radio" value="D"> D It can be administered using traditional radiography machines.</label></div></div>
        <a id="q31-anchor"></a><div id="q31-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>31 Which of these advantages does the writer attribute to the current use of computerised tomography?</p><div><label style="display:block; margin:4px 0;"><input name="q31" type="radio" value="A"> A It is most effective when used to create images of skin.</label><label style="display:block; margin:4px 0;"><input name="q31" type="radio" value="B"> B It can make a few people seem like a crowd.</label><label style="display:block; margin:4px 0;"><input name="q31" type="radio" value="C"> C It allows clothes designers to create new designs.</label><label style="display:block; margin:4px 0;"><input name="q31" type="radio" value="D"> D It is practical because of the time it takes.</label></div></div>
        <a id="q32-anchor"></a><div id="q32-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>32 The writer mentions Kavita Bala in order to</p><div><label style="display:block; margin:4px 0;"><input name="q32" type="radio" value="A"> A comment on the success of CGI in commercial contexts.</label><label style="display:block; margin:4px 0;"><input name="q32" type="radio" value="B"> B highlight the link between CGI and photography.</label><label style="display:block; margin:4px 0;"><input name="q32" type="radio" value="C"> C show that Marschner's team are uncertain about the future of CGI.</label><label style="display:block; margin:4px 0;"><input name="q32" type="radio" value="D"> D demonstrate a use for CGI outside the film industry.</label></div></div>
    </div>
    
    <div class="group">
        <h4>Questions 33–36</h4>
        <p>Do the following statements agree with the views of the writer in Reading Passage 3?</p>
        <p>In boxes 33–36 on your answer sheet, write</p>
        <ul>
            <li><strong>YES</strong> if the statement agrees with the views of the writer</li>
            <li><strong>NO</strong> if the statement contradicts the views of the writer</li>
            <li><strong>NOT GIVEN</strong> if it is impossible to say what the writer thinks about this</li>
        </ul>
        
        <a id="q33-anchor"></a><div id="q33-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>33 It used to be unusual for university researchers to receive a cinematography award.</p><div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;"><label><input name="q33" type="radio" value="YES"> YES</label> <label><input name="q33" type="radio" value="NO"> NO</label> <label><input name="q33" type="radio" value="NOT GIVEN"> NOT GIVEN</label></div></div>
        <a id="q34-anchor"></a><div id="q34-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>34 CGI is popular among ageing actors.</p><div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;"><label><input name="q34" type="radio" value="YES"> YES</label> <label><input name="q34" type="radio" value="NO"> NO</label> <label><input name="q34" type="radio" value="NOT GIVEN"> NOT GIVEN</label></div></div>
        <a id="q35-anchor"></a><div id="q35-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>35 The scientists' success in generating images of complete CGI garments has won them many awards.</p><div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;"><label><input name="q35" type="radio" value="YES"> YES</label> <label><input name="q35" type="radio" value="NO"> NO</label> <label><input name="q35" type="radio" value="NOT GIVEN"> NOT GIVEN</label></div></div>
        <a id="q36-anchor"></a><div id="q36-section" style="padding:8px 0;border-top:1px dashed var(--line);"><p>36 It will be a long time before computerised tomographic imaging of fabric is used by filmmakers.</p><div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;"><label><input name="q36" type="radio" value="YES"> YES</label> <label><input name="q36" type="radio" value="NO"> NO</label> <label><input name="q36" type="radio" value="NOT GIVEN"> NOT GIVEN</label></div></div>
    </div>

    <div class="group">
        <h4>Questions 37–40</h4>
        <p>Complete the summary below using the list of words, A–I.</p>
        <div class="summary-box">
            <h5 style="text-align:center; margin-top:0;">The work of Marschner and his colleagues</h5>
            <p>For many years, CGI characters did not appear entirely lifelike as their skin appeared plastic. Marschner and his colleagues were the first to apply an understanding of how <a id="q37-anchor"></a><span style="display:inline-block; vertical-align: middle; margin: 0 4px;"><div class="dropzone" data-target="q37"><span class="droplabel">37</span></div></span> interacts with human skin. Their CGI model is based on a novel application of principles of <a id="q38-anchor"></a><span style="display:inline-block; vertical-align: middle; margin: 0 4px;"><div class="dropzone" data-target="q38"><span class="droplabel">38</span></div></span>, which had previously been applied in other scientific research. The importance of CGI to the film industry has led to the <a id="q39-anchor"></a><span style="display:inline-block; vertical-align: middle; margin: 0 4px;"><div class="dropzone" data-target="q39"><span class="droplabel">39</span></div></span> of Marschner's model by special-effects studios. Marschner's model has led to the <a id="q40-anchor"></a><span style="display:inline-block; vertical-align: middle; margin: 0 4px;"><div class="dropzone" data-target="q40"><span class="droplabel">40</span></div></span> of cinematography.</p>
        </div>
        <div class="word-list-drag-drop" id="card-pool">
            <div class="card" draggable="true" data-value="A" id="card-A"><strong>A</strong> light</div>
            <div class="card" draggable="true" data-value="B" id="card-B"><strong>B</strong> transparency</div>
            <div class="card" draggable="true" data-value="C" id="card-C"><strong>C</strong> age</div>
            <div class="card" draggable="true" data-value="D" id="card-D"><strong>D</strong> use</div>
            <div class="card" draggable="true" data-value="E" id="card-E"><strong>E</strong> astrophysics</div>
            <div class="card" draggable="true" data-value="F" id="card-F"><strong>F</strong> mathematics</div>
            <div class="card" draggable="true" data-value="G" id="card-G"><strong>G</strong> improvement</div>
            <div class="card" draggable="true" data-value="H" id="card-H"><strong>H</strong> colour</div>
            <div class="card" draggable="true" data-value="I" id="card-I"><strong>I</strong> translucency</div>
        </div>
    </div>


    <div style="display:flex;gap:8px;margin-bottom:10px;">
      <button class="primary" onclick="grade()">Submit</button>
      <button onclick="resetForm()">Reset</button>
      <button onclick="toggleNotes()">Notes</button>
    </div>
    <div id="results"></div>
    <details class="answerbox" id="answerBox">
      <summary>Show answers (click to toggle) <span class="badge">hidden</span></summary>
      <div id="answerContent"></div>
    </details>
  </section>
</div>

<div aria-label="Selection tools" id="selbar" role="toolbar">
  <button id="btnHL">Highlight</button>
  <button id="btnUH">Remove</button>
  <button id="btnNote">Note</button>
</div>
<div id="notes">
  <header>
    <strong>Notes</strong>
    <div>
      <button id="btnCopy">Copy</button>
      <button id="btnClose">Close</button>
    </div>
  </header>
  <textarea id="noteArea" placeholder="Type your notes here..."></textarea>
</div>
<div id="toast"></div>

<script>
let _t=0; const _timerEl=document.getElementById('timer');
setInterval(function(){ _t++; var m=String(Math.floor(_t/60)).padStart(2,'0'); var s=String(_t%60).padStart(2,'0'); _timerEl.textContent=m+':'+s; },1000);
var divider = document.getElementById('divider');
var left = document.getElementById('left');
var right = document.getElementById('right');
var dragging=false;
function startDrag(e){ dragging=true; document.body.style.cursor='ew-resize'; if(e.preventDefault) e.preventDefault(); }
function endDrag(){ dragging=false; document.body.style.cursor=''; }
function onMove(clientX){ var container = document.querySelector('.shell').getBoundingClientRect(); var x = clientX - container.left; x = Math.max(280, Math.min(container.width-320, x)); left.style.flex = '0 0 ' + x + 'px'; right.style.flex = '1 1 auto'; }
divider.addEventListener('mousedown', function(e){ startDrag(e); });
window.addEventListener('mousemove', function(e){ if(dragging) onMove(e.clientX); });
window.addEventListener('mouseup', endDrag);
divider.addEventListener('touchstart', function(e){ startDrag(e.touches[0]); }, {passive:false});
window.addEventListener('touchmove', function(e){ if(dragging) onMove(e.touches[0].clientX); }, {passive:false});
window.addEventListener('touchend', endDrag);
var selbar = document.getElementById('selbar');
var lastRange=null, currentHlNode=null, keepToolbar=false;
function positionSelbarForRect(rect){
  selbar.style.display='flex';
  requestAnimationFrame(function(){
    var top = window.scrollY + rect.top - selbar.offsetHeight - 8;
    var leftPos = window.scrollX + rect.left + rect.width/2 - selbar.offsetWidth/2;
    selbar.style.top = ((top>0)?top:(window.scrollY + rect.bottom + 8)) + 'px';
    selbar.style.left = Math.max(8, leftPos) + 'px';
  });
}
function updateSelbar(){ var sel=window.getSelection(); if(!sel || sel.rangeCount===0 || sel.isCollapsed) { selbar.style.display='none'; currentHlNode=null; return; } var range = sel.getRangeAt(0); lastRange = range.cloneRange(); currentHlNode=null; positionSelbarForRect(range.getBoundingClientRect()); }
document.getElementById('left').addEventListener('mouseup', updateSelbar);
document.getElementById('right').addEventListener('mouseup', updateSelbar);
document.addEventListener('selectionchange', function(){ var sel=window.getSelection(); if(!sel || sel.rangeCount===0 || sel.isCollapsed){ if(!keepToolbar && !currentHlNode){ selbar.style.display='none'; } } });
document.addEventListener('scroll', function(){ if(selbar.style.display==='flex') updateSelbar(); });
document.addEventListener('mousedown', function(e){ var t = e.target; if(t.classList && t.classList.contains('hl')){ keepToolbar = true; } else { keepToolbar = false; } }, true);
document.addEventListener('click', function(e){ var target = e.target; if(target.classList && target.classList.contains('hl')){ currentHlNode = target; lastRange = null; positionSelbarForRect(target.getBoundingClientRect()); var sel=window.getSelection(); if(sel) sel.removeAllRanges(); setTimeout(function(){ keepToolbar=false; }, 0); } }, true);
function doHighlight(){ if(currentHlNode) return; if(!lastRange || lastRange.collapsed) return; var span=document.createElement('span'); span.className='hl'; try { lastRange.surroundContents(span); } catch(e){ var wrap=document.createElement('span'); wrap.className='hl'; wrap.appendChild(lastRange.cloneContents()); lastRange.deleteContents(); lastRange.insertNode(wrap); } selbar.style.display='none'; showToast('Highlighted'); }
function removeHighlight(){ if(currentHlNode){ var p = currentHlNode.parentNode; while(currentHlNode.firstChild) p.insertBefore(currentHlNode.firstChild, currentHlNode); p.removeChild(currentHlNode); p.normalize(); currentHlNode = null; selbar.style.display='none'; showToast('Highlight removed'); return; } if(!lastRange) return; var selRect = lastRange.getBoundingClientRect(); var walker=document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT); var toRemove=[]; while(walker.nextNode()){ var n=walker.currentNode; if(n.classList && n.classList.contains('hl')) { var r = n.getBoundingClientRect(); if(!(r.right < selRect.left || r.left > selRect.right || r.bottom < selRect.top || r.top > selRect.bottom)) toRemove.push(n); } } toRemove.forEach(function(el){ var p=el.parentNode; while(el.firstChild) p.insertBefore(el.firstChild, el); p.removeChild(el); p.normalize(); }); selbar.style.display='none'; showToast('Highlight removed'); }
document.getElementById('btnHL').addEventListener('click', doHighlight);
document.getElementById('btnUH').addEventListener('click', removeHighlight);
var notes = document.getElementById('notes'); var noteArea = document.getElementById('noteArea'); function toggleNotes(){ notes.style.display = (notes.style.display==='flex'?'none':'flex'); }
window.toggleNotes = toggleNotes;
document.getElementById('btnClose').addEventListener('click', toggleNotes);
document.getElementById('btnCopy').addEventListener('click', async function(){ await navigator.clipboard.writeText(noteArea.value||''); showToast('Copied'); });
document.getElementById('btnNote').addEventListener('click', function(){ var text = ''; if(currentHlNode){ text = (currentHlNode.textContent||'').trim(); } else if(lastRange){ var frag = lastRange.cloneContents(); text = (frag.textContent||'').trim(); } toggleNotes(); if(text) noteArea.value = (noteArea.value? noteArea.value+'\n':'') + '> ' + text + '\n'; selbar.style.display='none'; });
var toastEl=document.getElementById('toast'); function showToast(msg){ toastEl.textContent=msg; toastEl.style.display='block'; setTimeout(function(){ toastEl.style.display='none'; }, 1200); }
function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
  const isDarkMode = document.body.classList.contains('dark-mode');
  localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
  document.querySelector('.theme-toggle').textContent = isDarkMode ? '🌙' : '☀️';
}
if (localStorage.getItem('darkMode') === 'enabled') {
  document.body.classList.add('dark-mode');
  document.querySelector('.theme-toggle').textContent = '🌙';
}
var answers = { q27: "D", q28: "A", q29: "A", q30: "B", q31: "B", q32: "D", q33: "YES", q34: "NOT GIVEN", q35: "NOT GIVEN", q36: "NO", q37: "A", q38: "E", q39: "D", q40: "G" };
function grade(){
  var total=0, correct=0, lines=[];
  function push(q, ok, user){ total++; if(ok) correct++; lines.push(q.toUpperCase()+": "+(user||'None')+" "+(ok?'✅':'❌')); }
  
  for(var n=27;n<=36;n++){
      var qName = 'q' + n;
      var sel = document.querySelector('input[name="'+qName+'"]:checked');
      var val = sel ? sel.value : '';
      var isCorrect = val.toUpperCase() === answers[qName].toUpperCase();
      push(qName, isCorrect, val);
  }

  for(var n=37; n<=40; n++){
    var qName = 'q' + n;
    var zone = document.querySelector(`.dropzone[data-target="${qName}"]`);
    var card = zone ? zone.querySelector('.card') : null;
    var val = card ? card.dataset.value : '';
    var isCorrect = val === answers[qName];
    push(qName, isCorrect, val);
  }
  
  var acc = (total? Math.round(100*correct/total):0);
  var html = '<p><strong>Score:</strong> '+correct+'/'+total+' <span class="badge">Accuracy '+acc+'%</span></p>';
  html += '<pre>'+lines.join('\n')+'</pre>';
  document.getElementById('results').innerHTML = html;
  
  var ahtml = '<ol start="27">';
  for(var i=27; i<=40; i++){ ahtml += '<li>' + answers['q'+i] + '</li>'; }
  ahtml += '</ol>';
  document.getElementById('answerContent').innerHTML = ahtml;
  document.querySelector('#answerBox .badge').textContent='tap to view';
}
function resetForm(){
  document.querySelectorAll('input[type="radio"]').forEach(el=>el.checked=false);
  
  const pool = document.getElementById('card-pool');
  if (pool) {
    document.querySelectorAll('.dropzone .card').forEach(card => {
        pool.appendChild(card);
    });
    document.querySelectorAll('.dropzone').forEach((zone, index) => {
        zone.innerHTML = `<span class="droplabel">${37 + index}</span>`;
    });
  }

  document.getElementById('results').innerHTML='';
  document.getElementById('answerContent').innerHTML='';
  document.querySelector('#answerBox .badge').textContent = 'hidden';
  document.querySelectorAll('.q-item').forEach(item => item.classList.remove('answered'));
}
function scrollToElement(id){
  var el = document.getElementById(id);
  if(el){ el.scrollIntoView({behavior:'smooth', block:'center'}); }
  var navs = document.querySelectorAll('.practice-nav .q-item');
  navs.forEach(n => n.classList.remove('active'));
  var btn = document.getElementById(id.replace('-anchor','-nav'));
  if(btn){ btn.classList.add('active'); setTimeout(() => btn.classList.remove('active'), 800); }
}
(function(){
  function mark(qn){
    var nav = document.getElementById('q'+qn+'-nav');
    if(!nav) return;
    var answered = false;
    var radios = document.querySelectorAll(`input[name="q${qn}"]`);
    var zone = document.querySelector(`.dropzone[data-target="q${qn}"]`);
    
    if (radios.length > 0) { radios.forEach(function(r){ if(r.checked) answered=true; }); }
    if (zone) { answered = answered || zone.querySelector('.card') !== null; }
    
    if(answered) nav.classList.add('answered'); else nav.classList.remove('answered');
  }
  for(var q=27;q<=40;q++){
    (function(n){
      document.querySelectorAll(`input[name="q${n}"]`).forEach(function(r){ r.addEventListener('change', function(){ mark(n); }); });
    })(q);
  }

  // Drag and Drop Logic
  const cards = document.querySelectorAll('.card');
  const dropzones = document.querySelectorAll('.dropzone');
  const cardPool = document.getElementById('card-pool');

  let draggedCard = null;

  cards.forEach(card => {
      card.addEventListener('dragstart', (e) => {
          draggedCard = e.target;
          setTimeout(() => e.target.classList.add('ghost'), 0);
      });
      card.addEventListener('dragend', (e) => {
          e.target.classList.remove('ghost');
      });
  });

  dropzones.forEach(zone => {
      zone.addEventListener('dragover', e => {
          e.preventDefault();
          zone.classList.add('over');
      });
      zone.addEventListener('dragleave', () => {
          zone.classList.remove('over');
      });
      zone.addEventListener('drop', e => {
          e.preventDefault();
          zone.classList.remove('over');
          if (draggedCard) {
              if(zone.children.length > 0 && zone.children[0].classList.contains('card')) {
                  cardPool.appendChild(zone.children[0]);
              }
              zone.innerHTML = '';
              zone.appendChild(draggedCard);
              mark(zone.dataset.target.substring(1));
              draggedCard = null;
          }
      });
  });
})();
</script>

<!-- 练习页面数据传输增强脚本 -->
<script>
if (!window.practicePageEnhancer) {
    const script = document.createElement('script');
    script.src = '../../js/practice-page-enhancer.js';
    script.onload = function() { console.log('练习页面增强脚本已加载'); };
    script.onerror = function() { console.error('练习页面增强脚本加载失败'); loadInlineEnhancer(); };
    document.head.appendChild(script);
}
function loadInlineEnhancer() {
    if (window.practicePageEnhancer) return;
    window.practicePageEnhancer = {
        initialize: function() { this.setupCommunication(); this.setupAnswerListeners(); this.interceptSubmit(); },
        setupCommunication: function() {
            this.parentWindow = window.opener || window.parent;
            window.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'INIT_SESSION') {
                    this.sessionId = event.data.data.sessionId;
                    this.sendMessage('SESSION_READY', { pageType: this.detectPageType(), url: window.location.href });
                }
            });
        },
        detectPageType: function() { const title = document.title || ''; if (title.includes('P1')) return 'P1'; if (title.includes('P2')) return 'P2'; if (title.includes('P3')) return 'P3'; return 'unknown'; },
        setupAnswerListeners: function() {
            this.answers = {};
            this.startTime = Date.now();
            document.addEventListener('change', (e) => { if (e.target.name) this.answers[e.target.name] = e.target.value; });
            // For drag and drop, we'll capture on submit
        },
        interceptSubmit: function() {
            if (typeof window.grade === 'function') {
                const originalGrade = window.grade;
                window.grade = () => {
                    document.querySelectorAll('.dropzone').forEach(zone => {
                        const qName = zone.dataset.target;
                        const card = zone.querySelector('.card');
                        this.answers[qName] = card ? card.dataset.value : '';
                    });
                    originalGrade();
                    setTimeout(() => this.handleSubmit(), 200);
                };
            }
        },
        handleSubmit: function() {
            const results = { sessionId: this.sessionId, startTime: this.startTime, endTime: Date.now(), duration: Math.round((Date.now() - this.startTime) / 1000), answers: this.answers, scoreInfo: this.extractScore(), pageType: this.detectPageType(), url: window.location.href };
            this.sendMessage('PRACTICE_COMPLETE', results);
        },
        extractScore: function() {
            const resultsEl = document.getElementById('results');
            if (!resultsEl) return null;
            const text = resultsEl.textContent || '';
            const scoreMatch = text.match(/Score:\s*(\d+)\/(\d+)/i);
            if (scoreMatch) {
                const correct = parseInt(scoreMatch[1]);
                const total = parseInt(scoreMatch[2]);
                return { correct: correct, total: total, accuracy: total > 0 ? correct / total : 0, percentage: Math.round((correct / total) * 100), source: 'inline_extraction' };
            }
            return null;
        },
        sendMessage: function(type, data) { if (this.parentWindow) this.parentWindow.postMessage({ type: type, data: data, source: 'practice_page' }, '*'); }
    };
    if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', () => { window.practicePageEnhancer.initialize(); }); }
    else { window.practicePageEnhancer.initialize(); }
}

// Initialize modern features
function initModernFeatures() {
  loadTheme();
  startTimer();
  
  // Make timer clickable
  const timer = document.getElementById('timer');
  if (timer && !timer.onclick) {
    timer.onclick = toggleTimer;
  }
  
  showToast('Modern features loaded');
}

// Auto-initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initModernFeatures);
} else {
  initModernFeatures();
}
</script>

<script>
// 全面修复的JavaScript功能
(function() {
  // 防止重复加载
  if (window.comprehensiveFixLoaded) return;
  window.comprehensiveFixLoaded = true;
  
  console.log('Loading comprehensive P3 fixes...');
  
  // 计时器变量
  let timerSeconds = 0;
  let timerInterval = null;
  let timerPaused = false;
  
  // 强制覆盖计时器函数
  window.startTimer = function() {
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      if (!timerPaused) {
        timerSeconds++;
        updateTimerDisplay();
      }
    }, 1000);
    console.log('Timer started');
  };
  
  window.updateTimerDisplay = function() {
    const minutes = Math.floor(timerSeconds / 60);
    const seconds = timerSeconds % 60;
    const timerEl = document.getElementById('timer');
    if (timerEl) {
      timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
  };
  
  window.toggleTimer = function() {
    timerPaused = !timerPaused;
    const timerEl = document.getElementById('timer');
    if (timerEl) {
      timerEl.classList.toggle('paused', timerPaused);
      timerEl.style.background = timerPaused ? '#fef3c7' : '';
      timerEl.style.color = timerPaused ? '#92400e' : '';
    }
    
    if (!timerInterval) {
      window.startTimer();
    }
    
    showToast(timerPaused ? 'Timer paused ⏸️' : 'Timer resumed ▶️');
  };
  
  // 强制覆盖主题切换函数
  window.toggleTheme = function() {
    const body = document.body;
    const themeButton = document.querySelector('.theme-toggle');
    
    body.classList.toggle('dark');
    const isDark = body.classList.contains('dark');
    
    if (themeButton) {
      themeButton.textContent = isDark ? '☀️' : '🌙';
    }
    
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    showToast(`Switched to ${isDark ? 'dark' : 'light'} theme`);
    
    console.log('Theme toggled to:', isDark ? 'dark' : 'light');
  };
  
  window.loadTheme = function() {
    const savedTheme = localStorage.getItem('theme');
    const body = document.body;
    const themeButton = document.querySelector('.theme-toggle');
    
    if (savedTheme === 'dark') {
      body.classList.add('dark');
      if (themeButton) themeButton.textContent = '☀️';
    } else {
      body.classList.remove('dark');
      if (themeButton) themeButton.textContent = '🌙';
    }
    
    console.log('Theme loaded:', savedTheme || 'light');
  };
  
  // Toast通知系统
  window.showToast = function(message) {
    let toast = document.getElementById('toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast';
      toast.style.cssText = `
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        bottom: 100px;
        background: #111;
        color: #fff;
        padding: 12px 20px;
        border-radius: 8px;
        display: none;
        z-index: 2500;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      `;
      document.body.appendChild(toast);
    }
    
    toast.textContent = message;
    toast.style.display = 'block';
    
    setTimeout(() => {
      toast.style.display = 'none';
    }, 2500);
  };
  
  // 高亮功能修复
  window.doHighlight = function(color) {
    const selection = window.getSelection();
    if (selection.rangeCount > 0) {
      const range = selection.getRangeAt(0);
      const span = document.createElement('span');
      span.className = 'hl';
      span.style.backgroundColor = color || '#fbbf24';
      span.style.color = document.body.classList.contains('dark') ? '#1f2937' : 'inherit';
      
      try {
        range.surroundContents(span);
        selection.removeAllRanges();
        showToast('Text highlighted');
      } catch (e) {
        console.log('Highlight failed:', e);
      }
    }
  };
  
  window.removeHighlight = function() {
    const highlights = document.querySelectorAll('.hl');
    highlights.forEach(hl => {
      const parent = hl.parentNode;
      parent.insertBefore(document.createTextNode(hl.textContent), hl);
      parent.removeChild(hl);
    });
    showToast('Highlights removed');
  };
  
  // 笔记功能修复
  window.toggleNotes = function() {
    const notes = document.getElementById('notes');
    if (notes) {
      const isVisible = notes.style.display !== 'none';
      notes.style.display = isVisible ? 'none' : 'block';
      showToast(isVisible ? 'Notes hidden' : 'Notes shown');
    }
  };
  
  // 滚动到元素
  window.scrollToElement = function(id) {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      showToast(`Scrolled to question ${id.replace('q', '')}`);
    }
  };
  
  // 答案状态更新
  window.updateAnswerStatus = function() {
    const questions = document.querySelectorAll('[id^="q"]');
    questions.forEach(q => {
      const qNum = q.id.replace('q', '');
      const navItem = document.querySelector(`.q-item[onclick*="q${qNum}"]`);
      if (navItem) {
        const hasAnswer = q.querySelector('input:checked, input.blank[value!=""]');
        navItem.classList.toggle('answered', !!hasAnswer);
      }
    });
  };
  
  // 表单重置
  window.resetForm = function() {
    const form = document.querySelector('form');
    if (form) {
      form.reset();
      document.querySelectorAll('.hl').forEach(hl => {
        const parent = hl.parentNode;
        parent.insertBefore(document.createTextNode(hl.textContent), hl);
        parent.removeChild(hl);
      });
      updateAnswerStatus();
      showToast('Form reset');
    }
  };
  
  // 初始化函数
  function initComprehensiveFixes() {
    console.log('Initializing comprehensive fixes...');
    
    // 加载主题
    loadTheme();
    
    // 启动计时器
    startTimer();
    
    // 绑定计时器点击事件
    const timer = document.getElementById('timer');
    if (timer) {
      timer.onclick = toggleTimer;
      timer.style.cursor = 'pointer';
      timer.title = 'Click to pause/resume timer';
    }
    
    // 绑定主题切换按钮
    const themeButton = document.querySelector('.theme-toggle');
    if (themeButton) {
      themeButton.onclick = toggleTheme;
      themeButton.title = 'Toggle dark/light theme';
    }
    
    // 绑定答案变化监听
    document.addEventListener('change', updateAnswerStatus);
    document.addEventListener('input', updateAnswerStatus);
    
    // 绑定高亮选择事件
    document.addEventListener('mouseup', function() {
      const selection = window.getSelection();
      if (selection.toString().length > 0) {
        // 可以在这里添加高亮工具栏显示逻辑
      }
    });
    
    // 初始化答案状态
    setTimeout(updateAnswerStatus, 500);
    
    showToast('All features loaded successfully! ✅');
    console.log('Comprehensive fixes initialized successfully');
  }
  
  // 页面加载完成后初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initComprehensiveFixes);
  } else {
    initComprehensiveFixes();
  }
  
})();
</script>
</body>
</html>