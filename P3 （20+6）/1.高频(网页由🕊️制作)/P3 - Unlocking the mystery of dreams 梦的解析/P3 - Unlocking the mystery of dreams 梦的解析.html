<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Unlocking the mystery of dreams</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
  :root { --line:#e5e7eb; --bg:#f6f7fb; --panel:#fff; --accent:#3b82f6; --muted:#6b7280; --shadow:0 6px 20px rgba(0,0,0,.12); }
  
    --line: #374151;
    --bg: #111827;
    --panel: #1f2937;
    --accent: #60a5fa;
    --muted: #9ca3af;
    --shadow: 0 6px 20px rgba(0,0,0,.3);
  }
  
  body {
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  
  
  
    color: #f9fafb;
  }
  
  
    background: var(--panel);
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: #374151;
    border-color: var(--accent);
  }
  
  
    background: #1e40af;
    color: #93c5fd;
  }
  
  
    background: var(--panel);
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: #374151;
    border-color: var(--accent);
  }
  
  
    background: var(--accent);
    color: white;
  }
  
  
    background: var(--panel);
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    border-color: var(--line);
    color: #f9fafb;
  }
  
  
    background: #fbbf24;
    color: #1f2937;
  }
  
  
    background: #374151;
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    border-color: var(--line);
    color: #f9fafb;
  }
  
  
    background: #374151;
  }
  
  
    background: var(--panel);
    border-color: var(--line);
  }
  
  
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    color: #f9fafb;
  }
  
  /* Timer enhancements */
  #timer {
    cursor: pointer !important;
    transition: all 0.2s ease;
    user-select: none;
  }
  
  #timer:hover {
    background: #f8fafc;
    border-color: var(--accent);
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
  }
  
  
    background: #1e293b;
    color: #e2e8f0;
    border-color: #334155;
  }
  
  
    background: #334155;
    border-color: var(--accent);
  }
  
  #timer.paused {
    background: #fef3c7 !important;
    color: #92400e !important;
    border-color: #f59e0b !important;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }
  
  /* Controls layout */
  .practice-nav .controls {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  /* Theme toggle button */
  .theme-toggle {
    border: none;
    cursor: pointer;
    background: transparent;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.2s ease;
  }
  
  .theme-toggle:hover {
    background: var(--accent);
    color: #fff;
    transform: scale(1.05);
  }
  
  .theme-toggle:active {
    transform: scale(0.95);
  }

  * { box-sizing: border-box; }
  html,body { height:100%; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); }
  #timer { position: static; display: inline-block; margin-left: 8px; background:#fff; border:1px solid var(--line); border-radius:10px; padding:2px 8px; font-size:14px; vertical-align: middle; }
  .shell { display:flex; height:100vh; width:100%; }
  .pane { background:var(--panel); overflow:auto; padding:20px; }
  #left { flex: 0 0 50%; min-width: 280px; }
  #right { flex: 1 1 auto; min-width: 320px; background:#fbfbff; border-left:1px solid var(--line); }
  #divider { flex: 0 0 8px; background: linear-gradient(90deg,#e5e7eb,#d1d5db); cursor: ew-resize; position:relative; z-index: 5; user-select:none; }
  h2,h3,h4 { margin:0 0 10px; }
  #left p { margin: 0 0 12px; line-height: 1.6; word-break: normal; overflow-wrap: normal; hyphens: none; }
  .group { background:#fff; border:1px solid var(--line); border-radius:10px; padding:12px; margin-bottom:14px; }
  table { border-collapse: collapse; width:100%; }
  th, td { border:1px solid var(--line); padding:6px; text-align:center; font-size:14px; }
  th:first-child, td:first-child { width:92px; }
  button { padding:8px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; cursor:pointer; }
  button.primary { background:var(--accent); color:#fff; border-color:#3b82f6; }
  #results { background:#fff; border:1px solid var(--line); border-radius:10px; padding:10px; }
  .hl { background:#fff3a3; box-shadow: inset 0 -2px 0 rgba(0,0,0,.05); cursor: pointer; }
  .hl:hover { filter: brightness(0.98); }
  #selbar { position: absolute; display:none; z-index: 2000; background:#111; color:#fff; border-radius: 8px; padding: 6px; box-shadow: var(--shadow); font-size: 13px; gap:6px; align-items: center; }
  #selbar button { background: transparent; color:#fff; border: 1px solid rgba(255,255,255,.25); padding: 4px 8px; border-radius: 6px; cursor:pointer; }
  #selbar button:hover { border-color:#fff; }
  #notes { position: fixed; right: 12px; bottom: 12px; width: 320px; height: 42vh; background:#fff; border:1px solid var(--line); border-radius: 12px; display:none; flex-direction: column; z-index:1500; box-shadow: var(--shadow); }
  #notes header { display:flex; align-items:center; justify-content: space-between; padding:8px 10px; border-bottom:1px solid var(--line); }
  #notes textarea { flex:1; border:0; padding:10px; resize:none; font-size:14px; line-height:1.5; }
  #toast { position: fixed; left:50%; transform: translateX(-50%); bottom: 24px; background:#111; color:#fff; padding:8px 12px; border-radius: 8px; display:none; z-index:2500; }
  .dropzone { border:2px dashed #cbd5e1; background:#f8fafc; border-radius:10px; min-height:40px; padding:4px 8px; display:inline-flex; align-items:center; justify-content:space-between; gap:8px; width: auto; min-width: 120px; max-width: 200px; vertical-align: middle; }
  .droplabel { color:#64748b; font-size:14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .cardpool { background:#f1f5f9; border-radius:10px; padding:12px; display:flex; flex-wrap:wrap; gap:8px; }
  .pool-slot { min-height:40px; }
  .card { background:#fff; border:1px solid #e5e7eb; border-radius:8px; padding:8px 10px; display:inline-flex; gap:8px; align-items:center; cursor:grab; box-shadow:0 1px 0 rgba(0,0,0,.03); white-space: nowrap; }
  .card:active { cursor:grabbing; }
  .tag { background:#eef2ff; color:#4338ca; padding:2px 8px; border-radius:999px; font-size:12px; }
  .btn-clear { border:1px solid #e5e7eb; background:#fff; border-radius:8px; padding:6px 8px; cursor:pointer; }
  .ghost { opacity: .5; }
  .over { outline:2px dashed #3b82f6; }
  details.answerbox summary { cursor: pointer; user-select:none; list-style: none; }
  details.answerbox { border:1px dashed var(--line); border-radius:10px; padding:8px 10px; background:#fff; }
  .badge { display:inline-block; background:#eef2ff; color:#4338ca; padding:2px 8px; border-radius:999px; font-size:12px; margin-left:6px; }
  body { padding-bottom: 82px; }
  .practice-nav { background:#fff; border-bottom:2px solid var(--line); padding:12px 20px; display:flex; align-items:center; gap:20px; box-shadow:0 2px 4px rgba(0,0,0,.05); flex-wrap:wrap; position:fixed; left:0; right:0; bottom:0; border-top:2px solid var(--line); border-bottom:0; z-index:4000; }
  .practice-nav .title { font-weight:600; color:var(--muted); }
  .practice-nav .questions { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .practice-nav .q-item { padding:6px 10px; border:1px solid var(--line); border-radius:6px; background:#fff; cursor:pointer; font-size:14px; transition:all 0.2s; min-width:36px; text-align:center; }
  .practice-nav .q-item:hover { background:#f1f5f9; border-color:var(--accent); }
  .practice-nav .q-item.answered { background:#e0e7ff; border-color:var(--accent); color:var(--accent); font-weight:500; }
  .practice-nav .q-item.active { background:var(--accent); color:#fff; border-color:var(--accent); }
  #selbar { z-index: 6000 !important; }

/* 强力黑暗模式修复 - 使用!important确保优先级 */
body.dark {
  background: #111827 !important;
  color: #f9fafb !important;
}

body.dark * {
  border-color: #374151 !important;
}

body.dark .shell {
  background: #111827 !important;
}

body.dark .pane {
  background: #1f2937 !important;
  color: #f9fafb !important;
}

body.dark #left {
  background: #1f2937 !important;
}

body.dark #right {
  background: #1f2937 !important;
}

body.dark h1, body.dark h2, body.dark h3, body.dark h4, body.dark h5, body.dark h6 {
  color: #f9fafb !important;
}

body.dark p, body.dark li, body.dark td, body.dark th, body.dark label, body.dark span, body.dark div {
  color: #e5e7eb !important;
}

body.dark .group {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
  color: #f9fafb !important;
}

body.dark button {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark button:hover {
  background: #4b5563 !important;
  border-color: #60a5fa !important;
}

body.dark button.primary {
  background: #3b82f6 !important;
  color: white !important;
}

body.dark #results {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

body.dark details.answerbox {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
  color: #f9fafb !important;
}

body.dark details.answerbox summary {
  color: #f9fafb !important;
}

body.dark .practice-nav {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
}

body.dark .practice-nav .q-item {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark .practice-nav .q-item:hover {
  background: #4b5563 !important;
  border-color: #60a5fa !important;
}

body.dark .practice-nav .q-item.answered {
  background: #1e40af !important;
  color: #93c5fd !important;
}

body.dark .practice-nav .q-item.active {
  background: #3b82f6 !important;
  color: white !important;
}

body.dark #timer {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark #timer:hover {
  background: #4b5563 !important;
  border-color: #60a5fa !important;
}

body.dark .dropzone {
  background: #374151 !important;
  border: 2px dashed #4b5563 !important;
  color: #f9fafb !important;
}

body.dark .card {
  background: #374151 !important;
  border: 1px solid #4b5563 !important;
  color: #f9fafb !important;
}

body.dark .cardpool {
  background: #4b5563 !important;
}

body.dark .hl {
  background: #fbbf24 !important;
  color: #1f2937 !important;
}

body.dark input[type="radio"] {
  accent-color: #60a5fa !important;
}

body.dark input.blank {
  color: #f9fafb !important;
  border-bottom: 2px solid #4b5563 !important;
  background: transparent !important;
}

body.dark input.blank:focus {
  border-bottom-color: #60a5fa !important;
}

body.dark #notes {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
}

body.dark #notes header {
  color: #f9fafb !important;
  border-bottom: 1px solid #374151 !important;
}

body.dark #notes textarea {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

body.dark table {
  border-color: #374151 !important;
}

body.dark th, body.dark td {
  border-color: #374151 !important;
  color: #e5e7eb !important;
}

body.dark #divider {
  background: linear-gradient(90deg, #374151, #4b5563) !important;
}

/* 修复选择器和其他元素 */
body.dark select, body.dark option {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark textarea {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

body.dark input[type="text"], body.dark input[type="number"] {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

</style>
</head>
<body>
<div class="practice-nav">
  <div class="title">Questions</div>
  <div class="questions">
    <div class="q-item" id="q27-nav" onclick="scrollToElement('q27-anchor')">27</div>
    <div class="q-item" id="q28-nav" onclick="scrollToElement('q28-anchor')">28</div>
    <div class="q-item" id="q29-nav" onclick="scrollToElement('q29-anchor')">29</div>
    <div class="q-item" id="q30-nav" onclick="scrollToElement('q30-anchor')">30</div>
    <div class="q-item" id="q31-nav" onclick="scrollToElement('q31-anchor')">31</div>
    <div class="q-item" id="q32-nav" onclick="scrollToElement('q32-anchor')">32</div>
    <div class="q-item" id="q33-nav" onclick="scrollToElement('q33-anchor')">33</div>
    <div class="q-item" id="q34-nav" onclick="scrollToElement('q34-anchor')">34</div>
    <div class="q-item" id="q35-nav" onclick="scrollToElement('q35-anchor')">35</div>
    <div class="q-item" id="q36-nav" onclick="scrollToElement('q36-anchor')">36</div>
    <div class="q-item" id="q37-nav" onclick="scrollToElement('q37-anchor')">37</div>
    <div class="q-item" id="q38-nav" onclick="scrollToElement('q38-anchor')">38</div>
    <div class="q-item" id="q39-nav" onclick="scrollToElement('q39-anchor')">39</div>
    <div class="q-item" id="q40-nav" onclick="scrollToElement('q40-anchor')">40</div>
  </div>
  <div class="controls">
    <span id="timer" onclick="toggleTimer()">00:00</span>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">🌙</button>
  </div>
</div>
<div class="shell">
  <section class="pane" id="left">
    <h2>READING PASSAGE 3 <span id="timer">00:00</span></h2>
    <p>You should spend about 20 minutes on Questions 27–40, which are based on Reading Passage 3 below.</p>
    <h3>Unlocking the mystery of dreams</h3>
    <p>Dreams have captivated thinkers since ancient times, but their mystery is now closer than ever to resolution, thanks to new technology that allows scientists to watch the sleeping brain at work.</p>
    
    <h4>Paragraph A</h4>
    <p>Thousands of years ago, dreams were seen as messages from the gods, and in many cultures, they are still considered prophetic, foretelling things to come. In ancient Greece, sick people slept at the temples of Asclepius, the god of medicine, in order to receive healing dreams. Modern dream science really begins at the end of the 19th century with Sigmund Freud, who theorized that dreams were the expression of unconscious desires often from childhood. He believed that exploring these hidden emotions through analysis could help cure mental illness. After Freud, the most important event in dream science was the discovery in the early 1950s of a phase of sleep characterized by intense brain activity and rapid eye movement (REM).</p>
    
    <h4>Paragraph B</h4>
    <p>Adult humans spend about a quarter of their sleep time in REM, much of it dreaming. People awakened in the midst of REM sleep reported vivid dreams, which led researchers to conclude that most dreaming took place during REM. Using a machine called the electroencephalograph (EEG), researchers were able to see that brain activity during REM resembled that of the brain when the body is awake. The mystery of REM sleep is that even though it may not be essential, it is universal – at least in mammals and even birds. Some researchers think REM may have evolved for physiological reasons. "One thing that's unique about mammals and birds is that they regulate body temperature," says neuroscientist Jerry Siegel, director of UCLA's Center for Sleep Research. "There's no good evidence that any cold-blooded animal has REM sleep." REM sleep heats up the brain and non-REM cools it off, Siegel says, and that could mean that the changing sleep cycles allow the brain to repair itself. "It seems likely that REM sleep is filling a basic physiological function and that dreams are a kind of a side effect, or by-product of this."</p>
    
    <h4>Paragraph C</h4>
    <p>There is great disagreement about the psychological function of dreams and researchers have come up with some differing theories. On one side are scientists like Harvard's Allan Hobson, who believes that dreams are essentially random. In the 1970s, Hobson and his colleague Robert McCarley proposed what they called the "activation-synthesis hypothesis," which describes how dreams are formed by nerve signals sent out during REM sleep from a small area at the base of the brain called the pons. These signals, the researchers said, activate the images that we call dreams. That raised questions about dream research. If dreams are insignificant night-time images created by the brain, what is the point of studying them?</p>
    
    <h4>Paragraph D</h4>
    <p>But more recently, new theories have made some scientists take dreams more seriously. In 1997, Mark Solms of the University of Cape Town in South Africa found that there was more than one mechanism in the brain for activating dreams. Since then, Solms has argued that medical diagnostic equipment like functional magnetic resonance imaging (fMRI) and positron emission tomography (PET) that helps researchers watch dreaming brains might actually lend new support to Freud's ideas because the parts of the brain that are most active during dreaming control emotion. Further research has supported Solms's findings. Scientists using PET and fMRI technology to watch the dreaming brain have found that one of the most active areas during REM is the limbic system, which controls our emotions.</p>
    
    <h4>Paragraph E</h4>
    <p>Much less active during REM sleep is the prefrontal cortex, which is associated with logical thinking. That could explain why dreams in REM sleep often lack a coherent story line. Some researchers have also found that people dream in non-REM sleep as well, although those dreams generally are less vivid. Another active part of the brain in REM sleep is the anterior cingulate cortex, which detects differences or inconsistencies. Eric Nofzinger, director of the Sleep Neuroimaging Program at the University of Pittsburgh Medical Center, thinks that could be why people often solve tricky problems in their dreams.</p>
    
    <h4>Paragraph F</h4>
    <p>Deirdre Barrett, assistant professor at Harvard Medical School, would agree. In her book "The Committee of Sleep," she describes how painters like Jasper Johns and Salvador Dali found inspiration in their dreams. In her own research on problem solving through dreams, Barrett has found that even ordinary people can solve simple problems in their lives (like how to fit old furniture into a new apartment) if they focus on the dilemma before they fall asleep. There is also evidence that dreaming helps certain kinds of learning. Some researchers have found that dreaming about physical tasks, like a gymnast's floor routine, enhances performance.</p>
    
    <h4>Paragraph G</h4>
    <p>Whatever the function of dreams at night, they clearly can play a role in therapy during the day. The University of Maryland's Clara Hill, who has studied the use of dreams in therapy, says that dreams are a "back door" into a patient's thinking. "Dreams reveal stuff about you that you didn't know was there," she says. The therapists she trains to work with patients' dreams use dream imagery to uncover hidden emotions and feelings. Rosalind Cartwright from the university medical center in Chicago has been studying depression in divorced men and women, and she is finding that "good dreamers," people who have vivid dreams with strong story lines, are less likely to remain depressed. She thinks that dreaming helps diffuse powerful emotions. "Dreaming is a mental-health activity," she says.</p>
    
    <p>&nbsp;</p> <!-- 空白行防止加载不完全 -->
    <p>&nbsp;</p>
  </section>
  <div id="divider" title="Drag to resize"></div>
  <section class="pane" id="right">
    <h3>Questions</h3>
    
    <div class="group">
      <h4>Questions 27–31</h4>
      <p>Reading Passage 3 has seven paragraphs, A–G.</p>
      <p>Which paragraph contains the following information?</p>
      <p>Write the correct letter, A–G, in boxes 27–31 on your answer sheet.</p>
      
      <a id="q27-anchor"></a>
      <div id="q27-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>27 a reference to the significance of dreams on artists' work</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q27" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q27" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q27" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q27" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q27" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q27" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q27" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <a id="q28-anchor"></a>
      <div id="q28-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>28 a concern about the usefulness of dream research</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q28" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q28" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q28" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q28" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q28" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q28" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q28" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <a id="q29-anchor"></a>
      <div id="q29-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>29 the types of living creatures that have REM sleep</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q29" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q29" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q29" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q29" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q29" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q29" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q29" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <a id="q30-anchor"></a>
      <div id="q30-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>30 research results linking dreams to psychological well-being</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q30" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q30" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q30" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q30" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q30" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q30" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q30" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <a id="q31-anchor"></a>
      <div id="q31-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>31 an account of how modern research tools have strengthened Freud's theory</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q31" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q31" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q31" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q31" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q31" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q31" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q31" type="radio" value="G"> G</label>
        </div>
      </div>
    </div>
    
    <div class="group">
      <h4>Questions 32–35</h4>
      <p>Choose the correct letter, A, B, C or D.</p>
      <p>Write the correct letter in boxes 32–35 on your answer sheet.</p>
      
      <a id="q32-anchor"></a>
      <div id="q32-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>32 In ancient times, people thought that dreams</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q32" type="radio" value="A"> A sent messages to the gods.</label>
          <label style="margin:0;"><input name="q32" type="radio" value="B"> B helped resolve conflict.</label>
          <label style="margin:0;"><input name="q32" type="radio" value="C"> C were a sign of physical illness.</label>
          <label style="margin:0;"><input name="q32" type="radio" value="D"> D predicted future events.</label>
        </div>
      </div>
      
      <a id="q33-anchor"></a>
      <div id="q33-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>33 According to the passage, which of the following happens during REM sleep?</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q33" type="radio" value="A"> A People rarely dream.</label>
          <label style="margin:0;"><input name="q33" type="radio" value="B"> B People's dreams become confused.</label>
          <label style="margin:0;"><input name="q33" type="radio" value="C"> C The temperature of the brain increases.</label>
          <label style="margin:0;"><input name="q33" type="radio" value="D"> D The brain behaves differently than when you are awake.</label>
        </div>
      </div>
      
      <a id="q34-anchor"></a>
      <div id="q34-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>34 What explanation is suggested in paragraph E for lack of a clear narrative in dreams?</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q34" type="radio" value="A"> A Some dreams occur in non-REM sleep.</label>
          <label style="margin:0;"><input name="q34" type="radio" value="B"> B Some dreams are generated in different areas of the brain.</label>
          <label style="margin:0;"><input name="q34" type="radio" value="C"> C The part of the brain in control of reasoning is less involved.</label>
          <label style="margin:0;"><input name="q34" type="radio" value="D"> D The part of the brain responsible for feelings is more involved.</label>
        </div>
      </div>
      
      <a id="q35-anchor"></a>
      <div id="q35-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>35 According to the passage, which area of the brain helps people find solutions to difficult situations through their dreams?</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q35" type="radio" value="A"> A the anterior cingulate cortex</label>
          <label style="margin:0;"><input name="q35" type="radio" value="B"> B the pons</label>
          <label style="margin:0;"><input name="q35" type="radio" value="C"> C the limbic system</label>
          <label style="margin:0;"><input name="q35" type="radio" value="D"> D the prefrontal cortex</label>
        </div>
      </div>
    </div>
    
    <div class="group">
      <h4>Questions 36–40</h4>
      <p>Look at the following statements (Questions 36–40) and the list of people below.</p>
      <p>Match each statement with the correct person or people, A–G.</p>
      <p>Write the correct letter, A–G, in boxes 36–40 on your answer sheet.</p>
      
      <p><strong>List of People</strong></p>
      <ul>
        <li>A Jerry Siegel</li>
        <li>B Allan Hobson and Robert McCarley</li>
        <li>C Mark Solms</li>
        <li>D Eric Nofzinger</li>
        <li>E Deirdre Barrett</li>
        <li>F Clara Hill</li>
        <li>G Rosalind Cartwright</li>
      </ul>
      
      <a id="q36-anchor"></a>
      <div id="q36-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>36 Technology shows there is a link between dreams and the areas of the brain that deal with feelings.</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q36" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q36" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q36" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q36" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q36" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q36" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q36" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <a id="q37-anchor"></a>
      <div id="q37-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>37 Dreams are meaningless pictures created by the brain.</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q37" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q37" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q37" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q37" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q37" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q37" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q37" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <a id="q38-anchor"></a>
      <div id="q38-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>38 Dreaming is a method of calming strong feelings.</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q38" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q38" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q38" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q38" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q38" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q38" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q38" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <a id="q39-anchor"></a>
      <div id="q39-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>39 Our dreams can show us unexpected things about ourselves.</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q39" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q39" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q39" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q39" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q39" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q39" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q39" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <a id="q40-anchor"></a>
      <div id="q40-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>40 Dreams may be a result of maintaining an essential body function.</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label style="margin:0;"><input name="q40" type="radio" value="A"> A</label>
          <label style="margin:0;"><input name="q40" type="radio" value="B"> B</label>
          <label style="margin:0;"><input name="q40" type="radio" value="C"> C</label>
          <label style="margin:0;"><input name="q40" type="radio" value="D"> D</label>
          <label style="margin:0;"><input name="q40" type="radio" value="E"> E</label>
          <label style="margin:0;"><input name="q40" type="radio" value="F"> F</label>
          <label style="margin:0;"><input name="q40" type="radio" value="G"> G</label>
        </div>
      </div>
    </div>
    
    <div style="display:flex;gap:8px;margin-bottom:10px;">
      <button class="primary" onclick="grade()">Submit</button>
      <button onclick="resetForm()">Reset</button>
      <button onclick="toggleNotes()">Notes</button>
    </div>
    <div id="results"></div>
    <details class="answerbox" id="answerBox">
      <summary>Show answers (click to toggle) <span class="badge">hidden</span></summary>
      <div id="answerContent"></div>
    </details>
  </section>
</div>
<div aria-label="Selection tools" id="selbar" role="toolbar">
  <button id="btnHL">Highlight</button>
  <button id="btnUH">Remove</button>
  <button id="btnNote">Note</button>
</div>
<div id="notes">
  <header>
    <strong>Notes</strong>
    <div>
      <button id="btnCopy">Copy</button>
      <button id="btnClose">Close</button>
    </div>
  </header>
  <textarea id="noteArea" placeholder="Type your notes here..."></textarea>
</div>
<div id="toast"></div>
<script>

// Enhanced Timer
let timerSeconds = 0;
let timerInterval = null;
let timerPaused = false;

function startTimer() {
  if (timerInterval) return;
  timerInterval = setInterval(() => {
    if (!timerPaused) {
      timerSeconds++;
      updateTimerDisplay();
    }
  }, 1000);
}

function updateTimerDisplay() {
  const minutes = Math.floor(timerSeconds / 60);
  const seconds = timerSeconds % 60;
  const timerEl = document.getElementById('timer');
  if (timerEl) {
    timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }
}

function toggleTimer() {
  timerPaused = !timerPaused;
  const timerEl = document.getElementById('timer');
  if (timerEl) {
    timerEl.classList.toggle('paused', timerPaused);
  }
  
  if (!timerInterval) {
    startTimer();
  }
  
  showToast(timerPaused ? 'Timer paused' : 'Timer resumed');
}

// Theme functionality
function toggleTheme() {
  const body = document.body;
  const themeButton = document.querySelector('.theme-toggle');
  
  body.classList.toggle('dark');
  const isDark = body.classList.contains('dark');
  
  if (themeButton) {
    themeButton.textContent = isDark ? '☀️' : '🌙';
  }
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  
  showToast(`Switched to ${isDark ? 'dark' : 'light'} theme`);
}

function loadTheme() {
  const savedTheme = localStorage.getItem('theme');
  const body = document.body;
  const themeButton = document.querySelector('.theme-toggle');
  
  if (savedTheme === 'dark') {
    body.classList.add('dark');
    if (themeButton) themeButton.textContent = '☀️';
  } else {
    if (themeButton) themeButton.textContent = '🌙';
  }
}

// Toast notifications
function showToast(message) {
  let toast = document.getElementById('toast');
  if (!toast) {
    toast = document.createElement('div');
    toast.id = 'toast';
    toast.style.cssText = `
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 100px;
      background: #111;
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      display: none;
      z-index: 2500;
      font-weight: 500;
    `;
    document.body.appendChild(toast);
  }
  
  toast.textContent = message;
  toast.style.display = 'block';
  
  setTimeout(() => {
    toast.style.display = 'none';
  }, 2000);
}

// Initialize modern features
function initModernFeatures() {
  loadTheme();
  startTimer();
  
  // Make timer clickable
  const timer = document.getElementById('timer');
  if (timer && !timer.onclick) {
    timer.onclick = toggleTimer;
  }
  
  showToast('Modern features loaded');
}

// Auto-initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initModernFeatures);
} else {
  initModernFeatures();
}

// Drag divider
var divider = document.getElementById('divider');
var left = document.getElementById('left');
var right = document.getElementById('right');
var dragging=false;
function startDrag(e){ 
  dragging=true; 
  document.body.style.cursor='ew-resize'; 
  if(e.preventDefault) e.preventDefault(); 
}
function endDrag(){ 
  dragging=false; 
  document.body.style.cursor=''; 
}
function onMove(clientX){
  var container = document.querySelector('.shell').getBoundingClientRect();
  var x = clientX - container.left;
  x = Math.max(280, Math.min(container.width-320, x));
  left.style.flex = '0 0 ' + x + 'px';
  right.style.flex = '1 1 auto';
}
divider.addEventListener('mousedown', function(e){ startDrag(e); });
window.addEventListener('mousemove', function(e){ if(dragging) onMove(e.clientX); });
window.addEventListener('mouseup', endDrag);
divider.addEventListener('touchstart', function(e){ startDrag(e.touches[0]); }, {passive:false});
window.addEventListener('touchmove', function(e){ if(dragging) onMove(e.touches[0].clientX); }, {passive:false});
window.addEventListener('touchend', endDrag);
</script>
<script>
// Highlight toolbar
var selbar = document.getElementById('selbar');
var btnHL = document.getElementById('btnHL');
var btnUH = document.getElementById('btnUH');
var btnNote = document.getElementById('btnNote');
var lastRange=null;
var currentHlNode=null;
var keepToolbar=false;
function positionSelbarForRect(rect){
  selbar.style.display='flex';
  requestAnimationFrame(function(){
    var top = window.scrollY + rect.top - selbar.offsetHeight - 8;
    var leftPos = window.scrollX + rect.left + rect.width/2 - selbar.offsetWidth/2;
    selbar.style.top = ((top>0)?top:(window.scrollY + rect.bottom + 8)) + 'px';
    selbar.style.left = Math.max(8, leftPos) + 'px';
  });
}
function updateSelbar(){
  var sel=window.getSelection();
  if(!sel || sel.rangeCount===0 || sel.isCollapsed) { 
    selbar.style.display='none'; 
    currentHlNode=null; 
    return; 
  }
  var range = sel.getRangeAt(0);
  lastRange = range.cloneRange();
  currentHlNode=null;
  positionSelbarForRect(range.getBoundingClientRect());
}
document.getElementById('left').addEventListener('mouseup', updateSelbar);
document.getElementById('right').addEventListener('mouseup', updateSelbar);
document.addEventListener('selectionchange', function(){ 
  var sel=window.getSelection(); 
  if(!sel || sel.rangeCount===0 || sel.isCollapsed){ 
    if(!keepToolbar && !currentHlNode){ 
      selbar.style.display='none'; 
    } 
  } 
});
document.addEventListener('scroll', function(){ 
  if(selbar.style.display==='flex') updateSelbar(); 
});
document.addEventListener('mousedown', function(e){
  var t = e.target;
  if(t.classList && t.classList.contains('hl')){
    keepToolbar = true;
  } else {
    keepToolbar = false;
  }
}, true);
document.addEventListener('click', function(e){
  var target = e.target;
  if(target.classList && target.classList.contains('hl')){
    currentHlNode = target;
    lastRange = null;
    positionSelbarForRect(target.getBoundingClientRect());
    var sel=window.getSelection();
    if(sel) sel.removeAllRanges();
    setTimeout(function(){ keepToolbar=false; }, 0);
  }
}, true);
function doHighlight(){
  if(currentHlNode) return;
  if(!lastRange || lastRange.collapsed) return;
  
  if (lastRange.startContainer === lastRange.endContainer) {
    try {
      const span = document.createElement('span');
      span.className = 'hl';
      lastRange.surroundContents(span);
      selbar.style.display = 'none';
      showToast('Highlighted');
      return;
    } catch (e) {
      // 处理边缘情况
    }
  }
  
  const fragment = lastRange.cloneContents();
  const div = document.createElement('div');
  div.appendChild(fragment);
  
  function processNode(node, parentHighlight) {
    if (node.nodeType === Node.TEXT_NODE) {
      if (node.textContent.trim().length > 0) {
        const span = document.createElement('span');
        span.className = 'hl';
        span.textContent = node.textContent;
        return span;
      }
      return node;
    }
    
    if (node.nodeType === Node.ELEMENT_NODE) {
      const isBlock = window.getComputedStyle(node).display.includes('block') || 
                     ['P', 'H1', 'H2', 'H3', 'H4', 'DIV'].includes(node.tagName);
      
      const wrapper = isBlock ? document.createElement(node.tagName.toLowerCase()) : document.createElement('span');
      wrapper.className = isBlock ? node.className + ' hl' : 'hl';
      
      Array.from(node.attributes).forEach(attr => {
        wrapper.setAttribute(attr.name, attr.value);
      });
      
      while (node.firstChild) {
        const processedChild = processNode(node.firstChild, wrapper);
        wrapper.appendChild(processedChild);
      }
      
      return wrapper;
    }
    
    return node;
  }
  
  const highlightedContent = processNode(div, null);
  
  lastRange.deleteContents();
  lastRange.insertNode(highlightedContent);
  
  selbar.style.display = 'none';
  showToast('Highlighted');
}
function removeHighlight(){
  if(currentHlNode){
    const parent = currentHlNode.parentNode;
    while(currentHlNode.firstChild) {
      parent.insertBefore(currentHlNode.firstChild, currentHlNode);
    }
    parent.removeChild(currentHlNode);
    parent.normalize();
    currentHlNode = null;
    selbar.style.display='none';
    showToast('Highlight removed');
    return;
  }
  
  if(!lastRange) return;
  
  const selRect = lastRange.getBoundingClientRect();
  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
  const toRemove = [];
  
  while(walker.nextNode()){
    const node = walker.currentNode;
    if(node.classList && node.classList.contains('hl')) {
      const rect = node.getBoundingClientRect();
      if(!(rect.right < selRect.left || rect.left > selRect.right || 
          rect.bottom < selRect.top || rect.top > selRect.bottom)) {
        toRemove.push(node);
      }
    }
  }
  
  toRemove.forEach(el => {
    const parent = el.parentNode;
    while(el.firstChild) {
      parent.insertBefore(el.firstChild, el);
    }
    parent.removeChild(el);
    parent.normalize();
  });
  
  selbar.style.display='none';
  showToast('Highlight removed');
}
btnHL.addEventListener('click', doHighlight);
btnUH.addEventListener('click', removeHighlight);
</script>
<script>
// Notes
var notes = document.getElementById('notes');
var noteArea = document.getElementById('noteArea');
var btnCopy=document.getElementById('btnCopy');
var btnClose=document.getElementById('btnClose');
function toggleNotes(){ 
  notes.style.display = (notes.style.display==='flex'?'none':'flex'); 
}
window.toggleNotes = toggleNotes;
btnClose.addEventListener('click', toggleNotes);
btnCopy.addEventListener('click', async function(){ 
  await navigator.clipboard.writeText(noteArea.value||''); 
  showToast('Copied'); 
});
btnNote.addEventListener('click', function(){
  var text = '';
  if(currentHlNode){ 
    text = (currentHlNode.textContent||'').trim(); 
  } else if(lastRange){ 
    var frag = lastRange.cloneContents(); 
    text = (frag.textContent||'').trim(); 
  }
  toggleNotes();
  if(text) {
    noteArea.value = (noteArea.value? noteArea.value+'\n':'') + '> ' + text + '\n';
  }
  selbar.style.display='none';
});
// Toast
var toastEl=document.getElementById('toast');
function showToast(msg){
  toastEl.textContent=msg; 
  toastEl.style.display='block';
  setTimeout(function(){ toastEl.style.display='none'; }, 1200);
}
</script>
<script>
// Answer key and grading
var answers = {
  "q27":"F", "q28":"C", "q29":"B", "q30":"G", "q31":"D",
  "q32":"D", "q33":"C", "q34":"C", "q35":"A",
  "q36":"C", "q37":"B", "q38":"G", "q39":"F", "q40":"A"
};
function grade(){
  var total=0, correct=0, lines=[];
  
  // 检查段落匹配题 (27-31)
  for(let n=27; n<=31; n++){
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✓' : '✗'}`);
  }
  
  // 检查单选题 (32-35)
  for(let n=32; n<=35; n++){
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✓' : '✗'}`);
  }
  
  // 检查人物匹配题 (36-40)
  for(let n=36; n<=40; n++){
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✓' : '✗'}`);
  }
  
  // 显示结果
  const acc = Math.round(100 * correct / total);
  document.getElementById('results').innerHTML = `
    <p><strong>Score:</strong> ${correct}/${total} <span class="badge">Accuracy ${acc}%</span></p>
    <pre>${lines.join('\n')}</pre>
  `;
  
  // 显示答案
  document.getElementById('answerContent').innerHTML = `
    <ol>
      <li>27 → F</li>
      <li>28 → C</li>
      <li>29 → B</li>
      <li>30 → G</li>
      <li>31 → D</li>
      <li>32 → D</li>
      <li>33 → C</li>
      <li>34 → C</li>
      <li>35 → A</li>
      <li>36 → C</li>
      <li>37 → B</li>
      <li>38 → G</li>
      <li>39 → F</li>
      <li>40 → A</li>
    </ol>
  `;
  document.querySelector('#answerBox .badge').textContent = 'tap to view';
}
function resetForm(){
  // 重置单选按钮
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.checked = false;
  });
  
  // 重置结果和答案
  document.getElementById('results').innerHTML = '';
  document.getElementById('answerContent').innerHTML = '';
  document.querySelector('#answerBox .badge').textContent = 'hidden';
  
  // 重置导航栏中的已回答状态
  document.querySelectorAll('.q-item').forEach(item => {
    item.classList.remove('answered');
  });
}
// 滚动到问题锚点
function scrollToElement(id){
  const el = document.getElementById(id);
  if(el){ 
    el.scrollIntoView({behavior:'smooth', block:'center'}); 
  }
  // 短暂高亮导航项
  const navs = document.querySelectorAll('.practice-nav .q-item');
  navs.forEach(n => n.classList.remove('active'));
  const btn = document.getElementById(id.replace('-anchor','-nav'));
  if(btn){ 
    btn.classList.add('active'); 
    setTimeout(() => btn.classList.remove('active'), 800); 
  }
}
// 交互时标记已回答
(function(){
  function markAnswered(qn){
    const nav = document.getElementById(`q${qn}-nav`);
    if(!nav) return;
    let answered = false;
    
    // 检查单选按钮
    const radios = document.querySelectorAll(`input[name="q${qn}"]:checked`);
    answered = radios.length > 0;
    
    if(answered) nav.classList.add('answered');
    else nav.classList.remove('answered');
  }
  
  // 监听单选按钮
  for(let n=27; n<=40; n++){
    document.querySelectorAll(`input[name="q${n}"]`).forEach(radio => {
      radio.addEventListener('change', () => markAnswered(n));
    });
  }
})();
</script>

<script>
// 练习页面增强器 - 跨窗口通信功能
(function() {
    'use strict';
    
    let sessionData = null;
    let parentWindow = null;
    let startTime = Date.now();
    let isSessionActive = false;
    
    // 初始化通信功能
    function initializeCommunication() {
        console.log('[PracticePageEnhancer] 初始化通信功能');
        
        // 监听来自父窗口的消息
        window.addEventListener('message', function(event) {
            console.log('[PracticePageEnhancer] 收到消息:', event.data);
            
            if (event.data && event.data.type === 'INIT_SESSION') {
                sessionData = event.data.data;
                parentWindow = event.source;
                isSessionActive = true;
                startTime = Date.now();
                
                console.log('[PracticePageEnhancer] 会话已初始化:', sessionData);
                
                // 发送会话初始化确认
                sendMessage('SESSION_INITIALIZED', {
                    sessionId: sessionData.sessionId,
                    examId: sessionData.examId,
                    timestamp: Date.now()
                });
                
                // 设置页面关闭时的数据发送
                setupPageUnloadHandler();
            }
        });
        
        // 检测答题完成
        setupAnswerDetection();
        
        console.log('[PracticePageEnhancer] 通信功能已初始化');
    }
    
    // 发送消息到父窗口
    function sendMessage(type, data) {
        if (parentWindow && isSessionActive) {
            const message = {
                type: type,
                data: data,
                source: 'practice_page',
                timestamp: Date.now()
            };
            
            console.log('[PracticePageEnhancer] 发送消息:', message);
            parentWindow.postMessage(message, '*');
        }
    }
    
    // 设置答题检测
    function setupAnswerDetection() {
        // 检测提交按钮点击
        document.addEventListener('click', function(event) {
            const target = event.target;
            
            // 检测是否是提交相关的按钮
            if (target.tagName === 'BUTTON' && 
                (target.textContent.includes('提交') || 
                 target.textContent.includes('Submit') ||
                 target.textContent.includes('完成') ||
                 target.textContent.includes('Check') ||
                 target.id === 'submit-btn' ||
                 target.className.includes('submit'))) {
                
                console.log('[PracticePageEnhancer] 检测到提交按钮点击');
                
                // 延迟收集数据，确保答案已处理
                setTimeout(function() {
                    collectAndSendPracticeData();
                }, 1000);
            }
        });
        
        // 检测表单提交
        document.addEventListener('submit', function(event) {
            console.log('[PracticePageEnhancer] 检测到表单提交');
            setTimeout(function() {
                collectAndSendPracticeData();
            }, 1000);
        });
    }
    
    // 设置页面卸载处理器
    function setupPageUnloadHandler() {
        window.addEventListener('beforeunload', function() {
            if (isSessionActive) {
                collectAndSendPracticeData();
            }
        });
        
        // 页面隐藏时也发送数据
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden' && isSessionActive) {
                collectAndSendPracticeData();
            }
        });
    }
    
    // 收集并发送练习数据
    function collectAndSendPracticeData() {
        if (!isSessionActive || !sessionData) {
            console.log('[PracticePageEnhancer] 会话未激活，跳过数据收集');
            return;
        }
        
        console.log('[PracticePageEnhancer] 开始收集练习数据');
        
        const endTime = Date.now();
        const duration = endTime - startTime;
        
        // 收集答案数据
        const answers = collectAnswers();
        const score = calculateScore(answers);
        
        const practiceData = {
            sessionId: sessionData.sessionId,
            examId: sessionData.examId,
            examTitle: sessionData.examTitle,
            examCategory: sessionData.examCategory,
            startTime: startTime,
            endTime: endTime,
            duration: duration,
            answers: answers,
            score: score.correct,
            totalQuestions: score.total,
            accuracy: score.total > 0 ? score.correct / score.total : 0,
            percentage: score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0,
            url: window.location.href,
            source: 'page_extraction',
            timestamp: endTime
        };
        
        console.log('[PracticePageEnhancer] 练习数据已收集:', practiceData);
        
        // 发送练习完成数据
        sendMessage('PRACTICE_COMPLETE', practiceData);
        
        // 标记会话为非活跃状态，避免重复发送
        isSessionActive = false;
    }
    
    // 收集页面中的答案
    function collectAnswers() {
        const answers = [];
        
        // 收集输入框答案
        const inputs = document.querySelectorAll('input[type="text"], input.blank, input.blank-input');
        inputs.forEach(function(input, index) {
            if (input.value.trim()) {
                answers.push({
                    type: 'text',
                    question: index + 1,
                    answer: input.value.trim(),
                    element: input.tagName + (input.className ? '.' + input.className : '')
                });
            }
        });
        
        // 收集选择题答案
        const selects = document.querySelectorAll('select');
        selects.forEach(function(select, index) {
            if (select.value) {
                answers.push({
                    type: 'select',
                    question: index + 1,
                    answer: select.value,
                    element: 'SELECT'
                });
            }
        });
        
        // 收集单选按钮答案
        const radios = document.querySelectorAll('input[type="radio"]:checked');
        radios.forEach(function(radio, index) {
            answers.push({
                type: 'radio',
                question: radio.name || index + 1,
                answer: radio.value,
                element: 'INPUT[type="radio"]'
            });
        });
        
        // 收集复选框答案
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        checkboxes.forEach(function(checkbox, index) {
            answers.push({
                type: 'checkbox',
                question: checkbox.name || index + 1,
                answer: checkbox.value,
                element: 'INPUT[type="checkbox"]'
            });
        });
        
        console.log('[PracticePageEnhancer] 收集到答案:', answers);
        return answers;
    }
    
    // 计算得分（简单实现）
    function calculateScore(answers) {
        // 这里只是简单计算有答案的题目数量
        // 实际得分需要根据具体题目的正确答案来计算
        const total = answers.length;
        const correct = answers.filter(function(answer) {
            return answer.answer && answer.answer.trim().length > 0;
        }).length;
        
        return {
            correct: correct,
            total: total
        };
    }
    
    // 页面加载完成后初始化
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeCommunication);
    } else {
        initializeCommunication();
    }
    
})();
</script><script>
// 全面修复的JavaScript功能
(function() {
  // 防止重复加载
  if (window.comprehensiveFixLoaded) return;
  window.comprehensiveFixLoaded = true;
  
  console.log('Loading comprehensive P3 fixes...');
  
  // 计时器变量
  let timerSeconds = 0;
  let timerInterval = null;
  let timerPaused = false;
  
  // 强制覆盖计时器函数
  window.startTimer = function() {
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      if (!timerPaused) {
        timerSeconds++;
        updateTimerDisplay();
      }
    }, 1000);
    console.log('Timer started');
  };
  
  window.updateTimerDisplay = function() {
    const minutes = Math.floor(timerSeconds / 60);
    const seconds = timerSeconds % 60;
    const timerEl = document.getElementById('timer');
    if (timerEl) {
      timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
  };
  
  window.toggleTimer = function() {
    timerPaused = !timerPaused;
    const timerEl = document.getElementById('timer');
    if (timerEl) {
      timerEl.classList.toggle('paused', timerPaused);
      timerEl.style.background = timerPaused ? '#fef3c7' : '';
      timerEl.style.color = timerPaused ? '#92400e' : '';
    }
    
    if (!timerInterval) {
      window.startTimer();
    }
    
    showToast(timerPaused ? 'Timer paused ⏸️' : 'Timer resumed ▶️');
  };
  
  // 强制覆盖主题切换函数
  window.toggleTheme = function() {
    const body = document.body;
    const themeButton = document.querySelector('.theme-toggle');
    
    body.classList.toggle('dark');
    const isDark = body.classList.contains('dark');
    
    if (themeButton) {
      themeButton.textContent = isDark ? '☀️' : '🌙';
    }
    
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    showToast(`Switched to ${isDark ? 'dark' : 'light'} theme`);
    
    console.log('Theme toggled to:', isDark ? 'dark' : 'light');
  };
  
  window.loadTheme = function() {
    const savedTheme = localStorage.getItem('theme');
    const body = document.body;
    const themeButton = document.querySelector('.theme-toggle');
    
    if (savedTheme === 'dark') {
      body.classList.add('dark');
      if (themeButton) themeButton.textContent = '☀️';
    } else {
      body.classList.remove('dark');
      if (themeButton) themeButton.textContent = '🌙';
    }
    
    console.log('Theme loaded:', savedTheme || 'light');
  };
  
  // Toast通知系统
  window.showToast = function(message) {
    let toast = document.getElementById('toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast';
      toast.style.cssText = `
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        bottom: 100px;
        background: #111;
        color: #fff;
        padding: 12px 20px;
        border-radius: 8px;
        display: none;
        z-index: 2500;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      `;
      document.body.appendChild(toast);
    }
    
    toast.textContent = message;
    toast.style.display = 'block';
    
    setTimeout(() => {
      toast.style.display = 'none';
    }, 2500);
  };
  
  // 高亮功能修复
  window.doHighlight = function(color) {
    const selection = window.getSelection();
    if (selection.rangeCount > 0) {
      const range = selection.getRangeAt(0);
      const span = document.createElement('span');
      span.className = 'hl';
      span.style.backgroundColor = color || '#fbbf24';
      span.style.color = document.body.classList.contains('dark') ? '#1f2937' : 'inherit';
      
      try {
        range.surroundContents(span);
        selection.removeAllRanges();
        showToast('Text highlighted');
      } catch (e) {
        console.log('Highlight failed:', e);
      }
    }
  };
  
  window.removeHighlight = function() {
    const highlights = document.querySelectorAll('.hl');
    highlights.forEach(hl => {
      const parent = hl.parentNode;
      parent.insertBefore(document.createTextNode(hl.textContent), hl);
      parent.removeChild(hl);
    });
    showToast('Highlights removed');
  };
  
  // 笔记功能修复
  window.toggleNotes = function() {
    const notes = document.getElementById('notes');
    if (notes) {
      const isVisible = notes.style.display !== 'none';
      notes.style.display = isVisible ? 'none' : 'block';
      showToast(isVisible ? 'Notes hidden' : 'Notes shown');
    }
  };
  
  // 滚动到元素
  window.scrollToElement = function(id) {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      showToast(`Scrolled to question ${id.replace('q', '')}`);
    }
  };
  
  // 答案状态更新
  window.updateAnswerStatus = function() {
    const questions = document.querySelectorAll('[id^="q"]');
    questions.forEach(q => {
      const qNum = q.id.replace('q', '');
      const navItem = document.querySelector(`.q-item[onclick*="q${qNum}"]`);
      if (navItem) {
        const hasAnswer = q.querySelector('input:checked, input.blank[value!=""]');
        navItem.classList.toggle('answered', !!hasAnswer);
      }
    });
  };
  
  // 表单重置
  window.resetForm = function() {
    const form = document.querySelector('form');
    if (form) {
      form.reset();
      document.querySelectorAll('.hl').forEach(hl => {
        const parent = hl.parentNode;
        parent.insertBefore(document.createTextNode(hl.textContent), hl);
        parent.removeChild(hl);
      });
      updateAnswerStatus();
      showToast('Form reset');
    }
  };
  
  // 初始化函数
  function initComprehensiveFixes() {
    console.log('Initializing comprehensive fixes...');
    
    // 加载主题
    loadTheme();
    
    // 启动计时器
    startTimer();
    
    // 绑定计时器点击事件
    const timer = document.getElementById('timer');
    if (timer) {
      timer.onclick = toggleTimer;
      timer.style.cursor = 'pointer';
      timer.title = 'Click to pause/resume timer';
    }
    
    // 绑定主题切换按钮
    const themeButton = document.querySelector('.theme-toggle');
    if (themeButton) {
      themeButton.onclick = toggleTheme;
      themeButton.title = 'Toggle dark/light theme';
    }
    
    // 绑定答案变化监听
    document.addEventListener('change', updateAnswerStatus);
    document.addEventListener('input', updateAnswerStatus);
    
    // 绑定高亮选择事件
    document.addEventListener('mouseup', function() {
      const selection = window.getSelection();
      if (selection.toString().length > 0) {
        // 可以在这里添加高亮工具栏显示逻辑
      }
    });
    
    // 初始化答案状态
    setTimeout(updateAnswerStatus, 500);
    
    showToast('All features loaded successfully! ✅');
    console.log('Comprehensive fixes initialized successfully');
  }
  
  // 页面加载完成后初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initComprehensiveFixes);
  } else {
    initComprehensiveFixes();
  }
  
})();
</script>
</body>
</html>
