<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>P3 – Humanities and the health professional</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
  :root { --line:#e5e7eb; --bg:#f6f7fb; --panel:#fff; --accent:#3b82f6; --muted:#6b7280; --shadow:0 6px 20px rgba(0,0,0,.12); }
  
    --line: #374151;
    --bg: #111827;
    --panel: #1f2937;
    --accent: #60a5fa;
    --muted: #9ca3af;
    --shadow: 0 6px 20px rgba(0,0,0,.3);
  }
  
  body {
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  
  
  
    color: #f9fafb;
  }
  
  
    background: var(--panel);
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: #374151;
    border-color: var(--accent);
  }
  
  
    background: #1e40af;
    color: #93c5fd;
  }
  
  
    background: var(--panel);
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: #374151;
    border-color: var(--accent);
  }
  
  
    background: var(--accent);
    color: white;
  }
  
  
    background: var(--panel);
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    border-color: var(--line);
    color: #f9fafb;
  }
  
  
    background: #fbbf24;
    color: #1f2937;
  }
  
  
    background: #374151;
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    border-color: var(--line);
    color: #f9fafb;
  }
  
  
    background: #374151;
  }
  
  
    background: var(--panel);
    border-color: var(--line);
  }
  
  
    color: #f9fafb;
    border-color: var(--line);
  }
  
  
    background: var(--panel);
    color: #f9fafb;
  }
  
  /* Timer enhancements */
  #timer {
    cursor: pointer !important;
    transition: all 0.2s ease;
    user-select: none;
  }
  
  #timer:hover {
    background: #f8fafc;
    border-color: var(--accent);
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
  }
  
  
    background: #1e293b;
    color: #e2e8f0;
    border-color: #334155;
  }
  
  
    background: #334155;
    border-color: var(--accent);
  }
  
  #timer.paused {
    background: #fef3c7 !important;
    color: #92400e !important;
    border-color: #f59e0b !important;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }
  
  /* Controls layout */
  .practice-nav .controls {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  /* Theme toggle button */
  .theme-toggle {
    border: none;
    cursor: pointer;
    background: transparent;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.2s ease;
  }
  
  .theme-toggle:hover {
    background: var(--accent);
    color: #fff;
    transform: scale(1.05);
  }
  
  .theme-toggle:active {
    transform: scale(0.95);
  }

  * { box-sizing: border-box; }
  html,body { height:100%; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); }
  #timer { position: static; display: inline-block; margin-left: 8px; background:#fff; border:1px solid var(--line); border-radius:10px; padding:2px 8px; font-size:14px; vertical-align: middle; }
  .shell { display:flex; height:100vh; width:100%; }
  .pane { background:var(--panel); overflow:auto; padding:20px; }
  #left { flex: 0 0 50%; min-width: 280px; }
  #right { flex: 1 1 auto; min-width: 320px; background:#fbfbff; border-left:1px solid var(--line); }
  #divider { flex: 0 0 8px; background: linear-gradient(90deg,#e5e7eb,#d1d5db); cursor: ew-resize; position:relative; z-index: 5; user-select:none; }
  h2,h3,h4 { margin:0 0 10px; }
  #left p { margin: 0 0 12px; line-height: 1.6; word-break: normal; overflow-wrap: normal; hyphens: none; }
  .group { background:#fff; border:1px solid var(--line); border-radius:10px; padding:12px; margin-bottom:14px; }
  table { border-collapse: collapse; width:100%; }
  th, td { border:1px solid var(--line); padding:6px; text-align:center; font-size:14px; }
  th:first-child, td:first-child { width:92px; }
  button { padding:8px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; cursor:pointer; }
  button.primary { background:var(--accent); color:#fff; border-color:#3b82f6; }
  #results { background:#fff; border:1px solid var(--line); border-radius:10px; padding:10px; }
  .hl { background:#fff3a3; box-shadow: inset 0 -2px 0 rgba(0,0,0,.05); cursor: pointer; }
  .hl:hover { filter: brightness(0.98); }
  #selbar { position: absolute; display:none; z-index: 2000; background:#111; color:#fff; border-radius: 8px; padding: 6px; box-shadow: var(--shadow); font-size: 13px; gap:6px; align-items: center; }
  #selbar button { background: transparent; color:#fff; border: 1px solid rgba(255,255,255,.25); padding: 4px 8px; border-radius: 6px; cursor:pointer; }
  #selbar button:hover { border-color:#fff; }
  #notes { position: fixed; right: 12px; bottom: 12px; width: 320px; height: 42vh; background:#fff; border:1px solid var(--line); border-radius: 12px; display:none; flex-direction: column; z-index:1500; box-shadow: var(--shadow); }
  #notes header { display:flex; align-items:center; justify-content: space-between; padding:8px 10px; border-bottom:1px solid var(--line); }
  #notes textarea { flex:1; border:0; padding:10px; resize:none; font-size:14px; line-height:1.5; }
  #toast { position: fixed; left:50%; transform: translateX(-50%); bottom: 24px; background:#111; color:#fff; padding:8px 12px; border-radius: 8px; display:none; z-index:2500; }
  .dropzone { border:2px dashed #cbd5e1; background:#f8fafc; border-radius:10px; min-height:40px; padding:4px 8px; display:inline-flex; align-items:center; justify-content:space-between; gap:8px; width: auto; min-width: 120px; max-width: 200px; vertical-align: middle; }
  .droplabel { color:#64748b; font-size:14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .cardpool { background:#f1f5f9; border-radius:10px; padding:12px; display:flex; flex-wrap:wrap; gap:8px; }
  .pool-slot { min-height:40px; }
  .card { background:#fff; border:1px solid #e5e7eb; border-radius:8px; padding:8px 10px; display:inline-flex; gap:8px; align-items:center; cursor:grab; box-shadow:0 1px 0 rgba(0,0,0,.03); white-space: nowrap; }
  .card:active { cursor:grabbing; }
  .tag { background:#eef2ff; color:#4338ca; padding:2px 8px; border-radius:999px; font-size:12px; }
  .btn-clear { border:1px solid #e5e7eb; background:#fff; border-radius:8px; padding:6px 8px; cursor:pointer; }
  .ghost { opacity: .5; }
  .over { outline:2px dashed #3b82f6; }
  details.answerbox summary { cursor: pointer; user-select:none; list-style: none; }
  details.answerbox { border:1px dashed var(--line); border-radius:10px; padding:8px 10px; background:#fff; }
  .badge { display:inline-block; background:#eef2ff; color:#4338ca; padding:2px 8px; border-radius:999px; font-size:12px; margin-left:6px; }
  body { padding-bottom: 82px; }
  .practice-nav { background:#fff; border-bottom:2px solid var(--line); padding:12px 20px; display:flex; align-items:center; gap:20px; box-shadow:0 2px 4px rgba(0,0,0,.05); flex-wrap:wrap; position:fixed; left:0; right:0; bottom:0; border-top:2px solid var(--line); border-bottom:0; z-index:4000; }
  .practice-nav .title { font-weight:600; color:var(--muted); }
  .practice-nav .questions { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .practice-nav .q-item { padding:6px 10px; border:1px solid var(--line); border-radius:6px; background:#fff; cursor:pointer; font-size:14px; transition:all 0.2s; min-width:36px; text-align:center; }
  .practice-nav .q-item:hover { background:#f1f5f9; border-color:var(--accent); }
  .practice-nav .q-item.answered { background:#e0e7ff; border-color:var(--accent); color:var(--accent); font-weight:500; }
  .practice-nav .q-item.active { background:var(--accent); color:#fff; border-color:var(--accent); }
  #selbar { z-index: 6000 !important; }

/* 强力黑暗模式修复 - 使用!important确保优先级 */
body.dark {
  background: #111827 !important;
  color: #f9fafb !important;
}

body.dark * {
  border-color: #374151 !important;
}

body.dark .shell {
  background: #111827 !important;
}

body.dark .pane {
  background: #1f2937 !important;
  color: #f9fafb !important;
}

body.dark #left {
  background: #1f2937 !important;
}

body.dark #right {
  background: #1f2937 !important;
}

body.dark h1, body.dark h2, body.dark h3, body.dark h4, body.dark h5, body.dark h6 {
  color: #f9fafb !important;
}

body.dark p, body.dark li, body.dark td, body.dark th, body.dark label, body.dark span, body.dark div {
  color: #e5e7eb !important;
}

body.dark .group {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
  color: #f9fafb !important;
}

body.dark button {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark button:hover {
  background: #4b5563 !important;
  border-color: #60a5fa !important;
}

body.dark button.primary {
  background: #3b82f6 !important;
  color: white !important;
}

body.dark #results {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

body.dark details.answerbox {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
  color: #f9fafb !important;
}

body.dark details.answerbox summary {
  color: #f9fafb !important;
}

body.dark .practice-nav {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
}

body.dark .practice-nav .q-item {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark .practice-nav .q-item:hover {
  background: #4b5563 !important;
  border-color: #60a5fa !important;
}

body.dark .practice-nav .q-item.answered {
  background: #1e40af !important;
  color: #93c5fd !important;
}

body.dark .practice-nav .q-item.active {
  background: #3b82f6 !important;
  color: white !important;
}

body.dark #timer {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark #timer:hover {
  background: #4b5563 !important;
  border-color: #60a5fa !important;
}

body.dark .dropzone {
  background: #374151 !important;
  border: 2px dashed #4b5563 !important;
  color: #f9fafb !important;
}

body.dark .card {
  background: #374151 !important;
  border: 1px solid #4b5563 !important;
  color: #f9fafb !important;
}

body.dark .cardpool {
  background: #4b5563 !important;
}

body.dark .hl {
  background: #fbbf24 !important;
  color: #1f2937 !important;
}

body.dark input[type="radio"] {
  accent-color: #60a5fa !important;
}

body.dark input.blank {
  color: #f9fafb !important;
  border-bottom: 2px solid #4b5563 !important;
  background: transparent !important;
}

body.dark input.blank:focus {
  border-bottom-color: #60a5fa !important;
}

body.dark #notes {
  background: #1f2937 !important;
  border: 1px solid #374151 !important;
}

body.dark #notes header {
  color: #f9fafb !important;
  border-bottom: 1px solid #374151 !important;
}

body.dark #notes textarea {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

body.dark table {
  border-color: #374151 !important;
}

body.dark th, body.dark td {
  border-color: #374151 !important;
  color: #e5e7eb !important;
}

body.dark #divider {
  background: linear-gradient(90deg, #374151, #4b5563) !important;
}

/* 修复选择器和其他元素 */
body.dark select, body.dark option {
  background: #374151 !important;
  color: #f9fafb !important;
  border: 1px solid #4b5563 !important;
}

body.dark textarea {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

body.dark input[type="text"], body.dark input[type="number"] {
  background: #1f2937 !important;
  color: #f9fafb !important;
  border: 1px solid #374151 !important;
}

</style>
</head>
<body>
<div class="practice-nav">
  <div class="title">Questions</div>
  <div class="questions">
    <div class="q-item" id="q27-nav" onclick="scrollToElement('q27-anchor')">27</div>
    <div class="q-item" id="q28-nav" onclick="scrollToElement('q28-anchor')">28</div>
    <div class="q-item" id="q29-nav" onclick="scrollToElement('q29-anchor')">29</div>
    <div class="q-item" id="q30-nav" onclick="scrollToElement('q30-anchor')">30</div>
    <div class="q-item" id="q31-nav" onclick="scrollToElement('q31-anchor')">31</div>
    <div class="q-item" id="q32-nav" onclick="scrollToElement('q32-anchor')">32</div>
    <div class="q-item" id="q33-nav" onclick="scrollToElement('q33-anchor')">33</div>
    <div class="q-item" id="q34-nav" onclick="scrollToElement('q34-anchor')">34</div>
    <div class="q-item" id="q35-nav" onclick="scrollToElement('q35-anchor')">35</div>
    <div class="q-item" id="q36-nav" onclick="scrollToElement('q36-anchor')">36</div>
    <div class="q-item" id="q37-nav" onclick="scrollToElement('q37-anchor')">37</div>
    <div class="q-item" id="q38-nav" onclick="scrollToElement('q38-anchor')">38</div>
    <div class="q-item" id="q39-nav" onclick="scrollToElement('q39-anchor')">39</div>
    <div class="q-item" id="q40-nav" onclick="scrollToElement('q40-anchor')">40</div>
  </div>
  <div class="controls">
    <span id="timer" onclick="toggleTimer()">00:00</span>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">🌙</button>
  </div>
</div>
<div class="shell">
<section class="pane" id="left">
  <h2>READING PASSAGE 3 <span id="timer">00:00</span></h2>
  <p>You should spend about 20 minutes on Questions 27–40, which are based on Reading Passage 3 below.</p>
  <h3>Humanities and the health professional</h3>
  <p>Professor Jock Murray from Dalhousie Medical School in Canada writes about the role of humanities in the education of health professionals</p>
  
  <p>In a recent meeting with health professionals from many disciplines, the concept of the humanities and how they enrich the lives and practice of physicians was discussed. There were nurses, chiropractors, speech therapists, health administrators and professionals from a dozen other fields. Everyone commented on the need to achieve a balance between the humanities and the skills and technological expertise of their specific discipline, beginning with the experience in medical school and then life in their chosen specialisation, to create fully realised professionals. The purpose of my discussion here is to advocate a balanced approach to the education of all health professionals.</p>
  
  <p>I believe that most people wish to see in their medical professional a person who not only brings excellent skills, techniques and treatments, but also personal qualities that show they are fully developed individuals. Such individuals are sensitive, communicative, and understanding of the human condition. They acknowledge the vast array of backgrounds, views, fears and hopes each person brings to the clinical encounter.</p>
  
  <p>The training of health professionals has usually been exemplary in teaching them to recognise and treat a symptom or disease, but often less attentive to the broad education that would inform and educate them about the persons who come from various cultures, backgrounds and experiences. Such understanding does not come from the course textbooks but from literature, history, poetry, art and other aspects of the humanities.</p>
  
  <p>There are two sides to the healing profession, once described as the art and the science of medical practice. It is evident, however, that most educational programmes emphasise knowledge, clinical skill and competence, and although educators wish the person to be humanistic, empathetic and communicative, they take this aspect for granted, as if valuable educational time does not need to be allocated to this ‘soft’ feature of the profession. It is compounded by the recognition that this aspect is harder to define and measure than knowledge and competence. We may want the health professional to understand many elements of the human condition so they can understand, assess and manage the suffering of patients, but it is harder to design and teach such a course than one on anatomy, for example. Developing a humanities programme in professional education refocuses attention on what everyone recognises as important. Rather than take humanities education for granted, it becomes a direct part of the programme. This signals that the school takes it seriously and encourages activities related to the broad area of the humanities.</p>
  
  <p>Distinguished by their focus on human values, the humanities cover many areas, including history, ethics, literature, theology, art, music, law and the social sciences as they apply to the profession. For example, a history of the profession gives us an understanding of how we have come to be where we are, and how things change and progress. Literature can teach us about human hopes and aspirations, suffering and loss, relationships, and life and death. Emphasis on human values is important in this day and age as we are increasingly at risk of being overwhelmed by more emotionless technology and complex bureaucracy.</p>
  
  <p>In medical education during the 18th and 19th centuries, there was an emphasis on the humanities. As time went on, encouraged by increasing interest in medical sciences, laboratory experiments and technological aspects of the profession, emphasis in medical studies was weighted towards courses in the sciences. The Flexner Report in 1910 recognised the variable quality of medical education and the need to have better teaching in the medical sciences and laboratory methods. This resulted in a pendulum swing in emphasis, directing the curriculum to the medical sciences, to the exclusion of the humanities, an imbalance never intended by Flexner.</p>
  
  <p>Currently at Dalhousie Medical School we have elective programmes in the humanities, summer research studentships, lecture series, presentations and discussions. There is an artist-in-residence programme that brings artists to the school. There is a large choir of over a hundred students and faculty, a concert band, a string ensemble, and groups of student artists who put on regular performances and exhibitions. The list of activities is much longer, but it should be pointed out that these provide some balance and broaden the life and learning of the student.</p>
  
  <p>Perhaps more important than the activities themselves is the change in mind-set that occurs when students see that diversity in their studies and activities is legitimised and encouraged. We emphasise that we want students and faculty to continue to express interests and talents they had before entering medical school. They now come forward with ideas and activities that are more imaginative and exciting than we could have designed. They also comment that the humanities has made medical school a more enjoyable and fulfilling experience. Students see that their learning and their lives can be more balanced, making them better equipped to care for their patients.</p>
  
  <p>Will involvement in the humanities make one a better health professional? It’s a question often asked of today’s medical professionals but very difficult to document in this evidence-based era of medicine. But as ethics scholars have said of learning ethics, it cannot guarantee that a person will be more ethical, but it is more likely than not. My firm belief is that all the healing professions should increase the balance of humanities with the traditional educational emphasis on skills and knowledge, and this will benefit both the healers and those who need to be healed.</p>
  
  <p>&nbsp;</p> <!-- 新增空白行防止加载不完全 -->
  <p>&nbsp;</p> <!-- 额外增加一行空白行确保加载完整 -->
</section>
<div id="divider" title="Drag to resize"></div>
<section class="pane" id="right">
  <h3>Questions</h3>
  
  <!-- Questions 27-31: YES/NO/NOT GIVEN -->
  <div class="group">
    <h4>Questions 27–31</h4>
    <p>Do the following statements agree with the claims of the writer in Reading Passage 3?</p>
    <p>In boxes 27–31 on your answer sheet, write</p>
    <ul>
      <li>YES if the statement agrees with the claims of the writer</li>
      <li>NO if the statement contradicts the claims of the writer</li>
      <li>NOT GIVEN if it is impossible to say what the writer thinks about this</li>
    </ul>
    
    <a id="q27-anchor"></a>
    <div id="q27-section" style="padding:8px 0;border-top:1px dashed var(--line);">
      <p>27 An approach that incorporates the humanities is more important for some medical disciplines than others.</p>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
        <label style="margin:0;"><input name="q27" type="radio" value="YES"> YES</label>
        <label style="margin:0;"><input name="q27" type="radio" value="NO"> NO</label>
        <label style="margin:0;"><input name="q27" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
      </div>
    </div>
    
    <a id="q28-anchor"></a>
    <div id="q28-section" style="padding:8px 0;border-top:1px dashed var(--line);">
      <p>28 Most people value medical expertise over sensitivity in their medical professionals.</p>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
        <label style="margin:0;"><input name="q28" type="radio" value="YES"> YES</label>
        <label style="margin:0;"><input name="q28" type="radio" value="NO"> NO</label>
        <label style="margin:0;"><input name="q28" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
      </div>
    </div>
    
    <a id="q29-anchor"></a>
    <div id="q29-section" style="padding:8px 0;border-top:1px dashed var(--line);">
      <p>29 Most medical programmes devote little course time to developing interpersonal skills.</p>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
        <label style="margin:0;"><input name="q29" type="radio" value="YES"> YES</label>
        <label style="margin:0;"><input name="q29" type="radio" value="NO"> NO</label>
        <label style="margin:0;"><input name="q29" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
      </div>
    </div>
    
    <a id="q30-anchor"></a>
    <div id="q30-section" style="padding:8px 0;border-top:1px dashed var(--line);">
      <p>30 It is more difficult to design a humanities course for health professionals than a medical one.</p>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
        <label style="margin:0;"><input name="q30" type="radio" value="YES"> YES</label>
        <label style="margin:0;"><input name="q30" type="radio" value="NO"> NO</label>
        <label style="margin:0;"><input name="q30" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
      </div>
    </div>
    
    <a id="q31-anchor"></a>
    <div id="q31-section" style="padding:8px 0;border-top:1px dashed var(--line);">
      <p>31 It would be best if a medical programme included a course about the lives of medical professionals.</p>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
        <label style="margin:0;"><input name="q31" type="radio" value="YES"> YES</label>
        <label style="margin:0;"><input name="q31" type="radio" value="NO"> NO</label>
        <label style="margin:0;"><input name="q31" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
      </div>
    </div>
  </div>
  
  <!-- Questions 32-35: Multiple Choice -->
  <div class="group">
    <h4>Questions 32–35</h4>
    <p>Choose the correct letter, A, B, C or D.</p>
    <p>Write the correct letter in boxes 32–35 on your answer sheet.</p>
    
    <a id="q32-anchor"></a>
    <div id="q32-section" style="padding:8px 0;border-top:1px dashed var(--line);">
      <p>32 What unforeseen result did the Flexner report have?</p>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
        <label style="margin:0;"><input name="q32" type="radio" value="A"> A It caused the public to distrust the quality of medical education.</label>
        <label style="margin:0;"><input name="q32" type="radio" value="B"> B It caused a dramatic increase in medical-school applicants.</label>
        <label style="margin:0;"><input name="q32" type="radio" value="C"> C It started a fierce debate over proper laboratory methods.</label>
        <label style="margin:0;"><input name="q32" type="radio" value="D"> D It moved the focus of medical studies away from the humanities.</label>
      </div>
    </div>
    
    <a id="q33-anchor"></a>
    <div id="q33-section" style="padding:8px 0;border-top:1px dashed var(--line);">
      <p>33 The writer lists humanities activities at Dalhousie Medical School to show how these activities</p>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
        <label style="margin:0;"><input name="q33" type="radio" value="A"> A have become the most popular events on campus.</label>
        <label style="margin:0;"><input name="q33" type="radio" value="B"> B widen students’ educational experiences.</label>
        <label style="margin:0;"><input name="q33" type="radio" value="C"> C are of as high a quality as medical ones.</label>
        <label style="margin:0;"><input name="q33" type="radio" value="D"> D have gained acceptance with teaching staff.</label>
      </div>
    </div>
    
    <a id="q34-anchor"></a>
    <div id="q34-section" style="padding:8px 0;border-top:1px dashed var(--line);">
      <p>34 How do students at Dalhousie Medical School react to humanities activities?</p>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
        <label style="margin:0;"><input name="q34" type="radio" value="A"> A They have difficulty letting go of the mind-set that scientific knowledge is more legitimate.</label>
        <label style="margin:0;"><input name="q34" type="radio" value="B"> B They report feeling that medical school has become more engaging and satisfying.</label>
        <label style="margin:0;"><input name="q34" type="radio" value="C"> C They have started to transfer creative ideas to their scientific and laboratory studies.</label>
        <label style="margin:0;"><input name="q34" type="radio" value="D"> D They have trouble connecting to talents they had valued before entering medical school.</label>
      </div>
    </div>
    
    <a id="q35-anchor"></a>
    <div id="q35-section" style="padding:8px 0;border-top:1px dashed var(--line);">
      <p>35 What is the writer’s main conclusion?</p>
      <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
        <label style="margin:0;"><input name="q35" type="radio" value="A"> A Greater emphasis on humanities in medical schools will benefit both patients and practitioners.</label>
        <label style="margin:0;"><input name="q35" type="radio" value="B"> B Medical schools are not adequately preparing students to become balanced medical professionals.</label>
        <label style="margin:0;"><input name="q35" type="radio" value="C"> C Creating a humanities programme in a medical school is an overwhelmingly difficult but necessary task.</label>
        <label style="margin:0;"><input name="q35" type="radio" value="D"> D Medical schools should return to the early-twentieth-century model of medical education.</label>
      </div>
    </div>
  </div>
  
  <!-- Questions 36-40: Sentence Completion Matching -->
  <div class="group">
    <h4>Questions 36–40</h4>
    <p>Complete each sentence with the correct ending, A–G, below.</p>
    <p>Write the correct letter, A–G, in boxes 36–40 on your answer sheet.</p>
    
    <p><strong>List of Endings</strong></p>
    <ul>
      <li>A generate innovative and creative suggestions for activities and programmes.</li>
      <li>B are difficult to describe with any precision.</li>
      <li>C find it difficult to prove statistically the benefits of humanities programmes.</li>
      <li>D suggest that humanities studies create stronger practitioners.</li>
      <li>E rely on course textbooks to teach humanities.</li>
      <li>F give less attention to broad education and more to recognising and treating symptoms.</li>
      <li>G provide more equal coverage of both medical knowledge and skills, and humanities.</li>
    </ul>
    
    <div style="margin-top:10px;">
      <a id="q36-anchor"></a>
      <div id="q36-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>36 Health professionals at a recent seminar discussed a need for educational institutions to</p>
        <div class="cardpool" style="margin-top:8px;">
          <div class="dropzone" data-target="q36"><span class="droplabel">Drag answer here</span></div>
        </div>
      </div>
      
      <a id="q37-anchor"></a>
      <div id="q37-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>37 Most medical training programmes</p>
        <div class="cardpool" style="margin-top:8px;">
          <div class="dropzone" data-target="q37"><span class="droplabel">Drag answer here</span></div>
        </div>
      </div>
      
      <a id="q38-anchor"></a>
      <div id="q38-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>38 The interpersonal and behavioural aspects of medical practice</p>
        <div class="cardpool" style="margin-top:8px;">
          <div class="dropzone" data-target="q38"><span class="droplabel">Drag answer here</span></div>
        </div>
      </div>
      
      <a id="q39-anchor"></a>
      <div id="q39-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>39 Dalhousie Medical School students and faculty</p>
        <div class="cardpool" style="margin-top:8px;">
          <div class="dropzone" data-target="q39"><span class="droplabel">Drag answer here</span></div>
        </div>
      </div>
      
      <a id="q40-anchor"></a>
      <div id="q40-section" style="padding:8px 0;border-top:1px dashed var(--line);">
        <p>40 Modern evidence-based practitioners</p>
        <div class="cardpool" style="margin-top:8px;">
          <div class="dropzone" data-target="q40"><span class="droplabel">Drag answer here</span></div>
        </div>
      </div>
    </div>
    
    <!-- Answer Cards for Matching -->
    <div class="cardpool" style="margin-top:15px;">
      <div class="card" draggable="true" data-value="A">A generate innovative and creative suggestions</div>
      <div class="card" draggable="true" data-value="B">B are difficult to describe with any precision</div>
      <div class="card" draggable="true" data-value="C">C find it difficult to prove statistically benefits</div>
      <div class="card" draggable="true" data-value="D">D suggest humanities create stronger practitioners</div>
      <div class="card" draggable="true" data-value="E">E rely on textbooks to teach humanities</div>
      <div class="card" draggable="true" data-value="F">F give less attention to broad education</div>
      <div class="card" draggable="true" data-value="G">G provide equal coverage of medical & humanities</div>
    </div>
  </div>
  
  <div style="display:flex;gap:8px;margin-bottom:10px;">
    <button class="primary" onclick="grade()">Submit</button>
    <button onclick="resetForm()">Reset</button>
    <button onclick="toggleNotes()">Notes</button>
  </div>
  <div id="results"></div>
  <details class="answerbox" id="answerBox">
    <summary>Show answers (click to toggle) <span class="badge">hidden</span></summary>
    <div id="answerContent"></div>
  </details>
</section>
</div>
<div aria-label="Selection tools" id="selbar" role="toolbar">
  <button id="btnHL">Highlight</button>
  <button id="btnUH">Remove</button>
  <button id="btnNote">Note</button>
</div>
<div id="notes">
  <header>
    <strong>Notes</strong>
    <div>
      <button id="btnCopy">Copy</button>
      <button id="btnClose">Close</button>
    </div>
  </header>
  <textarea id="noteArea" placeholder="Type your notes here..."></textarea>
</div>
<div id="toast"></div>
<script>

// Enhanced Timer
let timerSeconds = 0;
let timerInterval = null;
let timerPaused = false;

function startTimer() {
  if (timerInterval) return;
  timerInterval = setInterval(() => {
    if (!timerPaused) {
      timerSeconds++;
      updateTimerDisplay();
    }
  }, 1000);
}

function updateTimerDisplay() {
  const minutes = Math.floor(timerSeconds / 60);
  const seconds = timerSeconds % 60;
  const timerEl = document.getElementById('timer');
  if (timerEl) {
    timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }
}

function toggleTimer() {
  timerPaused = !timerPaused;
  const timerEl = document.getElementById('timer');
  if (timerEl) {
    timerEl.classList.toggle('paused', timerPaused);
  }
  
  if (!timerInterval) {
    startTimer();
  }
  
  showToast(timerPaused ? 'Timer paused' : 'Timer resumed');
}

// Theme functionality
function toggleTheme() {
  const body = document.body;
  const themeButton = document.querySelector('.theme-toggle');
  
  body.classList.toggle('dark');
  const isDark = body.classList.contains('dark');
  
  if (themeButton) {
    themeButton.textContent = isDark ? '☀️' : '🌙';
  }
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  
  showToast(`Switched to ${isDark ? 'dark' : 'light'} theme`);
}

function loadTheme() {
  const savedTheme = localStorage.getItem('theme');
  const body = document.body;
  const themeButton = document.querySelector('.theme-toggle');
  
  if (savedTheme === 'dark') {
    body.classList.add('dark');
    if (themeButton) themeButton.textContent = '☀️';
  } else {
    if (themeButton) themeButton.textContent = '🌙';
  }
}

// Toast notifications
function showToast(message) {
  let toast = document.getElementById('toast');
  if (!toast) {
    toast = document.createElement('div');
    toast.id = 'toast';
    toast.style.cssText = `
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 100px;
      background: #111;
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      display: none;
      z-index: 2500;
      font-weight: 500;
    `;
    document.body.appendChild(toast);
  }
  
  toast.textContent = message;
  toast.style.display = 'block';
  
  setTimeout(() => {
    toast.style.display = 'none';
  }, 2000);
}

// Initialize modern features
function initModernFeatures() {
  loadTheme();
  startTimer();
  
  // Make timer clickable
  const timer = document.getElementById('timer');
  if (timer && !timer.onclick) {
    timer.onclick = toggleTimer;
  }
  
  showToast('Modern features loaded');
}

// Auto-initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initModernFeatures);
} else {
  initModernFeatures();
}

// Drag divider
var divider = document.getElementById('divider');
var left = document.getElementById('left');
var right = document.getElementById('right');
var dragging=false;
function startDrag(e){ 
  dragging=true; 
  document.body.style.cursor='ew-resize'; 
  if(e.preventDefault) e.preventDefault(); 
}
function endDrag(){ 
  dragging=false; 
  document.body.style.cursor=''; 
}
function onMove(clientX){
  var container = document.querySelector('.shell').getBoundingClientRect();
  var x = clientX - container.left;
  x = Math.max(280, Math.min(container.width-320, x));
  left.style.flex = '0 0 ' + x + 'px';
  right.style.flex = '1 1 auto';
}
divider.addEventListener('mousedown', function(e){ startDrag(e); });
window.addEventListener('mousemove', function(e){ if(dragging) onMove(e.clientX); });
window.addEventListener('mouseup', endDrag);
divider.addEventListener('touchstart', function(e){ startDrag(e.touches[0]); }, {passive:false});
window.addEventListener('touchmove', function(e){ if(dragging) onMove(e.touches[0].clientX); }, {passive:false});
window.addEventListener('touchend', endDrag);
// Drag and drop for questions 36-40
const cards = document.querySelectorAll('.card');
const dropzones = document.querySelectorAll('.dropzone');
cards.forEach(card => {
  card.addEventListener('dragstart', () => {
    card.classList.add('dragging');
  });
  card.addEventListener('dragend', () => {
    card.classList.remove('dragging');
  });
});
dropzones.forEach(zone => {
  zone.addEventListener('dragover', e => {
    e.preventDefault();
    zone.classList.add('over');
  });
  
  zone.addEventListener('dragleave', () => {
    zone.classList.remove('over');
  });
  
  zone.addEventListener('drop', e => {
    e.preventDefault();
    zone.classList.remove('over');
    const draggingCard = document.querySelector('.dragging');
    if (draggingCard) {
      // Clear existing content
      zone.innerHTML = '';
      zone.appendChild(draggingCard);
      // Mark as answered
      const targetQ = zone.dataset.target;
      document.getElementById(targetQ + '-nav').classList.add('answered');
    }
  });
});
// Highlight toolbar
var selbar = document.getElementById('selbar');
var btnHL = document.getElementById('btnHL');
var btnUH = document.getElementById('btnUH');
var btnNote = document.getElementById('btnNote');
var lastRange=null;
var currentHlNode=null;
var keepToolbar=false;
function positionSelbarForRect(rect){
  selbar.style.display='flex';
  requestAnimationFrame(function(){
    var top = window.scrollY + rect.top - selbar.offsetHeight - 8;
    var leftPos = window.scrollX + rect.left + rect.width/2 - selbar.offsetWidth/2;
    selbar.style.top = ((top>0)?top:(window.scrollY + rect.bottom + 8)) + 'px';
    selbar.style.left = Math.max(8, leftPos) + 'px';
  });
}
function updateSelbar(){
  var sel=window.getSelection();
  if(!sel || sel.rangeCount===0 || sel.isCollapsed) { 
    selbar.style.display='none'; 
    currentHlNode=null; 
    return; 
  }
  var range = sel.getRangeAt(0);
  lastRange = range.cloneRange();
  currentHlNode=null;
  positionSelbarForRect(range.getBoundingClientRect());
}
document.getElementById('left').addEventListener('mouseup', updateSelbar);
document.getElementById('right').addEventListener('mouseup', updateSelbar);
document.addEventListener('selectionchange', function(){ 
  var sel=window.getSelection(); 
  if(!sel || sel.rangeCount===0 || sel.isCollapsed){ 
    if(!keepToolbar && !currentHlNode){ 
      selbar.style.display='none'; 
    } 
  } 
});
document.addEventListener('scroll', function(){ 
  if(selbar.style.display==='flex') updateSelbar(); 
});
document.addEventListener('mousedown', function(e){
  var t = e.target;
  if(t.classList && t.classList.contains('hl')){
    keepToolbar = true;
  } else {
    keepToolbar = false;
  }
}, true);
document.addEventListener('click', function(e){
  var target = e.target;
  if(target.classList && target.classList.contains('hl')){
    currentHlNode = target;
    lastRange = null;
    positionSelbarForRect(target.getBoundingClientRect());
    var sel=window.getSelection();
    if(sel) sel.removeAllRanges();
    setTimeout(function(){ keepToolbar=false; }, 0);
  }
}, true);

  catch(e){
    var wrap=document.createElement('span'); wrap.className='hl';
    wrap.appendChild(lastRange.cloneContents());
    lastRange.deleteContents();
    lastRange.insertNode(wrap);
  }
  selbar.style.display='none';
  showToast('Highlighted');
}
function removeHighlight(){
  if(currentHlNode){
    var p = currentHlNode.parentNode;
    while(currentHlNode.firstChild) p.insertBefore(currentHlNode.firstChild, currentHlNode);
    p.removeChild(currentHlNode); p.normalize();
    currentHlNode = null;
    selbar.style.display='none';
    showToast('Highlight removed');
    return;
  }
  if(!lastRange) return;
  var selRect = lastRange.getBoundingClientRect();
  var walker=document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
  var toRemove=[];
  while(walker.nextNode()){
    var n=walker.currentNode;
    if(n.classList && n.classList.contains('hl')) {
      var r = n.getBoundingClientRect();
      if(!(r.right < selRect.left || r.left > selRect.right || r.bottom < selRect.top || r.top > selRect.bottom)) toRemove.push(n);
    }
  }
  toRemove.forEach(function(el){ var p=el.parentNode; while(el.firstChild) p.insertBefore(el.firstChild, el); p.removeChild(el); p.normalize(); });
  selbar.style.display='none';
  showToast('Highlight removed');
}
btnHL.addEventListener('click', doHighlight);
btnUH.addEventListener('click', removeHighlight);
// Notes
var notes = document.getElementById('notes');
var noteArea = document.getElementById('noteArea');
var btnCopy=document.getElementById('btnCopy');
var btnClose=document.getElementById('btnClose');
function toggleNotes(){ 
  notes.style.display = (notes.style.display==='flex'?'none':'flex'); 
}
window.toggleNotes = toggleNotes;
btnClose.addEventListener('click', toggleNotes);
btnCopy.addEventListener('click', async function(){ 
  await navigator.clipboard.writeText(noteArea.value||''); 
  showToast('Copied'); 
});
btnNote.addEventListener('click', function(){
  var text = '';
  if(currentHlNode){ text = (currentHlNode.textContent||'').trim(); }
  else if(lastRange){ var frag = lastRange.cloneContents(); text = (frag.textContent||'').trim(); }
  toggleNotes();
  if(text) noteArea.value = (noteArea.value? noteArea.value+'\n':'') + '> ' + text + '\n';
  selbar.style.display='none';
});
// Toast
var toastEl=document.getElementById('toast');
function showToast(msg){
  toastEl.textContent=msg; 
  toastEl.style.display='block';
  setTimeout(function(){ toastEl.style.display='none'; }, 1200);
}
// Answer key and grading
var answers = {
  "q27":"NO", "q28":"NO", "q29":"YES", "q30":"YES", "q31":"NOT GIVEN",
  "q32":"D", "q33":"B", "q34":"B", "q35":"A",
  "q36":"G", "q37":"F", "q38":"B", "q39":"A", "q40":"C"
};
`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✅' : '❌'}`);
  }
  
  // Check Multiple Choice (32-35)
  for(let n=32; n<=35; n++){
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✅' : '❌'}`);
  }
  
  // Check Drag-and-Drop Matching (36-40)
  dropzones.forEach(zone => {
    const q = zone.dataset.target;
    if(q && q.match(/q[36-40]/)){ // Only check 36-40
      total++;
      const selectedCard = zone.querySelector('.card');
      const userAnswer = selectedCard ? selectedCard.dataset.value : '';
      const isCorrect = userAnswer === answers[q];
      if (isCorrect) correct++;
      lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✅' : '❌'}`);
    }
  });
  
  // Show results
  const acc = Math.round(100 * correct / total);
  document.getElementById('results').innerHTML = `
    <p><strong>Score:</strong> ${correct}/${total} <span class="badge">Accuracy ${acc}%</span></p>
    <pre>${lines.join('\n')}</pre>
  `;
  
  // Show answer key
  document.getElementById('answerContent').innerHTML = `
    <ol>
      <li>27 → NO</li>
      <li>28 → NO</li>
      <li>29 → YES</li>
      <li>30 → YES</li>
      <li>31 → NOT GIVEN</li>
      <li>32 → D (It moved the focus of medical studies away from the humanities.)</li>
      <li>33 → B (widen students’ educational experiences.)</li>
      <li>34 → B (They report feeling that medical school has become more engaging and satisfying.)</li>
      <li>35 → A (Greater emphasis on humanities in medical schools will benefit both patients and practitioners.)</li>
      <li>36 → G (provide more equal coverage of both medical knowledge and skills, and humanities.)</li>
      <li>37 → F (give less attention to broad education and more to recognising and treating symptoms.)</li>
      <li>38 → B (are difficult to describe with any precision.)</li>
      <li>39 → A (generate innovative and creative suggestions for activities and programmes.)</li>
      <li>40 → C (find it difficult to prove statistically the benefits of humanities programmes.)</li>
    </ol>
  `;
  document.querySelector('#answerBox .badge').textContent = 'tap to view';
}
function resetForm(){
  // Reset YES/NO/NOT GIVEN and Multiple Choice
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.checked = false;
  });
  
  // Reset Drag-and-Drop
  dropzones.forEach(zone => {
    const card = zone.querySelector('.card');
    if (card) {
      document.querySelector('.cardpool').appendChild(card);
      zone.innerHTML = '<span class="droplabel">Drag answer here</span>';
    }
  });
  
  // Reset results and answers
  document.getElementById('results').innerHTML = '';
  document.getElementById('answerContent').innerHTML = '';
  document.querySelector('#answerBox .badge').textContent = 'hidden';
  
  // Reset answered status in nav
  document.querySelectorAll('.q-item').forEach(item => {
    item.classList.remove('answered');
  });
}
function scrollToElement(id){
  const el = document.getElementById(id);
  if(el){ 
    el.scrollIntoView({behavior:'smooth', block:'center'}); 
  }
  // Highlight nav item briefly
  const navs = document.querySelectorAll('.practice-nav .q-item');
  navs.forEach(n => n.classList.remove('active'));
  const btn = document.getElementById(id.replace('-anchor','-nav'));
  if(btn){ 
    btn.classList.add('active'); 
    setTimeout(() => btn.classList.remove('active'), 800); 
  }
}
// Mark answered on interaction
(function(){
  function markAnswered(qn){
    const nav = document.getElementById(`q${qn}-nav`);
    if(!nav) return;
    let answered = false;
    
    // Check radio buttons (27-35)
    if(qn >=27 && qn <=35){
      const radios = document.querySelectorAll(`input[name="q${qn}"]:checked`);
      answered = radios.length > 0;
    } 
    // Check dropzones (36-40)
    else if(qn >=36 && qn <=40){
      const zone = document.querySelector(`.dropzone[data-target="q${qn}"]`);
      answered = zone.querySelector('.card') !== null;
    }
    
    if(answered) nav.classList.add('answered');
    else nav.classList.remove('answered');
  }
  
  // Monitor radio buttons (27-35)
  for(let n=27; n<=35; n++){
    document.querySelectorAll(`input[name="q${n}"]`).forEach(radio => {
      radio.addEventListener('change', () => markAnswered(n));
    });
  }
  
  // Monitor dropzones (36-40)
  dropzones.forEach(zone => {
    zone.addEventListener('drop', () => {
      const qn = zone.dataset.target.replace('q', '');
      markAnswered(qn);
    });
  });
})();
</script>

<script>
// 检查是否已经有增强脚本
if (!window.practicePageEnhancer) {
    // 动态加载增强脚本
    const script = document.createElement('script');
    script.src = '../../../js/practice-page-enhancer.js';
    script.onload = function() {
        console.log('[PracticePageEnhancer] 外部脚本加载成功');
        if (window.practicePageEnhancer) {
            window.practicePageEnhancer.initialize();
        }
    };
    script.onerror = function() {
        console.log('[PracticePageEnhancer] 外部脚本加载失败，使用内联版本');
        loadInlineEnhancer();
    };
    document.head.appendChild(script);
    
    // 超时降级
    setTimeout(function() {
        if (!window.practicePageEnhancer) {
            console.log('[PracticePageEnhancer] 超时降级到内联版本');
            loadInlineEnhancer();
        }
    }, 2000);
}

// 内联增强器（降级方案）
function loadInlineEnhancer() {
    if (window.practicePageEnhancer) return;
    
    window.practicePageEnhancer = {
        initialize: function() {
            console.log('[InlineEnhancer] 内联增强器已初始化');
            this.setupCommunication();
            this.setupAnswerListeners();
            this.interceptSubmit();
        },
        
        setupCommunication: function() {
            this.parentWindow = window.opener || window.parent;
            window.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'INIT_SESSION') {
                    this.sessionId = event.data.data.sessionId;
                    this.sendMessage('SESSION_READY', {
                        pageType: this.detectPageType(),
                        url: window.location.href
                    });
                }
            });
        },
        
        detectPageType: function() {
            const title = document.title || '';
            if (title.includes('P1')) return 'P1';
            if (title.includes('P2')) return 'P2';
            if (title.includes('P3')) return 'P3';
            return 'unknown';
        },
        
        setupAnswerListeners: function() {
            this.answers = {};
            this.startTime = Date.now();
            
            document.addEventListener('change', (e) => {
                if (e.target.name && e.target.name.startsWith('q')) {
                    this.answers[e.target.name] = e.target.value;
                }
            });
        },
        
        interceptSubmit: function() {
            // 拦截grade函数
            if (typeof window.grade === 'function') {
                const originalGrade = window.grade;
                window.grade = () => {
                    const result = originalGrade();
                    setTimeout(() => this.handleSubmit(), 200);
                    return result;
                };
            }
            
            // 监听提交按钮
            document.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' && 
                    (e.target.textContent.includes('Submit') || 
                     e.target.textContent.includes('提交') ||
                     e.target.textContent.includes('完成') ||
                     e.target.textContent.includes('Check') ||
                     e.target.onclick && e.target.onclick.toString().includes('grade'))) {
                    setTimeout(() => this.handleSubmit(), 300);
                }
            });
        },
        
        handleSubmit: function() {
            const results = {
                sessionId: this.sessionId,
                startTime: this.startTime,
                endTime: Date.now(),
                duration: Math.round((Date.now() - this.startTime) / 1000),
                answers: this.answers,
                scoreInfo: this.extractScore(),
                pageType: this.detectPageType(),
                url: window.location.href
            };
            
            this.sendMessage('PRACTICE_COMPLETE', results);
        },
        
        extractScore: function() {
            const resultsEl = document.getElementById('results');
            if (!resultsEl) return null;
            
            const text = resultsEl.textContent || '';
            const scoreMatch = text.match(/Score:\s*(\d+)\/(\d+)/i);
            if (scoreMatch) {
                const correct = parseInt(scoreMatch[1]);
                const total = parseInt(scoreMatch[2]);
                return {
                    correct: correct,
                    total: total,
                    accuracy: total > 0 ? correct / total : 0,
                    percentage: Math.round((correct / total) * 100),
                    source: 'inline_extraction'
                };
            }
            return null;
        },
        
        sendMessage: function(type, data) {
            if (this.parentWindow) {
                this.parentWindow.postMessage({
                    type: type,
                    data: data,
                    source: 'practice_page'
                }, '*');
            }
        }
    };
    
    // 初始化
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            window.practicePageEnhancer.initialize();
        });
    } else {
        window.practicePageEnhancer.initialize();
    }
}
</script><script>
// 全面修复的JavaScript功能
(function() {
  // 防止重复加载
  if (window.comprehensiveFixLoaded) return;
  window.comprehensiveFixLoaded = true;
  
  console.log('Loading comprehensive P3 fixes...');
  
  // 计时器变量
  let timerSeconds = 0;
  let timerInterval = null;
  let timerPaused = false;
  
  // 强制覆盖计时器函数
  window.startTimer = function() {
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      if (!timerPaused) {
        timerSeconds++;
        updateTimerDisplay();
      }
    }, 1000);
    console.log('Timer started');
  };
  
  window.updateTimerDisplay = function() {
    const minutes = Math.floor(timerSeconds / 60);
    const seconds = timerSeconds % 60;
    const timerEl = document.getElementById('timer');
    if (timerEl) {
      timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
  };
  
  window.toggleTimer = function() {
    timerPaused = !timerPaused;
    const timerEl = document.getElementById('timer');
    if (timerEl) {
      timerEl.classList.toggle('paused', timerPaused);
      timerEl.style.background = timerPaused ? '#fef3c7' : '';
      timerEl.style.color = timerPaused ? '#92400e' : '';
    }
    
    if (!timerInterval) {
      window.startTimer();
    }
    
    showToast(timerPaused ? 'Timer paused ⏸️' : 'Timer resumed ▶️');
  };
  
  // 强制覆盖主题切换函数
  window.toggleTheme = function() {
    const body = document.body;
    const themeButton = document.querySelector('.theme-toggle');
    
    body.classList.toggle('dark');
    const isDark = body.classList.contains('dark');
    
    if (themeButton) {
      themeButton.textContent = isDark ? '☀️' : '🌙';
    }
    
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    showToast(`Switched to ${isDark ? 'dark' : 'light'} theme`);
    
    console.log('Theme toggled to:', isDark ? 'dark' : 'light');
  };
  
  window.loadTheme = function() {
    const savedTheme = localStorage.getItem('theme');
    const body = document.body;
    const themeButton = document.querySelector('.theme-toggle');
    
    if (savedTheme === 'dark') {
      body.classList.add('dark');
      if (themeButton) themeButton.textContent = '☀️';
    } else {
      body.classList.remove('dark');
      if (themeButton) themeButton.textContent = '🌙';
    }
    
    console.log('Theme loaded:', savedTheme || 'light');
  };
  
  // Toast通知系统
  window.showToast = function(message) {
    let toast = document.getElementById('toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast';
      toast.style.cssText = `
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        bottom: 100px;
        background: #111;
        color: #fff;
        padding: 12px 20px;
        border-radius: 8px;
        display: none;
        z-index: 2500;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      `;
      document.body.appendChild(toast);
    }
    
    toast.textContent = message;
    toast.style.display = 'block';
    
    setTimeout(() => {
      toast.style.display = 'none';
    }, 2500);
  };
  
  // 高亮功能修复
  window.doHighlight = function(color) {
    const selection = window.getSelection();
    if (selection.rangeCount > 0) {
      const range = selection.getRangeAt(0);
      const span = document.createElement('span');
      span.className = 'hl';
      span.style.backgroundColor = color || '#fbbf24';
      span.style.color = document.body.classList.contains('dark') ? '#1f2937' : 'inherit';
      
      try {
        range.surroundContents(span);
        selection.removeAllRanges();
        showToast('Text highlighted');
      } catch (e) {
        console.log('Highlight failed:', e);
      }
    }
  };
  
  window.removeHighlight = function() {
    const highlights = document.querySelectorAll('.hl');
    highlights.forEach(hl => {
      const parent = hl.parentNode;
      parent.insertBefore(document.createTextNode(hl.textContent), hl);
      parent.removeChild(hl);
    });
    showToast('Highlights removed');
  };
  
  // 笔记功能修复
  window.toggleNotes = function() {
    const notes = document.getElementById('notes');
    if (notes) {
      const isVisible = notes.style.display !== 'none';
      notes.style.display = isVisible ? 'none' : 'block';
      showToast(isVisible ? 'Notes hidden' : 'Notes shown');
    }
  };
  
  // 滚动到元素
  window.scrollToElement = function(id) {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });
      showToast(`Scrolled to question ${id.replace('q', '')}`);
    }
  };
  
  // 答案状态更新
  window.updateAnswerStatus = function() {
    const questions = document.querySelectorAll('[id^="q"]');
    questions.forEach(q => {
      const qNum = q.id.replace('q', '');
      const navItem = document.querySelector(`.q-item[onclick*="q${qNum}"]`);
      if (navItem) {
        const hasAnswer = q.querySelector('input:checked, input.blank[value!=""]');
        navItem.classList.toggle('answered', !!hasAnswer);
      }
    });
  };
  
  // 表单重置
  window.resetForm = function() {
    const form = document.querySelector('form');
    if (form) {
      form.reset();
      document.querySelectorAll('.hl').forEach(hl => {
        const parent = hl.parentNode;
        parent.insertBefore(document.createTextNode(hl.textContent), hl);
        parent.removeChild(hl);
      });
      updateAnswerStatus();
      showToast('Form reset');
    }
  };
  
  // 初始化函数
  function initComprehensiveFixes() {
    console.log('Initializing comprehensive fixes...');
    
    // 加载主题
    loadTheme();
    
    // 启动计时器
    startTimer();
    
    // 绑定计时器点击事件
    const timer = document.getElementById('timer');
    if (timer) {
      timer.onclick = toggleTimer;
      timer.style.cursor = 'pointer';
      timer.title = 'Click to pause/resume timer';
    }
    
    // 绑定主题切换按钮
    const themeButton = document.querySelector('.theme-toggle');
    if (themeButton) {
      themeButton.onclick = toggleTheme;
      themeButton.title = 'Toggle dark/light theme';
    }
    
    // 绑定答案变化监听
    document.addEventListener('change', updateAnswerStatus);
    document.addEventListener('input', updateAnswerStatus);
    
    // 绑定高亮选择事件
    document.addEventListener('mouseup', function() {
      const selection = window.getSelection();
      if (selection.toString().length > 0) {
        // 可以在这里添加高亮工具栏显示逻辑
      }
    });
    
    // 初始化答案状态
    setTimeout(updateAnswerStatus, 500);
    
    showToast('All features loaded successfully! ✅');
    console.log('Comprehensive fixes initialized successfully');
  }
  
  // 页面加载完成后初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initComprehensiveFixes);
  } else {
    initComprehensiveFixes();
  }
  
})();
\n
// 修复高亮功能
function doHighlight(color) {
  if(currentHlNode) return;
  if(!lastRange || lastRange.collapsed) return;
  
  const span = document.createElement('span');
  span.className = 'hl';
  span.style.backgroundColor = color || '#fff3a3';
  span.style.color = document.body.classList.contains('dark') ? '#1f2937' : 'inherit';
  
  try { 
    lastRange.surroundContents(span); 
  } catch(e) {
    const wrap = document.createElement('span');
    wrap.className = 'hl';
    wrap.style.backgroundColor = color || '#fff3a3';
    wrap.style.color = document.body.classList.contains('dark') ? '#1f2937' : 'inherit';
    wrap.appendChild(lastRange.cloneContents());
    lastRange.deleteContents();
    lastRange.insertNode(wrap);
  }
  
  selbar.style.display = 'none';
  showToast('Text highlighted ✨');
}

// 修复答案提交功能
function grade() {
  console.log('Grade function called');
  
  const answers = {
    "q27":"NO", "q28":"NO", "q29":"YES", "q30":"YES", "q31":"NOT GIVEN",
    "q32":"D", "q33":"B", "q34":"B", "q35":"A",
    "q36":"G", "q37":"F", "q38":"B", "q39":"A", "q40":"C"
  };
  
  let total = 0, correct = 0, lines = [];
  
  // Check YES/NO/NOT GIVEN (27-31)
  for(let n = 27; n <= 31; n++) {
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✅' : '❌'}`);
  }
  
  // Check Multiple Choice (32-35)
  for(let n = 32; n <= 35; n++) {
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const userAnswer = selected ? selected.value : '';
    const isCorrect = userAnswer === answers[q];
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✅' : '❌'}`);
  }
  
  // Check Drag-and-Drop Matching (36-40)
  const dropzones = document.querySelectorAll('.dropzone');
  dropzones.forEach(zone => {
    const q = zone.dataset.target;
    if(q && q.match(/q[36-40]/)) { // Only check 36-40
      total++;
      const selectedCard = zone.querySelector('.card');
      const userAnswer = selectedCard ? selectedCard.dataset.value : '';
      const isCorrect = userAnswer === answers[q];
      if (isCorrect) correct++;
      lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✅' : '❌'}`);
    }
  });
  
  // Show results
  const acc = Math.round(100 * correct / total);
  const resultsEl = document.getElementById('results');
  if (resultsEl) {
    resultsEl.innerHTML = `
      <p><strong>Score:</strong> ${correct}/${total} <span class="badge">Accuracy ${acc}%</span></p>
      <pre style="white-space: pre-wrap; font-family: monospace; font-size: 14px;">${lines.join('\n')}</pre>
    `;
    resultsEl.style.display = 'block';
  }
  
  // Show answer key
  const answerContent = document.getElementById('answerContent');
  if (answerContent) {
    answerContent.innerHTML = `
      <ol style="margin: 10px 0; padding-left: 20px;">
        <li>27 → NO</li>
        <li>28 → NO</li>
        <li>29 → YES</li>
        <li>30 → YES</li>
        <li>31 → NOT GIVEN</li>
        <li>32 → D (It moved the focus of medical studies away from the humanities.)</li>
        <li>33 → B (widen students' educational experiences.)</li>
        <li>34 → B (They report feeling that medical school has become more engaging and satisfying.)</li>
        <li>35 → A (Greater emphasis on humanities in medical schools will benefit both patients and practitioners.)</li>
        <li>36 → G (provide more equal coverage of both medical knowledge and skills, and humanities.)</li>
        <li>37 → F (give less attention to broad education and more to recognising and treating symptoms.)</li>
        <li>38 → B (are difficult to describe with any precision.)</li>
        <li>39 → A (generate innovative and creative suggestions for activities and programmes.)</li>
        <li>40 → C (find it difficult to prove statistically the benefits of humanities programmes.)</li>
      </ol>
    `;
  }
  
  const answerBadge = document.querySelector('#answerBox .badge');
  if (answerBadge) {
    answerBadge.textContent = 'tap to view';
  }
  
  showToast(`Results calculated: ${correct}/${total} correct! 🎯`);
  console.log('Grade function completed successfully');
}

// 确保按钮事件绑定
document.addEventListener('DOMContentLoaded', function() {
  // 绑定Submit按钮
  const submitBtn = document.querySelector('button.primary');
  if (submitBtn && submitBtn.textContent.includes('Submit')) {
    submitBtn.onclick = grade;
    console.log('Submit button bound to grade function');
  }
  
  // 绑定高亮按钮
  const hlBtn = document.getElementById('btnHL');
  if (hlBtn) {
    hlBtn.onclick = doHighlight;
    console.log('Highlight button bound');
  }
  
  // 确保高亮工具栏功能正常
  setTimeout(function() {
    const selbar = document.getElementById('selbar');
    if (selbar) {
      console.log('Highlight toolbar found and ready');
    }
  }, 1000);
});
\n</script>
</body>
</html>
