<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>P1 – Listening to the Ocean</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root { 
    --line:#e5e7eb; 
    --bg:#f6f7fb; 
    --panel:#fff; 
    --accent:#3b82f6; 
    --muted:#6b7280; 
    --shadow:0 6px 20px rgba(0,0,0,.12); 
  }
  * { box-sizing: border-box; }
  html,body { height:100%; }
  body { 
    margin:0; 
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
    background:var(--bg); 
    padding-bottom: 82px; 
  }
  
  /* 布局样式 */
  .shell { display:flex; height:100vh; width:100%; }
  .pane { background:var(--panel); overflow:auto; padding:20px; }
  #left { flex: 0 0 50%; min-width: 280px; }
  #right { flex: 1 1 auto; min-width: 320px; background:#fbfbff; border-left:1px solid var(--line); }
  #divider { flex: 0 0 8px; background: linear-gradient(90deg,#e5e7eb,#d1d5db); cursor: ew-resize; position:relative; z-index: 5; user-select:none; }
  
  /* 文本样式 */
  h2,h3,h4 { margin:0 0 10px; }
  #left p { margin: 0 0 12px; line-height: 1.6; word-break: normal; overflow-wrap: normal; hyphens: none; }
  
  /* 组件样式 */
  .group { background:#fff; border:1px solid var(--line); border-radius:10px; padding:12px; margin-bottom:14px; }
  input.blank { 
    border:none; 
    border-bottom:1px solid #9ca3af; 
    padding:2px 4px; 
    font-size:1em; 
    background:transparent; 
    min-width: 80px;
  }
  input.blank:focus { outline:none; border-bottom:2px solid var(--accent); }
  
  /* 按钮样式 */
  button { 
    padding:8px 12px; 
    border:1px solid var(--line); 
    background:#fff; 
    border-radius:6px; 
    cursor:pointer; 
    transition:all 0.2s; 
    font-size:14px; 
  }
  button:hover { background:#f8fafc; border-color:#cbd5e1; }
  button.primary { 
    background:var(--accent); 
    color:#fff; 
    border-color:var(--accent); 
  }
  button.primary:hover { background:#2563eb; }  

  /* 计时器样式 */
  #timer { 
    background:#fff; 
    color:var(--muted); 
    border:1px solid var(--line); 
    border-radius:6px; 
    padding:6px 12px; 
    cursor:pointer; 
    font-family: 'Courier New', monospace; 
    transition:all 0.2s; 
    min-width: 70px;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
  }
  #timer:hover { 
    background:#f1f5f9; 
    border-color:var(--accent); 
  }
  #timer.paused { 
    color: #ef4444; 
    border-color: #fecaca; 
    background: #fef2f2; 
  }
  
  /* 主题切换按钮 */
  .theme-toggle { 
    background:#fff; 
    color:var(--muted); 
    border:1px solid var(--line); 
    border-radius:6px; 
    width: 36px;
    height: 36px;
    font-size: 16px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .theme-toggle:hover {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
    transform: scale(1.05);
  }
  .theme-toggle:active {
    transform: scale(0.95);
  }  
  /
* 深色模式样式 */
  body.dark { 
    --bg: #0f172a; 
    --panel: #1e293b; 
    --line: #334155; 
    --muted: #94a3b8; 
    color: #e2e8f0; 
  }
  body.dark #right { background: #0f172a; }
  body.dark .group { background: #1e293b; border-color: #334155; }
  body.dark button { background: #1e293b; color: #e2e8f0; border-color: #334155; }
  body.dark button:hover { background: #334155; }
  body.dark button.primary { background: var(--accent); color: #fff; }
  body.dark #results { background: #1e293b; border-color: #334155; }
  body.dark #notes { background: #1e293b; border-color: #334155; color: #e2e8f0; }
  body.dark .practice-nav { background: #1e293b; border-color: #334155; }
  body.dark .q-item { background: #0f172a; color: #e2e8f0; border-color: #334155; }
  body.dark .q-item:hover { background: #334155; }
  body.dark .q-item.answered { background: #1e40af; border-color: var(--accent); color: #93c5fd; }
  body.dark #timer { background: #1e293b; color: #e2e8f0; border-color: #334155; }
  body.dark #timer:hover { background: #334155; border-color: var(--accent); }
  body.dark details.answerbox { background: #1e293b; border-color: #334155; }
  body.dark input.blank { color: #e2e8f0; border-bottom-color: #64748b; }
  body.dark input.blank:focus { border-bottom-color: var(--accent); }
  
  /* 响应式设计 */
  @media (max-width: 768px) {
    .shell { flex-direction: column; }
    #left, #right { flex: none; min-width: auto; }
    #divider { display: none; }
    .practice-nav .controls { gap: 8px; }
    #timer { font-size: 12px; padding: 3px 8px; }
    .theme-toggle { width: 32px; height: 32px; font-size: 14px; }
    #notes { width: calc(100vw - 24px); right: 12px; left: 12px; }
  }  
  /* 选
择工具栏 */
  #selbar { 
    position: fixed; 
    display:none; 
    z-index: 2000; 
    background:#111; 
    color:#fff; 
    border-radius: 8px; 
    padding: 6px; 
    box-shadow: var(--shadow); 
    font-size: 13px; 
    gap:6px; 
    align-items: center; 
  }
  #selbar button { 
    background: transparent; 
    color:#fff; 
    border: 1px solid rgba(255,255,255,.25); 
    padding: 4px 8px; 
    border-radius: 6px; 
    cursor:pointer; 
  }
  #selbar button:hover { border-color:#fff; }
  
  /* 笔记面板 */
  #notes { 
    position: fixed; 
    right: 12px; 
    bottom: 12px; 
    width: 320px; 
    height: 42vh; 
    background:#fff; 
    border:1px solid var(--line); 
    border-radius: 12px; 
    display:none; 
    flex-direction: column; 
    z-index:1500; 
    box-shadow: var(--shadow); 
  }
  #notes header { 
    display:flex; 
    align-items:center; 
    justify-content: space-between; 
    padding:8px 10px; 
    border-bottom:1px solid var(--line); 
  }
  #notes textarea { 
    flex:1; 
    border:0; 
    padding:10px; 
    resize:none; 
    font-size:14px; 
    line-height:1.5; 
  }  
  /
* Toast通知 */
  #toast { 
    position: fixed; 
    bottom: 20px; 
    left: 50%; 
    transform: translateX(-50%); 
    background: rgba(0,0,0,0.8); 
    color: #fff; 
    padding: 8px 16px; 
    border-radius: 4px; 
    display: none; 
    z-index: 3000; 
    font-size: 14px; 
  }
  
  /* 答题导航 */
  .practice-nav { 
    background:#fff; 
    padding:12px 20px; 
    display:flex; 
    align-items:center; 
    gap:16px; 
    box-shadow:0 2px 4px rgba(0,0,0,.05); 
    flex-wrap:wrap; 
    position:fixed; 
    left:0; 
    right:0; 
    bottom:0; 
    border-top:2px solid var(--line); 
    z-index:4000; 
  }
  .practice-nav .title { font-weight:600; color:var(--muted); }
  .practice-nav .questions { 
    display:flex; 
    gap:8px; 
    align-items:center; 
    flex-wrap:wrap; 
  }
  .practice-nav .q-item { 
    padding:6px 10px; 
    border:1px solid var(--line); 
    border-radius:6px; 
    background:#fff; 
    cursor:pointer; 
    font-size:14px; 
    transition:all 0.2s; 
    min-width:36px; 
    text-align:center; 
  }
  .practice-nav .q-item:hover { 
    background:#f1f5f9; 
    border-color:var(--accent); 
  }
  .practice-nav .q-item.answered { 
    background:#e0e7ff; 
    border-color:var(--accent); 
    color:var(--accent); 
    font-weight:500; 
  }
  .practice-nav .q-item.active { 
    background:var(--accent); 
    color:#fff; 
  }
  .practice-nav .controls { 
    display:flex; 
    gap:12px; 
    margin-left:auto; 
    align-items:center; 
  }  

  /* 答题结果显示 */
  #results { 
    background:#fff; 
    border:1px solid var(--line); 
    border-radius:10px; 
    padding:12px; 
    margin:16px 0; 
    font-family: monospace; 
    white-space:pre-wrap; 
  }
  #results p { margin:0 0 8px; }
  .badge { 
    background:#e0e7ff; 
    color:var(--accent); 
    padding:2px 8px; 
    border-radius:999px; 
    font-size:12px; 
  }
  
  /* 答案框 */
  details.answerbox { 
    background:#fff; 
    border:1px solid var(--line); 
    border-radius:10px; 
    padding:12px; 
    margin-top:10px; 
  }
  details.answerbox summary { 
    cursor:pointer; 
    font-weight:600; 
    list-style:none; 
    display:flex; 
    align-items:center; 
    justify-content:space-between; 
  }
  details.answerbox summary::-webkit-details-marker { display:none; }
  #answerContent { margin-top:10px; }
  #answerContent ol { margin:0; padding-left:20px; }
  #answerContent li { margin:4px 0; }
  
  /* 高亮样式 */
  .hl { background: #ffeb3b; color: #000; }
  body.dark .hl { background: #8a6d00; color: #fff; }
  
  /* 滚动条样式 */
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #c5c5d2; border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: #999; }
  body.dark ::-webkit-scrollbar-thumb { background: #4a5568; }
  body.dark ::-webkit-scrollbar-thumb:hover { background: #718096; }
</style>
</head>
<body><div 
class="practice-nav">
  <div class="title">Questions</div>
  <div class="questions">
    <div class="q-item" id="q1-nav" onclick="scrollToElement('q1-anchor')">1</div>
    <div class="q-item" id="q2-nav" onclick="scrollToElement('q2-anchor')">2</div>
    <div class="q-item" id="q3-nav" onclick="scrollToElement('q3-anchor')">3</div>
    <div class="q-item" id="q4-nav" onclick="scrollToElement('q4-anchor')">4</div>
    <div class="q-item" id="q5-nav" onclick="scrollToElement('q5-anchor')">5</div>
    <div class="q-item" id="q6-nav" onclick="scrollToElement('q6-anchor')">6</div>
    <div class="q-item" id="q7-nav" onclick="scrollToElement('q7-anchor')">7</div>
    <div class="q-item" id="q8-nav" onclick="scrollToElement('q8-anchor')">8</div>
    <div class="q-item" id="q9-nav" onclick="scrollToElement('q9-anchor')">9</div>
    <div class="q-item" id="q10-nav" onclick="scrollToElement('q10-anchor')">10</div>
    <div class="q-item" id="q11-nav" onclick="scrollToElement('q11-anchor')">11</div>
    <div class="q-item" id="q12-nav" onclick="scrollToElement('q12-anchor')">12</div>
    <div class="q-item" id="q13-nav" onclick="scrollToElement('q13-anchor')">13</div>
  </div>
  <div class="controls">
    <span id="timer" onclick="toggleTimer()">00:00</span>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">🌙</button>
  </div>
</div>

<div class="shell">
  <section class="pane" id="left">
    <h2>READING PASSAGE 1</h2>
    <p>You should spend about 20 minutes on Questions 1–13, which are based on Reading Passage 1 below.</p>
    <h3>Listening to the Ocean</h3>
    <p>The results of some recent research answer some long-standing questions</p>
    
    <h4>Paragraph A</h4>
    <p>The oceans cover more than 70 per cent of the planet's surface, yet until quite recently we knew less about their depths than about the surface of the Moon. The Moon has been far more accessible to study because astronomers have long been able to look at its surface, first with the naked eye and then with the telescope, both instruments that focus light. Until the twentieth century, however, no instruments were available for the study of Earth's oceans: light, which can travel trillions of kilometres through the vast vacuum of space, cannot penetrate very far in seawater.</p>
    
    <h4>Paragraph B</h4>
    <p>It turns out that for penetrating water the best instrument is sound. Curious investigators have long been fascinated by sound and the way it travels in water. As early as 1490, the artist and scientist Leonardo da Vinci observed: 'If you cause your ship to stop and place the head of a long tube in the water and place the outer extremity to your ear, you will hear ships at a great distance from you.' It was not until 1826 that two scientists, Colladon and Sturm, accurately measured the speed of sound in water. Using a long tube to listen under water (as da Vinci had suggested), they recorded how fast the sound of a submerged bell travelled across Lake Geneva in Switzerland. What these investigators demonstrated was that water is an excellent medium for sound, transmitting it almost five times faster than its speed in air.</p>  
  
    <h4>Paragraph C</h4>
    <p>A number of factors influence how far sound travels under water and how long it lasts, including particles, salinity, temperature and pressure. Particles in seawater can reflect, scatter and absorb certain frequencies of sound, just as certain wavelengths of light may be reflected, scattered and absorbed by specific types of particles in the atmosphere. In 1943, Maurice Ewing and J. L. Worzel conducted an experiment to test the theory that low-frequency waves, which are less vulnerable than higher frequencies to scattering and absorption, should be able to travel great distances, if the sound source is placed correctly. The researchers set off an underwater explosion and learned that it was detected easily by receivers 3,200 kilometres away. In analysing the results of this test, they discovered a kind of 'sound pipeline', known as the 'deep sound channel'. Sound introduced into this channel of water could travel thousands of kilometres with minimal loss of signal.</p>
    
    <h4>Paragraph D</h4>
    <p>The US Navy was quick to appreciate the usefulness of low-frequency sound and the deep sound channel. They developed the Sound Surveillance System (SOSUS), which involved underwater microphones, called hydrophones, that were placed on the ocean bottom and connected by cables to on-shore processing centres. It was Christopher Clark of Cornell University who soon realised that SOSUS could be used to listen to whales. Using a SOSUS receiver in the West Indies, he could hear whales that were 1,770 kilometres away.</p>
    
    <h4>Paragraph E</h4>
    <p>Whales are the biggest of Earth's creatures, yet these animals are also remarkably elusive. Scientists wishing to observe blue whales must simply wait in their ships for the whales to surface. A few whales have been tracked briefly in the wild in this way but not for very great distances, and much about them remains unknown. But by using SOSUS, scientists can track the whales and position them on a map. Moreover, they can track not just one whale at a time, but many creatures simultaneously. They can also learn to distinguish whale calls; researchers have detected changes in the calls of finback whales as the seasons change, and have found that blue whales in different regions of the Pacific Ocean have different calls.</p>
    
    <h4>Paragraph F</h4>
    <p>SOSUS has also proved instrumental in obtaining information crucial to our understanding of climate. The system has enabled researchers to begin making ocean-temperature measurements on a global scale, measurements that are key to understanding the workings of heat transfer between the ocean and the atmosphere. The ocean plays an enormous role in determining air temperature - the heat capacity in only the upper few metres of ocean is thought to be equal to all of the heat in the entire atmosphere. For sound waves travelling horizontally in the ocean, speed is largely a function of temperature. Thus, the travel time of a wave of sound between two points is a sensitive indicator of the average temperature along its path. Transmitting sound in numerous directions through the deep sound channel can give scientists measurements spanning vast areas of the globe. Thousands of sound paths in the ocean can be pieced together into a map of global ocean temperatures, and by repeating measurements along the same paths over time, scientists can track changes in temperature over months or years.</p>    
  
  <h4>Paragraph G</h4>
    <p>Researchers are also using other acoustic techniques to monitor climate. Oceanographer Jeff Nystuen, for example, has explored the use of sound to measure rainfall over the ocean. Monitoring changing global rainfall patterns will contribute to understanding major climate change as well as the weather phenomenon known as El Niño. Since 1985, Nystuen has used hydrophones to listen to rain over the ocean, acoustically measuring not only the rainfall rate but also the rainfall type, ranging from drizzle to thunderstorms. By using the sound of rain under water as a 'natural' rain gauge, the measurement of rainfall over the oceans will become available to climatologists. In this way, modern society continues to benefit from the investigations of those who, like Leonardo da Vinci, pursued the answers to some basic questions of nature.</p>
    
  </section>
  <div id="divider" title="Drag to resize"></div>
  <section class="pane" id="right">
    <h3>Questions</h3>
    
    <div class="group">
      <h4>Questions 1–4</h4>
      <p>Do the following statements agree with the information given in Reading Passage 1?</p>
      <p>In boxes 1–4 on your answer sheet, write</p>
      <ul>
        <li><strong>TRUE</strong> if the statement agrees with the information</li>
        <li><strong>FALSE</strong> if the statement contradicts the information</li>
        <li><strong>NOT GIVEN</strong> if there is no information on this</li>
      </ul>
      
      <div id="q1-anchor">
        <p><strong>1</strong> In the past, it was easier for scientists to study the Moon than the oceans.</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label><input name="q1" type="radio" value="TRUE"> TRUE</label>
          <label><input name="q1" type="radio" value="FALSE"> FALSE</label>
          <label><input name="q1" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
        </div>
      </div>
      
      <div id="q2-anchor">
        <p><strong>2</strong> Techniques for investigating the Moon are the same as techniques for researching the ocean.</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label><input name="q2" type="radio" value="TRUE"> TRUE</label>
          <label><input name="q2" type="radio" value="FALSE"> FALSE</label>
          <label><input name="q2" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
        </div>
      </div>
      
      <div id="q3-anchor">
        <p><strong>3</strong> Measuring temperature changes in the ocean using sound is more time-consuming than other methods.</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label><input name="q3" type="radio" value="TRUE"> TRUE</label>
          <label><input name="q3" type="radio" value="FALSE"> FALSE</label>
          <label><input name="q3" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
        </div>
      </div>
      
      <div id="q4-anchor">
        <p><strong>4</strong> Hydrophones can distinguish different kinds of rain.</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label><input name="q4" type="radio" value="TRUE"> TRUE</label>
          <label><input name="q4" type="radio" value="FALSE"> FALSE</label>
          <label><input name="q4" type="radio" value="NOT GIVEN"> NOT GIVEN</label>
        </div>
      </div>
    </div> 
   
    <div class="group">
      <h4>Questions 5–8</h4>
      <p>Reading Passage 1 has seven paragraphs, A–G.</p>
      <p>Which paragraph contains the following information?</p>
      <p>Write the correct letter, A–G, in boxes 5–8 on your answer sheet.</p>
      <p><strong>NB</strong> You may use any letter more than once.</p>
      
      <div id="q5-anchor">
        <p><strong>5</strong> examples of things that affect the distance sound can travel in water</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label><input name="q5" type="radio" value="A"> A</label>
          <label><input name="q5" type="radio" value="B"> B</label>
          <label><input name="q5" type="radio" value="C"> C</label>
          <label><input name="q5" type="radio" value="D"> D</label>
          <label><input name="q5" type="radio" value="E"> E</label>
          <label><input name="q5" type="radio" value="F"> F</label>
          <label><input name="q5" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <div id="q6-anchor">
        <p><strong>6</strong> details of the connection between ocean temperatures and climate</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label><input name="q6" type="radio" value="A"> A</label>
          <label><input name="q6" type="radio" value="B"> B</label>
          <label><input name="q6" type="radio" value="C"> C</label>
          <label><input name="q6" type="radio" value="D"> D</label>
          <label><input name="q6" type="radio" value="E"> E</label>
          <label><input name="q6" type="radio" value="F"> F</label>
          <label><input name="q6" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <div id="q7-anchor">
        <p><strong>7</strong> a description of how whales were tracked in the past</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label><input name="q7" type="radio" value="A"> A</label>
          <label><input name="q7" type="radio" value="B"> B</label>
          <label><input name="q7" type="radio" value="C"> C</label>
          <label><input name="q7" type="radio" value="D"> D</label>
          <label><input name="q7" type="radio" value="E"> E</label>
          <label><input name="q7" type="radio" value="F"> F</label>
          <label><input name="q7" type="radio" value="G"> G</label>
        </div>
      </div>
      
      <div id="q8-anchor">
        <p><strong>8</strong> an explanation of how sound travels in water</p>
        <div style="display:flex; flex-wrap:wrap; gap:10px; margin:4px 0;">
          <label><input name="q8" type="radio" value="A"> A</label>
          <label><input name="q8" type="radio" value="B"> B</label>
          <label><input name="q8" type="radio" value="C"> C</label>
          <label><input name="q8" type="radio" value="D"> D</label>
          <label><input name="q8" type="radio" value="E"> E</label>
          <label><input name="q8" type="radio" value="F"> F</label>
          <label><input name="q8" type="radio" value="G"> G</label>
        </div>
      </div>
    </div>    
   
 <div class="group">
      <h4>Questions 9–13</h4>
      <p>Complete the summary below.</p>
      <p>Choose <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
      <p>Write your answers in boxes 9–13 on your answer sheet.</p>
      
      <div style="padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-top: 1em;">
        <h4 style="text-align: center;">Sound and the Ocean</h4>
        
        <p>Sound is the best way to study the ocean because light cannot travel far in <strong>9</strong> <input id="q9-anchor" name="q9" type="text" class="blank" maxlength="40">. Leonardo da Vinci observed that sound could be used to detect <strong>10</strong> <input id="q10-anchor" name="q10" type="text" class="blank" maxlength="40"> at great distances. In 1826, scientists measured the speed of sound in water using a <strong>11</strong> <input id="q11-anchor" name="q11" type="text" class="blank" maxlength="40"> and a bell. The US Navy developed SOSUS, which uses <strong>12</strong> <input id="q12-anchor" name="q12" type="text" class="blank" maxlength="40"> placed on the ocean floor. Scientists can now use sound to measure <strong>13</strong> <input id="q13-anchor" name="q13" type="text" class="blank" maxlength="40"> over the ocean.</p>
      </div>
    </div>

    <div style="display:flex;gap:8px;margin-bottom:10px;">
      <button class="primary" onclick="grade()">Submit</button>
      <button onclick="resetForm()">Reset</button>
      <button onclick="toggleNotes()">Notes</button>
    </div>
    <div id="results"></div>
    <details class="answerbox" id="answerBox">
      <summary>Show answers (click to toggle) <span class="badge">hidden</span></summary>
      <div id="answerContent"></div>
    </details>
  </section>
</div>

<div aria-label="Selection tools" id="selbar" role="toolbar">
  <button id="btnHL">Highlight</button>
  <button id="btnUH">Remove</button>
  <button id="btnNote">Note</button>
</div>

<div id="notes">
  <header>
    <strong>Notes</strong>
    <div>
      <button id="btnCopy">Copy</button>
      <button id="btnClose">Close</button>
    </div>
  </header>
  <textarea id="noteArea" placeholder="Type your notes here..."></textarea>
</div>

<div id="toast"></div><script>

// 页面滚动功能
function scrollToElement(id) {
  const element = document.getElementById(id);
  if (element) {
    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
    // 高亮显示题目
    element.style.backgroundColor = '#e0e7ff';
    setTimeout(() => {
      element.style.backgroundColor = '';
    }, 1000);
  }
}

// 重置表单功能
function resetForm() {
  // 重置单选按钮
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.checked = false;
  });
  
  // 重置文本输入框
  document.querySelectorAll('input.blank').forEach(input => {
    input.value = '';
  });
  
  // 清除结果
  document.getElementById('results').innerHTML = '';
  
  // 更新导航状态
  updateAnswerStatus();
  
  showToast('Form reset');
}

// Toast通知功能
function showToast(msg) {
  const toastEl = document.getElementById('toast');
  toastEl.textContent = msg;
  toastEl.style.display = 'block';
  setTimeout(() => {
    toastEl.style.display = 'none';
  }, 1500);
}

// 计时器功能
let _t = 0;
let timerRunning = true;
let timerInterval;
const _timerEl = document.getElementById('timer');

function updateTimer() {
  const m = Math.floor(_t / 60);
  const s = _t % 60;
  _timerEl.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}

function startTimer() {
  timerInterval = setInterval(() => {
    if (timerRunning) {
      _t++;
      updateTimer();
    }
  }, 1000);
}

function toggleTimer() {
  if (timerRunning) {
    clearInterval(timerInterval);
    timerRunning = false;
    _timerEl.classList.add('paused');
    showToast('Timer paused');
  } else {
    startTimer();
    timerRunning = true;
    _timerEl.classList.remove('paused');
    showToast('Timer resumed');
  }
}

// 主题切换功能
function toggleTheme() {
  document.body.classList.toggle('dark');
  const isDark = document.body.classList.contains('dark');
  localStorage.setItem('darkMode', isDark);
  const themeButton = document.querySelector('.theme-toggle');
  themeButton.textContent = isDark ? '☀️' : '🌙';
}// 
拖拽分栏功能
var divider = document.getElementById('divider');
var left = document.getElementById('left');
var right = document.getElementById('right');
var dragging = false;

function startDrag(e) {
  dragging = true;
  document.body.style.cursor = 'ew-resize';
  if (e.preventDefault) e.preventDefault();
}

function endDrag() {
  dragging = false;
  document.body.style.cursor = '';
}

function onMove(clientX) {
  var container = document.querySelector('.shell').getBoundingClientRect();
  var x = clientX - container.left;
  x = Math.max(280, Math.min(container.width - 320, x));
  left.style.flex = '0 0 ' + x + 'px';
  right.style.flex = '1 1 auto';
}

divider.addEventListener('mousedown', function(e) { startDrag(e); });
window.addEventListener('mousemove', function(e) { if (dragging) onMove(e.clientX); });
window.addEventListener('mouseup', endDrag);
divider.addEventListener('touchstart', function(e) { startDrag(e.touches[0]); }, { passive: false });
window.addEventListener('touchmove', function(e) { if (dragging) onMove(e.touches[0].clientX); }, { passive: false });
window.addEventListener('touchend', endDrag);

// 高亮和笔记功能
var selbar = document.getElementById('selbar');
var btnHL = document.getElementById('btnHL');
var btnUH = document.getElementById('btnUH');
var btnNote = document.getElementById('btnNote');
var lastRange = null;
var currentHlNode = null;
var keepToolbar = false;

function positionSelbarForRect(rect) {
  selbar.style.display = 'flex';
  requestAnimationFrame(function() {
    var top = window.scrollY + rect.top - selbar.offsetHeight - 8;
    var leftPos = window.scrollX + rect.left + rect.width/2 - selbar.offsetWidth/2;
    selbar.style.top = ((top > 0) ? top : (window.scrollY + rect.bottom + 8)) + 'px';
    selbar.style.left = Math.max(8, leftPos) + 'px';
  });
}

function updateSelbar() {
  var sel = window.getSelection();
  if (!sel || sel.rangeCount === 0 || sel.isCollapsed) {
    selbar.style.display = 'none';
    currentHlNode = null;
    return;
  }
  var range = sel.getRangeAt(0);
  lastRange = range.cloneRange();
  currentHlNode = null;
  positionSelbarForRect(range.getBoundingClientRect());
}

document.getElementById('left').addEventListener('mouseup', updateSelbar);
document.getElementById('right').addEventListener('mouseup', updateSelbar);
document.addEventListener('selectionchange', function() {
  var sel = window.getSelection();
  if (!sel || sel.rangeCount === 0 || sel.isCollapsed) {
    if (!keepToolbar && !currentHlNode) {
      selbar.style.display = 'none';
    }
  }
});
document.addEventListener('scroll', function() {
  if (selbar.style.display === 'flex') updateSelbar();
});

document.addEventListener('mousedown', function(e) {
  var t = e.target;
  if (t.classList && t.classList.contains('hl')) {
    keepToolbar = true;
  } else {
    keepToolbar = false;
  }
}, true);

document.addEventListener('click', function(e) {
  var target = e.target;
  if (target.classList && target.classList.contains('hl')) {
    currentHlNode = target;
    lastRange = null;
    positionSelbarForRect(target.getBoundingClientRect());
    var sel = window.getSelection();
    if (sel) sel.removeAllRanges();
    setTimeout(function() { keepToolbar = false; }, 0);
  }
}, true);func
tion doHighlight() {
  if (currentHlNode) return;
  if (!lastRange || lastRange.collapsed) return;
  
  const startNode = lastRange.startContainer;
  const endNode = lastRange.endContainer;
  
  if (startNode === endNode) {
    try {
      const span = document.createElement('span');
      span.className = 'hl';
      lastRange.surroundContents(span);
      selbar.style.display = 'none';
      showToast('Highlighted');
      return;
    } catch (e) {}
  }
  
  const fragment = lastRange.cloneContents();
  const div = document.createElement('div');
  div.appendChild(fragment);
  
  function processNode(node) {
    if (node.nodeType === Node.TEXT_NODE) {
      if (node.textContent.trim().length > 0) {
        const span = document.createElement('span');
        span.className = 'hl';
        span.textContent = node.textContent;
        return span;
      }
      return node;
    }
    
    if (node.nodeType === Node.ELEMENT_NODE) {
      const isBlock = window.getComputedStyle(node).display.includes('block') ||
        ['P', 'H1', 'H2', 'H3', 'H4', 'DIV'].includes(node.tagName);
      
      const wrapper = isBlock ? document.createElement(node.tagName.toLowerCase()) : document.createElement('span');
      wrapper.className = isBlock ? node.className + ' hl' : 'hl';
      
      Array.from(node.attributes).forEach(attr => {
        wrapper.setAttribute(attr.name, attr.value);
      });
      
      while (node.firstChild) {
        const processedChild = processNode(node.firstChild);
        wrapper.appendChild(processedChild);
      }
      
      return wrapper;
    }
    
    return node;
  }
  
  const highlightedContent = processNode(div);
  lastRange.deleteContents();
  lastRange.insertNode(highlightedContent);
  
  selbar.style.display = 'none';
  showToast('Highlighted');
}

function removeHighlight() {
  if (currentHlNode) {
    const parent = currentHlNode.parentNode;
    while (currentHlNode.firstChild) {
      parent.insertBefore(currentHlNode.firstChild, currentHlNode);
    }
    parent.removeChild(currentHlNode);
    parent.normalize();
    currentHlNode = null;
    selbar.style.display = 'none';
    showToast('Highlight removed');
    return;
  }
  
  if (!lastRange) return;
  
  const selRect = lastRange.getBoundingClientRect();
  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
  const toRemove = [];
  
  while (walker.nextNode()) {
    const node = walker.currentNode;
    if (node.classList && node.classList.contains('hl')) {
      const rect = node.getBoundingClientRect();
      if (!(rect.right < selRect.left || rect.left > selRect.right ||
        rect.bottom < selRect.top || rect.top > selRect.bottom)) {
        toRemove.push(node);
      }
    }
  }
  
  toRemove.forEach(el => {
    const parent = el.parentNode;
    while (el.firstChild) {
      parent.insertBefore(el.firstChild, el);
    }
    parent.removeChild(el);
    parent.normalize();
  });
  
  selbar.style.display = 'none';
  showToast('Highlight removed');
}

btnHL.addEventListener('click', doHighlight);
btnUH.addEventListener('click', removeHighlight);// 笔记
功能
var notes = document.getElementById('notes');
var noteArea = document.getElementById('noteArea');
var btnCopy = document.getElementById('btnCopy');
var btnClose = document.getElementById('btnClose');

function toggleNotes() {
  notes.style.display = (notes.style.display === 'flex' ? 'none' : 'flex');
}
window.toggleNotes = toggleNotes;

btnClose.addEventListener('click', toggleNotes);
btnCopy.addEventListener('click', async function() {
  await navigator.clipboard.writeText(noteArea.value || '');
  showToast('Copied');
});

btnNote.addEventListener('click', function() {
  var text = '';
  if (currentHlNode) {
    text = (currentHlNode.textContent || '').trim();
  } else if (lastRange) {
    var frag = lastRange.cloneContents();
    text = (frag.textContent || '').trim();
  }
  toggleNotes();
  if (text) {
    noteArea.value = (noteArea.value ? noteArea.value + '\n' : '') + '> ' + text + '\n';
  }
  selbar.style.display = 'none';
});

// 答题状态更新
function updateAnswerStatus() {
  for (let i = 1; i <= 13; i++) {
    const inputs = document.querySelectorAll(`input[name="q${i}"]`);
    const navItem = document.getElementById(`q${i}-nav`);
    if (navItem) {
      let answered = false;
      inputs.forEach(input => {
        if ((input.type === 'radio' || input.type === 'checkbox') && input.checked) {
          answered = true;
        } else if (input.type === 'text' && input.value.trim()) {
          answered = true;
        }
      });
      if (answered) {
        navItem.classList.add('answered');
      } else {
        navItem.classList.remove('answered');
      }
    }
  }
}

// 答案和评分系统
var answers = {
  "q1": "TRUE", "q2": "FALSE", "q3": "NOT GIVEN", "q4": "TRUE", 
  "q5": "C", "q6": "F", "q7": "E", "q8": "B",
  "q9": "seawater", "q10": "ships", "q11": "tube", "q12": "hydrophones", "q13": "rainfall"
};

function grade() {
  var total = 0, correct = 0, lines = [];
  
  // 检查单选题和文本题 (1-13)
  for (let n = 1; n <= 13; n++) {
    const q = `q${n}`;
    total++;
    const selected = document.querySelector(`input[name="${q}"]:checked`);
    const textInput = document.querySelector(`input[name="${q}"][type="text"]`);
    let userAnswer = '';
    
    if (selected) {
      userAnswer = selected.value;
    } else if (textInput) {
      userAnswer = textInput.value.trim();
    }
    
    const isCorrect = userAnswer.toLowerCase() === answers[q].toLowerCase();
    if (isCorrect) correct++;
    lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✓' : '✗'}`);
  }
  
  // 显示结果
  const acc = Math.round(100 * correct / total);
  document.getElementById('results').innerHTML = `
    <p><strong>Score:</strong> ${correct}/${total} <span class="badge">Accuracy ${acc}%</span></p>
    <pre>${lines.join('\n')}</pre>
  `;
  
  // 显示答案
  document.getElementById('answerContent').innerHTML = `
    <ol>
      <li>1 → TRUE</li>
      <li>2 → FALSE</li>
      <li>3 → NOT GIVEN</li>
      <li>4 → TRUE</li>
      <li>5 → C</li>
      <li>6 → F</li>
      <li>7 → E</li>
      <li>8 → B</li>
      <li>9 → seawater</li>
      <li>10 → ships</li>
      <li>11 → tube</li>
      <li>12 → hydrophones</li>
      <li>13 → rainfall</li>
    </ol>
  `;
  document.querySelector('#answerBox .badge').textContent = 'tap to view';
  
  updateAnswerStatus();
}// 页面加载完成后初
始化
document.addEventListener('DOMContentLoaded', function() {
  startTimer();
  updateAnswerStatus(); // 初始化答题状态
  
  // 加载保存的主题
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark');
    document.querySelector('.theme-toggle').textContent = '☀️';
  }
});

// 监听答案变化
document.addEventListener('change', updateAnswerStatus);
document.addEventListener('input', updateAnswerStatus);

// 练习页面增强脚本集成
function loadPracticePageEnhancer() {
  const script = document.createElement('script');
  script.src = '../../../js/practice-page-enhancer.js';
  script.onload = function() {
    console.log('练习页面增强脚本已加载');
  };
  script.onerror = function() {
    console.error('练习页面增强脚本加载失败');
    // 降级到内联增强
    loadInlineEnhancer();
  };
  document.head.appendChild(script);
}

// 内联增强器（降级方案）
function loadInlineEnhancer() {
  if (window.practicePageEnhancer) return;
  
  window.practicePageEnhancer = {
    initialize: function() {
      console.log('[InlineEnhancer] 内联增强器已初始化');
      this.setupCommunication();
      this.setupAnswerListeners();
      this.interceptSubmit();
    },
    
    setupCommunication: function() {
      this.parentWindow = window.opener || window.parent;
      window.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'INIT_SESSION') {
          this.sessionId = event.data.data.sessionId;
          this.sendMessage('SESSION_READY', {
            pageType: this.detectPageType(),
            url: window.location.href
          });
        }
      });
    },
    
    detectPageType: function() {
      const title = document.title || '';
      if (title.includes('P1')) return 'P1';
      if (title.includes('P2')) return 'P2';
      if (title.includes('P3')) return 'P3';
      return 'unknown';
    },
    
    setupAnswerListeners: function() {
      this.answers = {};
      this.startTime = Date.now();
      
      document.addEventListener('change', (e) => {
        if (e.target.name && e.target.name.startsWith('q')) {
          this.answers[e.target.name] = e.target.value;
        }
      });
      
      document.addEventListener('input', (e) => {
        if (e.target.name && e.target.name.startsWith('q')) {
          this.answers[e.target.name] = e.target.value;
        }
      });
    },
    
    interceptSubmit: function() {
      // 拦截grade函数
      if (typeof window.grade === 'function') {
        const originalGrade = window.grade;
        window.grade = () => {
          const result = originalGrade();
          setTimeout(() => this.handleSubmit(), 200);
          return result;
        };
      }
      
      // 监听提交按钮
      document.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON' &&
          (e.target.textContent.includes('Submit') ||
            e.target.onclick && e.target.onclick.toString().includes('grade'))) {
          setTimeout(() => this.handleSubmit(), 300);
        }
      });
    },
    
    handleSubmit: function() {
      const results = {
        sessionId: this.sessionId,
        startTime: this.startTime,
        endTime: Date.now(),
        duration: Math.round((Date.now() - this.startTime) / 1000),
        answers: this.answers,
        scoreInfo: this.extractScore(),
        pageType: this.detectPageType(),
        url: window.location.href
      };
      
      this.sendMessage('PRACTICE_COMPLETE', results);
    },
    
    extractScore: function() {
      const resultsEl = document.getElementById('results');
      if (!resultsEl) return null;
      
      const text = resultsEl.textContent || '';
      const scoreMatch = text.match(/Score:\s*(\d+)\/(\d+)/i);
      if (scoreMatch) {
        const correct = parseInt(scoreMatch[1]);
        const total = parseInt(scoreMatch[2]);
        return {
          correct: correct,
          total: total,
          accuracy: total > 0 ? correct / total : 0,
          percentage: Math.round((correct / total) * 100),
          source: 'inline_extraction'
        };
      }
      return null;
    },
    
    sendMessage: function(type, data) {
      if (this.parentWindow) {
        this.parentWindow.postMessage({
          type: type,
          data: data,
          source: 'practice_page'
        }, '*');
      }
    }
  };
  
  // 初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      window.practicePageEnhancer.initialize();
    });
  } else {
    window.practicePageEnhancer.initialize();
  }
}

// 加载增强脚本
loadPracticePageEnhancer();
</script>

</body>
</html>