<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>P1 – A Brief History of Tea</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --line: #e5e7eb;
      --bg: #f6f7fb;
      --panel: #fff;
      --accent: #3b82f6;
      --muted: #6b7280;
      --shadow: 0 6px 20px rgba(0, 0, 0, .12);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      padding-bottom: 82px;
    }

    /* 布局样式 */
    .shell {
      display: flex;
      height: 100vh;
      width: 100%;
    }

    .pane {
      background: var(--panel);
      overflow: auto;
      padding: 20px;
    }

    #left {
      flex: 0 0 50%;
      min-width: 280px;
    }

    #right {
      flex: 1 1 auto;
      min-width: 320px;
      background: #fbfbff;
      border-left: 1px solid var(--line);
    }

    #divider {
      flex: 0 0 8px;
      background: linear-gradient(90deg, #e5e7eb, #d1d5db);
      cursor: ew-resize;
      position: relative;
      z-index: 5;
      user-select: none;
    }

    /* 文本样式 */
    h2,
    h3,
    h4 {
      margin: 0 0 10px;
    }

    #left p {
      margin: 0 0 12px;
      line-height: 1.6;
      word-break: normal;
      overflow-wrap: normal;
      hyphens: none;
    }

    /* 组件样式 */
    .group {
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 14px;
    }

    input.blank {
      border: none;
      border-bottom: 1px solid #9ca3af;
      padding: 2px 4px;
      font-size: 1em;
      background: transparent;
      min-width: 80px;
    }

    input.blank:focus {
      outline: none;
      border-bottom: 2px solid var(--accent);
    }

    /* 按钮样式 */
    button {
      padding: 8px 12px;
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }

    button:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
    }

    button.primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    button.primary:hover {
      background: #2563eb;
    }

    /* 计时器样式 */
    #timer {
      background: #fff;
      color: var(--muted);
      border: 1px solid var(--line);
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      transition: all 0.2s;
      min-width: 70px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
    }

    #timer:hover {
      background: #f1f5f9;
      border-color: var(--accent);
    }

    #timer.paused {
      color: #ef4444;
      border-color: #fecaca;
      background: #fef2f2;
    }

    /* 主题切换按钮 */
    .theme-toggle {
      background: #fff;
      color: var(--muted);
      border: 1px solid var(--line);
      border-radius: 6px;
      width: 36px;
      height: 36px;
      font-size: 16px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .theme-toggle:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      transform: scale(1.05);
    }

    .theme-toggle:active {
      transform: scale(0.95);
    }

    /* 深色模式样式 */
    body.dark {
      --bg: #0f172a;
      --panel: #1e293b;
      --line: #334155;
      --muted: #94a3b8;
      color: #e2e8f0;
    }

    body.dark #right {
      background: #0f172a;
    }

    body.dark .group {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark button {
      background: #1e293b;
      color: #e2e8f0;
      border-color: #334155;
    }

    body.dark button:hover {
      background: #334155;
    }

    body.dark button.primary {
      background: var(--accent);
      color: #fff;
    }

    body.dark #results {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark #notes {
      background: #1e293b;
      border-color: #334155;
      color: #e2e8f0;
    }

    body.dark .practice-nav {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark .q-item {
      background: #0f172a;
      color: #e2e8f0;
      border-color: #334155;
    }

    body.dark .q-item:hover {
      background: #334155;
    }

    body.dark .q-item.answered {
      background: #1e40af;
      border-color: var(--accent);
      color: #93c5fd;
    }

    body.dark #timer {
      background: #1e293b;
      color: #e2e8f0;
      border-color: #334155;
    }

    body.dark #timer:hover {
      background: #334155;
      border-color: var(--accent);
    }

    body.dark details.answerbox {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark input.blank {
      color: #e2e8f0;
      border-bottom-color: #64748b;
    }

    body.dark input.blank:focus {
      border-bottom-color: var(--accent);
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
      .shell {
        flex-direction: column;
      }

      #left,
      #right {
        flex: none;
        min-width: auto;
      }

      #divider {
        display: none;
      }

      .practice-nav .controls {
        gap: 8px;
      }

      #timer {
        font-size: 12px;
        padding: 3px 8px;
      }

      .theme-toggle {
        width: 32px;
        height: 32px;
        font-size: 14px;
      }

      #notes {
        width: calc(100vw - 24px);
        right: 12px;
        left: 12px;
      }
    }

    /* 选择工具栏 */
    #selbar {
      position: fixed;
      display: none;
      z-index: 2000;
      background: #111;
      color: #fff;
      border-radius: 8px;
      padding: 6px;
      box-shadow: var(--shadow);
      font-size: 13px;
      gap: 6px;
      align-items: center;
    }

    #selbar button {
      background: transparent;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, .25);
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
    }

    #selbar button:hover {
      border-color: #fff;
    }

    /* 笔记面板 */
    #notes {
      position: fixed;
      right: 12px;
      bottom: 12px;
      width: 320px;
      height: 42vh;
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 12px;
      display: none;
      flex-direction: column;
      z-index: 1500;
      box-shadow: var(--shadow);
    }

    #notes header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      border-bottom: 1px solid var(--line);
    }

    #notes textarea {
      flex: 1;
      border: 0;
      padding: 10px;
      resize: none;
      font-size: 14px;
      line-height: 1.5;
    }

    /* Toast通知 */
    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 8px 16px;
      border-radius: 4px;
      display: none;
      z-index: 3000;
      font-size: 14px;
    }

    /* 答题导航 */
    .practice-nav {
      background: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .05);
      flex-wrap: wrap;
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      border-top: 2px solid var(--line);
      z-index: 4000;
    }

    .practice-nav .title {
      font-weight: 600;
      color: var(--muted);
    }

    .practice-nav .questions {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .practice-nav .q-item {
      padding: 6px 10px;
      border: 1px solid var(--line);
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      min-width: 36px;
      text-align: center;
    }

    .practice-nav .q-item:hover {
      background: #f1f5f9;
      border-color: var(--accent);
    }

    .practice-nav .q-item.answered {
      background: #e0e7ff;
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 500;
    }

    .practice-nav .q-item.active {
      background: var(--accent);
      color: #fff;
    }

    .practice-nav .controls {
      display: flex;
      gap: 12px;
      margin-left: auto;
      align-items: center;
    }

    /* 答题结果显示 */
    #results {
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 12px;
      margin: 16px 0;
      font-family: monospace;
      white-space: pre-wrap;
    }

    #results p {
      margin: 0 0 8px;
    }

    .badge {
      background: #e0e7ff;
      color: var(--accent);
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
    }

    /* 答案框 */
    details.answerbox {
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 12px;
      margin-top: 10px;
    }

    details.answerbox summary {
      cursor: pointer;
      font-weight: 600;
      list-style: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    details.answerbox summary::-webkit-details-marker {
      display: none;
    }

    #answerContent {
      margin-top: 10px;
    }

    #answerContent ol {
      margin: 0;
      padding-left: 20px;
    }

    #answerContent li {
      margin: 4px 0;
    }

    /* 高亮样式 */
    .hl {
      background: #ffeb3b;
      color: #000;
    }

    body.dark .hl {
      background: #8a6d00;
      color: #fff;
    }

    /* 滚动条样式 */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #c5c5d2;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #999;
    }

    body.dark ::-webkit-scrollbar-thumb {
      background: #4a5568;
    }

    body.dark ::-webkit-scrollbar-thumb:hover {
      background: #718096;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th,
    td {
      border: 1px solid var(--line);
      padding: 6px;
      text-align: center;
      font-size: 14px;
    }

    th:first-child,
    td:first-child {
      width: 92px;
    }

    .hl {
      background: #fff3a3;
      box-shadow: inset 0 -2px 0 rgba(0, 0, 0, .05);
      cursor: pointer;
    }

    .hl:hover {
      filter: brightness(0.98);
    }

    #selbar {
      position: absolute;
      display: none;
      z-index: 2000;
      background: #111;
      color: #fff;
      border-radius: 8px;
      padding: 6px;
      box-shadow: var(--shadow);
      font-size: 13px;
      gap: 6px;
      align-items: center;
    }

    #selbar button {
      background: transparent;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, .25);
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
    }

    #selbar button[disabled] {
      opacity: .45;
      cursor: not-allowed;
    }

    #selbar button:hover {
      border-color: #fff;
    }

    #notes {
      position: fixed;
      right: 12px;
      bottom: 12px;
      width: 320px;
      height: 42vh;
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 12px;
      display: none;
      flex-direction: column;
      z-index: 1500;
      box-shadow: var(--shadow);
    }

    #notes header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 10px;
      border-bottom: 1px solid var(--line);
    }

    #notes textarea {
      flex: 1;
      border: 0;
      padding: 10px;
      resize: none;
      font-size: 14px;
      line-height: 1.5;
    }

    #toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
      background: #111;
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      display: none;
      z-index: 2500;
    }
  </style>
</head>

<body>

  <div class="practice-nav">
    <div class="title">Questions</div>
    <div class="questions">
      <div class="q-item" id="q1-nav" onclick="scrollToElement('q1-anchor')">1</div>
      <div class="q-item" id="q2-nav" onclick="scrollToElement('q2-anchor')">2</div>
      <div class="q-item" id="q3-nav" onclick="scrollToElement('q3-anchor')">3</div>
      <div class="q-item" id="q4-nav" onclick="scrollToElement('q4-anchor')">4</div>
      <div class="q-item" id="q5-nav" onclick="scrollToElement('q5-anchor')">5</div>
      <div class="q-item" id="q6-nav" onclick="scrollToElement('q6-anchor')">6</div>
      <div class="q-item" id="q7-nav" onclick="scrollToElement('q7-anchor')">7</div>
      <div class="q-item" id="q8-nav" onclick="scrollToElement('q8-anchor')">8</div>
      <div class="q-item" id="q9-nav" onclick="scrollToElement('q9-anchor')">9</div>
      <div class="q-item" id="q10-nav" onclick="scrollToElement('q10-anchor')">10</div>
      <div class="q-item" id="q11-nav" onclick="scrollToElement('q11-anchor')">11</div>
      <div class="q-item" id="q12-nav" onclick="scrollToElement('q12-anchor')">12</div>
      <div class="q-item" id="q13-nav" onclick="scrollToElement('q13-anchor')">13</div>
    </div>
    <div class="controls">
      <span id="timer" onclick="toggleTimer()">00:00</span>
      <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">🌙</button>
    </div>
  </div>

  <div class="shell">
    <section class="pane" id="left">

      <h2>READING PASSAGE 1</h2>
      <p>You should spend about 20 minutes on Questions 1–13, which are based on Reading Passage 1 below.</p>
      <h3>A Brief History of Tea</h3>

      <h4>Paragraph A</h4>
      <p>The story of tea began in ancient China over 5,000 years ago. According to legend, the Emperor Shen Nung was a
        skilled ruler, creative scientist and patron of the arts. His far-sighted edicts required, among other things,
        that all drinking water be boiled as a hygienic precaution. One summer day, while visiting a distant region of
        his realm, he and the court stopped to rest. In accordance with his ruling, the servants began to boil water for
        the court to drink. Dried leaves from a nearby bush fell into the boiling water, and as the leaves infused the
        water turned brown. As a scientist, the Emperor was intrigued by the new liquid, drank some, and found it very
        refreshing. And so, according to legend, tea was created.</p>

      <h4>Paragraph B</h4>
      <p>Tea consumption spread throughout Chinese culture, reaching into every aspect of society. The first definitive
        book was written on tea – a book clearly reflecting Zen Buddhist philosophy – 1,200 years ago. The first tea
        seeds were brought to Japan by a returning Buddhist priest, who had seen the value of tea in enhancing
        meditation in China. As a result, he is known as the “Father of Tea” in Japan. Because of this early
        association, tea in Japan has always been linked with Zen Buddhism. Tea received the Japanese Emperor’s support
        almost instantly and spread rapidly from the royal court and monasteries to other sections of society.</p>

      <h4>Paragraph C</h4>
      <p>Tea was elevated to an art form in the Japanese tea ceremony, in which supreme importance is given to making
        tea in the most perfect, most polite, most graceful, most charming manner possible. Such a purity of expression
        prompted the creation of a particular form of architecture for tea houses, duplicating the simplicity of a
        forest cottage. The cultural/artistic hostesses of Japan, the geishas, began to specialise in the presentation
        of the tea ceremony. However, as more and more people became involved in the excitement surrounding tea, the
        purity of the original concept was lost, and for a period the tea ceremony became corrupted, boisterous and
        highly embellished. Efforts were then made to return to the earlier simplicity, with the result that, in the
        15th and 16th centuries, tea was viewed as the ultimate gift. Even warlords paused for tea before battles.</p>

      <h4>Paragraph D</h4>
      <p>While tea was at this high level of development in parts of Asia, information concerning the then-unknown
        beverage began to filter back to Europe. Earlier traders had mentioned it, but were unclear as to whether tea
        should be eaten or drunk. The first European to personally encounter tea and write about it was Portuguese –
        Portugal, with her technologically advanced navy, had been successful in gaining the first right of trade with
        China.</p>

      <h4>Paragraph E</h4>
      <p>Tea finally arrived in Europe in the 16th century, brought to Holland by the country’s navy, and became very
        fashionable in the Dutch capital, The Hague. This was due in part to tea being very expensive (over $100 per
        pound), which immediately made it the domain of the wealthy. Slowly, as the amount of tea imported increased,
        the price fell, and by 1675 it was available in common food shops throughout Holland.</p>

      <h4>Paragraph F</h4>
      <p>As the consumption of tea increased dramatically in Dutch society, doctors and university authorities in
        Holland argued as to its benefits or drawbacks. The public largely ignored the scholarly debate and continued to
        enjoy their new beverage, though the controversy lasted from 1635 to roughly 1657. Throughout this period,
        France and Holland led Europe in the use of tea.</p>

      <h4>Paragraph G</h4>
      <p>As the craze for all things oriental swept through Europe, tea became part of everyday life. Adding milk to the
        drink was first mentioned in 1680. Around that time, Dutch inns provided the first restaurant service of tea.
        Innkeepers would furnish guests with a portable tea set complete with a heating unit. The Dutchman would then
        prepare tea for himself and his friends outside in the inn garden. Tea remained popular in France for only about
        fifty years, being replaced by a preference for wine, chocolate and exotic coffees. Tea was introduced into
        England in 1660 by King Charles II and his Portuguese queen, who were both confirmed tea drinkers. Tea mania
        swept across England as it had earlier spread throughout France and Holland. By 1708, tea importation had risen
        to thirteen times the 1699 level. Tea was drunk by all levels of society.</p>

      <h4>Paragraph H</h4>
      <p>Russian interest in tea began as early as 1618, when the Chinese embassy in Moscow presented several chests of
        tea to the Emperor, Czar Alexis. Later in the century, a trade treaty between Russia and China allowed caravans
        to cross back and forth freely between the two countries. Still, the journey was not easy. The average caravan
        consisted of 200 to 300 camels, and the 18,000-kilometre trip took over 16 months to complete. Eventually,
        however, tea became – as it still is – one of the most popular drinks in the country.</p>

    </section>

    <div id="divider" title="Drag to resize"></div>

    <section class="pane" id="right">
      <h3>Questions</h3>

      <div class="group">
        <h4>Questions 1–8</h4>
        <p>Reading Passage 1 has eight paragraphs A–H.</p>
        <p>Choose the correct heading for each paragraph from the list of headings below.</p>
        <p>Write the correct number, <strong>i–x</strong>, in boxes <strong>1–8</strong> on your answer sheet.</p>

        <div class="headings">
          <p><strong>List of Headings</strong></p>
          <ol type="i">
            <li>Not enough tea to meet demand</li>
            <li>Religious objections</li>
            <li>In – and sometimes out – of fashion</li>
            <li>A connection between tea and religion</li>
            <li>A luxury item</li>
            <li>News of tea reaches another continent</li>
            <li>Is tea a good or a bad thing?</li>
            <li>A chance discovery</li>
            <li>Tea-making as a ritual</li>
            <li>Difficulties in importing tea</li>
          </ol>
        </div>

        <div id="q1-anchor">
          <table>
            <tr>
              <th>Paragraph</th>
              <th>i</th>
              <th>ii</th>
              <th>iii</th>
              <th>iv</th>
              <th>v</th>
              <th>vi</th>
              <th>vii</th>
              <th>viii</th>
              <th>ix</th>
              <th>x</th>
            </tr>
            <tr id="q1-anchor">
              <td>A</td>
              <td><input type="radio" name="q1" value="i"></td>
              <td><input type="radio" name="q1" value="ii"></td>
              <td><input type="radio" name="q1" value="iii"></td>
              <td><input type="radio" name="q1" value="iv"></td>
              <td><input type="radio" name="q1" value="v"></td>
              <td><input type="radio" name="q1" value="vi"></td>
              <td><input type="radio" name="q1" value="vii"></td>
              <td><input type="radio" name="q1" value="viii"></td>
              <td><input type="radio" name="q1" value="ix"></td>
              <td><input type="radio" name="q1" value="x"></td>
            </tr>
            <tr id="q2-anchor">
              <td>B</td>
              <td><input type="radio" name="q2" value="i"></td>
              <td><input type="radio" name="q2" value="ii"></td>
              <td><input type="radio" name="q2" value="iii"></td>
              <td><input type="radio" name="q2" value="iv"></td>
              <td><input type="radio" name="q2" value="v"></td>
              <td><input type="radio" name="q2" value="vi"></td>
              <td><input type="radio" name="q2" value="vii"></td>
              <td><input type="radio" name="q2" value="viii"></td>
              <td><input type="radio" name="q2" value="ix"></td>
              <td><input type="radio" name="q2" value="x"></td>
            </tr>
            <tr id="q3-anchor">
              <td>C</td>
              <td><input type="radio" name="q3" value="i"></td>
              <td><input type="radio" name="q3" value="ii"></td>
              <td><input type="radio" name="q3" value="iii"></td>
              <td><input type="radio" name="q3" value="iv"></td>
              <td><input type="radio" name="q3" value="v"></td>
              <td><input type="radio" name="q3" value="vi"></td>
              <td><input type="radio" name="q3" value="vii"></td>
              <td><input type="radio" name="q3" value="viii"></td>
              <td><input type="radio" name="q3" value="ix"></td>
              <td><input type="radio" name="q3" value="x"></td>
            </tr>
            <tr id="q4-anchor">
              <td>D</td>
              <td><input type="radio" name="q4" value="i"></td>
              <td><input type="radio" name="q4" value="ii"></td>
              <td><input type="radio" name="q4" value="iii"></td>
              <td><input type="radio" name="q4" value="iv"></td>
              <td><input type="radio" name="q4" value="v"></td>
              <td><input type="radio" name="q4" value="vi"></td>
              <td><input type="radio" name="q4" value="vii"></td>
              <td><input type="radio" name="q4" value="viii"></td>
              <td><input type="radio" name="q4" value="ix"></td>
              <td><input type="radio" name="q4" value="x"></td>
            </tr>
            <tr id="q5-anchor">
              <td>E</td>
              <td><input type="radio" name="q5" value="i"></td>
              <td><input type="radio" name="q5" value="ii"></td>
              <td><input type="radio" name="q5" value="iii"></td>
              <td><input type="radio" name="q5" value="iv"></td>
              <td><input type="radio" name="q5" value="v"></td>
              <td><input type="radio" name="q5" value="vi"></td>
              <td><input type="radio" name="q5" value="vii"></td>
              <td><input type="radio" name="q5" value="viii"></td>
              <td><input type="radio" name="q5" value="ix"></td>
              <td><input type="radio" name="q5" value="x"></td>
            </tr>
            <tr id="q6-anchor">
              <td>F</td>
              <td><input type="radio" name="q6" value="i"></td>
              <td><input type="radio" name="q6" value="ii"></td>
              <td><input type="radio" name="q6" value="iii"></td>
              <td><input type="radio" name="q6" value="iv"></td>
              <td><input type="radio" name="q6" value="v"></td>
              <td><input type="radio" name="q6" value="vi"></td>
              <td><input type="radio" name="q6" value="vii"></td>
              <td><input type="radio" name="q6" value="viii"></td>
              <td><input type="radio" name="q6" value="ix"></td>
              <td><input type="radio" name="q6" value="x"></td>
            </tr>
            <tr id="q7-anchor">
              <td>G</td>
              <td><input type="radio" name="q7" value="i"></td>
              <td><input type="radio" name="q7" value="ii"></td>
              <td><input type="radio" name="q7" value="iii"></td>
              <td><input type="radio" name="q7" value="iv"></td>
              <td><input type="radio" name="q7" value="v"></td>
              <td><input type="radio" name="q7" value="vi"></td>
              <td><input type="radio" name="q7" value="vii"></td>
              <td><input type="radio" name="q7" value="viii"></td>
              <td><input type="radio" name="q7" value="ix"></td>
              <td><input type="radio" name="q7" value="x"></td>
            </tr>
            <tr id="q8-anchor">
              <td>H</td>
              <td><input type="radio" name="q8" value="i"></td>
              <td><input type="radio" name="q8" value="ii"></td>
              <td><input type="radio" name="q8" value="iii"></td>
              <td><input type="radio" name="q8" value="iv"></td>
              <td><input type="radio" name="q8" value="v"></td>
              <td><input type="radio" name="q8" value="vi"></td>
              <td><input type="radio" name="q8" value="vii"></td>
              <td><input type="radio" name="q8" value="viii"></td>
              <td><input type="radio" name="q8" value="ix"></td>
              <td><input type="radio" name="q8" value="x"></td>
            </tr>
          </table>
        </div>
      </div>

      <div class="group">
        <h4>Questions 9–13</h4>
        <p>Look at the following statements (Questions 9–13) and the list of countries below.</p>
        <p>Match each statement with the correct country, <strong>A–G</strong>.</p>
        <p><strong>List of Countries:</strong> A China &nbsp; B Japan &nbsp; C Portugal &nbsp; D Holland &nbsp; E France
          &nbsp; F England &nbsp; G Russia</p>

        <ol start="9">
          <li id="q9-anchor">Claims that tea might be harmful failed to affect its popularity.<br>
            <label><input type="radio" name="q9" value="A"> A</label> <label><input type="radio" name="q9" value="B">
              B</label> <label><input type="radio" name="q9" value="C"> C</label> <label><input type="radio" name="q9"
                value="D"> D</label> <label><input type="radio" name="q9" value="E"> E</label> <label><input
                type="radio" name="q9" value="F"> F</label> <label><input type="radio" name="q9" value="G"> G</label>
          </li>
          <li id="q10-anchor">Tea lost favour to other drinks.<br>
            <label><input type="radio" name="q10" value="A"> A</label> <label><input type="radio" name="q10" value="B">
              B</label> <label><input type="radio" name="q10" value="C"> C</label> <label><input type="radio" name="q10"
                value="D"> D</label> <label><input type="radio" name="q10" value="E"> E</label> <label><input
                type="radio" name="q10" value="F"> F</label> <label><input type="radio" name="q10" value="G"> G</label>
          </li>
          <li id="q11-anchor">Special buildings were constructed in which to drink tea.<br>
            <label><input type="radio" name="q11" value="A"> A</label> <label><input type="radio" name="q11" value="B">
              B</label> <label><input type="radio" name="q11" value="C"> C</label> <label><input type="radio" name="q11"
                value="D"> D</label> <label><input type="radio" name="q11" value="E"> E</label> <label><input
                type="radio" name="q11" value="F"> F</label> <label><input type="radio" name="q11" value="G"> G</label>
          </li>
          <li id="q12-anchor">Animals were involved in importing tea.<br>
            <label><input type="radio" name="q12" value="A"> A</label> <label><input type="radio" name="q12" value="B">
              B</label> <label><input type="radio" name="q12" value="C"> C</label> <label><input type="radio" name="q12"
                value="D"> D</label> <label><input type="radio" name="q12" value="E"> E</label> <label><input
                type="radio" name="q12" value="F"> F</label> <label><input type="radio" name="q12" value="G"> G</label>
          </li>
          <li>A ruler’s specialist knowledge led to an interest in tea.<br>
            <label><input type="radio" name="q13" value="A"> A</label> <label><input type="radio" name="q13" value="B">
              B</label> <label><input type="radio" name="q13" value="C"> C</label> <label><input type="radio" name="q13"
                value="D"> D</label> <label><input type="radio" name="q13" value="E"> E</label> <label><input
                type="radio" name="q13" value="F"> F</label> <label><input type="radio" name="q13" value="G"> G</label>
          </li>
        </ol>
      </div>

      <div style="display:flex;gap:8px;margin-bottom:10px;">
        <button class="primary" onclick="grade()">Submit</button>
        <button onclick="resetForm()">Reset</button>
        <button onclick="toggleNotes()">Notes</button>
      </div>
      <div id="results"></div>
      <details class="answerbox" id="answerBox">
        <summary>Show answers (click to toggle) <span class="badge">hidden</span></summary>
        <div id="answerContent"></div>
      </details>
    </section>
  </div>

  <div id="selbar" role="toolbar" aria-label="Selection tools">
    <button id="btnHL">Highlight</button>
    <button id="btnUH">Remove</button>
    <button id="btnNote">Note</button>
  </div>

  <div id="notes">
    <header>
      <strong>Notes</strong>
      <div>
        <button id="btnCopy">Copy</button>
        <button id="btnClose">Close</button>
      </div>
    </header>
    <textarea id="noteArea" placeholder="Type your notes here..."></textarea>
  </div>

  <div id="toast"></div>

  <script>
    // 页面滚动功能
    function scrollToElement(id) {
      const element = document.getElementById(id);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        // 高亮显示题目
        element.style.backgroundColor = '#e0e7ff';
        setTimeout(() => {
          element.style.backgroundColor = '';
        }, 1000);
      }
    }

    // 重置表单功能
    function resetForm() {
      // 重置单选按钮
      document.querySelectorAll('input[type="radio"]').forEach(radio => {
        radio.checked = false;
      });

      // 重置文本输入框
      document.querySelectorAll('input.blank').forEach(input => {
        input.value = '';
      });

      // 清除结果
      document.getElementById('results').innerHTML = '';

      // 更新导航状态
      updateAnswerStatus();

      showToast('Form reset');
    }

    // Toast通知功能
    function showToast(msg) {
      const toastEl = document.getElementById('toast');
      toastEl.textContent = msg;
      toastEl.style.display = 'block';
      setTimeout(() => {
        toastEl.style.display = 'none';
      }, 1500);
    }

    // 计时器功能
    let _t = 0;
    let timerRunning = true;
    let timerInterval;
    const _timerEl = document.getElementById('timer');

    function updateTimer() {
      const m = Math.floor(_t / 60);
      const s = _t % 60;
      _timerEl.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        if (timerRunning) {
          _t++;
          updateTimer();
        }
      }, 1000);
    }

    function toggleTimer() {
      if (timerRunning) {
        clearInterval(timerInterval);
        timerRunning = false;
        _timerEl.classList.add('paused');
        showToast('Timer paused');
      } else {
        startTimer();
        timerRunning = true;
        _timerEl.classList.remove('paused');
        showToast('Timer resumed');
      }
    }

    // 主题切换功能
    function toggleTheme() {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem('darkMode', isDark);
      const themeButton = document.querySelector('.theme-toggle');
      themeButton.textContent = isDark ? '☀️' : '🌙';
    }

    // 拖拽分栏功能
    var divider = document.getElementById('divider');
    var left = document.getElementById('left');
    var right = document.getElementById('right');
    var dragging = false;

    function startDrag(e) {
      dragging = true;
      document.body.style.cursor = 'ew-resize';
      if (e.preventDefault) e.preventDefault();
    }

    function endDrag() {
      dragging = false;
      document.body.style.cursor = '';
    }

    function onMove(clientX) {
      var container = document.querySelector('.shell').getBoundingClientRect();
      var x = clientX - container.left;
      x = Math.max(280, Math.min(container.width - 320, x));
      left.style.flex = '0 0 ' + x + 'px';
      right.style.flex = '1 1 auto';
    }

    divider.addEventListener('mousedown', function (e) { startDrag(e); });
    window.addEventListener('mousemove', function (e) { if (dragging) onMove(e.clientX); });
    window.addEventListener('mouseup', endDrag);
    divider.addEventListener('touchstart', function (e) { startDrag(e.touches[0]); }, { passive: false });
    window.addEventListener('touchmove', function (e) { if (dragging) onMove(e.touches[0].clientX); }, { passive: false });
    window.addEventListener('touchend', endDrag);

    // 高亮和笔记功能
    var selbar = document.getElementById('selbar');
    var btnHL = document.getElementById('btnHL');
    var btnUH = document.getElementById('btnUH');
    var btnNote = document.getElementById('btnNote');
    var lastRange = null;
    var currentHlNode = null;
    var keepToolbar = false;

    function positionSelbarForRect(rect) {
      selbar.style.display = 'flex';
      requestAnimationFrame(function () {
        var top = window.scrollY + rect.top - selbar.offsetHeight - 8;
        var leftPos = window.scrollX + rect.left + rect.width / 2 - selbar.offsetWidth / 2;
        selbar.style.top = ((top > 0) ? top : (window.scrollY + rect.bottom + 8)) + 'px';
        selbar.style.left = Math.max(8, leftPos) + 'px';
      });
    }

    function updateSelbar() {
      var sel = window.getSelection();
      if (!sel || sel.rangeCount === 0 || sel.isCollapsed) {
        selbar.style.display = 'none';
        currentHlNode = null;
        return;
      }
      var range = sel.getRangeAt(0);
      lastRange = range.cloneRange();
      currentHlNode = null;
      positionSelbarForRect(range.getBoundingClientRect());
    }

    document.getElementById('left').addEventListener('mouseup', updateSelbar);
    document.getElementById('right').addEventListener('mouseup', updateSelbar);
    document.addEventListener('selectionchange', function () {
      var sel = window.getSelection();
      if (!sel || sel.rangeCount === 0 || sel.isCollapsed) {
        if (!keepToolbar && !currentHlNode) {
          selbar.style.display = 'none';
        }
      }
    });
    document.addEventListener('scroll', function () {
      if (selbar.style.display === 'flex') updateSelbar();
    });

    document.addEventListener('mousedown', function (e) {
      var t = e.target;
      if (t.classList && t.classList.contains('hl')) {
        keepToolbar = true;
      } else {
        keepToolbar = false;
      }
    }, true);

    document.addEventListener('click', function (e) {
      var target = e.target;
      if (target.classList && target.classList.contains('hl')) {
        currentHlNode = target;
        lastRange = null;
        positionSelbarForRect(target.getBoundingClientRect());
        var sel = window.getSelection();
        if (sel) sel.removeAllRanges();
        setTimeout(function () { keepToolbar = false; }, 0);
      }
    }, true);

    function doHighlight() {
      if (currentHlNode) return;
      if (!lastRange || lastRange.collapsed) return;

      const startNode = lastRange.startContainer;
      const endNode = lastRange.endContainer;

      if (startNode === endNode) {
        try {
          const span = document.createElement('span');
          span.className = 'hl';
          lastRange.surroundContents(span);
          selbar.style.display = 'none';
          showToast('Highlighted');
          return;
        } catch (e) { }
      }

      const fragment = lastRange.cloneContents();
      const div = document.createElement('div');
      div.appendChild(fragment);

      function processNode(node) {
        if (node.nodeType === Node.TEXT_NODE) {
          if (node.textContent.trim().length > 0) {
            const span = document.createElement('span');
            span.className = 'hl';
            span.textContent = node.textContent;
            return span;
          }
          return node;
        }

        if (node.nodeType === Node.ELEMENT_NODE) {
          const isBlock = window.getComputedStyle(node).display.includes('block') ||
            ['P', 'H1', 'H2', 'H3', 'H4', 'DIV'].includes(node.tagName);

          const wrapper = isBlock ? document.createElement(node.tagName.toLowerCase()) : document.createElement('span');
          wrapper.className = isBlock ? node.className + ' hl' : 'hl';

          Array.from(node.attributes).forEach(attr => {
            wrapper.setAttribute(attr.name, attr.value);
          });

          while (node.firstChild) {
            const processedChild = processNode(node.firstChild);
            wrapper.appendChild(processedChild);
          }

          return wrapper;
        }

        return node;
      }

      const highlightedContent = processNode(div);
      lastRange.deleteContents();
      lastRange.insertNode(highlightedContent);

      selbar.style.display = 'none';
      showToast('Highlighted');
    }

    function removeHighlight() {
      if (currentHlNode) {
        const parent = currentHlNode.parentNode;
        while (currentHlNode.firstChild) {
          parent.insertBefore(currentHlNode.firstChild, currentHlNode);
        }
        parent.removeChild(currentHlNode);
        parent.normalize();
        currentHlNode = null;
        selbar.style.display = 'none';
        showToast('Highlight removed');
        return;
      }

      if (!lastRange) return;

      const selRect = lastRange.getBoundingClientRect();
      const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
      const toRemove = [];

      while (walker.nextNode()) {
        const node = walker.currentNode;
        if (node.classList && node.classList.contains('hl')) {
          const rect = node.getBoundingClientRect();
          if (!(rect.right < selRect.left || rect.left > selRect.right ||
            rect.bottom < selRect.top || rect.top > selRect.bottom)) {
            toRemove.push(node);
          }
        }
      }

      toRemove.forEach(el => {
        const parent = el.parentNode;
        while (el.firstChild) {
          parent.insertBefore(el.firstChild, el);
        }
        parent.removeChild(el);
        parent.normalize();
      });

      selbar.style.display = 'none';
      showToast('Highlight removed');
    }

    btnHL.addEventListener('click', doHighlight);
    btnUH.addEventListener('click', removeHighlight);

    // 笔记功能
    var notes = document.getElementById('notes');
    var noteArea = document.getElementById('noteArea');
    var btnCopy = document.getElementById('btnCopy');
    var btnClose = document.getElementById('btnClose');

    function toggleNotes() {
      notes.style.display = (notes.style.display === 'flex' ? 'none' : 'flex');
    }
    window.toggleNotes = toggleNotes;

    btnClose.addEventListener('click', toggleNotes);
    btnCopy.addEventListener('click', async function () {
      await navigator.clipboard.writeText(noteArea.value || '');
      showToast('Copied');
    });

    btnNote.addEventListener('click', function () {
      var text = '';
      if (currentHlNode) {
        text = (currentHlNode.textContent || '').trim();
      } else if (lastRange) {
        var frag = lastRange.cloneContents();
        text = (frag.textContent || '').trim();
      }
      toggleNotes();
      if (text) {
        noteArea.value = (noteArea.value ? noteArea.value + '\n' : '') + '> ' + text + '\n';
      }
      selbar.style.display = 'none';
    });

    // 答题状态更新
    function updateAnswerStatus() {
      for (let i = 1; i <= 13; i++) {
        const inputs = document.querySelectorAll(`input[name="q${i}"]`);
        const navItem = document.getElementById(`q${i}-nav`);
        if (navItem) {
          let answered = false;
          inputs.forEach(input => {
            if ((input.type === 'radio' || input.type === 'checkbox') && input.checked) {
              answered = true;
            } else if (input.type === 'text' && input.value.trim()) {
              answered = true;
            }
          });
          if (answered) {
            navItem.classList.add('answered');
          } else {
            navItem.classList.remove('answered');
          }
        }
      }
    }

    // 答案和评分系统
    var answers = {
      "q1": "viii", "q2": "iv", "q3": "ix", "q4": "vi", "q5": "v", "q6": "vii", "q7": "iii", "q8": "x",
      "q9": "D", "q10": "E", "q11": "B", "q12": "G", "q13": "A"
    };

    function grade() {
      var total = 0, correct = 0, lines = [];

      // 检查单选题 (1-13)
      for (let n = 1; n <= 13; n++) {
        const q = `q${n}`;
        total++;
        const selected = document.querySelector(`input[name="${q}"]:checked`);
        const userAnswer = selected ? selected.value : '';
        const isCorrect = userAnswer === answers[q];
        if (isCorrect) correct++;
        lines.push(`${q.toUpperCase()}: ${userAnswer || 'None'} ${isCorrect ? '✓' : '✗'}`);
      }

      // 显示结果
      const acc = Math.round(100 * correct / total);
      document.getElementById('results').innerHTML = `
    <p><strong>Score:</strong> ${correct}/${total} <span class="badge">Accuracy ${acc}%</span></p>
    <pre>${lines.join('\n')}</pre>
  `;

      // 显示答案
      document.getElementById('answerContent').innerHTML = `
    <ol>
      <li>1 → viii</li>
      <li>2 → iv</li>
      <li>3 → ix</li>
      <li>4 → vi</li>
      <li>5 → v</li>
      <li>6 → vii</li>
      <li>7 → iii</li>
      <li>8 → x</li>
      <li>9 → D</li>
      <li>10 → E</li>
      <li>11 → B</li>
      <li>12 → G</li>
      <li>13 → A</li>
    </ol>
  `;
      document.querySelector('#answerBox .badge').textContent = 'tap to view';

      updateAnswerStatus();
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function () {
      startTimer();
      updateAnswerStatus(); // 初始化答题状态

      // 加载保存的主题
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark');
        document.querySelector('.theme-toggle').textContent = '☀️';
      }
    });

    // 监听答案变化
    document.addEventListener('change', updateAnswerStatus);
    document.addEventListener('input', updateAnswerStatus);
  </script>

  <!-- 练习页面数据传输增强脚本 -->
  <script>
    // 检查是否已经有增强脚本
    if (!window.practicePageEnhancer) {
      // 动态加载增强脚本
      const script = document.createElement('script');
      script.src = '../../../js/practice-page-enhancer.js';
      script.onload = function () {
        console.log('练习页面增强脚本已加载');
      };
      script.onerror = function () {
        console.error('练习页面增强脚本加载失败');
        // 降级到内联增强
        loadInlineEnhancer();
      };
      document.head.appendChild(script);
    }

    // 内联增强器（降级方案）
    function loadInlineEnhancer() {
      if (window.practicePageEnhancer) return;

      window.practicePageEnhancer = {
        initialize: function () {
          console.log('[InlineEnhancer] 内联增强器已初始化');
          this.setupCommunication();
          this.setupAnswerListeners();
          this.interceptSubmit();
        },

        setupCommunication: function () {
          this.parentWindow = window.opener || window.parent;
          window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'INIT_SESSION') {
              this.sessionId = event.data.data.sessionId;
              this.sendMessage('SESSION_READY', {
                pageType: this.detectPageType(),
                url: window.location.href
              });
            }
          });
        },

        detectPageType: function () {
          const title = document.title || '';
          if (title.includes('P1')) return 'P1';
          if (title.includes('P2')) return 'P2';
          if (title.includes('P3')) return 'P3';
          return 'unknown';
        },

        setupAnswerListeners: function () {
          this.answers = {};
          this.startTime = Date.now();

          document.addEventListener('change', (e) => {
            if (e.target.name && e.target.name.startsWith('q')) {
              this.answers[e.target.name] = e.target.value;
            }
          });
        },

        interceptSubmit: function () {
          // 拦截grade函数
          if (typeof window.grade === 'function') {
            const originalGrade = window.grade;
            window.grade = () => {
              const result = originalGrade();
              setTimeout(() => this.handleSubmit(), 200);
              return result;
            };
          }

          // 监听提交按钮
          document.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON' &&
              (e.target.textContent.includes('Submit') ||
                e.target.onclick && e.target.onclick.toString().includes('grade'))) {
              setTimeout(() => this.handleSubmit(), 300);
            }
          });
        },

        handleSubmit: function () {
          const results = {
            sessionId: this.sessionId,
            startTime: this.startTime,
            endTime: Date.now(),
            duration: Math.round((Date.now() - this.startTime) / 1000),
            answers: this.answers,
            scoreInfo: this.extractScore(),
            pageType: this.detectPageType(),
            url: window.location.href
          };

          this.sendMessage('PRACTICE_COMPLETE', results);
        },

        extractScore: function () {
          const resultsEl = document.getElementById('results');
          if (!resultsEl) return null;

          const text = resultsEl.textContent || '';
          const scoreMatch = text.match(/Score:\s*(\d+)\/(\d+)/i);
          if (scoreMatch) {
            const correct = parseInt(scoreMatch[1]);
            const total = parseInt(scoreMatch[2]);
            return {
              correct: correct,
              total: total,
              accuracy: total > 0 ? correct / total : 0,
              percentage: Math.round((correct / total) * 100),
              source: 'inline_extraction'
            };
          }
          return null;
        },

        sendMessage: function (type, data) {
          if (this.parentWindow) {
            this.parentWindow.postMessage({
              type: type,
              data: data,
              source: 'practice_page'
            }, '*');
          }
        }
      };

      // 初始化
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          window.practicePageEnhancer.initialize();
        });
      } else {
        window.practicePageEnhancer.initialize();
      }
    }
  </script>

</body>

</html>