<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTSç³»ç»Ÿä¿®å¤æµ‹è¯•è¿è¡Œå™¨</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8fafc;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-section {
            background: white;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background-color 0.2s;
        }
        
        .test-button:hover {
            background: #2563eb;
        }
        
        .test-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .run-all-button {
            background: #10b981;
            font-size: 16px;
            font-weight: 600;
            padding: 16px 32px;
        }
        
        .run-all-button:hover {
            background: #059669;
        }
        
        .test-output {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pending { background: #6b7280; }
        .status-running { background: #f59e0b; }
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #10b981;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .summary {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .summary.success {
            background: #f0fdf4;
            border-color: #10b981;
        }
        
        .summary.warning {
            background: #fffbeb;
            border-color: #f59e0b;
        }
        
        .summary.error {
            background: #fef2f2;
            border-color: #ef4444;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§ª IELTSç³»ç»Ÿä¿®å¤æµ‹è¯•è¿è¡Œå™¨</h1>
        <p>éªŒè¯æ‰€æœ‰ä¿®å¤åŠŸèƒ½çš„å®Œæ•´æ€§å’ŒååŒå·¥ä½œèƒ½åŠ›</p>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•é¡¹ç›®</h2>
        <p>ä»¥ä¸‹æµ‹è¯•å°†éªŒè¯IELTSç³»ç»Ÿä¿®å¤çš„å„ä¸ªæ–¹é¢ï¼š</p>
        
        <div style="margin: 20px 0;">
            <div>
                <span class="status-indicator status-pending" id="status-interaction"></span>
                <button class="test-button" onclick="runSingleTest('interaction')" id="btn-interaction">
                    äº¤äº’ä½“éªŒæ”¹è¿›æµ‹è¯•
                </button>
            </div>
            
            <div>
                <span class="status-indicator status-pending" id="status-markdown"></span>
                <button class="test-button" onclick="runSingleTest('markdown')" id="btn-markdown">
                    Markdownå¯¼å‡ºåŠŸèƒ½æµ‹è¯•
                </button>
            </div>
            
            <div>
                <span class="status-indicator status-pending" id="status-communication"></span>
                <button class="test-button" onclick="runSingleTest('communication')" id="btn-communication">
                    é€šä¿¡é”™è¯¯ä¿®å¤æµ‹è¯•
                </button>
            </div>
            
            <div>
                <span class="status-indicator status-pending" id="status-component"></span>
                <button class="test-button" onclick="runSingleTest('component')" id="btn-component">
                    ç»„ä»¶åŠ è½½ä¼˜åŒ–æµ‹è¯•
                </button>
            </div>
            
            <div>
                <span class="status-indicator status-pending" id="status-integration"></span>
                <button class="test-button" onclick="runSingleTest('integration')" id="btn-integration">
                    é›†æˆæµ‹è¯•
                </button>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="test-button run-all-button" onclick="runAllTests()" id="btn-run-all">
                ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•
            </button>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•è¾“å‡º</h2>
        <div class="test-output" id="test-output">ç­‰å¾…æµ‹è¯•å¼€å§‹...</div>
        
        <div id="test-summary" style="display: none;"></div>
    </div>

    <!-- åŠ è½½æµ‹è¯•è„šæœ¬ -->
    <script src="test-interaction-improvements.js"></script>
    <script src="test-markdown-export.js"></script>
    <script src="test-communication-fixes.js"></script>
    <script src="test-component-loading.js"></script>
    <script src="test-integration-final.js"></script>

    <script>
        let testResults = {};
        let currentTest = null;
        let totalTests = 5;
        let completedTests = 0;

        // é‡å®šå‘console.logåˆ°æµ‹è¯•è¾“å‡º
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        function appendToOutput(message, type = 'log') {
            const output = document.getElementById('test-output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'warn' ? 'âš ï¸' : '';
            output.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        console.log = (...args) => {
            originalConsoleLog.apply(console, args);
            appendToOutput(args.join(' '), 'log');
        };
        
        console.error = (...args) => {
            originalConsoleError.apply(console, args);
            appendToOutput(args.join(' '), 'error');
        };
        
        console.warn = (...args) => {
            originalConsoleWarn.apply(console, args);
            appendToOutput(args.join(' '), 'warn');
        };

        function updateStatus(testId, status) {
            const indicator = document.getElementById(`status-${testId}`);
            const button = document.getElementById(`btn-${testId}`);
            
            indicator.className = `status-indicator status-${status}`;
            
            if (status === 'running') {
                button.disabled = true;
                button.textContent = button.textContent.replace('æµ‹è¯•', 'æµ‹è¯•ä¸­...');
            } else if (status === 'success' || status === 'error') {
                button.disabled = false;
                button.textContent = button.textContent.replace('æµ‹è¯•ä¸­...', 'æµ‹è¯•');
            }
        }

        function updateProgress() {
            const progress = (completedTests / totalTests) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }

        async function runSingleTest(testType) {
            if (currentTest) {
                console.log('å·²æœ‰æµ‹è¯•åœ¨è¿è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ');
                return;
            }

            currentTest = testType;
            updateStatus(testType, 'running');
            
            try {
                let result;
                
                switch (testType) {
                    case 'interaction':
                        console.log('=== å¼€å§‹äº¤äº’ä½“éªŒæ”¹è¿›æµ‹è¯• ===');
                        result = await testInteractionImprovements();
                        break;
                    case 'markdown':
                        console.log('=== å¼€å§‹Markdownå¯¼å‡ºåŠŸèƒ½æµ‹è¯• ===');
                        result = await testMarkdownExport();
                        break;
                    case 'communication':
                        console.log('=== å¼€å§‹é€šä¿¡é”™è¯¯ä¿®å¤æµ‹è¯• ===');
                        result = await testCommunicationFixes();
                        break;
                    case 'component':
                        console.log('=== å¼€å§‹ç»„ä»¶åŠ è½½ä¼˜åŒ–æµ‹è¯• ===');
                        result = await testComponentLoading();
                        break;
                    case 'integration':
                        console.log('=== å¼€å§‹é›†æˆæµ‹è¯• ===');
                        result = await runFinalIntegrationTest();
                        break;
                    default:
                        throw new Error(`æœªçŸ¥æµ‹è¯•ç±»å‹: ${testType}`);
                }
                
                testResults[testType] = result;
                updateStatus(testType, result.successRate >= 80 ? 'success' : 'error');
                
                console.log(`${testType} æµ‹è¯•å®Œæˆ: ${result.passed}/${result.total} é€šè¿‡ (${result.successRate}%)`);
                
            } catch (error) {
                console.error(`${testType} æµ‹è¯•å¤±è´¥:`, error);
                testResults[testType] = { total: 1, passed: 0, failed: 1, successRate: 0, error: error.message };
                updateStatus(testType, 'error');
            } finally {
                currentTest = null;
                completedTests++;
                updateProgress();
            }
        }

        async function runAllTests() {
            if (currentTest) {
                console.log('å·²æœ‰æµ‹è¯•åœ¨è¿è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ');
                return;
            }

            // é‡ç½®çŠ¶æ€
            testResults = {};
            completedTests = 0;
            updateProgress();
            
            // æ¸…ç©ºè¾“å‡º
            document.getElementById('test-output').textContent = '';
            document.getElementById('test-summary').style.display = 'none';
            
            console.log('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰IELTSç³»ç»Ÿä¿®å¤æµ‹è¯•...\n');
            
            const tests = ['interaction', 'markdown', 'communication', 'component', 'integration'];
            
            for (const test of tests) {
                await runSingleTest(test);
                // åœ¨æµ‹è¯•ä¹‹é—´æ·»åŠ çŸ­æš‚å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            // æ˜¾ç¤ºæœ€ç»ˆæ€»ç»“
            showFinalSummary();
        }

        function showFinalSummary() {
            const summaryDiv = document.getElementById('test-summary');
            
            let totalTests = 0;
            let totalPassed = 0;
            let allResults = [];
            
            Object.entries(testResults).forEach(([testType, result]) => {
                totalTests += result.total || 0;
                totalPassed += result.passed || 0;
                allResults.push({
                    name: getTestName(testType),
                    result: result
                });
            });
            
            const overallSuccessRate = totalTests > 0 ? Math.round((totalPassed / totalTests) * 100) : 0;
            
            let summaryClass = 'summary';
            let summaryIcon = 'ğŸ“Š';
            let summaryTitle = 'æµ‹è¯•å®Œæˆ';
            
            if (overallSuccessRate >= 90) {
                summaryClass += ' success';
                summaryIcon = 'ğŸ‰';
                summaryTitle = 'æµ‹è¯•ä¼˜ç§€';
            } else if (overallSuccessRate >= 80) {
                summaryClass += ' success';
                summaryIcon = 'âœ…';
                summaryTitle = 'æµ‹è¯•è‰¯å¥½';
            } else if (overallSuccessRate >= 70) {
                summaryClass += ' warning';
                summaryIcon = 'âš ï¸';
                summaryTitle = 'æµ‹è¯•åŸºæœ¬é€šè¿‡';
            } else {
                summaryClass += ' error';
                summaryIcon = 'âŒ';
                summaryTitle = 'æµ‹è¯•éœ€è¦æ”¹è¿›';
            }
            
            let summaryHTML = `
                <div class="${summaryClass}">
                    <h3>${summaryIcon} ${summaryTitle}</h3>
                    <p><strong>æ•´ä½“æˆåŠŸç‡: ${overallSuccessRate}%</strong> (${totalPassed}/${totalTests} æµ‹è¯•é€šè¿‡)</p>
                    
                    <h4>å„æµ‹è¯•æ¨¡å—ç»“æœ:</h4>
                    <ul>
            `;
            
            allResults.forEach(item => {
                const status = item.result.successRate >= 80 ? 'âœ…' : 'âŒ';
                summaryHTML += `<li>${status} ${item.name}: ${item.result.passed}/${item.result.total} (${item.result.successRate}%)</li>`;
            });
            
            summaryHTML += `
                    </ul>
                    
                    <p style="margin-top: 15px; font-size: 14px; color: #6b7280;">
                        æµ‹è¯•å®Œæˆæ—¶é—´: ${new Date().toLocaleString()}
                    </p>
                </div>
            `;
            
            summaryDiv.innerHTML = summaryHTML;
            summaryDiv.style.display = 'block';
            
            console.log(`\nğŸ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼æ•´ä½“æˆåŠŸç‡: ${overallSuccessRate}%`);
        }

        function getTestName(testType) {
            const names = {
                'interaction': 'äº¤äº’ä½“éªŒæ”¹è¿›',
                'markdown': 'Markdownå¯¼å‡ºåŠŸèƒ½',
                'communication': 'é€šä¿¡é”™è¯¯ä¿®å¤',
                'component': 'ç»„ä»¶åŠ è½½ä¼˜åŒ–',
                'integration': 'é›†æˆæµ‹è¯•'
            };
            return names[testType] || testType;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('IELTSç³»ç»Ÿä¿®å¤æµ‹è¯•è¿è¡Œå™¨å·²å°±ç»ª');
            console.log('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•ï¼Œæˆ–ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"è¿›è¡Œå®Œæ•´éªŒè¯');
        });
    </script>
</body>
</html>